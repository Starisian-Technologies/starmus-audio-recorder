# phpstan.neon.dist

includes:
  - phpstan-baseline.neon

parameters:
  reportUnmatchedIgnoredErrors: false
  level: 6
  paths:
    - src
    - starmus-audio-recorder.php
    - uninstall.php

  tmpDir: .phpstan-cache

  # Configure WordPress-specific settings
  bootstrapFiles:
    - tests/wordpress-mocks.php

  # WordPress stubs for core function and constant discovery
  stubFiles:
    - vendor/php-stubs/wordpress-stubs/wordpress-stubs.php

  # Consolidated and cleaned-up exclusion paths
  excludePaths:
    analyse:
      # Exclude the entire vendor directory from *source code* analysis
      - vendor/*
      # Exclude other known directories
      - node_modules/*
      - tests/*
      - wp-admin/*
      - wp-content/*
      - wordpress-installer/*
      - src/cli/*

  # Consolidated and cleaned-up ignore errors
  ignoreErrors:
    # WordPress/ACF functions and methods
    - '#Call to an undefined method ACF#'
    - '#Function get_field not found#'
    - '#Undefined variable: \$wpdb#'
    - '#Access to an undefined property#'

    # Core PHP functions that PHPStan doesn't recognize
    - '#Undefined function .*(defined|function_exists|class_exists|file_exists|dirname|intval|array_unique|max|ceil|rawurlencode|usort|array_slice)#'

    # Standard exception types
    - '#Undefined type .*(Throwable|RuntimeException|LogicException)#'

    # Plugin constants defined elsewhere
    - '#Constant STARMUS_URL not found#'
    - '#Constant STARMUS_PATH not found#'
    - '#Undefined constant.*STARMUS_DAL_OVERRIDE_KEY#'

    # Missing service classes (to be implemented)
    - '#Use of unknown class.*StarmusStatsDataService#'
    - '#has unknown class.*StarmusStatsDataService#'
    - '#invalid type.*StarmusStatsDataService#'

    # WordPress-specific patterns
    - '#Method.*has parameter.*with generic class WP_REST_Request but does not specify its types#'

    # Allow African runtime monitoring patterns
    - '#error_log.*STARMUS PHP.*is not allowed#'
    - '#Call to function set_error_handler.*not found#'
