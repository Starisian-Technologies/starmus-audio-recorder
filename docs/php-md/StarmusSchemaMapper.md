# StarmusSchemaMapper

**Namespace:** `Starisian\Sparxstar\Starmus\helpers`

**File:** `/workspaces/starmus-audio-recorder/src/helpers/StarmusSchemaMapper.php`

## Description

Schema field mapping helper for the Unified Archival Schema migration.
@package Starisian\Sparxstar\Starmus\helpers

## Methods

### `map_field_name()`

**Visibility:** `public`

Schema field mapping helper for the Unified Archival Schema migration.
@package Starisian\Sparxstar\Starmus\helpers
/
namespace Starisian\Sparxstar\Starmus\helpers;

if ( ! \defined( 'ABSPATH' ) ) {
	exit;
}

/**
Handles field mapping between legacy and new unified archival schema.
/
final class StarmusSchemaMapper {

	/**
Legacy to new field mappings for audio recordings.
/
	private const FIELD_MAPPINGS = array(
		// Legacy -> New Schema
		'audio_file'             => 'original_source',
		'recorded_by_user_id'    => 'subject_user_id',
		'consent_timestamp'      => 'agreement_datetime',
		'consent_ip'             => 'contributor_ip',
		'starmus_title'          => 'dc_creator',
		'filename'               => 'dc_creator',
		'dc_creator'             => 'dc_creator', // Direct mapping
		'_audio_mp3_path'        => 'mastered_mp3',
		'_audio_wav_path'        => 'archival_wav',
		'_starmus_archival_path' => 'archival_wav',
		// JavaScript field mappings
		'_starmus_env'           => 'environment_data',
		'_starmus_calibration'   => 'transcriber',
		// Additional new mappings
		'user_agent'             => 'contributor_user_agent',
		'submission_url'         => 'url',
		'agreement_to_terms'     => 'agreement_to_terms_toggle',
		'recording_type'         => 'recording_type', // Direct mapping
		'language'               => 'language', // Direct mapping
	);

	/**
JSON fields that need encoding/decoding.
/
	private const JSON_FIELDS = array(
		'school_reviewed',
		'qa_review',
		'transcriber',
		'translator',
		'ai_training',
		'ai_trained',
		'waveform_json',
		'parental_permission_slip',
		'contributor_verification',
		'transcribed',
		'translated',
		'environment_data',
		'recording_metadata',
	);

	/**
Fields that should be initialized as empty JSON if missing.
/
	private const REQUIRED_JSON_FIELDS = array(
		'school_reviewed'  => '{}',
		'qa_review'        => '{}',
		'transcriber'      => '{}',
		'translator'       => '{}',
		'ai_training'      => '{}',
		'ai_trained'       => '{}',
		'environment_data' => '{}',
	);

	/**
Map legacy field name to new schema field name.

### `is_json_field()`

**Visibility:** `public`

Check if field should be JSON encoded.

### `prepare_field_value()`

**Visibility:** `public`

Prepare field value for storage based on field type.

### `get_field_value()`

**Visibility:** `public`

Get field value from storage, decoding JSON if needed.

### `map_form_data()`

**Visibility:** `public`

Map form data to new schema fields.

### `extract_user_ids()`

**Visibility:** `public`

Extract user ID mappings from form data.

### `map_environment_data()`

**Visibility:** `public`

Map environment and calibration data to schema fields.

---

_Generated by Starisian Documentation Generator_
