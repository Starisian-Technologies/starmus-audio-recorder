# StarmusFileService

**Namespace:** `Starisian\Sparxstar\Starmus\services`

**File:** `/workspaces/starmus-audio-recorder/src/services/StarmusFileService.php`

## Description

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
StarmusFileService (DAL-integrated)
----------------------------
- Guarantees local access for offloaded files.
- Routes all persistence and attachment updates through DAL.
- Supports external offloaders like WP Offload Media (AS3CF).
@package Starisian\Sparxstar\Starmus\services
@version 0.8.5-dal

## Methods

### `get_local_copy()`

**Visibility:** `public`

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
StarmusFileService (DAL-integrated)
----------------------------
- Guarantees local access for offloaded files.
- Routes all persistence and attachment updates through DAL.
- Supports external offloaders like WP Offload Media (AS3CF).
@package Starisian\Sparxstar\Starmus\services
@version 0.8.5-dal
/
namespace Starisian\Sparxstar\Starmus\services;

if (! \defined('ABSPATH')) {
    exit;
}

use Starisian\Sparxstar\Starmus\core\StarmusAudioRecorderDAL;

final readonly class StarmusFileService
{
    private StarmusAudioRecorderDAL $dal;

    public function __construct(?StarmusAudioRecorderDAL $dal = null)
    {
        $this->dal = $dal ?: new StarmusAudioRecorderDAL();
    }

    /**
Guarantees a local copy of an attachment's file is available for processing.
If offloaded, downloads it to a temp path and returns the local copy.
The caller is responsible for cleanup.

### `upload_and_replace_attachment()`

**Visibility:** `public`

Uploads or re-attaches a local file via offloader or DAL fallback.

### `star_get_public_url()`

**Visibility:** `public`

Returns the correct public URL for an attachment.
- Honors external offloaders (AS3CF, Cloudflare, etc.)
- Falls back to wp_get_attachment_url()
- Normalizes HTTPS and Base URL mismatches
@param int $attachment_id Attachment ID to resolve URL for.
@return string|null Public URL or null if attachment not found.

---

_Generated by Starisian Documentation Generator_
