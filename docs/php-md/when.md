# when

**Namespace:** `Starisian\Sparxstar\Starmus\cron`

**File:** `/workspaces/starmus-audio-recorder/src/cron/StarmusCron.php`

## Description

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
Asynchronous background processor for the Starmus mastering pipeline.
Handles waveform generation, post-processing, and temp cleanup via WP-Cron.
@package   Starisian\Sparxstar\Starmus\cron
@version   0.8.5

## Methods

### `register_hooks()`

**Visibility:** `public`

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
Asynchronous background processor for the Starmus mastering pipeline.
Handles waveform generation, post-processing, and temp cleanup via WP-Cron.
@package   Starisian\Sparxstar\Starmus\cron
@version   0.8.5
/
namespace Starisian\Sparxstar\Starmus\cron;

if (! \defined('ABSPATH')) {
    exit;
}

use Starisian\Sparxstar\Starmus\helpers\StarmusLogger;
use Starisian\Sparxstar\Starmus\services\StarmusPostProcessingService;
use Starisian\Sparxstar\Starmus\services\StarmusWaveformService;

use function trailingslashit;

/**
StarmusCron
Coordinates deferred waveform + mastering jobs and periodic cleanup.
Use this class when you want to run heavy audio post-processing
safely in the background after uploads.
/
final readonly class StarmusCron
{
    /** Single-run job for background mastering. */
    public const PROCESS_AUDIO_HOOK = 'starmus_process_audio_attachment';

    /** Recurring hourly cleanup for stale temp upload chunks. */
    public const CLEANUP_TEMP_FILES_HOOK = 'starmus_cleanup_temp_files';

    private StarmusWaveformService $waveform;

    private StarmusPostProcessingService $post;

    public function __construct(
        ?StarmusWaveformService $waveform_service = null,
        ?StarmusPostProcessingService $post_service = null
    ) {
        $this->waveform = $waveform_service ?: new StarmusWaveformService();
        $this->post     = $post_service ?: new StarmusPostProcessingService();
    }

    /** Registers WP hooks for both the processor and cleanup jobs.

### `schedule_audio_processing()`

**Visibility:** `public`

Queue a background mastering job for a given attachment.

### `run_audio_processing_pipeline()`

**Visibility:** `public`

Executes the full pipeline asynchronously.

### `cleanup_stale_temp_files()`

**Visibility:** `public`

Remove stale temp upload files (>24h old).

### `activate()`

**Visibility:** `public`

Schedule recurring cleanup on plugin activation.

### `deactivate()`

**Visibility:** `public`

Unschedule cleanup on deactivation.

### `register_custom_schedules()`

**Visibility:** `public`

Optional 15-minute schedule.

---

_Generated by Starisian Documentation Generator_
