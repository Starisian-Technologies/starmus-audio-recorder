# when

**Namespace:** `Starisian\Sparxstar\Starmus\cron`

**File:** `/workspaces/starmus-audio-recorder/src/cron/StarmusCron.php`

## Description

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
Asynchronous background processor for the Starmus mastering pipeline.
Handles waveform generation, post-processing, and temp cleanup via WP-Cron.
@package   Starisian\Sparxstar\Starmus\cron
@version 0.9.2

## Methods

### `__construct()`

**Visibility:** `public`

STARISIAN TECHNOLOGIES CONFIDENTIAL
© 2023–2025 Starisian Technologies. All Rights Reserved.
Asynchronous background processor for the Starmus mastering pipeline.
Handles waveform generation, post-processing, and temp cleanup via WP-Cron.
@package   Starisian\Sparxstar\Starmus\cron
@version 0.9.2
/
namespace Starisian\Sparxstar\Starmus\cron;

use function add_action;
use function add_filter;

use Starisian\Sparxstar\Starmus\helpers\StarmusLogger;
use Starisian\Sparxstar\Starmus\services\StarmusAudioPipeline;
use Starisian\Sparxstar\Starmus\services\StarmusPostProcessingService;
use Starisian\Sparxstar\Starmus\services\StarmusWaveformService;
use Throwable;

use function time;
use function trailingslashit;
use function wp_delete_file;
use function wp_get_upload_dir;
use function wp_mkdir_p;
use function wp_next_scheduled;
use function wp_schedule_event;
use function wp_unschedule_event;

if ( ! \defined('ABSPATH')) {
    exit;
}

/**
StarmusCron
Coordinates deferred waveform + mastering jobs and periodic cleanup.
Use this class when you want to run heavy audio post-processing
safely in the background after uploads.
/
final readonly class StarmusCron
{
    /** Single-run job for background mastering. */
    public const PROCESS_AUDIO_HOOK = 'starmus_process_audio_attachment';

    /** Recurring hourly cleanup for stale temp upload chunks. */
    public const CLEANUP_TEMP_FILES_HOOK = 'starmus_cleanup_temp_files';

    /**
Waveform service instance.
/
    private ?StarmusWaveformService $waveform;

    /**
Post-processing service instance.
/
    private ?StarmusPostProcessingService $post;

    private ?StarmusAudioPipeline $pipeline;

    /**
Builds the cron coordinator with optional injected services.
@param StarmusWaveformService|null $waveform_service Waveform generation dependency
@param StarmusPostProcessingService|null $post_service Post-processing dependency

### `register_hooks()`

**Visibility:** `public`

Registers WP hooks for both the processor and cleanup jobs.

### `schedule_audio_processing()`

**Visibility:** `public`

Queue a background mastering job for a given attachment.

### `run_audio_processing_pipeline()`

**Visibility:** `public`

Executes the full pipeline asynchronously.
@param int $attachment_id WordPress attachment ID for processing.

### `cleanup_stale_temp_files()`

**Visibility:** `public`

Remove stale temp upload files (>24h old).

### `starmus_activate()`

**Visibility:** `public`

Schedule recurring cleanup on plugin activation.

### `starmus_deactivate()`

**Visibility:** `public`

Unschedule cleanup on deactivation.

### `register_custom_schedules()`

**Visibility:** `public`

Optional 15-minute schedule.

## Properties

---

_Generated by Starisian Documentation Generator_
