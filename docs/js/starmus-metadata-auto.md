# starmus-metadata-auto.js

**Source:** `src/js/starmus-metadata-auto.js`

---

## Modules

<dl>
<dt><a href="#module_initAutoMetadata">initAutoMetadata</a> ⇒ <code>function</code></dt>
<dd><p>State mapping:</p>
<ul>
<li><code>state.calibration</code> → <code>_starmus_calibration</code> (when calibration.complete is true)</li>
<li><code>state.env</code> → <code>_starmus_env</code> (UEC browser/device data)</li>
<li><code>state.calibration</code> data → <code>_starmus_calibration</code></li>
<li><code>state.source.metadata</code> → <code>recording_metadata</code> (technical audio data)</li>
<li><code>state.source.waveform</code> → <code>waveform_json</code> (visualization data)</li>
</ul>
</dd>
</dl>

## Functions

<dl>
<dt><a href="#updateField">updateField(form, name, value)</a> ⇒ <code>void</code></dt>
<dd><p>Safety features:</p>
<ul>
<li>Creates hidden input if it doesn&#39;t exist</li>
<li>Converts objects to JSON strings automatically</li>
<li>Protects existing PHP-injected values from being overwritten by empty JS values</li>
<li>Only updates if the value has actually changed</li>
<li>Skips updates when trying to overwrite non-empty values with empty ones</li>
</ul>
</dd>
</dl>

<a name="module_initAutoMetadata"></a>

## initAutoMetadata ⇒ <code>function</code>

State mapping:

- `state.calibration` → `_starmus_calibration` (when calibration.complete is true)
- `state.env` → `_starmus_env` (UEC browser/device data)
- `state.calibration` data → `_starmus_calibration`
- `state.source.metadata` → `recording_metadata` (technical audio data)
- `state.source.waveform` → `waveform_json` (visualization data)

**Returns**: <code>function</code> - A cleanup function. Call this during component
unmounting or page transitions to prevent the sync listener from
firing on a non-existent form.  

| Param | Type | Description |
| --- | --- | --- |
| store | <code>Object</code> | Redux-style store with getState, subscribe methods |
| store.getState | <code>function</code> | Function to get current application state |
| store.subscribe | <code>function</code> | Function to subscribe to state changes |
| formEl | <code>HTMLFormElement</code> | Form element to sync metadata fields to |
| [options] | <code>Object</code> | Configuration options (currently unused) |

**Example**  

```js
// Basic initialization
const unsubscribe = initAutoMetadata(store, document.querySelector('form'));
```

**Example**  

```js
// With cleanup
const cleanup = initAutoMetadata(store, formElement);
// Later: cleanup() to stop synchronization
```

**Example**  

```js
// State structure expected:
const state = {
  calibration: { complete: true, gain: 0.8, speechLevel: 'good' },
  env: { browser: 'Chrome', device: 'mobile' },
  source: {
    transcript: 'Hello world',
    interimTranscript: 'how are',
    metadata: { sampleRate: 44100, format: 'webm' },
    waveform: [0.1, 0.2, 0.3]
  }
};
```

<a name="module_initAutoMetadata..sync"></a>

### initAutoMetadata~sync() ⇒ <code>void</code>

Synchronizes current store state to form fields.
Called initially and whenever store state changes.

**Kind**: inner method of [<code>initAutoMetadata</code>](#module_initAutoMetadata)  
<a name="updateField"></a>

## updateField(form, name, value) ⇒ <code>void</code>

Safety features:

- Creates hidden input if it doesn't exist
- Converts objects to JSON strings automatically
- Protects existing PHP-injected values from being overwritten by empty JS values
- Only updates if the value has actually changed
- Skips updates when trying to overwrite non-empty values with empty ones

**Kind**: global function  
**Important**: If input.value exists (server-side injection), it is protected
against 'Zero-ing out'. Updates only occur if stringValue is
non-empty AND different from current value.  

| Param | Type | Description |
| --- | --- | --- |
| form | <code>HTMLFormElement</code> | Form element containing the input fields |
| name | <code>string</code> | Name attribute for the input field |
| value | <code>\*</code> | Value to set (objects are JSON.stringify'd) |

**Example**  

```js
// Update calibration data
updateField(form, '_starmus_calibration', { gain: 0.8, level: 'good' });
```

**Example**  

```js
// Create new transcript field
updateField(form, 'session_date', '2024-01-01');
```

**Example**  

```js
// Protected update - won't overwrite existing PHP value with empty string
updateField(form, 'existing_field', ''); // Skipped if field has value
```

---

_Generated by Starisian JS Documentation Generator_
