#!/usr/bin/env node

/**
 * Auto-generate JS documentation for Starisian plugins.
 * Scans /src/js and outputs Markdown docs into /docs/js.
 * 
 * SPDX-FileCopyrightText: 2023-2025 Starisian Technologies
 * SPDX-License-Identifier: MIT
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import jsdoc2md from 'jsdoc-to-markdown';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const SRC = path.resolve(__dirname, '../src/js');
const OUT = path.resolve(__dirname, '../docs/js');

if (!fs.existsSync(OUT)) {
  fs.mkdirSync(OUT, { recursive: true });
}

async function generate() {
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log('üìö JS DOCUMENTATION GENERATOR');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log(`\nüìÇ Source: ${SRC}`);
  console.log(`üìÇ Output: ${OUT}\n`);

  const files = fs.readdirSync(SRC).filter((f) => f.endsWith('.js'));

  let count = 0;

  for (const file of files) {
    const filePath = path.join(SRC, file);
    const outFile = path.join(OUT, file.replace('.js', '.md'));

    try {
      console.log(`‚úì Generating ${file} ‚Üí ${path.basename(outFile)}`);

      const output = await jsdoc2md.render({
        files: filePath,
        'no-cache': true,
        'heading-depth': 2,
      });

      // Add header
      const header = `# ${file}\n\n**Source:** \`src/js/${file}\`\n\n---\n\n`;
      const footer = `\n\n---\n\n_Generated by Starisian JS Documentation Generator_\n`;

      fs.writeFileSync(outFile, header + output + footer);
      count++;
    } catch (err) {
      console.error(`‚úó Error processing ${file}:`, err.message);
    }
  }

  console.log('\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log(`‚úÖ Documentation complete: ${count} files`);
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n');
}

generate().catch((err) => {
  console.error('‚ùå [JS DOCS] Fatal error:', err);
  process.exit(1);
});
