!function(t,e){"use strict";const r="[Starmus UI Controller]";function s(t){return e.getElementById(t)}function n(t){return"string"==typeof t&&/^[a-zA-Z0-9_-]{1,100}$/.test(t)}const o=t.StarmusHooks;function i(t,e,r="info"){if(!n(t))return;const o=s(`starmus_recorder_status_${t}`)||s(`starmus_step1_usermsg_${t}`);var i;o&&(o.textContent="string"!=typeof(i=e)?"":i.replace(/[\x00-\x1F\x7F<>"'&]/g," ").substring(0,500),o.setAttribute("data-status",r),o.style.display=e?"block":"none")}function a(e){if(!n(e))return;s(`starmus_recorder_container_${e}`);setInterval(()=>{if(!n(e))return;const r=t.StarmusAudioRecorder.instances[e],o=s(`starmus_timer_${e}`);if(r?.isRecording&&!r.isPaused&&o){const t=Date.now()-r.startTime,e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);o.textContent=String(e).padStart(2,"0")+":"+String(s).padStart(2,"0")}},1e3)}function u(e){if(!n(e))return;const o=s(`starmus_step1_${e}`),u=s(`starmus_step2_${e}`);let c=!0;for(const t of o.querySelectorAll("[required]"))if(!t.checkValidity()){i(e,"Please complete all required fields.","error"),"function"==typeof t.reportValidity&&t.reportValidity(),c=!1;break}c&&(o.style.display="none",u.style.display="block",i(e,"","info"),t.StarmusSubmissionsHandler.initRecorder(e).then(()=>{a(e)}).catch(t=>{var e,s,n;e="error",s="Recorder init failed, reverting to step 1.",n=t?.message,console&&console[e]&&console[e](r,s,n||""),o.style.display="block",u.style.display="none"}))}function c(e){const r=e.id;e.getAttribute("data-starmus-bound")||(e.setAttribute("data-starmus-bound","1"),s(`starmus_continue_btn_${r}`).addEventListener("click",()=>u(r)),e.addEventListener("submit",s=>{s.preventDefault(),t.StarmusSubmissionsHandler.handleSubmit(r,e)}))}o.addAction("starmus_hooks_ready",function(){e.querySelectorAll("form.starmus-audio-form").forEach(c),o.doAction("starmus_ui_ready")}),t.StarmusUIController={updateRecorderUI:function(t,e){n(t)},showUserMessage:i,buildRecorderUI:a}}(window,document);