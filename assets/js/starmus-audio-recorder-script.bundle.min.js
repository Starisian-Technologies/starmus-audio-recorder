!function(){"use strict";!function(e){if(e.Starmus=e.Starmus||{},e.STARMUS_EDITOR_DATA?(e.STARMUS_BOOTSTRAP=e.STARMUS_EDITOR_DATA,e.STARMUS_BOOTSTRAP.pageType="editor"):e.STARMUS_RERECORDER_DATA?(e.STARMUS_BOOTSTRAP=e.STARMUS_RERECORDER_DATA,e.STARMUS_BOOTSTRAP.pageType="rerecorder"):e.STARMUS_RECORDER_DATA&&(e.STARMUS_BOOTSTRAP=e.STARMUS_RECORDER_DATA,e.STARMUS_BOOTSTRAP.pageType="recorder"),e.Starmus_DisableOptionalNodes=!0,e.Starmus_DisableOptionalNodes){var t=(e.AudioContext||e.webkitAudioContext||{}).prototype;t&&(t.createConstantSource&&(t.createConstantSource=function(){throw new Error("ConstantSourceNode disabled")}),t.createIIRFilter&&(t.createIIRFilter=function(){throw new Error("IIRFilterNode disabled")}))}!function(e){try{if("function"==typeof e.Peaks||"object"==typeof e.Peaks)return void(e.Starmus.Peaks=e.Peaks);Object.defineProperty(e,"Peaks",{get:function(){return e.Starmus.Peaks},set:function(t){e.Starmus.Peaks=t},configurable:!0})}catch(e){console.warn("[Starmus] Peaks.js exposure failed:",e)}}(e);var r=e.StarmusHooks,a=e.StarmusStateStore,n=e.StarmusUI_initInstance,o=e.StarmusCore_init,i=e.StarmusOffline_init;if(r&&a&&n&&o&&i){e.StarmusApp=e.StarmusApp||{},e.StarmusApp.isRecordingSupported=f,i().catch(function(e){console.error("[Starmus] Offline queue init failed:",e)});var s={},c=!1,u=null;document.addEventListener("sparxstar:environment-ready",function(e){c=!0,u&&(clearTimeout(u),u=null),p(e)}),u=setTimeout(function(){c||(console.warn("[Starmus] environment-ready not fired; using fallback."),g())},2e3),e.Starmus.instances=s}else console.error("[Starmus Integrator] Critical dependencies missing — cannot initialize.");function d(t,r){try{e.StarmusHooks&&"function"==typeof e.StarmusHooks.doAction&&e.StarmusHooks.doAction("starmus_event",{instanceId:r.instanceId||null,event:t,severity:r.severity||"info",message:r.message||"",data:r.data||{}})}catch(e){console.warn("[Starmus] Global telemetry emit failed:",e)}}function l(){try{return navigator.deviceMemory||null}catch(e){return null}}function m(){try{return navigator.hardwareConcurrency||null}catch(e){return null}}function f(){try{var t=!(!navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia),r="function"==typeof e.MediaRecorder,a=!(!e.AudioContext&&!e.webkitAudioContext);return t&&r&&a}catch(e){return!1}}function S(e,t,r){var a=document.createElement("script");a.src=e,a.async=!0,a.onload=t,a.onerror=r,document.head.appendChild(a)}function y(t,r){var i=r.getAttribute("data-starmus-id");if(i||(i="starmus_"+Date.now()+"_"+Math.random().toString(16).slice(2),r.setAttribute("data-starmus-id",i)),s[i])return i;var c=function(e){var t=e.capabilities||{},r=e.network||{};if(/\bCrOS\b|Chrome OS/i.test(navigator.userAgent))return"A";if(!t.mediaRecorder||!t.webrtc)return"C";var a=l(),n=m();if(a&&a<1)return"C";if(n){if(1===n)return"C";if(2===n)return"B"}return/wv|Crosswalk|Android WebView|Opera Mini/i.test(navigator.userAgent)?"C":"2g"===r.effectiveType||"slow-2g"===r.effectiveType||a&&a<2?"B":"A"}(t);(async function(e){if("C"===e)return"C";if(navigator.storage&&navigator.storage.estimate)try{var t=((await navigator.storage.estimate()).quota||0)/1024/1024;if(t&&t<80)return"C"}catch(e){}if(navigator.permissions&&navigator.permissions.query)try{if("denied"===(await navigator.permissions.query({name:"microphone"})).state)return"C"}catch(e){}return e})(c).then(function(c){console.log("[Starmus] Instance",i,"-> Tier",c),d("TIER_ASSIGN",{instanceId:i,severity:"info",message:"Tier "+c+" assigned",data:{tier:c}});var u=a({instanceId:i,env:t,tier:c});u.getState().tier||u.dispatch({type:"starmus/tier-ready",payload:{tier:c}});var l={step1:r.querySelector(".starmus-step-1"),step2:r.querySelector(".starmus-step-2"),continueBtn:r.querySelector('[data-starmus-action="continue"]'),messageBox:r.querySelector("[data-starmus-message-box]"),setupMicBtn:r.querySelector('[data-starmus-action="setup-mic"]'),recordBtn:r.querySelector('[data-starmus-action="record"]'),pauseBtn:r.querySelector('[data-starmus-action="pause"]'),resumeBtn:r.querySelector('[data-starmus-action="resume"]'),stopBtn:r.querySelector('[data-starmus-action="stop"]'),submitBtn:r.querySelector('[data-starmus-action="submit"]'),resetBtn:r.querySelector('[data-starmus-action="reset"]'),fileInput:r.querySelector('input[type="file"]'),statusEl:r.querySelector("[data-starmus-status]"),progressEl:r.querySelector("[data-starmus-progress]"),progressWrap:r.querySelector(".starmus-progress-wrap"),recorderContainer:r.querySelector("[data-starmus-recorder-container]"),fallbackContainer:r.querySelector("[data-starmus-fallback-container]")};n(u,l),o(u,i,t),"C"!==c&&f()?S("starmus-recorder.js",function(){"function"==typeof e.initStarmusRecorder?e.initStarmusRecorder(u,i):(console.warn("[Starmus] Recorder init missing — falling back"),S("starmus-recorder-legacy.js",function(){"function"==typeof e.initStarmusRecorderLegacy?e.initStarmusRecorderLegacy(u,i):u.dispatch({type:"starmus/error",payload:{message:"Recorder init failed",retryable:!1}})}))},function(){console.warn("[Starmus] Full recorder load failed — falling back to legacy"),S("starmus-recorder-legacy.js",function(){"function"==typeof e.initStarmusRecorderLegacy?e.initStarmusRecorderLegacy(u,i):u.dispatch({type:"starmus/error",payload:{message:"Recorder fallback load failed",retryable:!1}})})}):(l.recorderContainer&&(l.recorderContainer.style.display="none"),l.fallbackContainer&&(l.fallbackContainer.style.display="block"),S("starmus-recorder-legacy.js",function(){"function"==typeof e.initStarmusRecorderLegacy?e.initStarmusRecorderLegacy(u,i):u.dispatch({type:"starmus/error",payload:{message:"Legacy recorder not available",retryable:!1}})},function(){console.error("[Starmus] Failed to load legacy recorder."),u.dispatch({type:"starmus/error",payload:{message:"Legacy recorder load failed",retryable:!1}})})),s[i]={store:u,form:r,elements:l,tier:c}})}function p(e){var t=e.detail||{},r=document.querySelectorAll('form[data-starmus="recorder"]');if(r&&0!==r.length)for(var a=0;a<r.length;a++)y(t,r[a])}function g(){var t=function(){try{return navigator.connection||navigator.mozConnection||navigator.webkitConnection||null}catch(e){return null}}()||{},r={browser:{userAgent:navigator.userAgent},device:{type:/mobile|android|iphone|ipad/i.test(navigator.userAgent)?"mobile":"desktop",memory:l(),concurrency:m()},capabilities:{webrtc:!(!navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia),mediaRecorder:!!e.MediaRecorder,indexedDB:!!e.indexedDB},network:{effectiveType:t.effectiveType||"unknown",downlink:t.downlink||null,saveData:t.saveData||!1}};d("E_ENV_FALLBACK_INIT",{severity:"warning",message:"Fallback env used",data:{fallbackEnv:r}}),p({detail:r})}}("undefined"!=typeof window?window:globalThis)}();
