!function(){"use strict";const t=Math.PI/180;const e="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},n={_global:e,version:"10.0.12",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:e=>n.angleDeg?e*t:e,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>n.DD.isDragging,isTransforming(){var t,e;return null!==(e=null===(t=n.Transformer)||void 0===t?void 0:t.isTransforming())&&void 0!==e&&e},isDragReady:()=>!!n.DD.node,releaseCanvasOnDestroy:!0,document:e.document,_injectGlobal(t){void 0!==e.Konva&&console.error("Several Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),e.Konva=t}},i=t=>{n[t.prototype.getClassName()]=t};n._injectGlobal(n);const r=()=>{if("undefined"==typeof document)throw new Error('Konva.js unsupported environment.\n\nLooks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.\n\nTo use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.\n\nbash: npm install canvas\njs: import "konva/canvas-backend";\n\nor\n\nbash: npm install skia-canvas\njs: import "konva/skia-backend";\n')};class o{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new o(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){const e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.m[0]*e+this.m[2]*n,r=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,a=this.m[1]*-n+this.m[3]*e;return this.m[0]=i,this.m[1]=r,this.m[2]=o,this.m[3]=a,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){const n=this.m[0]+this.m[2]*e,i=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=i,this.m[2]=r,this.m[3]=o,this}multiply(t){const e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=a,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=a,this}getMatrix(){return this.m}decompose(){const t=this.m[0],e=this.m[1],n=this.m[2],i=this.m[3],r=t*i-e*n,o={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){const a=Math.sqrt(t*t+e*e);o.rotation=e>0?Math.acos(t/a):-Math.acos(t/a),o.scaleX=a,o.scaleY=r/a,o.skewX=(t*n+e*i)/r,o.skewY=0}else if(0!=n||0!=i){const a=Math.sqrt(n*n+i*i);o.rotation=Math.PI/2-(i>0?Math.acos(-n/a):-Math.acos(n/a)),o.scaleX=r/a,o.scaleY=a,o.skewX=0,o.skewY=(t*n+e*i)/r}return o.rotation=g._getRotation(o.rotation),o}}const a=Math.PI/180,s=180/Math.PI,h="#",l="Konva error: ",u={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},c=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let d=[],f=null;const p="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},g={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;const e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){d.push(t),1===d.length&&p(function(){const t=d;d=[],t.forEach(function(t){t()})})},createCanvasElement(){r();const t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>(r(),document.createElement("img")),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){const n=g.createImageElement();n.onload=function(){e(n)},n.src=t},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace(h,"");const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){let t=(16777215*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return h+t},isCanvasFarblingActive(){if(null!==f)return f;if("undefined"==typeof document)return f=!1,!1;const t=this.createCanvasElement();t.width=10,t.height=10;const e=t.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,10,10),e.fillStyle="#282828",e.fillRect(0,0,10,10);const n=e.getImageData(0,0,10,10).data;let i=!1;for(let t=0;t<100;t++)if(40!==n[4*t]||40!==n[4*t+1]||40!==n[4*t+2]||255!==n[4*t+3]){i=!0;break}return f=i,this.releaseCanvas(t),f},getHitColor(){const t=this.getRandomColor();return this.isCanvasFarblingActive()?this.getSnappedHexColor(t):t},getHitColorKey(t,e,n){return this.isCanvasFarblingActive()&&(t=5*Math.round(t/5),e=5*Math.round(e/5),n=5*Math.round(n/5)),h+this._rgbToHex(t,e,n)},getSnappedHexColor(t){const e=this._hexToRgb(t);return h+this._rgbToHex(5*Math.round(e.r/5),5*Math.round(e.g/5),5*Math.round(e.b/5))},getRGB(t){let e;return t in u?(e=u[t],{r:e[0],g:e[1],b:e[2]}):t[0]===h?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=c.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",g._namedColorToRBA(t)||g._hex3ColorToRGBA(t)||g._hex4ColorToRGBA(t)||g._hex6ColorToRGBA(t)||g._hex8ColorToRGBA(t)||g._rgbColorToRGBA(t)||g._rgbaColorToRGBA(t)||g._hslColorToRGBA(t)),_namedColorToRBA(t){const e=u[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){const e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){const e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),i=Number(n[0])/360,r=Number(n[1])/100,o=Number(n[2])/100;let a,s,h;if(0===r)return h=255*o,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};a=o<.5?o*(1+r):o+r-o*r;const l=2*o-a,u=[0,0,0];for(let t=0;t<3;t++)s=i+1/3*-(t-1),s<0&&s++,s>1&&s--,h=6*s<1?l+6*(a-l)*s:2*s<1?a:3*s<2?l+(a-l)*(2/3-s)*6:l,u[t]=255*h;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){const e={};for(const n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*a,radToDeg:t=>t*s,_degToRad:t=>(g.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),g.degToRad(t)),_radToDeg:t=>(g.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),g.radToDeg(t)),_getRotation:t=>n.angleDeg?g.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(l+t)},error(t){console.error(l+t)},warn(t){n.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(const n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,i,r,o){let a,s,h;const l=(t-n)*(t-n)+(e-i)*(e-i);if(0==l)a=t,s=e,h=(r-n)*(r-n)+(o-i)*(o-i);else{const u=((r-t)*(n-t)+(o-e)*(i-e))/l;u<0?(a=t,s=e,h=(t-r)*(t-r)+(e-o)*(e-o)):u>1?(a=n,s=i,h=(n-r)*(n-r)+(i-o)*(i-o)):(a=t+u*(n-t),s=e+u*(i-e),h=(a-r)*(a-r)+(s-o)*(s-o))}return[a,s,h]},_getProjectionToLine(t,e,n){const i=g.cloneObject(t);let r=Number.MAX_VALUE;return e.forEach(function(o,a){if(!n&&a===e.length-1)return;const s=e[(a+1)%e.length],h=g._getProjectionToSegment(o.x,o.y,s.x,s.y,t.x,t.y),l=h[0],u=h[1],c=h[2];c<r&&(i.x=l,i.y=u,r=c)}),i},_prepareArrayForTween(t,e,n){const i=[],r=[];if(t.length>e.length){const n=e;e=t,t=n}for(let e=0;e<t.length;e+=2)i.push({x:t[e],y:t[e+1]});for(let t=0;t<e.length;t+=2)r.push({x:e[t],y:e[t+1]});const o=[];return r.forEach(function(t){const e=g._getProjectionToLine(t,i,n);o.push(e.x),o.push(e.y)}),o},_prepareToStringify(t){let e;t.visitedByCircularReferenceRemoval=!0;for(const n in t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(e=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||g._isElement(t[n])){if(!e.configurable)return null;delete t[n]}else if(null===g._prepareToStringify(t[n])){if(!e.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(const n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){n.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,n,i){let r=e<0?e:0,o=n<0?n:0;e=Math.abs(e),n=Math.abs(n);let a=0,s=0,h=0,l=0;"number"==typeof i?a=s=h=l=Math.min(i,e/2,n/2):(a=Math.min(i[0]||0,e/2,n/2),s=Math.min(i[1]||0,e/2,n/2),l=Math.min(i[2]||0,e/2,n/2),h=Math.min(i[3]||0,e/2,n/2)),t.moveTo(r+a,o),t.lineTo(r+e-s,o),t.arc(r+e-s,o+s,s,3*Math.PI/2,0,!1),t.lineTo(r+e,o+n-l),t.arc(r+e-l,o+n-l,l,0,Math.PI/2,!1),t.lineTo(r+h,o+n),t.arc(r+h,o+n-h,h,Math.PI/2,Math.PI,!1),t.lineTo(r,o+a),t.arc(r+a,o+a,a,Math.PI,3*Math.PI/2,!1)},drawRoundedPolygonPath(t,e,n,i,r){i=Math.abs(i);for(let o=0;o<n;o++){const a=e[(o-1+n)%n],s=e[o],h=e[(o+1)%n],l={x:s.x-a.x,y:s.y-a.y},u={x:h.x-s.x,y:h.y-s.y},c=Math.hypot(l.x,l.y),d=Math.hypot(u.x,u.y);let f;f="number"==typeof r?r:o<r.length?r[o]:0;f=i*Math.cos(Math.PI/n)*Math.min(1,f/i*2);const p={x:l.x/c,y:l.y/c},g={x:u.x/d,y:u.y/d},m={x:s.x-p.x*f,y:s.y-p.y*f},_={x:s.x+g.x*f,y:s.y+g.y*f};0===o?t.moveTo(m.x,m.y):t.lineTo(m.x,m.y),t.arcTo(s.x,s.y,_.x,_.y,f)}}};const m=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let _,v=null;function y(){if(null!==v)return v;try{const t=g.createCanvasElement().getContext("2d");return t?!!t&&"filter"in t:(v=!1,!1)}catch(t){return v=!1,!1}}class b{constructor(t){this.canvas=t,n.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){let n,i,r,o,a=this.traceArr,s=a.length,h="";for(n=0;n<s;n++)i=a[n],r=i.method,r?(o=i.args,h+=r,t?h+="()":g._isArray(o[0])?h+="(["+o.join(",")+"])":(e&&(o=o.map(t=>"number"==typeof t?Math.floor(t):t)),h+="("+o.join(",")+")")):(h+=i.property,t||(h+="="+i.val)),h+=";";return h}clearTrace(){this.traceArr=[]}_trace(t){let e,n=this.traceArr;n.push(t),e=n.length,e>=100&&n.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){const e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}_applyMiterLimit(t){const e=t.attrs.miterLimit;null!=e&&this.setAttr("miterLimit",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,i,r,o){this._context.arc(t,e,n,i,r,o)}arcTo(t,e,n,i,r){this._context.arcTo(t,e,n,i,r)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,i,r,o){this._context.bezierCurveTo(t,e,n,i,r,o)}clearRect(t,e,n,i){this._context.clearRect(t,e,n,i)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){const n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,i){return this._context.createLinearGradient(t,e,n,i)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,i,r,o){return this._context.createRadialGradient(t,e,n,i,r,o)}drawImage(t,e,n,i,r,o,a,s,h){const l=arguments,u=this._context;3===l.length?u.drawImage(t,e,n):5===l.length?u.drawImage(t,e,n,i,r):9===l.length&&u.drawImage(t,e,n,i,r,o,a,s,h)}ellipse(t,e,n,i,r,o,a,s){this._context.ellipse(t,e,n,i,r,o,a,s)}isPointInPath(t,e,n,i){return n?this._context.isPointInPath(n,t,e,i):this._context.isPointInPath(t,e,i)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,n,i){this._context.fillRect(t,e,n,i)}strokeRect(t,e,n,i){this._context.strokeRect(t,e,n,i)}fillText(t,e,n,i){i?this._context.fillText(t,e,n,i):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,i){return this._context.getImageData(t,e,n,i)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,i){this._context.rect(t,e,n,i)}roundRect(t,e,n,i,r){this._context.roundRect(t,e,n,i,r)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,i){this._context.quadraticCurveTo(t,e,n,i)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,i,r,o){this._context.setTransform(t,e,n,i,r,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,i){this._context.strokeText(t,e,n,i)}transform(t,e,n,i,r,o){this._context.transform(t,e,n,i,r,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let t,e,n=this,i=m.length,r=this.setAttr;const o=function(t){let i,r=n[t];n[t]=function(){return e=function(t){const e=[],n=t.length,i=g;for(let r=0;r<n;r++){let n=t[r];i._isNumber(n)?n=Math.round(1e3*n)/1e3:i._isString(n)||(n+=""),e.push(n)}return e}(Array.prototype.slice.call(arguments,0)),i=r.apply(n,arguments),n._trace({method:t,args:e}),i}};for(t=0;t<i;t++)o(m[t]);n.setAttr=function(){r.apply(n,arguments);const t=arguments[0];let e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"].forEach(function(t){Object.defineProperty(b.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class w extends b{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){const e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)return void this._fillColor(t);const i=t.getFillPatternImage();if(i&&"pattern"===n)return void this._fillPattern(t);const r=t.getFillLinearGradientColorStops();if(r&&"linear-gradient"===n)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):i?this._fillPattern(t):r?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),i=t.getStrokeLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,n.x,n.y);if(i){for(let t=0;t<i.length;t+=2)r.addColorStop(i[t],i[t+1]);this.setAttr("strokeStyle",r)}}_stroke(t){const e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,i;const r=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,a=null!==(i=t.getShadowOffset())&&void 0!==i?i:{x:0,y:0},s=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=s.x*h,u=s.y*h;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",o*Math.min(Math.abs(l),Math.abs(u))),this.setAttr("shadowOffsetX",a.x*l),this.setAttr("shadowOffsetY",a.y*u)}}class S extends b{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const e=t.getStrokeScaleEnabled();if(!e){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t);const n=t.hitStrokeWidth(),i="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}class x{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const e=(t||{}).pixelRatio||n.pixelRatio||function(){if(_)return _;const t=g.createCanvasElement(),e=t.getContext("2d");return _=(n._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),g.releaseCanvas(t),_}();this.pixelRatio=e,this._canvas=g.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return g.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class C extends x{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new w(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}class k extends x{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new S(this),this.setSize(t.width,t.height)}}const T={get isDragging(){let t=!1;return T._dragElements.forEach(e=>{"dragging"===e.dragStatus&&(t=!0)}),t},justDragged:!1,get node(){let t;return T._dragElements.forEach(e=>{t=e.node}),t},_dragElements:new Map,_drag(t){const e=[];T._dragElements.forEach((n,i)=>{const{node:r}=n,o=r.getStage();o.setPointersPositions(t),void 0===n.pointerId&&(n.pointerId=g._getFirstPointerId(t));const a=o._changedPointerPositions.find(t=>t.id===n.pointerId);if(a){if("dragging"!==n.dragStatus){const e=r.dragDistance();if(Math.max(Math.abs(a.x-n.startPointerPos.x),Math.abs(a.y-n.startPointerPos.y))<e)return;if(r.startDrag({evt:t}),!r.isDragging())return}r._setDragPosition(t,n),e.push(r)}}),e.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)})},_endDragBefore(t){const e=[];T._dragElements.forEach(i=>{const{node:r}=i,o=r.getStage();t&&o.setPointersPositions(t);if(!o._changedPointerPositions.find(t=>t.id===i.pointerId))return;"dragging"!==i.dragStatus&&"stopped"!==i.dragStatus||(T.justDragged=!0,n._mouseListenClick=!1,n._touchListenClick=!1,n._pointerListenClick=!1,i.dragStatus="stopped");const a=i.node.getLayer()||i.node instanceof n.Stage&&i.node;a&&-1===e.indexOf(a)&&e.push(a)}),e.forEach(t=>{t.draw()})},_endDragAfter(t){T._dragElements.forEach((e,n)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&T._dragElements.delete(n)})}};function A(t){return g._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||g._isBoolean(t)?t:Object.prototype.toString.call(t)}function I(){if(n.isUnminified)return function(t,e){return g._isNumber(t)||g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function E(){if(n.isUnminified)return function(t,e){return g._isNumber(t)||"auto"===t||g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function P(){if(n.isUnminified)return function(t,e){return g._isString(t)||g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function M(){if(n.isUnminified)return function(t,e){const n=g._isString(t),i="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return n||i||g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function D(){if(n.isUnminified)return function(t,e){return!0===t||!1===t||g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}n.isBrowser&&(window.addEventListener("mouseup",T._endDragBefore,!0),window.addEventListener("touchend",T._endDragBefore,!0),window.addEventListener("touchcancel",T._endDragBefore,!0),window.addEventListener("mousemove",T._drag),window.addEventListener("touchmove",T._drag),window.addEventListener("mouseup",T._endDragAfter,!1),window.addEventListener("touchend",T._endDragAfter,!1),window.addEventListener("touchcancel",T._endDragAfter,!1));const O="get",L="set",R={addGetterSetter(t,e,n,i,r){R.addGetter(t,e,n),R.addSetter(t,e,i,r),R.addOverloadedGetterSetter(t,e)},addGetter(t,e,n){const i=O+g._capitalize(e);t.prototype[i]=t.prototype[i]||function(){const t=this.attrs[e];return void 0===t?n:t}},addSetter(t,e,n,i){const r=L+g._capitalize(e);t.prototype[r]||R.overWriteSetter(t,e,n,i)},overWriteSetter(t,e,n,i){const r=L+g._capitalize(e);t.prototype[r]=function(t){return n&&null!=t&&(t=n.call(this,t,e)),this._setAttr(e,t),i&&i.call(this),this}},addComponentsGetterSetter(t,e,i,r,o){const a=i.length,s=g._capitalize,h=O+s(e),l=L+s(e);t.prototype[h]=function(){const t={};for(let n=0;n<a;n++){const r=i[n];t[r]=this.getAttr(e+s(r))}return t};const u=function(t){if(n.isUnminified)return function(e,n){return null==e||g.isObject(e)||g.warn(A(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(i);t.prototype[l]=function(t){const n=this.attrs[e];r&&(t=r.call(this,t,e)),u&&u.call(this,t,e);for(const n in t)t.hasOwnProperty(n)&&this._setAttr(e+s(n),t[n]);return t||i.forEach(t=>{this._setAttr(e+s(t),void 0)}),this._fireChangeEvent(e,n,t),o&&o.call(this),this},R.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){const n=g._capitalize(e),i=L+n,r=O+n;t.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[r]()}},addDeprecatedGetterSetter(t,e,n,i){g.error("Adding deprecated "+e);const r=O+g._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[r]=function(){g.error(o);const t=this.attrs[e];return void 0===t?n:t},R.addSetter(t,e,i,function(){g.error(o)}),R.addOverloadedGetterSetter(t,e)},backCompat(t,e){g.each(e,function(e,n){const i=t.prototype[n],r=O+g._capitalize(e),o=L+g._capitalize(e);function a(){i.apply(this,arguments),g.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=a,t.prototype[r]=a,t.prototype[o]=a})},afterSetFilter(){this._filterUpToDate=!1}};function F(t){const e=/(\w+)\(([^)]+)\)/g;let i;for(;null!==(i=e.exec(t));){const[,t,e]=i;switch(t){case"blur":{const t=parseFloat(e.replace("px",""));return function(e){this.blurRadius(.5*t);const i=n.Filters;i&&i.Blur&&i.Blur.call(this,e)}}case"brightness":{const t=e.includes("%")?parseFloat(e)/100:parseFloat(e);return function(e){this.brightness(t);const i=n.Filters;i&&i.Brightness&&i.Brightness.call(this,e)}}case"contrast":{const t=parseFloat(e);return function(e){const i=100*(Math.sqrt(t)-1);this.contrast(i);const r=n.Filters;r&&r.Contrast&&r.Contrast.call(this,e)}}case"grayscale":return function(t){const e=n.Filters;e&&e.Grayscale&&e.Grayscale.call(this,t)};case"sepia":return function(t){const e=n.Filters;e&&e.Sepia&&e.Sepia.call(this,t)};case"invert":return function(t){const e=n.Filters;e&&e.Invert&&e.Invert.call(this,t)};default:g.warn(`CSS filter "${t}" is not supported in fallback mode. Consider using function filters for better compatibility.`)}}return()=>{}}const W="absoluteOpacity",B="allEventListeners",G="absoluteTransform",H="absoluteScale",N="canvas",z="listening",X="Shape",j=" ",U="stage",V="transform",Y="visible",Z=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(j);let K=1;class q{constructor(t){this._id=K++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==V&&t!==G||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){let n=this._cache.get(t);return(void 0===n||(t===V||t===G)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map(t=>t+"Change.konva").join(j);this.on(n,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(N)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===G&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(N)){const{scene:t,filter:e,hit:n,buffer:i}=this._cache.get(N);g.releaseCanvas(t,e,n,i),this._cache.delete(N)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){const e=t||{};let n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(e.width||n.width),r=Math.ceil(e.height||n.height),o=e.pixelRatio,a=void 0===e.x?Math.floor(n.x):e.x,s=void 0===e.y?Math.floor(n.y):e.y,h=e.offset||0,l=e.drawBorder||!1,u=e.hitCanvasPixelRatio||1;if(!i||!r)return void g.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");i+=2*h+(Math.abs(Math.round(n.x)-a)>.5?1:0),r+=2*h+(Math.abs(Math.round(n.y)-s)>.5?1:0),a-=h,s-=h;const c=new C({pixelRatio:o,width:i,height:r}),d=new C({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),f=new k({pixelRatio:u,width:i,height:r}),p=c.getContext(),m=f.getContext(),_=new C({width:c.width/c.pixelRatio+Math.abs(a),height:c.height/c.pixelRatio+Math.abs(s),pixelRatio:c.pixelRatio}),v=_.getContext();return f.isCache=!0,c.isCache=!0,this._cache.delete(N),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(c.getContext()._context.imageSmoothingEnabled=!1,d.getContext()._context.imageSmoothingEnabled=!1),p.save(),m.save(),v.save(),p.translate(-a,-s),m.translate(-a,-s),v.translate(-a,-s),_.x=a,_.y=s,this._isUnderCache=!0,this._clearSelfAndDescendantCache(W),this._clearSelfAndDescendantCache(H),this.drawScene(c,this,_),this.drawHit(f,this),this._isUnderCache=!1,p.restore(),m.restore(),l&&(p.save(),p.beginPath(),p.rect(0,0,i,r),p.closePath(),p.setAttr("strokeStyle","red"),p.setAttr("lineWidth",5),p.stroke(),p.restore()),this._cache.set(N,{scene:c,filter:d,hit:f,buffer:_,x:a,y:s}),this._requestDraw(),this}isCached(){return this._cache.has(N)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){const n=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let i=1/0,r=1/0,o=-1/0,a=-1/0;const s=this.getAbsoluteTransform(e);return n.forEach(function(t){const e=s.point(t);void 0===i&&(i=o=e.x,r=a=e.y),i=Math.min(i,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y)}),{x:i,y:r,width:o-i,height:a-r}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);const n=this._getCachedSceneCanvas(),i=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/i,n.height/i),t.restore()}_drawCachedHitCanvas(t){const e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t,e,n,i,r=this.filters(),o=this._getCanvasCache(),a=o.scene,s=o.filter,h=s.getContext();if(!r||0===r.length)return a;if(this._filterUpToDate)return s;let l=!0;for(let t=0;t<r.length;t++)if("string"==typeof r[t]&&y(),"string"!=typeof r[t]||!y()){l=!1;break}const u=a.pixelRatio;if(s.setSize(a.width/a.pixelRatio,a.height/a.pixelRatio),l){const t=r.join(" ");return h.save(),h.setAttr("filter",t),h.drawImage(a._canvas,0,0,a.getWidth()/u,a.getHeight()/u),h.restore(),this._filterUpToDate=!0,s}try{for(t=r.length,h.clear(),h.drawImage(a._canvas,0,0,a.getWidth()/u,a.getHeight()/u),e=h.getImageData(0,0,s.getWidth(),s.getHeight()),n=0;n<t;n++)i=r[n],"string"==typeof i&&(i=F(i)),i.call(this,e),h.putImageData(e,0,0)}catch(t){g.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,s}on(t,e){if(this._cache&&this._cache.delete(B),3===arguments.length)return this._delegate.apply(this,arguments);const n=t.split(j);for(let t=0;t<n.length;t++){const i=n[t].split("."),r=i[0],o=i[1]||"";this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:o,handler:e})}return this}off(t,e){let n,i,r,o,a,s,h=(t||"").split(j),l=h.length;if(this._cache&&this._cache.delete(B),!t)for(i in this.eventListeners)this._off(i);for(n=0;n<l;n++)if(r=h[n],o=r.split("."),a=o[0],s=o[1],a)this.eventListeners[a]&&this._off(a,s,e);else for(i in this.eventListeners)this._off(i,s,e);return this}dispatchEvent(t){const e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){const i=this;this.on(t,function(t){const r=t.target.findAncestors(e,!0,i);for(let e=0;e<r.length;e++)(t=g.cloneObject(t)).currentTarget=r[e],n.call(r[e],t)})}remove(){return this.isDragging()&&this.stopDrag(),T._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(G),this._clearSelfAndDescendantCache(W),this._clearSelfAndDescendantCache(H),this._clearSelfAndDescendantCache(U),this._clearSelfAndDescendantCache(Y),this._clearSelfAndDescendantCache(z)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const e="get"+g._capitalize(t);return g._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];for(;t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+g._capitalize(e),g._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(z,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(Y,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);const i=this.getLayer();let r=!1;T._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===i)&&(r=!0)});const o=!e&&!n.hitOnDragEnabled&&(r||n.isTransforming());return this.isListening()&&this.isVisible()&&!o}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t,e,n,i,r=this.getDepth(),o=this,a=0;const s=this.getStage();return"Stage"!==o.nodeType&&s&&function s(h){for(t=[],e=h.length,n=0;n<e;n++)i=h[n],a++,i.nodeType!==X&&(t=t.concat(i.getChildren().slice())),i._id===o._id&&(n=e);t.length>0&&t[0].getDepth()<=r&&s(t)}(s.getChildren()),a}getDepth(){let t=0,e=this.parent;for(;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(V),this._clearSelfAndDescendantCache(G)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const e=t.getPointerPosition();if(!e)return null;const n=this.getAbsoluteTransform().copy();return n.invert(),n.point(e)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);const i=this.getAbsoluteTransform(t).getMatrix(),r=new o,a=this.offset();return r.m=i.slice(),r.translate(a.x,a.y),r.getTranslation()}setAbsolutePosition(t){const{x:e,y:n,...i}=this._clearTransform();this.attrs.x=e,this.attrs.y=n,this._clearCache(V);const r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(t.x,t.y),t={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(i),this.setPosition({x:t.x,y:t.y}),this._clearCache(V),this._clearSelfAndDescendantCache(G),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let e=t.x,n=t.y,i=this.x(),r=this.y();return void 0!==e&&(i+=e),void 0!==n&&(r+=n),this.setPosition({x:i,y:r}),this}_eachAncestorReverse(t,e){let n,i,r=[],o=this.getParent();if(!e||e._id!==this._id){for(r.unshift(this);o&&(!e||o._id!==e._id);)r.unshift(o),o=o.parent;for(n=r.length,i=0;i<n;i++)t(r[i])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return g.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return g.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return g.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return g.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return g.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&g.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(W,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t,e,n,i,r,o=this.getAttrs();const a={attrs:{},className:this.getClassName()};for(t in o)e=o[t],r=g.isObject(e)&&!g._isPlainObject(e)&&!g._isArray(e),r||(n="function"==typeof this[t]&&this[t],delete o[t],i=n?n.call(this):null,o[t]=e,i!==e&&(a.attrs[t]=e));return g._prepareToStringify(a)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){const i=[];e&&this._isMatch(t)&&i.push(this);let r=this.parent;for(;r;){if(r===n)return i;r._isMatch(t)&&i.push(r),r=r.parent}return i}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);let e,n,i=t.replace(/ /g,"").split(","),r=i.length;for(e=0;e<r;e++)if(n=i[e],g.isValidSelector(n)||(g.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),g.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),g.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(U,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(G,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new o,this._eachAncestorReverse(function(t){const n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())},t),e;{e=this._cache.get(G)||new o,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();const t=this.transformsEnabled();if("all"===t)e.multiply(this.getTransform());else if("position"===t){const t=this.attrs.x||0,n=this.attrs.y||0,i=this.attrs.offsetX||0,r=this.attrs.offsetY||0;e.translate(t-i,n-r)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;for(;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(V,this._getTransform)}_getTransform(){var t,e;const i=this._cache.get(V)||new o;i.reset();const r=this.x(),a=this.y(),s=n.getAngle(this.rotation()),h=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,l=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,u=this.attrs.skewX||0,c=this.attrs.skewY||0,d=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===r&&0===a||i.translate(r,a),0!==s&&i.rotate(s),0===u&&0===c||i.skew(u,c),1===h&&1===l||i.scale(h,l),0===d&&0===f||i.translate(-1*d,-1*f),i.dirty=!1,i}clone(t){let e,n,i,r,o,a=g.cloneObject(this.attrs);for(e in t)a[e]=t[e];const s=new this.constructor(a);for(e in this.eventListeners)for(n=this.eventListeners[e],i=n.length,r=0;r<i;r++)o=n[r],o.name.indexOf("konva")<0&&(s.eventListeners[e]||(s.eventListeners[e]=[]),s.eventListeners[e].push(o));return s}_toKonvaCanvas(t){t=t||{};const e=this.getClientRect(),n=this.getStage(),i=void 0!==t.x?t.x:Math.floor(e.x),r=void 0!==t.y?t.y:Math.floor(e.y),o=t.pixelRatio||1,a=new C({width:t.width||Math.ceil(e.width)||(n?n.width():0),height:t.height||Math.ceil(e.height)||(n?n.height():0),pixelRatio:o}),s=a.getContext(),h=new C({width:a.width/a.pixelRatio+Math.abs(i),height:a.height/a.pixelRatio+Math.abs(r),pixelRatio:a.pixelRatio});return!1===t.imageSmoothingEnabled&&(s._context.imageSmoothingEnabled=!1),s.save(),(i||r)&&s.translate(-1*i,-1*r),this.drawScene(a,void 0,h),s.restore(),a}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){const e=(t=t||{}).mimeType||null,n=t.quality||null,i=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(i),i}toImage(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,g._urlToImage(this.toDataURL(t),function(t){e(t),null==n||n(t)})}catch(t){n(t)}})}toBlob(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==n||n(t)},null==t?void 0:t.mimeType,null==t?void 0:t.quality)}catch(t){n(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():n.dragDistance}_off(t,e,n){let i,r,o,a=this.eventListeners[t];for(i=0;i<a.length;i++)if(r=a[i].name,o=a[i].handler,!("konva"===r&&"konva"!==e||e&&r!==e||n&&n!==o)){if(a.splice(i,1),0===a.length){delete this.eventListeners[t];break}i--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){const e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;return-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){const e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){const n=this["set"+g._capitalize(t)];return g._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(n.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){const n=this.attrs[t];(n!==e||g.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){let i;void 0!==n&&(i=this.attrs[t],i||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,i,n))}_fireAndBubble(t,e,n){e&&this.nodeType===X&&(e.target=this);const i=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(!(-1!==i.indexOf(t)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(t,e);const r=-1!==i.indexOf(t)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!r&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,n,i;const r=null!==(e=this._cache.get(B))&&void 0!==e?e:{};let o=null==r?void 0:r[t];if(void 0===o){o=[];let e=Object.getPrototypeOf(this);for(;e;){const r=null!==(i=null===(n=e.eventListeners)||void 0===n?void 0:n[t])&&void 0!==i?i:[];o.push(...r),e=Object.getPrototypeOf(e)}r[t]=o,this._cache.set(B,r)}return o}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(let t=0;t<n.length;t++)n[t].handler.call(this,e);const i=this.eventListeners[t];if(i)for(let t=0;t<i.length;t++)i[t].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const e=t?t.pointerId:void 0,n=this.getStage(),i=this.getAbsolutePosition();if(!n)return;const r=n._getPointerById(e)||n._changedPointerPositions[0]||i;T._dragElements.set(this._id,{node:this,startPointerPos:r,offset:{x:r.x-i.x,y:r.y-i.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){T._dragElements.has(this._id)||this._createDragElement(t);T._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(!n)return;let i={x:n.x-e.offset.x,y:n.y-e.offset.y};const r=this.dragBoundFunc();if(void 0!==r){const e=r.call(this,i,t);e?i=e:g.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(t){const e=T._dragElements.get(this._id);e&&(e.dragStatus="stopped"),T._endDragBefore(t),T._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=T._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(!(void 0!==t.evt.button)||n.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let e=!1;T._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(e=!0)}),e||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();if(!this.getStage())return;const t=T._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,n=t&&"ready"===t.dragStatus;e?this.stopDrag():n&&T._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return g.haveIntersection(n,this.getClientRect())}static create(t,e){return g._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){let i,r,o,a=q.prototype.getClassName.call(t),s=t.children;e&&(t.attrs.container=e),n[a]||(g.warn('Can not find a node with class name "'+a+'". Fallback to "Shape".'),a="Shape");if(i=new(0,n[a])(t.attrs),s)for(r=s.length,o=0;o<r;o++)i.add(q._createNode(s[o]));return i}}q.prototype.nodeType="Node",q.prototype._attrsAffectingSize=[],q.prototype.eventListeners={},q.prototype.on.call(q.prototype,Z,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(V),this._clearSelfAndDescendantCache(G))}),q.prototype.on.call(q.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Y)}),q.prototype.on.call(q.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(z)}),q.prototype.on.call(q.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(W)});const J=R.addGetterSetter;J(q,"zIndex"),J(q,"absolutePosition"),J(q,"position"),J(q,"x",0,I()),J(q,"y",0,I()),J(q,"globalCompositeOperation","source-over",P()),J(q,"opacity",1,I()),J(q,"name","",P()),J(q,"id","",P()),J(q,"rotation",0,I()),R.addComponentsGetterSetter(q,"scale",["x","y"]),J(q,"scaleX",1,I()),J(q,"scaleY",1,I()),R.addComponentsGetterSetter(q,"skew",["x","y"]),J(q,"skewX",0,I()),J(q,"skewY",0,I()),R.addComponentsGetterSetter(q,"offset",["x","y"]),J(q,"offsetX",0,I()),J(q,"offsetY",0,I()),J(q,"dragDistance",void 0,I()),J(q,"width",0,I()),J(q,"height",0,I()),J(q,"listening",!0,D()),J(q,"preventDefault",!0,D()),J(q,"filters",void 0,function(t){return this._filterUpToDate=!1,t}),J(q,"visible",!0,D()),J(q,"transformsEnabled","all",P()),J(q,"size"),J(q,"dragBoundFunc"),J(q,"draggable",!1,D()),R.backCompat(q,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Q extends q{constructor(){super(...arguments),this.children=[]}getChildren(t){const e=this.children||[];return t?e.filter(t):e}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(let e=0;e<t.length;e++)this.add(t[e]);return this}const e=t[0];return e.getParent()?(e.moveTo(this),this):(this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){const n=[];return this._descendants(i=>{const r=i._isMatch(t);return r&&n.push(i),!(!r||!e)}),n}_descendants(t){let e=!1;const n=this.getChildren();for(const i of n){if(e=t(i),e)return!0;if(i.hasChildren()&&(e=i._descendants(t),e))return!0}return!1}toObject(){const t=q.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();for(;e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){const e=q.prototype.clone.call(this,t);return this.getChildren().forEach(function(t){e.add(t.clone())}),e}getAllIntersections(t){const e=[];return this.find("Shape").forEach(n=>{n.isVisible()&&n.intersects(t)&&e.push(n)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach(function(e){e._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach(function(t,e){t.index=e}),this._requestDraw()}drawScene(t,e,n){const i=this.getLayer(),r=t||i&&i.getCanvas(),o=r&&r.getContext(),a=this._getCanvasCache(),s=a&&a.scene,h=r&&r.isCache;if(!this.isVisible()&&!h)return this;if(s){o.save();const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",r,e,n);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;const n=this.getLayer(),i=t||n&&n.hitCanvas,r=i&&i.getContext(),o=this._getCanvasCache();if(o&&o.hit){r.save();const t=this.getAbsoluteTransform(e).getMatrix();r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(r),r.restore()}else this._drawChildren("drawHit",i,e);return this}_drawChildren(t,e,n,i){var r;const o=e&&e.getContext(),a=this.clipWidth(),s=this.clipHeight(),h=this.clipFunc(),l="number"==typeof a&&"number"==typeof s||h,u=n===this;if(l){o.save();const t=this.getAbsoluteTransform(n);let e,i=t.getMatrix();if(o.transform(i[0],i[1],i[2],i[3],i[4],i[5]),o.beginPath(),h)e=h.call(this,o,this);else{const t=this.clipX(),e=this.clipY();o.rect(t||0,e||0,a,s)}o.clip.apply(o,e),i=t.copy().invert().getMatrix(),o.transform(i[0],i[1],i[2],i[3],i[4],i[5])}const c=!u&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;c&&(o.save(),o._applyGlobalCompositeOperation(this)),null===(r=this.children)||void 0===r||r.forEach(function(r){r[t](e,n,i)}),c&&o.restore(),l&&o.restore()}getClientRect(t={}){var e;const n=t.skipTransform,i=t.relativeTo;let r,o,a,s,h={x:1/0,y:1/0,width:0,height:0};const l=this;null===(e=this.children)||void 0===e||e.forEach(function(e){if(!e.visible())return;const n=e.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===n.width&&0===n.height||(void 0===r?(r=n.x,o=n.y,a=n.x+n.width,s=n.y+n.height):(r=Math.min(r,n.x),o=Math.min(o,n.y),a=Math.max(a,n.x+n.width),s=Math.max(s,n.y+n.height)))});const u=this.find("Shape");let c=!1;for(let t=0;t<u.length;t++){if(u[t]._isVisible(this)){c=!0;break}}return h=c&&void 0!==r?{x:r,y:o,width:a-r,height:s-o}:{x:0,y:0,width:0,height:0},n?h:this._transformedRect(h,i)}}R.addComponentsGetterSetter(Q,"clip",["x","y","width","height"]),R.addGetterSetter(Q,"clipX",void 0,I()),R.addGetterSetter(Q,"clipY",void 0,I()),R.addGetterSetter(Q,"clipWidth",void 0,I()),R.addGetterSetter(Q,"clipHeight",void 0,I()),R.addGetterSetter(Q,"clipFunc");const $=new Map,tt=void 0!==n._global.PointerEvent;function et(t){return $.get(t)}function nt(t){return{evt:t,pointerId:t.pointerId}}function it(t,e){return $.get(t)===e}function rt(t,e){ot(t);e.getStage()&&($.set(t,e),tt&&e._fire("gotpointercapture",nt(new PointerEvent("gotpointercapture"))))}function ot(t,e){const n=$.get(t);if(!n)return;const i=n.getStage();i&&i.content,$.delete(t),tt&&n._fire("lostpointercapture",nt(new PointerEvent("lostpointercapture")))}const at="mouseleave",st="mouseover",ht="mouseenter",lt="mousemove",ut="mousedown",ct="mouseup",dt="pointermove",ft="pointerdown",pt="pointerup",gt="pointercancel",mt="pointerout",_t="pointerleave",vt="pointerover",yt="pointerenter",bt="contextmenu",wt="touchstart",St="touchend",xt="touchmove",Ct="touchcancel",kt="wheel",Tt=[[ht,"_pointerenter"],[ut,"_pointerdown"],[lt,"_pointermove"],[ct,"_pointerup"],[at,"_pointerleave"],[wt,"_pointerdown"],[xt,"_pointermove"],[St,"_pointerup"],[Ct,"_pointercancel"],[st,"_pointerover"],[kt,"_wheel"],[bt,"_contextmenu"],[ft,"_pointerdown"],[dt,"_pointermove"],[pt,"_pointerup"],[gt,"_pointercancel"],[_t,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],At={mouse:{[mt]:"mouseout",[_t]:at,[vt]:st,[yt]:ht,[dt]:lt,[ft]:ut,[pt]:ct,[gt]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[mt]:"touchout",[_t]:"touchleave",[vt]:"touchover",[yt]:"touchenter",[dt]:xt,[ft]:wt,[pt]:St,[gt]:Ct,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[mt]:mt,[_t]:_t,[vt]:vt,[yt]:yt,[dt]:dt,[ft]:ft,[pt]:pt,[gt]:gt,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},It=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",Et=t=>{const e=It(t);return"pointer"===e?n.pointerEventsEnabled&&At.pointer:"touch"===e?At.touch:"mouse"===e?At.mouse:void 0};function Pt(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&g.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const Mt=[];class Dt extends Q{constructor(t){super(Pt(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Mt.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Pt(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),n="FastLayer"===t.getType();e||n||g.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){let e;if("."===t.charAt(0)){const e=t.slice(1);t=document.getElementsByClassName(e)[0]}else e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e);if(!t)throw"Can not find container in document with id "+e}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const t=this.children,e=t.length;for(let n=0;n<e;n++)t[n].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),Q.prototype.clone.call(this,t)}destroy(){super.destroy();const t=this.content;t&&g._isInDocument(t)&&this.container().removeChild(t);const e=Mt.indexOf(this);return e>-1&&Mt.splice(e,1),g.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(g.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t={...t}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();const e=new C({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,i=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),i.forEach(function(e){if(!e.isVisible())return;const i=e._toKonvaCanvas(t);n.drawImage(i._canvas,t.x,t.y,i.getWidth()/i.getPixelRatio(),i.getHeight()/i.getPixelRatio())}),e}getIntersection(t){if(!t)return null;const e=this.children;for(let n=e.length-1;n>=0;n--){const i=e[n].getIntersection(t);if(i)return i}return null}_resizeDOM(){const t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(n=>{n.setSize({width:t,height:e}),n.draw()})}add(t,...e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}super.add(t);const i=this.children.length;return i>5&&g.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),n.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){rt(t,this)}releaseCapture(t){ot(t)}getLayers(){return this.children}_bindContentEvents(){n.isBrowser&&Tt.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=Et(t.type);e&&this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=Et(t.type);e&&this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=Et(t.type),i=It(t.type);if(!e)return;this.setPointersPositions(t);const r=this._getTargetShape(i),o=!(n.isDragging()||n.isTransforming())||n.hitOnDragEnabled;r&&o?(r._fireAndBubble(e.pointerout,{evt:t}),r._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null):o&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){const e=Et(t.type),i=It(t.type);if(!e)return;this.setPointersPositions(t);let r=!1;this._changedPointerPositions.forEach(o=>{const a=this.getIntersection(o);if(T.justDragged=!1,n["_"+i+"ListenClick"]=!0,!a||!a.isListening())return void(this[i+"ClickStartShape"]=void 0);n.capturePointerEventsEnabled&&a.setPointerCapture(o.id),this[i+"ClickStartShape"]=a,a._fireAndBubble(e.pointerdown,{evt:t,pointerId:o.id}),r=!0;const s=t.type.indexOf("touch")>=0;a.preventDefault()&&t.cancelable&&s&&t.preventDefault()}),r||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){const e=Et(t.type),i=It(t.type);if(!e)return;const r=t.type.indexOf("touch")>=0||"touch"===t.pointerType;n.isDragging()&&T.node.preventDefault()&&t.cancelable&&r&&t.preventDefault(),this.setPointersPositions(t);if(!(!(n.isDragging()||n.isTransforming())||n.hitOnDragEnabled))return;const o={};let a=!1;const s=this._getTargetShape(i);this._changedPointerPositions.forEach(n=>{const r=et(n.id)||this.getIntersection(n),h=n.id,l={evt:t,pointerId:h},u=s!==r;if(u&&s&&(s._fireAndBubble(e.pointerout,{...l},r),s._fireAndBubble(e.pointerleave,{...l},r)),r){if(o[r._id])return;o[r._id]=!0}r&&r.isListening()?(a=!0,u&&(r._fireAndBubble(e.pointerover,{...l},s),r._fireAndBubble(e.pointerenter,{...l},s),this[i+"targetShape"]=r),r._fireAndBubble(e.pointermove,{...l})):s&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:h}),this[i+"targetShape"]=null)}),a||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=Et(t.type),i=It(t.type);if(!e)return;this.setPointersPositions(t);const r=this[i+"ClickStartShape"],o=this[i+"ClickEndShape"],a={};let s=!1;this._changedPointerPositions.forEach(h=>{const l=et(h.id)||this.getIntersection(h);if(l){if(l.releaseCapture(h.id),a[l._id])return;a[l._id]=!0}const u=h.id,c={evt:t,pointerId:u};let d=!1;n["_"+i+"InDblClickWindow"]?(d=!0,clearTimeout(this[i+"DblTimeout"])):T.justDragged||(n["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){n["_"+i+"InDblClickWindow"]=!1},n.dblClickWindow),l&&l.isListening()?(s=!0,this[i+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,{...c}),n["_"+i+"ListenClick"]&&r&&r===l&&(l._fireAndBubble(e.pointerclick,{...c}),d&&o&&o===l&&l._fireAndBubble(e.pointerdblclick,{...c}))):(this[i+"ClickEndShape"]=null,s||(this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s=!0),n["_"+i+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:u}),d&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:u}))}),s||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),n["_"+i+"ListenClick"]=!1,t.cancelable&&"touch"!==i&&"pointer"!==i&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(bt,{evt:t}):this._fire(bt,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(kt,{evt:t}):this._fire(kt,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=et(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(pt,nt(t)),ot(t.pointerId)}_lostpointercapture(t){ot(t.pointerId)}setPointersPositions(t){const e=this._getContentPosition();let n=null,i=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})):(n=(t.clientX-e.left)/e.scaleX,i=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:n,y:i},this._pointerPositions=[{x:n,y:i,id:g._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:i,id:g._getFirstPointerId(t)}])}_setPointerPosition(t){g.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new C({width:this.width(),height:this.height()}),this.bufferHitCanvas=new k({pixelRatio:1,width:this.width(),height:this.height()}),!n.isBrowser)return;const t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return g.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}Dt.prototype.nodeType="Stage",i(Dt),R.addGetterSetter(Dt,"container"),n.isBrowser&&document.addEventListener("visibilitychange",()=>{Mt.forEach(t=>{t.batchDraw()})});const Ot="hasShadow",Lt="shadowRGBA",Rt="patternImage",Ft="linearGradient",Wt="radialGradient";let Bt;function Gt(){return Bt||(Bt=g.createCanvasElement().getContext("2d"),Bt)}const Ht={};class Nt extends q{constructor(t){let e;super(t);let n=0;for(;e=g.getHitColor(),!e||e in Ht;)if(n++,n>=1e4){g.warn("Failed to find a unique color key for a shape. Konva may work incorrectly. Most likely your browser is using canvas farbling. Consider disabling it."),e=g.getRandomColor();break}this.colorKey=e,Ht[e]=this}getContext(){return g.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return g.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Ot,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Rt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=Gt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new o;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(n.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=e.getMatrix(),r="undefined"==typeof DOMMatrix?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(r)}return t}}_getLinearGradient(){return this._getCache(Ft,this.__getLinearGradient)}__getLinearGradient(){const t=this.fillLinearGradientColorStops();if(t){const e=Gt(),n=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),r=e.createLinearGradient(n.x,n.y,i.x,i.y);for(let e=0;e<t.length;e+=2)r.addColorStop(t[e],t[e+1]);return r}}_getRadialGradient(){return this._getCache(Wt,this.__getRadialGradient)}__getRadialGradient(){const t=this.fillRadialGradientColorStops();if(t){const e=Gt(),n=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),r=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius());for(let e=0;e<t.length;e+=2)r.addColorStop(t[e],t[e+1]);return r}}getShadowRGBA(){return this._getCache(Lt,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const t=g.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){const e=this.getStage();if(!e)return!1;const n=e.bufferHitCanvas;n.getContext().clear(),this.drawHit(n,void 0,!0);return n.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return q.prototype.destroy.call(this),delete Ht[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const n=t||this.hasFill(),i=this.hasStroke(),r=1!==this.getAbsoluteOpacity();if(n&&i&&r)return!0;const o=this.hasShadow(),a=this.shadowForStrokeEnabled();return!!(n&&i&&o&&a)}setStrokeHitEnabled(t){g.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,n=this.getParent();for(;n;){if(n.isCached()){e=!0;break}n=n.getParent()}const i=t.skipTransform,r=t.relativeTo||e&&this.getStage()||void 0,o=this.getSelfRect(),a=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,s=o.width+a,h=o.height+a,l=!t.skipShadow&&this.hasShadow(),u=l?this.shadowOffsetX():0,c=l?this.shadowOffsetY():0,d=s+Math.abs(u),f=h+Math.abs(c),p=l&&this.shadowBlur()||0,g={width:d+2*p,height:f+2*p,x:-(a/2+p)+Math.min(u,0)+o.x,y:-(a/2+p)+Math.min(c,0)+o.y};return i?g:this._transformedRect(g,r)}drawScene(t,e,n){const i=this.getLayer(),r=(t||i.getCanvas()).getContext(),o=this._getCanvasCache(),a=this.getSceneFunc(),s=this.hasShadow();let h;const l=e===this;if(!this.isVisible()&&!l)return this;if(o){r.save();const t=this.getAbsoluteTransform(e).getMatrix();return r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(r),r.restore(),this}if(!a)return this;if(r.save(),this._useBufferCanvas()){h=this.getStage();const t=n||h.bufferCanvas,i=t.getContext();i.clear(),i.save(),i._applyLineJoin(this),i._applyMiterLimit(this);const o=this.getAbsoluteTransform(e).getMatrix();i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),a.call(this,i,this),i.restore();const u=t.pixelRatio;s&&r._applyShadow(this),l||(r._applyOpacity(this),r._applyGlobalCompositeOperation(this)),r.drawImage(t._canvas,t.x||0,t.y||0,t.width/u,t.height/u)}else{if(r._applyLineJoin(this),r._applyMiterLimit(this),!l){const t=this.getAbsoluteTransform(e).getMatrix();r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),r._applyOpacity(this),r._applyGlobalCompositeOperation(this)}s&&r._applyShadow(this),a.call(this,r,this)}return r.restore(),this}drawHit(t,e,n=!1){if(!this.shouldDrawHit(e,n))return this;const i=this.getLayer(),r=t||i.hitCanvas,o=r&&r.getContext(),a=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),h=s&&s.hit;if(this.colorKey||g.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),h){o.save();const t=this.getAbsoluteTransform(e).getMatrix();return o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!a)return this;o.save(),o._applyLineJoin(this),o._applyMiterLimit(this);if(!(this===e)){const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return a.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){const e=this._getCanvasCache(),n=this._getCachedSceneCanvas(),i=e.hit,r=i.getContext(),o=i.getWidth(),a=i.getHeight();r.clear(),r.drawImage(n._canvas,0,0,o,a);try{const e=r.getImageData(0,0,o,a),n=e.data,i=n.length,s=g._hexToRgb(this.colorKey);for(let e=0;e<i;e+=4){n[e+3]>t?(n[e]=s.r,n[e+1]=s.g,n[e+2]=s.b,n[e+3]=255):n[e+3]=0}r.putImageData(e,0,0)}catch(t){g.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){rt(t,this)}releaseCapture(t){ot(t)}}Nt.prototype._fillFunc=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Nt.prototype._strokeFunc=function(t){t.stroke()},Nt.prototype._fillFuncHit=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Nt.prototype._strokeFuncHit=function(t){t.stroke()},Nt.prototype._centroid=!1,Nt.prototype.nodeType="Shape",i(Nt),Nt.prototype.eventListeners={},Nt.prototype.on.call(Nt.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Ot)}),Nt.prototype.on.call(Nt.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Lt)}),Nt.prototype.on.call(Nt.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(Rt)}),Nt.prototype.on.call(Nt.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(Ft)}),Nt.prototype.on.call(Nt.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(Wt)}),R.addGetterSetter(Nt,"stroke",void 0,M()),R.addGetterSetter(Nt,"strokeWidth",2,I()),R.addGetterSetter(Nt,"fillAfterStrokeEnabled",!1),R.addGetterSetter(Nt,"hitStrokeWidth","auto",E()),R.addGetterSetter(Nt,"strokeHitEnabled",!0,D()),R.addGetterSetter(Nt,"perfectDrawEnabled",!0,D()),R.addGetterSetter(Nt,"shadowForStrokeEnabled",!0,D()),R.addGetterSetter(Nt,"lineJoin"),R.addGetterSetter(Nt,"lineCap"),R.addGetterSetter(Nt,"miterLimit"),R.addGetterSetter(Nt,"sceneFunc"),R.addGetterSetter(Nt,"hitFunc"),R.addGetterSetter(Nt,"dash"),R.addGetterSetter(Nt,"dashOffset",0,I()),R.addGetterSetter(Nt,"shadowColor",void 0,P()),R.addGetterSetter(Nt,"shadowBlur",0,I()),R.addGetterSetter(Nt,"shadowOpacity",1,I()),R.addComponentsGetterSetter(Nt,"shadowOffset",["x","y"]),R.addGetterSetter(Nt,"shadowOffsetX",0,I()),R.addGetterSetter(Nt,"shadowOffsetY",0,I()),R.addGetterSetter(Nt,"fillPatternImage"),R.addGetterSetter(Nt,"fill",void 0,M()),R.addGetterSetter(Nt,"fillPatternX",0,I()),R.addGetterSetter(Nt,"fillPatternY",0,I()),R.addGetterSetter(Nt,"fillLinearGradientColorStops"),R.addGetterSetter(Nt,"strokeLinearGradientColorStops"),R.addGetterSetter(Nt,"fillRadialGradientStartRadius",0),R.addGetterSetter(Nt,"fillRadialGradientEndRadius",0),R.addGetterSetter(Nt,"fillRadialGradientColorStops"),R.addGetterSetter(Nt,"fillPatternRepeat","repeat"),R.addGetterSetter(Nt,"fillEnabled",!0),R.addGetterSetter(Nt,"strokeEnabled",!0),R.addGetterSetter(Nt,"shadowEnabled",!0),R.addGetterSetter(Nt,"dashEnabled",!0),R.addGetterSetter(Nt,"strokeScaleEnabled",!0),R.addGetterSetter(Nt,"fillPriority","color"),R.addComponentsGetterSetter(Nt,"fillPatternOffset",["x","y"]),R.addGetterSetter(Nt,"fillPatternOffsetX",0,I()),R.addGetterSetter(Nt,"fillPatternOffsetY",0,I()),R.addComponentsGetterSetter(Nt,"fillPatternScale",["x","y"]),R.addGetterSetter(Nt,"fillPatternScaleX",1,I()),R.addGetterSetter(Nt,"fillPatternScaleY",1,I()),R.addComponentsGetterSetter(Nt,"fillLinearGradientStartPoint",["x","y"]),R.addComponentsGetterSetter(Nt,"strokeLinearGradientStartPoint",["x","y"]),R.addGetterSetter(Nt,"fillLinearGradientStartPointX",0),R.addGetterSetter(Nt,"strokeLinearGradientStartPointX",0),R.addGetterSetter(Nt,"fillLinearGradientStartPointY",0),R.addGetterSetter(Nt,"strokeLinearGradientStartPointY",0),R.addComponentsGetterSetter(Nt,"fillLinearGradientEndPoint",["x","y"]),R.addComponentsGetterSetter(Nt,"strokeLinearGradientEndPoint",["x","y"]),R.addGetterSetter(Nt,"fillLinearGradientEndPointX",0),R.addGetterSetter(Nt,"strokeLinearGradientEndPointX",0),R.addGetterSetter(Nt,"fillLinearGradientEndPointY",0),R.addGetterSetter(Nt,"strokeLinearGradientEndPointY",0),R.addComponentsGetterSetter(Nt,"fillRadialGradientStartPoint",["x","y"]),R.addGetterSetter(Nt,"fillRadialGradientStartPointX",0),R.addGetterSetter(Nt,"fillRadialGradientStartPointY",0),R.addComponentsGetterSetter(Nt,"fillRadialGradientEndPoint",["x","y"]),R.addGetterSetter(Nt,"fillRadialGradientEndPointX",0),R.addGetterSetter(Nt,"fillRadialGradientEndPointY",0),R.addGetterSetter(Nt,"fillPatternRotation",0),R.addGetterSetter(Nt,"fillRule",void 0,P()),R.backCompat(Nt,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const zt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Xt=zt.length;class jt extends Q{constructor(t){super(t),this.canvas=new C,this.hitCanvas=new k({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){q.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!q.prototype.moveUp.call(this))return!1;const t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(q.prototype.moveDown.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(q.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const t=this.getNativeCanvasElement();return q.prototype.remove.call(this),t&&t.parentNode&&g._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&g.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t={...t}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),q.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){g.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){g.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,g.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,n=!1;for(;;){for(let i=0;i<Xt;i++){const r=zt[i],o=this._getIntersection({x:t.x+r.x*e,y:t.y+r.y*e}),a=o.shape;if(a)return a;if(n=!!o.antialiased,!o.antialiased)break}if(!n)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,i=n[3];if(255===i){const t=g.getHitColorKey(n[0],n[1],n[2]),e=Ht[t];return e?{shape:e}:{antialiased:!0}}return i>0?{antialiased:!0}:{}}drawScene(t,e,n){const i=this.getLayer(),r=t||i&&i.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),Q.prototype.drawScene.call(this,r,e,n),this._fire("draw",{node:this}),this}drawHit(t,e){const n=this.getLayer(),i=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),Q.prototype.drawHit.call(this,i,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){g.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return g.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return g.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}jt.prototype.nodeType="Layer",i(jt),R.addGetterSetter(jt,"imageSmoothingEnabled",!0),R.addGetterSetter(jt,"clearBeforeDraw",!0),R.addGetterSetter(jt,"hitGraphEnabled",!0,D());class Ut extends jt{constructor(t){super(t),this.listening(!1),g.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Ut.prototype.nodeType="FastLayer",i(Ut);class Vt extends Q{_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&g.throw("You may only add groups and shapes to groups.")}}Vt.prototype.nodeType="Group",i(Vt);const Yt=e.performance&&e.performance.now?function(){return e.performance.now()}:function(){return(new Date).getTime()};class Zt{constructor(t,e){this.id=Zt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Yt(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,n=e.length;for(let i=0;i<n;i++)if(e[i]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const t=Zt.animations,e=t.length;for(let n=0;n<e;n++)if(t[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Yt(),Zt._addAnimation(this),this}stop(){return Zt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,n=this.animations,i=n.length;for(let t=0;t<i;t++)if(n[t].id===e){this.animations.splice(t,1);break}}static _runFrames(){const t={},e=this.animations;for(let n=0;n<e.length;n++){const i=e[n],r=i.layers,o=i.func;i._updateFrameObject(Yt());const a=r.length;let s;if(s=!o||!1!==o.call(i,i.frame),s)for(let e=0;e<a;e++){const n=r[e];void 0!==n._id&&(t[n._id]=n)}}for(const e in t)t.hasOwnProperty(e)&&t[e].batchDraw()}static _animationLoop(){const t=Zt;t.animations.length?(t._runFrames(),g.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,g.requestAnimFrame(this._animationLoop))}}Zt.animations=[],Zt.animIdCounter=0,Zt.animRunning=!1;const Kt={node:1,duration:1,easing:1,onFinish:1,yoyo:1},qt=["fill","stroke","shadowColor"];let Jt=0;class Qt{constructor(t,e,n,i,r,o,a){this.prop=t,this.propFunc=e,this.begin=i,this._pos=i,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=r-this.begin,this.pause()}fire(t){const e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class $t{constructor(t){const e=this,i=t.node,r=i._id,o=t.easing||te.Linear,a=!!t.yoyo;let s,h;s=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=i,this._id=Jt++;const l=i.getLayer()||(i instanceof n.Stage?i.getLayers():null);for(h in l||g.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Zt(function(){e.tween.onEnterFrame()},l),this.tween=new Qt(h,function(t){e._tweenFunc(t)},o,0,1,1e3*s,a),this._addListeners(),$t.attrs[r]||($t.attrs[r]={}),$t.attrs[r][this._id]||($t.attrs[r][this._id]={}),$t.tweens[r]||($t.tweens[r]={}),t)void 0===Kt[h]&&this._addAttr(h,t[h]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){const n=this.node,i=n._id;let r,o,a,s,h;const l=$t.tweens[i][t];l&&delete $t.attrs[i][l][t];let u=n.getAttr(t);if(g._isArray(e))if(r=[],o=Math.max(e.length,u.length),"points"===t&&e.length!==u.length&&(e.length>u.length?(s=u,u=g._prepareArrayForTween(u,e,n.closed())):(a=e,e=g._prepareArrayForTween(e,u,n.closed()))),0===t.indexOf("fill"))for(let t=0;t<o;t++)if(t%2==0)r.push(e[t]-u[t]);else{const n=g.colorToRGBA(u[t]);h=g.colorToRGBA(e[t]),u[t]=n,r.push({r:h.r-n.r,g:h.g-n.g,b:h.b-n.b,a:h.a-n.a})}else for(let t=0;t<o;t++)r.push(e[t]-u[t]);else-1!==qt.indexOf(t)?(u=g.colorToRGBA(u),h=g.colorToRGBA(e),r={r:h.r-u.r,g:h.g-u.g,b:h.b-u.b,a:h.a-u.a}):r=e-u;$t.attrs[i][this._id][t]={start:u,diff:r,end:e,trueEnd:a,trueStart:s},$t.tweens[i][t]=this._id}_tweenFunc(t){const e=this.node,n=$t.attrs[e._id][this._id];let i,r,o,a,s,h,l,u;for(i in n){if(r=n[i],o=r.start,a=r.diff,u=r.end,g._isArray(o))if(s=[],l=Math.max(o.length,u.length),0===i.indexOf("fill"))for(h=0;h<l;h++)h%2==0?s.push((o[h]||0)+a[h]*t):s.push("rgba("+Math.round(o[h].r+a[h].r*t)+","+Math.round(o[h].g+a[h].g*t)+","+Math.round(o[h].b+a[h].b*t)+","+(o[h].a+a[h].a*t)+")");else for(h=0;h<l;h++)s.push((o[h]||0)+a[h]*t);else s=-1!==qt.indexOf(i)?"rgba("+Math.round(o.r+a.r*t)+","+Math.round(o.g+a.g*t)+","+Math.round(o.b+a.b*t)+","+(o.a+a.a*t)+")":o+a*t;e.setAttr(i,s)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const t=this.node,e=$t.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const t=this.node,e=$t.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const t=this.node._id,e=this._id,n=$t.tweens[t];this.pause(),this.anim&&this.anim.stop();for(const e in n)delete $t.tweens[t][e];delete $t.attrs[t][e],$t.tweens[t]&&(0===Object.keys($t.tweens[t]).length&&delete $t.tweens[t],0===Object.keys($t.attrs[t]).length&&delete $t.attrs[t])}}$t.attrs={},$t.tweens={},q.prototype.to=function(t){const e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()};new $t(t).play()};const te={BackEaseIn(t,e,n,i){const r=1.70158;return n*(t/=i)*t*((r+1)*t-r)+e},BackEaseOut(t,e,n,i){const r=1.70158;return n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut(t,e,n,i){let r=1.70158;return(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn(t,e,n,i,r,o){let a=0;return 0===t?e:1===(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,n,i,r,o){let a=0;return 0===t?e:1===(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-a)*(2*Math.PI)/o)+n+e)},ElasticEaseInOut(t,e,n,i,r,o){let a=0;return 0===t?e:2==(t/=i/2)?e+n:(o||(o=i*(.3*1.5)),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)*.5+n+e)},BounceEaseOut:(t,e,n,i)=>(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,n,i)=>n-te.BounceEaseOut(i-t,0,n,i)+e,BounceEaseInOut:(t,e,n,i)=>t<i/2?.5*te.BounceEaseIn(2*t,0,n,i)+e:.5*te.BounceEaseOut(2*t-i,0,n,i)+.5*n+e,EaseIn:(t,e,n,i)=>n*(t/=i)*t+e,EaseOut:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,EaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,i)=>n*(t/=i)*t*t*t*t+e,StrongEaseOut:(t,e,n,i)=>n*((t=t/i-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,i)=>n*t/i+e},ee=g._assign(n,{Util:g,Transform:o,Node:q,Container:Q,Stage:Dt,stages:Mt,Layer:jt,FastLayer:Ut,Group:Vt,DD:T,Shape:Nt,shapes:Ht,Animation:Zt,Tween:$t,Easings:te,Context:b,Canvas:x});function ne(t,e,n,i,r,o,a){const s=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2)),h=Math.sqrt(Math.pow(r-n,2)+Math.pow(o-i,2)),l=a*s/(s+h),u=a*h/(s+h);return[n-l*(r-t),i-l*(o-e),n+u*(r-t),i+u*(o-e)]}function ie(t,e){const n=t.length,i=[];for(let r=2;r<n-2;r+=2){const n=ne(t[r-2],t[r-1],t[r],t[r+1],t[r+2],t[r+3],e);isNaN(n[0])||(i.push(n[0]),i.push(n[1]),i.push(t[r]),i.push(t[r+1]),i.push(n[2]),i.push(n[3]))}return i}class re extends Nt{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){const e=this.points(),n=e.length,i=this.tension(),r=this.closed(),o=this.bezier();if(!n)return;let a=0;if(t.beginPath(),t.moveTo(e[0],e[1]),0!==i&&n>4){const i=this.getTensionPoints(),o=i.length;for(a=r?0:4,r||t.quadraticCurveTo(i[0],i[1],i[2],i[3]);a<o-2;)t.bezierCurveTo(i[a++],i[a++],i[a++],i[a++],i[a++],i[a++]);r||t.quadraticCurveTo(i[o-2],i[o-1],e[n-2],e[n-1])}else if(o)for(a=2;a<n;)t.bezierCurveTo(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);else for(a=2;a<n;a+=2)t.lineTo(e[a],e[a+1]);r?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():ie(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),e=t.length,n=this.tension(),i=ne(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),r=ne(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),o=ie(t,n);return[i[2],i[3]].concat(o).concat([r[0],r[1],t[e-2],t[e-1],r[2],r[3],i[0],i[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points();let e,n,i=t[0],r=t[0],o=t[1],a=t[1];for(let s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],i=Math.min(i,e),r=Math.max(r,e),o=Math.min(o,n),a=Math.max(a,n);return{x:i,y:o,width:r-i,height:a-o}}}re.prototype.className="Line",re.prototype._attrsAffectingSize=["points","bezier","tension"],i(re),R.addGetterSetter(re,"closed",!1),R.addGetterSetter(re,"bezier",!1),R.addGetterSetter(re,"tension",0,I()),R.addGetterSetter(re,"points",[],function(){if(n.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(g._isArray(t)?t.forEach(function(t){g._isNumber(t)||g.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):g.warn(A(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());class oe extends Nt{_sceneFunc(t){const e=this.cornerRadius(),n=this.width(),i=this.height();t.beginPath(),e?g.drawRoundedRectPath(t,n,i,e):t.rect(0,0,n,i),t.closePath(),t.fillStrokeShape(this)}}function ae(t){return[...t].reduce((t,e,n,i)=>{if(/\p{Emoji}/u.test(e)){const r=i[n+1];r&&/\p{Emoji_Modifier}|\u200D/u.test(r)?(t.push(e+r),i[n+1]=""):t.push(e)}else/\p{Regional_Indicator}{2}/u.test(e+(i[n+1]||""))?t.push(e+i[n+1]):n>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(e)?t[t.length-1]+=e:e&&t.push(e);return t},[])}oe.prototype.className="Rect",i(oe),R.addGetterSetter(oe,"cornerRadius",0,function(t){if(n.isUnminified)return function(e,n){let i=g._isNumber(e),r=g._isArray(e)&&e.length==t;return i||r||g.warn(A(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}(4));const se="auto",he="inherit",le="justify",ue="left",ce="middle",de="normal",fe=" ",pe="none",ge=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],me=ge.length;let _e;function ve(){return _e||(_e=g.createCanvasElement().getContext("2d"),_e)}class ye extends Nt{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<me;t++)this.on(ge[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e,i;const r=this.textArr,o=r.length;if(!this.text())return;let a,s=this.padding(),h=this.fontSize(),l=this.lineHeight()*h,u=this.verticalAlign(),c=this.direction(),d=0,f=this.align(),p=this.getWidth(),g=this.letterSpacing(),m=this.charRenderFunc(),_=this.fill(),v=this.textDecoration(),y=-1!==v.indexOf("underline"),b=-1!==v.indexOf("line-through");c=c===he?t.direction:c;let w=l/2,S=ce;if(!n.legacyTextRendering){const t=this.measureSize("M");S="alphabetic";w=((null!==(e=t.fontBoundingBoxAscent)&&void 0!==e?e:t.actualBoundingBoxAscent)-(null!==(i=t.fontBoundingBoxDescent)&&void 0!==i?i:t.actualBoundingBoxDescent))/2+l/2}for("rtl"===c&&t.setAttr("direction",c),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",S),t.setAttr("textAlign",ue),u===ce?d=(this.getHeight()-o*l-2*s)/2:"bottom"===u&&(d=this.getHeight()-o*l-2*s),t.translate(s,d+s),a=0;a<o;a++){let e=0,i=0;const u=r[a],d=u.text,v=u.width,S=u.lastInParagraph;if(t.save(),"right"===f?e+=p-v-2*s:"center"===f&&(e+=(p-v-2*s)/2),y){t.save(),t.beginPath();const r=e,o=w+i+(n.legacyTextRendering?Math.round(h/2):Math.round(h/4));t.moveTo(r,o);const a=f!==le||S?v:p-2*s;t.lineTo(r+Math.round(a),o),t.lineWidth=h/15;const l=this._getLinearGradient();t.strokeStyle=l||_,t.stroke(),t.restore()}const x=e;if("rtl"===c||0===g&&f!==le&&!m)0!==g&&t.setAttr("letterSpacing",`${g}px`),this._partialTextX=e,this._partialTextY=w+i,this._partialText=d,t.fillStrokeShape(this);else{const n=d.split(" ").length-1,o=ae(d);for(let h=0;h<o.length;h++){const l=o[h];if(" "!==l||S||f!==le||(e+=(p-2*s-v)/n),this._partialTextX=e,this._partialTextY=w+i,this._partialText=l,m){t.save();m({char:l,index:h+r.slice(0,a).reduce((t,e)=>t+ae(e.text).length,0),x:e,y:w+i,lineIndex:a,column:h,isLastInLine:S,width:this.measureSize(l).width,context:t})}t.fillStrokeShape(this),m&&t.restore(),e+=this.measureSize(l).width+g}}if(b){t.save(),t.beginPath();const e=n.legacyTextRendering?0:-Math.round(h/4),r=x;t.moveTo(r,w+i+e);const o=f!==le||S?v:p-2*s;t.lineTo(r+Math.round(o),w+i+e),t.lineWidth=h/15;const a=this._getLinearGradient();t.strokeStyle=a||_,t.stroke(),t.restore()}t.restore(),o>1&&(w+=l)}}_hitFunc(t){const e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(t){const e=g._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===se||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===se||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return g.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n,i,r,o,a,s,h,l,u,c;let d,f=ve(),p=this.fontSize();f.save(),f.font=this._getContextFont(),d=f.measureText(t),f.restore();const g=p/100;return{actualBoundingBoxAscent:null!==(e=d.actualBoundingBoxAscent)&&void 0!==e?e:71.58203125*g,actualBoundingBoxDescent:null!==(n=d.actualBoundingBoxDescent)&&void 0!==n?n:0,actualBoundingBoxLeft:null!==(i=d.actualBoundingBoxLeft)&&void 0!==i?i:-7.421875*g,actualBoundingBoxRight:null!==(r=d.actualBoundingBoxRight)&&void 0!==r?r:75.732421875*g,alphabeticBaseline:null!==(o=d.alphabeticBaseline)&&void 0!==o?o:0,emHeightAscent:null!==(a=d.emHeightAscent)&&void 0!==a?a:100*g,emHeightDescent:null!==(s=d.emHeightDescent)&&void 0!==s?s:-20*g,fontBoundingBoxAscent:null!==(h=d.fontBoundingBoxAscent)&&void 0!==h?h:91*g,fontBoundingBoxDescent:null!==(l=d.fontBoundingBoxDescent)&&void 0!==l?l:21*g,hangingBaseline:null!==(u=d.hangingBaseline)&&void 0!==u?u:72.80000305175781*g,ideographicBaseline:null!==(c=d.ideographicBaseline)&&void 0!==c?c:-21*g,width:d.width,height:p}}_getContextFont(){return this.fontStyle()+fe+this.fontVariant()+fe+(this.fontSize()+"px ")+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){this.align()===le&&(t=t.trim());const e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){const e=this.letterSpacing(),n=t.length;return ve().measureText(t).width+e*n}_setTextData(){let t=this.text().split("\n"),e=+this.fontSize(),n=0,i=this.lineHeight()*e,r=this.attrs.width,o=this.attrs.height,a=r!==se&&void 0!==r,s=o!==se&&void 0!==o,h=this.padding(),l=r-2*h,u=o-2*h,c=0,d=this.wrap(),f="char"!==d&&d!==pe,p=this.ellipsis();this.textArr=[],ve().font=this._getContextFont();const g=p?this._getTextWidth(""):0;for(let e=0,r=t.length;e<r;++e){let o=t[e],h=this._getTextWidth(o);if(a&&h>l)for(;o.length>0;){let t=0,e=ae(o).length,r="",a=0;for(;t<e;){const n=t+e>>>1,h=ae(o).slice(0,n+1).join(""),d=this._getTextWidth(h);(p&&s&&c+i>u?d+g:d)<=l?(t=n+1,r=h,a=d):e=n}if(!r)break;if(f){const e=ae(o),n=ae(r),i=e[n.length];let s;if((i===fe||"-"===i)&&a<=l)s=n.length;else{const t=n.lastIndexOf(fe),e=n.lastIndexOf("-");s=Math.max(t,e)+1}s>0&&(t=s,r=e.slice(0,t).join(""),a=this._getTextWidth(r))}r=r.trimRight(),this._addTextLine(r),n=Math.max(n,a),c+=i;if(this._shouldHandleEllipsis(c)){this._tryToAddEllipsisToLastLine();break}if(o=ae(o).slice(t).join("").trimLeft(),o.length>0&&(h=this._getTextWidth(o),h<=l)){this._addTextLine(o),c+=i,n=Math.max(n,h);break}}else this._addTextLine(o),c+=i,n=Math.max(n,h),this._shouldHandleEllipsis(c)&&e<r-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),s&&c+i>u)break}this.textHeight=e,this.textWidth=n}_shouldHandleEllipsis(t){const e=+this.fontSize(),n=this.lineHeight()*e,i=this.attrs.height,r=i!==se&&void 0!==i,o=i-2*this.padding();return!(this.wrap()!==pe)||r&&t+n>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,e=t!==se&&void 0!==t,n=t-2*this.padding(),i=this.ellipsis(),r=this.textArr[this.textArr.length-1];if(r&&i){if(e){this._getTextWidth(r.text+"")<n||(r.text=r.text.slice(0,r.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(r.text+"")}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas()}}function be(t,e){this._waveformData=t,this._channelIndex=e}ye.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},ye.prototype._strokeFunc=function(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},ye.prototype.className="Text",ye.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],i(ye),R.overWriteSetter(ye,"width",E()),R.overWriteSetter(ye,"height",E()),R.addGetterSetter(ye,"direction",he),R.addGetterSetter(ye,"fontFamily","Arial"),R.addGetterSetter(ye,"fontSize",12,I()),R.addGetterSetter(ye,"fontStyle",de),R.addGetterSetter(ye,"fontVariant",de),R.addGetterSetter(ye,"padding",0,I()),R.addGetterSetter(ye,"align",ue),R.addGetterSetter(ye,"verticalAlign","top"),R.addGetterSetter(ye,"lineHeight",1,I()),R.addGetterSetter(ye,"wrap","word"),R.addGetterSetter(ye,"ellipsis",!1,D()),R.addGetterSetter(ye,"letterSpacing",0,I()),R.addGetterSetter(ye,"text","",P()),R.addGetterSetter(ye,"textDecoration",""),R.addGetterSetter(ye,"charRenderFunc",void 0),be.prototype.min_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._at(e)},be.prototype.max_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._at(e)},be.prototype.set_min_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._set_at(n,e)},be.prototype.set_max_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._set_at(n,e)},be.prototype.min_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.min_sample(n));return e},be.prototype.max_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.max_sample(n));return e};function we(t){for(var e=t.scale,n=t.amplitude_scale,i=t.split_channels,r=t.length,o=t.sample_rate,a=t.channels.map(function(t){return new Float32Array(t)}),s=i?a.length:1,h=function(t,e){var n=Math.floor(t/e);return t-n*e>0&&n++,n}(r,e),l=8===t.bits?1:2,u=new ArrayBuffer(24+2*h*l*s),c=new DataView(u),d=0,f=24,p=new Array(s),g=new Array(s),m=0;m<s;m++)p[m]=1/0,g[m]=-1/0;var _=8===t.bits?-128:-32768,v=8===t.bits?127:32767;c.setInt32(0,2,!0),c.setUint32(4,8===t.bits,!0),c.setInt32(8,o,!0),c.setInt32(12,e,!0),c.setInt32(16,h,!0),c.setInt32(20,s,!0);for(var y=0;y<r;y++){var b=0;if(1===s){for(var w=0;w<a.length;++w)b+=a[w][y];(b=Math.floor(v*b*n/a.length))<p[0]&&(p[0]=b,p[0]<_&&(p[0]=_)),b>g[0]&&(g[0]=b,g[0]>v&&(g[0]=v))}else for(var S=0;S<s;++S)(b=Math.floor(v*a[S][y]*n))<p[S]&&(p[S]=b,p[S]<_&&(p[S]=_)),b>g[S]&&(g[S]=b,g[S]>v&&(g[S]=v));if(++d===e){for(var x=0;x<s;x++)8===t.bits?(c.setInt8(f++,p[x]),c.setInt8(f++,g[x])):(c.setInt16(f,p[x],!0),c.setInt16(f+2,g[x],!0),f+=4),p[x]=1/0,g[x]=-1/0;d=0}}if(d>0)for(var C=0;C<s;C++)8===t.bits?(c.setInt8(f++,p[C]),c.setInt8(f++,g[C])):(c.setInt16(f,p[C],!0),c.setInt16(f+2,g[C],!0));return u}function Se(t){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(t)}function xe(t){return null==t}function Ce(t,e,n){var i=function(t){return atob(t)}(t),r=i.indexOf("\n",10)+1,o=i.substring(r)+"",a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}function ke(t,e,n){var i;return function(e){return i=i||Ce(t),new Worker(i,e)}}var Te=ke("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgdmFyIElOVDE2X01BWCA9IDMyNzY3OwogIHZhciBJTlQxNl9NSU4gPSAtMzI3Njg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgaGVhZGVyX3NpemUgPSAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciBieXRlc19wZXJfc2FtcGxlID0gb3B0aW9ucy5iaXRzID09PSA4ID8gMSA6IDI7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogYnl0ZXNfcGVyX3NhbXBsZSAqIG91dHB1dF9jaGFubmVsczsKICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxfc2l6ZSk7CiAgICB2YXIgZGF0YV92aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB2YXIgc2NhbGVfY291bnRlciA9IDA7CiAgICB2YXIgb2Zmc2V0ID0gaGVhZGVyX3NpemU7CiAgICB2YXIgbWluX3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICB2YXIgbWF4X3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICBmb3IgKHZhciBjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CiAgICB2YXIgcmFuZ2VfbWluID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NSU4gOiBJTlQxNl9NSU47CiAgICB2YXIgcmFuZ2VfbWF4ID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NQVggOiBJTlQxNl9NQVg7CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMCwgMiwgdHJ1ZSk7IC8vIFZlcnNpb24KICAgIGRhdGFfdmlldy5zZXRVaW50MzIoNCwgb3B0aW9ucy5iaXRzID09PSA4LCB0cnVlKTsgLy8gSXMgOCBiaXQ/CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoOCwgc2FtcGxlX3JhdGUsIHRydWUpOyAvLyBTYW1wbGUgcmF0ZQogICAgZGF0YV92aWV3LnNldEludDMyKDEyLCBzY2FsZSwgdHJ1ZSk7IC8vIFNjYWxlCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTYsIGRhdGFfbGVuZ3RoLCB0cnVlKTsgLy8gTGVuZ3RoCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMjAsIG91dHB1dF9jaGFubmVscywgdHJ1ZSk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzYW1wbGUgPSAwOwogICAgICBpZiAob3V0cHV0X2NoYW5uZWxzID09PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwgPSAwOyBfY2hhbm5lbCA8IGNoYW5uZWxzLmxlbmd0aDsgKytfY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlICs9IGNoYW5uZWxzW19jaGFubmVsXVtpXTsKICAgICAgICB9CiAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBzYW1wbGUgKiBhbXBsaXR1ZGVfc2NhbGUgLyBjaGFubmVscy5sZW5ndGgpOwogICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbMF0pIHsKICAgICAgICAgIG1pbl92YWx1ZVswXSA9IHNhbXBsZTsKICAgICAgICAgIGlmIChtaW5fdmFsdWVbMF0gPCByYW5nZV9taW4pIHsKICAgICAgICAgICAgbWluX3ZhbHVlWzBdID0gcmFuZ2VfbWluOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlWzBdKSB7CiAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWF4X3ZhbHVlWzBdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgIG1heF92YWx1ZVswXSA9IHJhbmdlX21heDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwyID0gMDsgX2NoYW5uZWwyIDwgb3V0cHV0X2NoYW5uZWxzOyArK19jaGFubmVsMikgewogICAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBjaGFubmVsc1tfY2hhbm5lbDJdW2ldICogYW1wbGl0dWRlX3NjYWxlKTsKICAgICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtaW5fdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtfY2hhbm5lbDJdIDwgcmFuZ2VfbWluKSB7CiAgICAgICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9taW47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzYW1wbGUgPiBtYXhfdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtYXhfdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1heF92YWx1ZVtfY2hhbm5lbDJdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgICAgbWF4X3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9tYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKHZhciBfY2hhbm5lbDMgPSAwOyBfY2hhbm5lbDMgPCBvdXRwdXRfY2hhbm5lbHM7IF9jaGFubmVsMysrKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtaW5fdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50MTYob2Zmc2V0LCBtaW5fdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQxNihvZmZzZXQgKyAyLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgfQogICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsM10gPSBJbmZpbml0eTsKICAgICAgICAgIG1heF92YWx1ZVtfY2hhbm5lbDNdID0gLUluZmluaXR5OwogICAgICAgIH0KICAgICAgICBzY2FsZV9jb3VudGVyID0gMDsKICAgICAgfQogICAgfQogICAgaWYgKHNjYWxlX2NvdW50ZXIgPiAwKSB7CiAgICAgIGZvciAodmFyIF9jaGFubmVsNCA9IDA7IF9jaGFubmVsNCA8IG91dHB1dF9jaGFubmVsczsgX2NoYW5uZWw0KyspIHsKICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWluX3ZhbHVlW19jaGFubmVsNF0pOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtfY2hhbm5lbDRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW19jaGFubmVsNF0sIHRydWUpOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCArIDIsIG1heF92YWx1ZVtfY2hhbm5lbDRdLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBidWZmZXI7CiAgfQoKICBvbm1lc3NhZ2UgPSBmdW5jdGlvbiBvbm1lc3NhZ2UoZXZ0KSB7CiAgICB2YXIgYnVmZmVyID0gZ2VuZXJhdGVXYXZlZm9ybURhdGEoZXZ0LmRhdGEpOwoKICAgIC8vIFRyYW5zZmVyIGJ1ZmZlciB0byB0aGUgY2FsbGluZyB0aHJlYWQKICAgIHRoaXMucG9zdE1lc3NhZ2UoYnVmZmVyLCBbYnVmZmVyXSk7CiAgICB0aGlzLmNsb3NlKCk7CiAgfTsKCn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdhdmVmb3JtLWRhdGEtd29ya2VyLmpzLm1hcAoK");function Ae(t){if(function(t){return t&&"object"===Se(t)&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t}(t)&&(t=function(t){var e=t.data,n=t.channels||1,i=8===t.bits?1:2,r=2*t.length*n;if(e.length!==r)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var o=24+e.length*i,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===t.bits,!0),s.setInt32(8,t.sample_rate,!0),s.setInt32(12,t.samples_per_pixel,!0),s.setInt32(16,t.length,!0),s.setInt32(20,n,!0);var h=24;if(8===t.bits)for(var l=0;l<e.length;l++)s.setInt8(h++,e[l],!0);else for(var u=0;u<e.length;u++)s.setInt16(h,e[u],!0),h+=2;return a}(t)),!function(t){var e=t&&"object"===Se(t)&&"byteLength"in t;if(e){var n=new DataView(t).getInt32(0,!0);if(1!==n&&2!==n)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}(t))throw new TypeError("WaveformData.create(): Unknown data format");this._data=new DataView(t),this._offset=2===this._version()?24:20,this._channels=[];for(var e=0;e<this.channels;e++)this._channels[e]=new be(this,e)}var Ie=512,Ee=8,Pe=1,Me=!1,De=!1;function Oe(t,e,n){var i=function(t){for(var e=[],n=0;n<t.numberOfChannels;++n)e.push(t.getChannelData(n).buffer);return e}(t);if(e.disable_worker){var r=we({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:i});n(void 0,new Ae(r),t)}else{var o=new Te;o.onmessage=function(e){n(void 0,new Ae(e.data),t)},o.postMessage({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:i},i)}}function Le(t){this._inputData=t.waveformData,this._output_samples_per_pixel=t.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var e=this._input_buffer_size*this._inputData.scale,n=Math.ceil(e/this._output_samples_per_pixel),i=8===this._inputData.bits?1:2,r=24+2*n*this._inputData.channels*i;this._output_data=new ArrayBuffer(r),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,8===this._inputData.bits,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,n,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new Ae(this._output_data),this._input_index=0,this._output_index=0;var o=this._inputData.channels;this._min=new Array(o),this._max=new Array(o);for(var a=0;a<o;++a)this._input_buffer_size>0?(this._min[a]=this._inputData.channel(a).min_sample(this._input_index),this._max[a]=this._inputData.channel(a).max_sample(this._input_index)):(this._min[a]=0,this._max[a]=0);this._min_value=8===this._inputData.bits?-128:-32768,this._max_value=8===this._inputData.bits?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}function Re(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}Ae.create=function(t){return new Ae(t)},Ae.createFromAudio=function(t,e){var n=function(t){return{scale:t.scale||Ie,bits:t.bits||Ee,amplitude_scale:t.amplitude_scale||Pe,split_channels:t.split_channels||Me,disable_worker:t.disable_worker||De}}(t);if(t.audio_context&&t.array_buffer)return function(t,e,n,i){function r(t){t||(t=new DOMException("EncodingError")),i(t),i=function(){}}var o=t.decodeAudioData(e,function(t){Oe(t,n,i)},r);o&&o.catch(r)}(t.audio_context,t.array_buffer,n,e);if(t.audio_buffer)return Oe(t.audio_buffer,n,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")},Le.prototype.sample_at_pixel=function(t){return Math.floor(t*this._output_samples_per_pixel)},Le.prototype.next=function(){for(var t,e=0,n=this._inputData.channels;this._input_index<this._input_buffer_size&&e<1e3;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(var i=0;i<n;++i)(t=this._outputWaveformData.channel(i)).set_min_sample(this._output_index-1,this._min[i]),t.set_max_sample(this._output_index-1,this._max[i]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(var r=0;r<n;++r)this._min[r]=this._max_value,this._max[r]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(var o=0;o<n;++o){var a=(t=this._inputData.channel(o)).min_sample(this._input_index);a<this._min[o]&&(this._min[o]=a),(a=t.max_sample(this._input_index))>this._max[o]&&(this._max[o]=a)}this._input_index++}e++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(var s=0;s<n;++s)(t=this._outputWaveformData.channel(s)).set_min_sample(this._output_index-1,this._min[s]),t.set_max_sample(this._output_index-1,this._max[s]);return!0},Le.prototype.getOutputData=function(){return this._output_data},Ae.prototype={_getResampleOptions:function(t){var e={};if(e.scale=t.scale,e.width=t.width,!xe(e.width)&&("number"!=typeof e.width||e.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(!xe(e.scale)&&("number"!=typeof e.scale||e.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!e.scale&&!e.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(e.width&&(e.scale=Math.floor(this.duration*this.sample_rate/e.width)),e.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+e.scale+" too low, minimum: "+this.scale);return e.abortSignal=t.abortSignal,e},resample:function(t){(t=this._getResampleOptions(t)).waveformData=this;for(var e=new Le(t);!e.next(););return new Ae(e.getOutputData())},concat:function(){var t=this,e=Array.prototype.slice.call(arguments);e.forEach(function(e){if(t.channels!==e.channels||t.sample_rate!==e.sample_rate||t.bits!==e.bits||t.scale!==e.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")});var n=this._concatBuffers.apply(this,e);return Ae.create(n)},_concatBuffers:function(){for(var t=Array.prototype.slice.call(arguments),e=this._offset,n=e,i=0,r=[this].concat(t).map(function(t){return t._data.buffer}),o=0;o<r.length;o++){var a=r[o],s=new DataView(a).getInt32(16,!0);n+=a.byteLength-e,i+=s}for(var h=new ArrayBuffer(n),l=new DataView(r[0]),u=new DataView(h),c=0;c<e;c++)u.setUint8(c,l.getUint8(c));u.setInt32(16,i,!0);for(var d=0,f=new Uint8Array(h,e),p=0;p<r.length;p++){var g=r[p];f.set(new Uint8Array(g,e),d),d+=g.byteLength-e}return h},slice:function(t){var e=0,n=0;if(xe(t.startIndex)||xe(t.endIndex)?xe(t.startTime)||xe(t.endTime)||(e=this.at_time(t.startTime),n=this.at_time(t.endTime)):(e=t.startIndex,n=t.endIndex),e<0)throw new RangeError("startIndex or startTime must not be negative");if(n<0)throw new RangeError("endIndex or endTime must not be negative");e>this.length&&(e=this.length),n>this.length&&(n=this.length),e>n&&(e=n);var i=n-e,r=8===this.bits?1:2,o=24+2*i*this.channels*r,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===this.bits,!0),s.setInt32(8,this.sample_rate,!0),s.setInt32(12,this.scale,!0),s.setInt32(16,i,!0),s.setInt32(20,this.channels,!0);for(var h=0;h<i*this.channels*2;h++){var l=this._at(e*this.channels*2+h);8===this.bits?s.setInt8(24+h,l):s.setInt16(24+2*h,l,!0)}return new Ae(a)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return 2===this._version()?this._data.getInt32(20,!0):1},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return 8===this.bits?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+2*t,!0)},_set_at:function(t,e){return 8===this.bits?this._data.setInt8(this._offset+t,e):this._data.setInt16(this._offset+2*t,e,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},e=0;e<this.length;e++)for(var n=0;n<this.channels;n++)t.data.push(this.channel(n).min_sample(e)),t.data.push(this.channel(n).max_sample(e));return t},toArrayBuffer:function(){return this._data.buffer}};var Fe,We={exports:{}};var Be=(Fe||(Fe=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||t,a),h=n?n+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],s]:t._events[h].push(s):(t._events[h]=s,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,i,r=[];if(0===this._eventsCount)return r;for(i in t=this._events)e.call(t,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},s.prototype.emit=function(t,e,i,r,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var h,l,u=this._events[s],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,r),!0;case 5:return u.fn.call(u.context,e,i,r,o),!0;case 6:return u.fn.call(u.context,e,i,r,o,a),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,r);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var h=0,l=[],u=s.length;h<u;h++)(s[h].fn!==e||r&&!s[h].once||i&&s[h].context!==i)&&l.push(s[h]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(We)),We.exports),Ge=Re(Be);function He(t){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(t)}function Ne(t,e,n){this.time=t,this.type=e,this.id=n}function ze(t,e){for(t=t.toString();t.length<e;)t="0"+t;return t}function Xe(t,e){var n=[],i=Math.floor(t%1*Math.pow(10,e)),r=Math.floor(t),o=Math.floor(r/60),a=Math.floor(o/60);a>0&&n.push(a),n.push(o%60),n.push(r%60);for(var s=0;s<n.length;s++)n[s]=ze(n[s],2);return n=n.join(":"),e>0&&(n+="."+ze(i,e)),n}function je(t,e,n){return t<e?e:t>n?n:t}function Ue(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ve(t,e){for(var n in e)Ue(e,n)&&(t[n]=e[n]);return t}function Ye(t){return"number"==typeof t}function Ze(t){return"number"==typeof t&&Number.isFinite(t)}function Ke(t){return null!==t&&"object"===He(t)&&!Array.isArray(t)}function qe(t){return"string"==typeof t}function Je(t){return null==t}function Qe(t){return!0===t||!1===t}function $e(t){return t instanceof HTMLElement}function tn(t){return Ke(t)&&Ue(t,"linearGradientStart")&&Ue(t,"linearGradientEnd")&&Ue(t,"linearGradientColorStops")&&Ye(t.linearGradientStart)&&Ye(t.linearGradientEnd)&&function(t){return Array.isArray(t)}(t.linearGradientColorStops)&&2===t.linearGradientColorStops.length}function en(t){for(;null!==t.parent;){if(t.parent instanceof ee.Layer)return t;t=t.parent}return null}Ne.POINT=0,Ne.SEGMENT_START=1,Ne.SEGMENT_END=2,Ne.sorter=function(t,e){return t.time-e.time};var nn=/HeadlessChrome/.test(navigator.userAgent);var rn=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,on=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,an={forward:{},reverse:{}};an.forward[Ne.POINT]=0,an.forward[Ne.SEGMENT_START]=1,an.forward[Ne.SEGMENT_END]=2,an.reverse[Ne.POINT]=0,an.reverse[Ne.SEGMENT_START]=2,an.reverse[Ne.SEGMENT_END]=1;var sn={0:"points.enter",1:"segments.enter",2:"segments.exit"},hn={};function ln(t,e){switch(e.type){case Ne.POINT:return t.points.getPoint(e.id);case Ne.SEGMENT_START:case Ne.SEGMENT_END:return t.segments.getSegment(e.id);default:throw new Error("getPointOrSegment: id not found?")}}function un(t){this._cues=[],this._peaks=t,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}function cn(t){return function(e){return e.id===t}}hn[0]="point",hn[1]="segment",hn[2]="segment",un.prototype._updateCues=function(){var t=this,e=t._peaks.points.getPoints(),n=t._peaks.segments.getSegments();t._cues.length=0,e.forEach(function(e){t._cues.push(new Ne(e.time,Ne.POINT,e.id))}),n.forEach(function(e){t._cues.push(new Ne(e.startTime,Ne.SEGMENT_START,e.id)),t._cues.push(new Ne(e.endTime,Ne.SEGMENT_END,e.id))}),t._cues.sort(Ne.sorter);var i=t._peaks.player.getCurrentTime();t._updateActiveSegments(i)},un.prototype._onUpdate=function(t,e){var n,i,r,o=t>e;o?(n=0,i=this._cues.length,r=1):(n=this._cues.length-1,i=-1,r=-1);for(var a=n;o?a<i:a>i;a+=r){var s=this._cues[a];if(o?s.time>e:s.time<e){if(o?s.time>t:s.time<t)break;var h=ln(this._peaks,s),l=o?an.forward[s.type]:an.reverse[s.type];1===l?this._activeSegments[h.id]=h:2===l&&delete this._activeSegments[h.id];var u={time:t};u[hn[l]]=h,this._peaks.emit(sn[l],u)}}},un.prototype._onTimeUpdate=function(t){(nn||navigator.webdriver||"object"!==("undefined"==typeof document?"undefined":He(document))||!("visibilityState"in document)||"visible"!==document.visibilityState)&&(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(t,this._previousTime),this._previousTime=t)},un.prototype._onAnimationFrame=function(){var t=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(t,this._previousTime),this._previousTime=t,this._peaks.player.isPlaying()&&(this._rAFHandle=rn(this._onAnimationFrame))},un.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=rn(this._onAnimationFrame)},un.prototype._onSeeked=function(t){this._previousTime=t,this._updateActiveSegments(t)},un.prototype._updateActiveSegments=function(t){var e=this,n=e._peaks.segments.getSegmentsAtTime(t);for(var i in e._activeSegments){if(Ue(e._activeSegments,i))n.find(cn(i))||(e._peaks.emit("segments.exit",{segment:e._activeSegments[i],time:t}),delete e._activeSegments[i])}n.forEach(function(n){n.id in e._activeSegments||(e._activeSegments[n.id]=n,e._peaks.emit("segments.enter",{segment:n,time:t}))})};var dn=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];un.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var t=0;t<dn.length;t++)this._peaks.on(dn[t],this._updateCues);this._updateCues()},un.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var t=0;t<dn.length;t++)this._peaks.off(dn[t],this._updateCues)},un.prototype.destroy=function(){this._rAFHandle&&(on(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var fn=["id","pid","time","labelText","color","editable"],pn=["update","isVisible","peaks","pid"];function gn(t,e){var n=e?"update()":"add()";if((!e||e&&Ue(t,"time"))&&!Ze(t.time))throw new TypeError("peaks.points."+n+": time should be a numeric value");if(t.time<0)throw new RangeError("peaks.points."+n+": time should not be negative");if(Ue(t,"labelText")&&!qe(t.labelText))throw new TypeError("peaks.points."+n+": labelText must be a string");if(Ue(t,"editable")&&!Qe(t.editable))throw new TypeError("peaks.points."+n+": editable must be true or false");if(Ue(t,"color")&&!qe(t.color)&&!tn(t.color))throw new TypeError("peaks.points."+n+": color must be a string or a valid linear gradient object");pn.forEach(function(e){if(Ue(t,e))throw new Error("peaks.points."+n+": invalid option name: "+e)}),fn.forEach(function(e){if(Ue(t,"_"+e))throw new Error("peaks.points."+n+": invalid option name: _"+e)})}function mn(t,e,n){this._peaks=t,this._pid=e,this._setUserData(n)}function _n(t){this._peaks=t,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}mn.prototype._setUserData=function(t){for(var e in t)Ue(t,e)&&(-1===fn.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(mn.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),mn.prototype.update=function(t){if(gn(t,!0),Ue(t,"id")){if(Je(t.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,t.id)}this._setUserData(t),this._peaks.emit("points.update",this,t)},mn.prototype.isVisible=function(t,e){return this.time>=t&&this.time<e},mn.prototype._setTime=function(t){this._time=t},_n.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++},_n.prototype._getNextPid=function(){return this._pointPid++},_n.prototype._addPoint=function(t){this._points.push(t),this._pointsById[t.id]=t,this._pointsByPid[t.pid]=t},_n.prototype._createPoint=function(t){var e={};Ve(e,t),Je(e.id)&&(e.id=this._getNextPointId());var n=this._getNextPid();return function(t,e){Je(t.labelText)&&(t.labelText=""),Je(t.editable)&&(t.editable=!1),Je(t.color)&&(t.color=e.pointMarkerColor)}(e,this._peaks.options),gn(e,!1),new mn(this._peaks,n,e)},_n.prototype.getPoints=function(){return this._points},_n.prototype.getPoint=function(t){return this._pointsById[t]},_n.prototype.find=function(t,e){return this._points.filter(function(n){return n.isVisible(t,e)})},_n.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createPoint(e);if(Ue(t._pointsById,n.id))throw new Error("peaks.points.add(): duplicate id");return n}),n.forEach(function(e){t._addPoint(e)}),this._peaks.emit("points.add",{points:n}),e?n:n[0]},_n.prototype.updatePointId=function(t,e){if(this._pointsById[t.id]){if(this._pointsById[e])throw new Error("point.update(): duplicate id");delete this._pointsById[t.id],this._pointsById[e]=t}},_n.prototype._findPoint=function(t){for(var e=[],n=0,i=this._points.length;n<i;n++)t(this._points[n])&&e.push(n);return e},_n.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n]-e.length,r=this._points.splice(i,1)[0];delete this._pointsById[r.id],delete this._pointsByPid[r.pid],e.push(r)}return e},_n.prototype._removePoints=function(t){var e=this._findPoint(t),n=this._removeIndexes(e);return this._peaks.emit("points.remove",{points:n}),n},_n.prototype.remove=function(t){return this._removePoints(function(e){return e===t})},_n.prototype.removeById=function(t){return this._removePoints(function(e){return e.id===t})},_n.prototype.removeByTime=function(t){return this._removePoints(function(e){return e.time===t})},_n.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var vn=["id","pid","startTime","endTime","labelText","color","borderColor","markers","overlay","editable"],yn=["update","isVisible","peaks","pid"];function bn(t,e){var n=e?"update()":"add()";if(Ue(t,"startTime")&&!Ze(t.startTime))throw new TypeError("peaks.segments."+n+": startTime should be a valid number");if(Ue(t,"endTime")&&!Ze(t.endTime))throw new TypeError("peaks.segments."+n+": endTime should be a valid number");if(!(e||Ue(t,"startTime")&&Ue(t,"endTime")))throw new TypeError("peaks.segments."+n+": missing startTime or endTime");if(t.startTime<0)throw new RangeError("peaks.segments."+n+": startTime should not be negative");if(t.endTime<0)throw new RangeError("peaks.segments."+n+": endTime should not be negative");if(t.endTime<t.startTime)throw new RangeError("peaks.segments."+n+": endTime should not be less than startTime");if(Ue(t,"labelText")&&!qe(t.labelText))throw new TypeError("peaks.segments."+n+": labelText must be a string");if(e&&Ue(t,"markers"))throw new TypeError("peaks.segments."+n+": cannot update markers attribute");if(Ue(t,"markers")&&!Qe(t.markers))throw new TypeError("peaks.segments."+n+": markers must be true or false");if(e&&Ue(t,"overlay"))throw new TypeError("peaks.segments."+n+": cannot update overlay attribute");if(Ue(t,"overlay")&&!Qe(t.overlay))throw new TypeError("peaks.segments."+n+": overlay must be true or false");if(Ue(t,"editable")&&!Qe(t.editable))throw new TypeError("peaks.segments."+n+": editable must be true or false");if(Ue(t,"color")&&!qe(t.color)&&!tn(t.color))throw new TypeError("peaks.segments."+n+": color must be a string or a valid linear gradient object");if(Ue(t,"borderColor")&&!qe(t.borderColor))throw new TypeError("peaks.segments."+n+": borderColor must be a string");yn.forEach(function(e){if(Ue(t,e))throw new Error("peaks.segments."+n+": invalid option name: "+e)}),vn.forEach(function(e){if(Ue(t,"_"+e))throw new Error("peaks.segments."+n+": invalid option name: _"+e)})}function wn(t,e,n){this._peaks=t,this._pid=e,this._id=n.id,this._startTime=n.startTime,this._endTime=n.endTime,this._labelText=n.labelText,this._color=n.color,this._borderColor=n.borderColor,this._editable=n.editable,this._markers=n.markers,this._overlay=n.overlay,this._setUserData(n)}function Sn(t){this._peaks=t,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}wn.prototype._setUserData=function(t){for(var e in t)Ue(t,e)&&(-1===vn.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(wn.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},markers:{enumerable:!0,get:function(){return this._markers}},overlay:{enumerable:!0,get:function(){return this._overlay}},editable:{enumerable:!0,get:function(){return this._editable}}}),wn.prototype.update=function(t){if(bn(t,!0),Ue(t,"id")){if(Je(t.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,t.id)}this._setUserData(t),this._peaks.emit("segments.update",this,t)},wn.prototype.isVisible=function(t,e){return this.startTime===this.endTime&&this.startTime===t||!(this.endTime<=t)&&!(this.startTime>=e)},wn.prototype._setStartTime=function(t){this._startTime=t},wn.prototype._setEndTime=function(t){this._endTime=t},Sn.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++},Sn.prototype._getNextPid=function(){return this._segmentPid++},Sn.prototype._addSegment=function(t){this._segments.push(t),this._segmentsById[t.id]=t,this._segmentsByPid[t.pid]=t},Sn.prototype._createSegment=function(t){var e={};Ve(e,t),Je(e.id)&&(e.id=this._getNextSegmentId());var n=this._getNextPid();return function(t,e){Je(t.color)&&(e.overlay?t.color=e.overlayColor:t.color=e.waveformColor),Je(t.borderColor)&&(t.borderColor=e.overlayBorderColor),Je(t.labelText)&&(t.labelText=""),Je(t.markers)&&(t.markers=e.markers),Je(t.overlay)&&(t.overlay=e.overlay),Je(t.editable)&&(t.editable=!1)}(e,this._peaks.options.segmentOptions),bn(e,!1),new wn(this._peaks,n,e)},Sn.prototype.getSegments=function(){return this._segments},Sn.prototype.getSegment=function(t){return this._segmentsById[t]},Sn.prototype.getSegmentsAtTime=function(t){return this._segments.filter(function(e){return t>=e.startTime&&t<e.endTime})},Sn.prototype.find=function(t,e){return this._segments.filter(function(n){return n.isVisible(t,e)})},Sn.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(t,e){return t.startTime-e.startTime})},Sn.prototype.findPreviousSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n-1]},Sn.prototype.findNextSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n+1]},Sn.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createSegment(e);if(Ue(t._segmentsById,n.id))throw new Error("peaks.segments.add(): duplicate id");return n}),n.forEach(function(e){t._addSegment(e)}),this._peaks.emit("segments.add",{segments:n,insert:this._isInserting}),e?n:n[0]},Sn.prototype.updateSegmentId=function(t,e){if(this._segmentsById[t.id]){if(this._segmentsById[e])throw new Error("segment.update(): duplicate id");delete this._segmentsById[t.id],this._segmentsById[e]=t}},Sn.prototype._findSegment=function(t){for(var e=[],n=0,i=this._segments.length;n<i;n++)t(this._segments[n])&&e.push(n);return e},Sn.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n]-e.length,r=this._segments.splice(i,1)[0];delete this._segmentsById[r.id],delete this._segmentsByPid[r.pid],e.push(r)}return e},Sn.prototype._removeSegments=function(t){var e=this._findSegment(t),n=this._removeIndexes(e);return this._peaks.emit("segments.remove",{segments:n}),n},Sn.prototype.remove=function(t){return this._removeSegments(function(e){return e===t})},Sn.prototype.removeById=function(t){return this._removeSegments(function(e){return e.id===t})},Sn.prototype.removeByTime=function(t,e){var n;return n=(e="number"==typeof e?e:0)>0?function(n){return n.startTime===t&&n.endTime===e}:function(e){return e.startTime===t},this._removeSegments(n)},Sn.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")},Sn.prototype.setInserting=function(t){this._isInserting=t},Sn.prototype.isInserting=function(){return this._isInserting};var xn=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],Cn=[32,9,37,39];function kn(t){this.eventEmitter=t,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}function Tn(t){this._mediaElement=t}function An(t,e){this._eventEmitter=t,this._mediaElement=e,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}function In(t){var e=function(t){for(var e=[],n=t;n;)Object.getOwnPropertyNames(n).forEach(function(t){e.push(t)}),n=Object.getPrototypeOf(n);return e}(t);["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"].forEach(function(n){if(!e.includes(n))throw new TypeError("Peaks.init(): Player method "+n+" is undefined");if("function"!=typeof t[n])throw new TypeError("Peaks.init(): Player method "+n+" is not a function")})}function En(t,e){this._peaks=t,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),In(e),this._adapter=e}function Pn(t){this._options=t,this._draggable=t.editable}function Mn(t){this._options=t,this._editable=t.editable}function Dn(t){return"zoomview"===t.view?new Mn(t):null}function On(t){return new ye({x:12,y:12,text:t.segment.labelText,textAlign:"center",fontFamily:t.fontFamily||"sans-serif",fontSize:t.fontSize||12,fontStyle:t.fontStyle||"normal",fill:"#000"})}function Ln(t){return new Pn(t)}function Rn(t,e){this._view=t,this._offset=e.highlightOffset,this._color=e.highlightColor,this._layer=new ee.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=e.highlightStrokeColor,this._opacity=e.highlightOpacity,this._cornerRadius=e.highlightCornerRadius}function Fn(t){this._point=t.point,this._marker=t.marker,this._draggable=t.draggable,this._onDragStart=t.onDragStart,this._onDragMove=t.onDragMove,this._onDragEnd=t.onDragEnd,this._dragBoundFunc=t.dragBoundFunc,this._onMouseEnter=t.onMouseEnter,this._onMouseLeave=t.onMouseLeave,this._group=new ee.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:t.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}function Wn(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._pointMarkers={},this._layer=new ee.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}function Bn(t,e,n){this._player=t,this._view=e,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=n.playheadColor,this._playheadTextColor=n.playheadTextColor,this._playheadBackgroundColor=n.playheadBackgroundColor,this._playheadPadding=n.playheadPadding,this._playheadWidth=n.playheadWidth,this._playheadFontFamily=n.playheadFontFamily,this._playheadFontSize=n.playheadFontSize,this._playheadFontStyle=n.playheadFontStyle,this._playheadLayer=new ee.Layer({listening:!1}),this._createPlayhead(),n.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}function Gn(t){this._options=t}function Hn(t){var e=this;e._segment=t.segment,e._marker=t.marker,e._segmentShape=t.segmentShape,e._editable=t.editable,e._startMarker=t.startMarker,e._onClick=t.onClick,e._onDragStart=t.onDragStart,e._onDragMove=t.onDragMove,e._onDragEnd=t.onDragEnd,e._group=new ee.Group({name:"segment-marker",segment:e._segment,draggable:e._editable,visible:e._editable,dragBoundFunc:function(n){return t.dragBoundFunc(e,n)}}),e._bindDefaultEventHandlers(),e._marker.init(e._group)}function Nn(t){this._color=t.color;var e={};if(qe(t.color))e.fill=t.color;else{if(!tn(t.color))throw new TypeError("Unknown type for color property");var n=t.view._height*(t.color.linearGradientStart/100),i=t.view._height*(t.color.linearGradientEnd/100);e.fillLinearGradientStartPointY=n,e.fillLinearGradientEndPointY=i,e.fillLinearGradientColorStops=[0,t.color.linearGradientColorStops[0],1,t.color.linearGradientColorStops[1]]}this._shape=new ee.Shape(e),this._view=t.view,this._segment=t.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}function zn(t,e,n,i){this._segment=t,this._peaks=e,this._layer=n,this._view=i,this._label=null,this._startMarker=null,this._endMarker=null,this._color=t.color,this._borderColor=t.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var r=i.getViewOptions(),o=r.segmentOptions;this._overlayOffset=o.overlayOffset,t.overlay||(this._waveformShape=new Nn({color:t.color,view:i,segment:t})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerClick=this._onSegmentMarkerClick.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:t,view:this._view.getName(),layer:this._layer,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle}),this._label&&this._label.hide();var a,s,h,l,u,c=this._view.timeToPixelOffset(this._segment.startTime),d=this._view.timeToPixelOffset(this._segment.endTime),f=je(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new ee.Group({name:"segment-overlay",segment:this._segment,x:c,y:0,width:d-c,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:d-c,clipHeight:f,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),t.overlay&&(a=this._borderColor||o.overlayBorderColor,s=o.overlayBorderWidth,h=this._color||o.overlayColor,l=o.overlayOpacity,u=o.overlayCornerRadius),this._overlayRect=new ee.Rect({x:0,y:this._overlayOffset,width:d-c,stroke:a,strokeWidth:s,height:f,fill:h,opacity:l,cornerRadius:u}),this._overlay.add(this._overlayRect),t.overlay&&(this._overlayText=new ee.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:o.overlayFontFamily,fontSize:o.overlayFontSize,fontStyle:o.overlayFontStyle,fill:o.overlayLabelColor,listening:!1,align:o.overlayLabelAlign,width:d-c,verticalAlign:o.overlayLabelVerticalAlign,height:f,padding:o.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function Xn(t){return new Gn(t)}function jn(t){return t.endTime-t.startTime}function Un(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._segmentShapes={},this._layer=new ee.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}function Vn(t,e){var n=this;n._axisGridlineColor=e.axisGridlineColor,n._axisLabelColor=e.axisLabelColor,n._showAxisLabels=e.showAxisLabels,n._axisTopMarkerHeight=e.axisTopMarkerHeight,n._axisBottomMarkerHeight=e.axisBottomMarkerHeight,e.formatAxisTime?n._formatAxisTime=e.formatAxisTime:n._formatAxisTime=function(t){return Xe(t,0)},n._axisLabelFont=Vn._buildFontString(e.fontFamily,e.fontSize,e.fontStyle),n._axisShape=new ee.Shape({sceneFunc:function(e){n._drawAxis(e,t)}})}function Yn(t,e,n,i){var r=this;r._container=e,r._peaks=n,r._options=n.options,r._viewOptions=i,r._originalWaveformData=t,r._data=t,r._frameOffset=0,r._width=e.clientWidth,r._height=e.clientHeight,r._amplitudeScale=1,r._waveformColor=r._viewOptions.waveformColor,r._playedWaveformColor=r._viewOptions.playedWaveformColor,r._timeLabelPrecision=r._viewOptions.timeLabelPrecision,r._viewOptions.formatPlayheadTime?r._formatPlayheadTime=r._viewOptions.formatPlayheadTime:r._formatPlayheadTime=function(t){return Xe(t,r._timeLabelPrecision)},r._enableSeek=!0,r.initWaveformData(),ee.showWarnings=!1,r._stage=new ee.Stage({container:e,width:r._width,height:r._height}),r._createWaveform(),r._viewOptions.enableSegments&&(r._segmentsLayer=new Un(n,r,r._viewOptions.enableEditing),r._segmentsLayer.addToStage(r._stage)),r._viewOptions.enablePoints&&(r._pointsLayer=new Wn(n,r,r._viewOptions.enableEditing),r._pointsLayer.addToStage(r._stage)),r.initHighlightLayer(),r._createAxisLabels(),r._playheadLayer=new Bn(r._peaks.player,r,r._viewOptions),r._playheadLayer.addToStage(r._stage),r._onClick=r._onClick.bind(r),r._onDblClick=r._onDblClick.bind(r),r._onContextMenu=r._onContextMenu.bind(r),r._stage.on("click",r._onClick),r._stage.on("dblclick",r._onDblClick),r._stage.on("contextmenu",r._onContextMenu)}function Zn(t,e){this._stage=t,this._handlers=e,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}function Kn(t,e){this._peaks=t,this._view=e,this._firstMove=!1,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Zn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function qn(t,e,n){var i=this;Yn.call(i,t,e,n,n.options.overview),i._onTimeUpdate=i._onTimeUpdate.bind(i),i._onPlaying=i._onPlaying.bind(i),i._onPause=i._onPause.bind(i),i._onZoomviewUpdate=i._onZoomviewUpdate.bind(i),n.on("player.timeupdate",i._onTimeUpdate),n.on("player.playing",i._onPlaying),n.on("player.pause",i._onPause),n.on("zoomview.update",i._onZoomviewUpdate);var r=i._peaks.player.getCurrentTime();i._playheadLayer.updatePlayheadTime(r),i._mouseDragHandler=new Kn(n,i);var o=n.views.getView("zoomview");o&&i._highlightLayer.showHighlight(o.getStartTime(),o.getEndTime())}function Jn(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Zn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function Qn(t,e){this._peaks=t,this._view=e,this._seeking=!1,this._firstMove=!1,this._segment=null,this._segmentIsDraggable=!1,this._initialFrameOffset=0,this._mouseDownX=0,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Zn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function $n(t,e,n){var i=this;Yn.call(i,t,e,n,n.options.zoomview),i._onTimeUpdate=i._onTimeUpdate.bind(i),i._onPlaying=i._onPlaying.bind(i),i._onPause=i._onPause.bind(i),i._onKeyboardLeft=i._onKeyboardLeft.bind(i),i._onKeyboardRight=i._onKeyboardRight.bind(i),i._onKeyboardShiftLeft=i._onKeyboardShiftLeft.bind(i),i._onKeyboardShiftRight=i._onKeyboardShiftRight.bind(i),i._peaks.on("player.timeupdate",i._onTimeUpdate),i._peaks.on("player.playing",i._onPlaying),i._peaks.on("player.pause",i._onPause),i._peaks.on("keyboard.left",i._onKeyboardLeft),i._peaks.on("keyboard.right",i._onKeyboardRight),i._peaks.on("keyboard.shift_left",i._onKeyboardShiftLeft),i._peaks.on("keyboard.shift_right",i._onKeyboardShiftRight),i._autoScroll=i._viewOptions.autoScroll,i._autoScrollOffset=i._viewOptions.autoScrollOffset,i._enableSegmentDragging=!1,i._segmentDragMode="overlap",i._minSegmentDragWidth=0,i._insertSegmentShape=null,i._playheadClickTolerance=i._viewOptions.playheadClickTolerance,i._zoomLevelAuto=!1,i._zoomLevelSeconds=null;var r=i._peaks.player.getCurrentTime();i._syncPlayhead(r),i._mouseDragHandler=new Qn(n,i),i._onWheel=i._onWheel.bind(i),i._onWheelCaptureVerticalScroll=i._onWheelCaptureVerticalScroll.bind(i),i.setWheelMode(i._viewOptions.wheelMode),i._peaks.emit("zoomview.update",{startTime:0,endTime:i.getEndTime()})}function ti(t,e){this._container=t,this._peaks=e,this._options=e.options.scrollbar,this._zoomview=e.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewUpdate=this._onZoomviewUpdate.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),this._peaks.on("zoomview.update",this._onZoomviewUpdate),this._width=t.clientWidth,this._height=t.clientHeight,this._stage=new ee.Stage({container:t,width:this._width,height:this._height}),this._layer=new ee.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new ee.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new oe({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._updateScrollbarWidthAndPosition()}function ei(t){this._peaks=t,this._overview=null,this._zoomview=null,this._scrollbar=null}function ni(t,e){this._peaks=t,this._zoomLevels=e,this._zoomLevelIndex=0}kn.prototype._handleKeyEvent=function(t){if(-1===xn.indexOf(t.target.nodeName))if(Cn.indexOf(t.type)>-1&&t.preventDefault(),"keydown"===t.type||"keypress"===t.type)switch(t.keyCode){case 32:this.eventEmitter.emit("keyboard.space");break;case 9:this.eventEmitter.emit("keyboard.tab")}else if("keyup"===t.type)switch(t.keyCode){case 37:t.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case 39:t.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right")}},kn.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)},Tn.prototype._addMediaListener=function(t,e){this._listeners.push({type:t,callback:e}),this._mediaElement.addEventListener(t,e)},Tn.prototype.init=function(t){var e,n=this;return n._eventEmitter=t,n._listeners=[],n._duration=n.getDuration(),n._addMediaListener("timeupdate",function(){n._eventEmitter.emit("player.timeupdate",n.getCurrentTime())}),n._addMediaListener("playing",function(){n._eventEmitter.emit("player.playing",n.getCurrentTime())}),n._addMediaListener("pause",function(){n._eventEmitter.emit("player.pause",n.getCurrentTime())}),n._addMediaListener("ended",function(){n._eventEmitter.emit("player.ended")}),n._addMediaListener("seeked",function(){n._eventEmitter.emit("player.seeked",n.getCurrentTime())}),n._addMediaListener("canplay",function(){n._eventEmitter.emit("player.canplay")}),n._addMediaListener("error",function(t){n._eventEmitter.emit("player.error",t.target.error)}),n._interval=null,(e=n._mediaElement).src||e.querySelector("source")?n._mediaElement.error&&n._mediaElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?Promise.reject(n._mediaElement.error):new Promise(function(t,e){function i(r){n._mediaElement.removeEventListener("loadedmetadata",i),n._mediaElement.removeEventListener("error",i),"loadedmetadata"===r.type?t():e(r.target.error)}n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(n._mediaElement.addEventListener("loadedmetadata",i),n._mediaElement.addEventListener("error",i),n._mediaElement.load()):t()}):Promise.resolve()},Tn.prototype.destroy=function(){for(var t=0;t<this._listeners.length;t++){var e=this._listeners[t];this._mediaElement.removeEventListener(e.type,e.callback)}this._listeners.length=0,this._mediaElement=null},Tn.prototype.play=function(){return this._mediaElement.play()},Tn.prototype.pause=function(){this._mediaElement.pause()},Tn.prototype.isPlaying=function(){return!this._mediaElement.paused},Tn.prototype.isSeeking=function(){return this._mediaElement.seeking},Tn.prototype.getCurrentTime=function(){return this._mediaElement.currentTime},Tn.prototype.getDuration=function(){return this._mediaElement.duration},Tn.prototype.seek=function(t){this._mediaElement.currentTime=t},An.prototype.setSource=function(t,e){var n=this;return n._options=t,n._callback=e,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),new Promise(function(e,i){n._resolve=e,n._reject=i,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),n._mediaElement.setAttribute("src",t.mediaUrl),n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&n._mediaElement.load()})},An.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)},An.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()},An.prototype._playerErrorHandler=function(t){this._reset(),this._reject(t)},Tn.prototype.setSource=function(t){return t.mediaUrl?new An(this._eventEmitter,this._mediaElement).setSource(t):Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"))},En.prototype.init=function(){return this._adapter.init(this._peaks)},En.prototype.destroy=function(){this._adapter.destroy()},En.prototype.play=function(){return this._adapter.play()},En.prototype.pause=function(){this._adapter.pause()},En.prototype.isPlaying=function(){return this._adapter.isPlaying()},En.prototype.isSeeking=function(){return this._adapter.isSeeking()},En.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()},En.prototype.getDuration=function(){return this._adapter.getDuration()},En.prototype.seek=function(t){Ze(t)?this._adapter.seek(t):this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds")},En.prototype.playSegment=function(t,e){var n=this;return t&&Ze(t.startTime)&&Ze(t.endTime)?(n._segment=t,n._loop=e,n.seek(t.startTime),n._peaks.once("player.playing",function(){n._playingSegment||(n._playingSegment=!0,window.requestAnimationFrame(n._playSegmentTimerCallback))}),n.play()):Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object"))},En.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime){if(!this._loop)return this.pause(),this._peaks.emit("player.ended"),void(this._playingSegment=!1);this.seek(this._segment.startTime)}window.requestAnimationFrame(this._playSegmentTimerCallback)}else this._playingSegment=!1},En.prototype._setSource=function(t){return this._adapter.setSource(t)},Pn.prototype.init=function(t){"zoomview"===this._options.view&&(this._label=new ye({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new oe({x:-4.5,y:0,width:10,height:20,fill:this._options.color,visible:this._draggable}),this._line=new re({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new ye({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),t.add(this._handle),t.add(this._line),this._label&&t.add(this._label),t.add(this._time),this.fitToView(),this.bindEventHandlers(t)},Pn.prototype.bindEventHandlers=function(t){var e=this;e._handle.on("mouseover touchstart",function(){e._draggable&&(e._time.setX(-24-e._time.getWidth()),e._time.show())}),e._handle.on("mouseout touchend",function(){e._draggable&&e._time.hide()}),t.on("dragstart",function(){e._time.setX(-24-e._time.getWidth()),e._time.show()}),t.on("dragend",function(){e._time.hide()})},Pn.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._line.points([.5,0,.5,t]),this._label&&this._label.y(12),this._handle&&this._handle.y(t/2-10.5),this._time&&this._time.y(t/2-5)},Pn.prototype.update=function(t){void 0!==t.time&&this._time&&this._time.setText(this._options.layer.formatTime(t.time)),void 0!==t.labelText&&this._label&&this._label.text(t.labelText),void 0!==t.color&&(this._handle&&this._handle.fill(t.color),this._line.stroke(t.color)),void 0!==t.editable&&(this._draggable=t.editable,this._handle.visible(this._draggable))},Mn.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ye({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new oe({x:-4.5,y:0,width:10,height:20,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new re({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),t.add(this._label),t.add(this._line),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},Mn.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),e._handle.on("mouseout touchend",function(){e._label.hide()})},Mn.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._label.y(t/2-5),this._handle.y(t/2-10.5),this._line.points([.5,0,.5,t])},Mn.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime)),void 0!==t.editable&&(this._editable=t.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))},Rn.prototype.addToStage=function(t){t.add(this._layer)},Rn.prototype.showHighlight=function(t,e){this._highlightRect||this._createHighlightRect(t,e),this._update(t,e)},Rn.prototype._update=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),i=this._view.timeToPixels(e);this._highlightRect.setAttrs({x:n,width:i-n})},Rn.prototype._createHighlightRect=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),i=this._view.timeToPixels(e);this._highlightRect=new oe({x:n,y:0,width:i-n,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)},Rn.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)},Rn.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)},Rn.prototype.fitToView=function(){if(this._highlightRect){var t=this._view.getHeight(),e=je(this._offset,0,Math.floor(t/2));this._highlightRect.setAttrs({y:e,height:t-2*e})}},Fn.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("dragstart",function(e){t._onDragStart(e,t._point)}),t._group.on("dragmove",function(e){t._onDragMove(e,t._point)}),t._group.on("dragend",function(e){t._onDragEnd(e,t._point)}),t._group.on("mouseenter",function(e){t._onMouseEnter(e,t._point)}),t._group.on("mouseleave",function(e){t._onMouseLeave(e,t._point)})},Fn.prototype.addToLayer=function(t){t.add(this._group)},Fn.prototype.fitToView=function(){this._marker.fitToView()},Fn.prototype.getPoint=function(){return this._point},Fn.prototype.getX=function(){return this._group.getX()},Fn.prototype.setX=function(t){this._group.setX(t)},Fn.prototype.getWidth=function(){return this._group.getWidth()},Fn.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},Fn.prototype.update=function(t){void 0!==t.editable&&this._group.draggable(t.editable),this._marker.update&&this._marker.update(t)},Fn.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},Wn.prototype.addToStage=function(t){t.add(this._layer)},Wn.prototype.setListening=function(t){this._layer.listening(t)},Wn.prototype.enableEditing=function(t){this._enableEditing=t},Wn.prototype.getPointMarker=function(t){return this._pointMarkers[t.pid]},Wn.prototype.formatTime=function(t){return this._view.formatTime(t)},Wn.prototype._onPointsUpdate=function(t,e){var n=this._view.getStartTime(),i=this._view.getEndTime(),r=this.getPointMarker(t),o=t.isVisible(n,i);if(r&&!o)this._removePoint(t);else if(!r&&o)this._updatePoint(t);else if(r&&o){if(Ue(e,"time")){var a=this._view.timeToPixels(t.time)-this._view.getFrameOffset();r.setX(a)}r.update(e)}},Wn.prototype._onPointsAdd=function(t){var e=this,n=e._view.getStartTime(),i=e._view.getEndTime();t.points.forEach(function(t){t.isVisible(n,i)&&e._updatePoint(t)})},Wn.prototype._onPointsRemove=function(t){var e=this;t.points.forEach(function(t){e._removePoint(t)})},Wn.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}},Wn.prototype._createPointMarker=function(t){var e=this._enableEditing&&t.editable,n=this._view.getViewOptions();return new Fn({point:t,draggable:e,marker:this._peaks.options.createPointMarker({point:t,editable:e,color:t.color,fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,layer:this,view:this._view.getName()}),onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})},Wn.prototype.getHeight=function(){return this._view.getHeight()},Wn.prototype._addPointMarker=function(t){var e=this._createPointMarker(t);return this._pointMarkers[t.pid]=e,e.addToLayer(this._layer),e},Wn.prototype._onPointsDrag=function(t){this._updatePoint(t.point).update({time:t.point.time})},Wn.prototype._onPointMarkerMouseEnter=function(t,e){this._peaks.emit("points.mouseenter",{point:e,evt:t.evt})},Wn.prototype._onPointMarkerMouseLeave=function(t,e){this._peaks.emit("points.mouseleave",{point:e,evt:t.evt})},Wn.prototype._onPointMarkerDragStart=function(t,e){this._dragPointMarker=this.getPointMarker(e),this._peaks.emit("points.dragstart",{point:e,evt:t.evt})},Wn.prototype._onPointMarkerDragMove=function(t,e){var n=this._pointMarkers[e.pid],i=n.getX()+n.getWidth();e._setTime(this._view.pixelOffsetToTime(i)),this._peaks.emit("points.dragmove",{point:e,evt:t.evt})},Wn.prototype._onPointMarkerDragEnd=function(t,e){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:e,evt:t.evt})},Wn.prototype._pointMarkerDragBoundFunc=function(t){return{x:je(t.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}},Wn.prototype.updatePoints=function(t,e){this._peaks.points.find(t,e).forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(t,e)},Wn.prototype._updatePoint=function(t){var e=this.getPointMarker(t);e||(e=this._addPointMarker(t));var n=this._view.timeToPixels(t.time)-this._view.getFrameOffset();return e.setX(n),e},Wn.prototype._removeInvisiblePoints=function(t,e){for(var n in this._pointMarkers)if(Ue(this._pointMarkers,n)){var i=this._pointMarkers[n].getPoint();i.isVisible(t,e)||this._removePoint(i)}},Wn.prototype._removePoint=function(t){var e=this.getPointMarker(t);e&&(e.destroy(),delete this._pointMarkers[t.pid])},Wn.prototype.setVisible=function(t){this._layer.setVisible(t)},Wn.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)},Wn.prototype.fitToView=function(){for(var t in this._pointMarkers){if(Ue(this._pointMarkers,t))this._pointMarkers[t].fitToView()}},Wn.prototype.draw=function(){this._layer.draw()},Bn.prototype.addToStage=function(t){t.add(this._playheadLayer)},Bn.prototype.zoomLevelChanged=function(){var t=this._view.timeToPixels(1);if(this._useAnimation=t>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var e=this._player.getCurrentTime();this.stop(e)}},Bn.prototype.fitToView=function(){var t=this._view.getHeight();this._playheadLine.points([.5,0,.5,t]),this._playheadText&&this._playheadText.y(12)},Bn.prototype._createPlayhead=function(){this._playheadLine=new re({stroke:this._playheadColor,strokeWidth:this._playheadWidth}),this._playheadGroup=new ee.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)},Bn.prototype._createPlayheadText=function(){var t=this,e=t._player.getCurrentTime(),n=t._view.formatTime(e);t._playheadText=new ye({x:0,y:0,padding:t._playheadPadding,text:n,fontSize:t._playheadFontSize,fontFamily:t._playheadFontFamily,fontStyle:t._playheadFontStyle,fill:t._playheadTextColor,align:"right",sceneFunc:function(e,n){var i=n.width(),r=n.height()+2*t._playheadPadding;e.fillStyle=t._playheadBackgroundColor,e.fillRect(0,-t._playheadPadding,i,r),n._sceneFunc(e)}}),t._playheadGroup.add(t._playheadText)},Bn.prototype.updatePlayheadTime=function(t){this._syncPlayhead(t),this._player.isPlaying()&&this._start()},Bn.prototype._syncPlayhead=function(t){var e=this._view.timeToPixels(t),n=this._view.getFrameOffset(),i=this._view.getWidth(),r=e>=n&&e<=n+i;if(this._playheadPixel=e,r){var o=this._playheadPixel-n;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(o),this._playheadText){var a=this._view.formatTime(t),s=this._playheadText.width();this._playheadText.setText(a),s+o>i-2?this._playheadText.setX(-s):s+o<i&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(t)},Bn.prototype._start=function(){var t=this;if(t._playheadLineAnimation&&(t._playheadLineAnimation.stop(),t._playheadLineAnimation=null),t._useAnimation){var e=null;t._playheadLineAnimation=new Zt(function(){var n=t._player.getCurrentTime(),i=t._view.timeToPixels(n);i!==e&&(t._syncPlayhead(n),e=i)},t._playheadLayer),t._playheadLineAnimation.start()}},Bn.prototype.stop=function(t){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(t)},Bn.prototype.getPlayheadPixel=function(){return this._playheadPixel},Bn.prototype.showPlayheadTime=function(t){t?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)},Bn.prototype.updatePlayheadText=function(){if(this._playheadText){var t=this._player.getCurrentTime(),e=this._view.formatTime(t);this._playheadText.setText(e)}},Bn.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)},Gn.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ye({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new oe({x:-4.5,y:0,width:10,height:20}),t.add(this._label),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},Gn.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show(),document.body.style.cursor="ew-resize"}),e._handle.on("mouseout touchend",function(){e._label.hide(),document.body.style.cursor="default"})},Gn.prototype.fitToView=function(){var t=this._options.layer.getHeight(),e=this._options.segmentOptions.overlayOffset,n=je(0,t-2*e);this._label.y(t/2-5),this._handle.y(e),this._handle.height(n)},Gn.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime))},Hn.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("click",function(e){t._onClick(t,e)}),t._group.on("dragstart",function(e){t._onDragStart(t,e)}),t._group.on("dragmove",function(e){t._onDragMove(t,e)}),t._group.on("dragend",function(e){t._onDragEnd(t,e)})},Hn.prototype.addToLayer=function(t){t.add(this._group)},Hn.prototype.moveToTop=function(){this._group.moveToTop()},Hn.prototype.fitToView=function(){this._marker.fitToView()},Hn.prototype.getSegment=function(){return this._segment},Hn.prototype.getX=function(){return this._group.getX()},Hn.prototype.setX=function(t){this._group.setX(t)},Hn.prototype.getWidth=function(){return this._group.getWidth()},Hn.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},Hn.prototype.isStartMarker=function(){return this._startMarker},Hn.prototype.update=function(t){void 0!==t.editable&&(this._group.visible(t.editable),this._group.draggable(t.editable)),this._marker.update&&this._marker.update(t)},Hn.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},Hn.prototype.startDrag=function(){this._group.startDrag()},Hn.prototype.stopDrag=function(){this._group.stopDrag()},Nn.prototype.getX=function(){return this._shape.getX()},Nn.prototype.setX=function(t){return this._shape.setX(t)},Nn.prototype.setSegment=function(t){this._segment=t},Nn.prototype.setWaveformColor=function(t){if(qe(t))this._shape.fill(t),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else{if(!tn(t))throw new TypeError("Unknown type for color property");this._shape.fill(null);var e=this._view._height*(t.linearGradientStart/100),n=this._view._height*(t.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(e),this._shape.fillLinearGradientEndPointY(n),this._shape.fillLinearGradientColorStops([0,t.linearGradientColorStops[0],1,t.linearGradientColorStops[1]])}},Nn.prototype.fitToView=function(){this.setWaveformColor(this._color)},Nn.prototype._sceneFunc=function(t){var e=this._view.getFrameOffset(),n=this._view.getWidth(),i=this._view.getHeight();this._drawWaveform(t,this._view.getWaveformData(),e,this._segment?this._view.timeToPixels(this._segment.startTime):e,this._segment?this._view.timeToPixels(this._segment.endTime):e+n,n,i)},Nn.prototype._drawWaveform=function(t,e,n,i,r,o,a){i<n&&(i=n);var s=n+o;r>s&&(r=s),r>e.length-1&&(r=e.length-1);for(var h=e.channels,l=0,u=Math.floor(a/h),c=0;c<h;c++)c===h-1&&(u=a-(h-1)*u),this._drawChannel(t,e.channel(c),n,i,r,l,u),l+=u},Nn.prototype._drawChannel=function(t,e,n,i,r,o,a){var s,h,l,u,c=this._view.getAmplitudeScale();for(t.beginPath(),s=i;s<=r;s++)h=e.min_sample(s),l=s-n+.5,u=o+Nn.scaleY(h,a,c)+.5,t.lineTo(l,u);for(s=r;s>=i;s--)h=e.max_sample(s),l=s-n+.5,u=o+Nn.scaleY(h,a,c)+1,t.lineTo(l,u);t.closePath(),t.fillShape(this._shape)},Nn.prototype.addToLayer=function(t){t.add(this._shape)},Nn.prototype.destroy=function(){this._shape.destroy(),this._shape=null},Nn.prototype.on=function(t,e){this._shape.on(t,e)},Nn.prototype.off=function(t,e){this._shape.off(t,e)},Nn.scaleY=function(t,e,n){var i=-(e-1)*(t*n+128)/255+(e-1);return je(Math.floor(i),0,e-1)},zn.prototype._createMarkers=function(){var t,e,n,i=this._layer.isEditingEnabled()&&this._segment.editable,r=this._view.getViewOptions(),o=r.segmentOptions;this._segment.markers?t=this._peaks.options.createSegmentMarker:this._segment.overlay&&(t=Xn),t&&(e=t({segment:this._segment,editable:i,startMarker:!0,color:o.startMarkerColor,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),e&&(this._startMarker=new Hn({segment:this._segment,segmentShape:this,editable:i,startMarker:!0,marker:e,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc})),t&&(n=t({segment:this._segment,editable:i,startMarker:!1,color:o.endMarkerColor,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),n&&(this._endMarker=new Hn({segment:this._segment,segmentShape:this,editable:i,startMarker:!1,marker:n,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))},zn.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},zn.prototype.update=function(t){var e,n=this._view.timeToPixelOffset(this._segment.startTime),i=this._view.timeToPixelOffset(this._segment.endTime),r=i-n;(e=this.getStartMarker())&&(e.setX(n-e.getWidth()),t&&e.update(t)),(e=this.getEndMarker())&&(e.setX(i),t&&e.update(t)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._label&&this._label.text(this._segment.labelText),this._overlayText&&this._overlayText.text(this._segment.labelText),this._segment.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:n,width:r,clipWidth:r<1?1:r}),this._overlayRect.setAttrs({x:0,width:r}),this._overlayText&&this._overlayText.setAttrs({width:r}))},zn.prototype.getSegment=function(){return this._segment},zn.prototype.getStartMarker=function(){return this._startMarker},zn.prototype.getEndMarker=function(){return this._endMarker},zn.prototype.addToLayer=function(t){this._waveformShape&&this._waveformShape.addToLayer(t),this._label&&t.add(this._label),this._overlay&&t.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(t),this._endMarker&&this._endMarker.addToLayer(t)},zn.prototype.isDragging=function(){return this._dragging},zn.prototype._onMouseEnter=function(t){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:t.evt})},zn.prototype._onMouseLeave=function(t){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:t.evt})},zn.prototype._onMouseDown=function(t){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:t.evt})},zn.prototype._onMouseUp=function(t){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:t.evt})},zn.prototype.segmentClicked=function(t,e){this._moveToTop(),this._peaks.emit("segments."+t,e)},zn.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()},zn.prototype.enableSegmentDragging=function(t){this._segment.editable&&(!this._draggable&&t?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!t&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(t),this._draggable=t)},zn.prototype._setPreviousAndNextSegments=function(){"overlap"!==this._view.getSegmentDragMode()?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)},zn.prototype._onSegmentDragStart=function(t){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},zn.prototype._onSegmentDragMove=function(t){var e,n=this._overlay.getX()-this._dragStartX,i=this._view.pixelsToTime(n),r=this._dragStartTime+i,o=this._dragEndTime+i,a=this._segment.endTime-this._segment.startTime,s=this._view.getMinSegmentDragWidth(),h=this._view.pixelsToTime(s),l=!1,u=!1;if(r<0&&(r=0,o=a,this._overlay.setX(this._view.timeToPixelOffset(r))),this._previousSegment){var c=this._view.timeToPixelOffset(this._previousSegment.endTime);if(r<this._previousSegment.endTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._previousSegment.editable)o=(r=this._previousSegment.endTime)+a,this._overlay.setX(c);else if("compress"===e){var d=r,f=this._previousSegment.startTime+h;d<f&&(d=f,c=this._view.timeToPixelOffset(d),this._overlay.setX(c),o=(r=d)+a),this._previousSegment.update({endTime:d}),l=!0}}if(this._nextSegment){var p=this._view.timeToPixelOffset(this._nextSegment.startTime);if(o>this._nextSegment.startTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._nextSegment.editable)r=(o=this._nextSegment.startTime)-a,this._overlay.setX(p-this._overlay.getWidth());else if("compress"===e){var g=o,m=this._nextSegment.endTime-h;g>m&&(g=m,p=this._view.timeToPixelOffset(g),this._overlay.setX(p-this._overlay.getWidth()),r=(o=g)-a),this._nextSegment.update({startTime:g}),u=!0}}this._segment._setStartTime(r),this._segment._setEndTime(o),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt}),l?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:t.evt}):u&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:t.evt})},zn.prototype._onSegmentDragEnd=function(t){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},zn.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()},zn.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()},zn.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()},zn.prototype._onSegmentMarkerDragStart=function(t,e){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:t.isStartMarker(),evt:e.evt})},zn.prototype._onSegmentMarkerDragMove=function(t,e){t.isStartMarker()?(this._segmentStartMarkerDragMove(t,e),t.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(t,e),t.update({endTime:this._segment.endTime}))},zn.prototype._segmentStartMarkerDragMove=function(t,e){var n=this._view.getWidth(),i=this._startMarker.getX(),r=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._endMarker.getX()-a;s>n&&(s=n);var h,l=!1,u=!1;if(this._previousSegment&&(l=(h=this._view.timeToPixelOffset(this._previousSegment.endTime))>=0),i>s)t.setX(s),this._overlay.clipWidth(s-r),0===a&&s<n?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(s));else if(this._previousSegment&&l){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._previousSegment.editable,f="compress"===c&&this._previousSegment.editable;if(i<=h){if(d)t.setX(h),this._overlay.clipWidth(h-r),this._segment._setStartTime(this._previousSegment.endTime);else if(f){var p=jn(this._previousSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._previousSegment.startTime+o);i<g&&(i=g),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(i)}),u=!0}}else i<0&&(i=0),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i))}else i<0&&(i=0),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:e.evt})},zn.prototype._segmentEndMarkerDragMove=function(t,e){var n=this._view.getWidth(),i=this._startMarker.getX(),r=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._startMarker.getX()+a;s<0&&(s=0);var h,l=!1,u=!1;if(this._nextSegment&&(l=(h=this._view.timeToPixelOffset(this._nextSegment.startTime))<n),r<s)t.setX(s),this._overlay.clipWidth(s-i),0===a&&s>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(s));else if(this._nextSegment&&l){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._nextSegment.editable,f="compress"===c&&this._nextSegment.editable;if(r>=h){if(d)t.setX(h),this._overlay.clipWidth(h-i),this._segment._setEndTime(this._nextSegment.startTime);else if(f){var p=jn(this._nextSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._nextSegment.endTime-o);r>g&&(r=g),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(r)}),u=!0}}else r>n&&(r=n),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r))}else r>n&&(r=n),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:e.evt})},zn.prototype._onSegmentMarkerDragEnd=function(t,e){this._nextSegment=null,this._previousSegment=null;var n=t.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:n,evt:e.evt})},zn.prototype._segmentMarkerDragBoundFunc=function(t,e){return{x:e.x,y:t.getAbsolutePosition().y}},zn.prototype._onSegmentMarkerClick=function(){this._moveToTop()},zn.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var t=this._view.getHeight(),e=je(0,t-2*this._overlayOffset);this._overlay.setAttrs({y:0,height:t,clipY:this._overlayOffset,clipHeight:e}),this._overlayRect.setAttrs({y:this._overlayOffset,height:e}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:e})}},zn.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()},Un.prototype.addToStage=function(t){t.add(this._layer)},Un.prototype.setListening=function(t){this._layer.listening(t)},Un.prototype.enableEditing=function(t){this._enableEditing=t},Un.prototype.isEditingEnabled=function(){return this._enableEditing},Un.prototype.enableSegmentDragging=function(t){for(var e in this._segmentShapes)Ue(this._segmentShapes,e)&&this._segmentShapes[e].enableSegmentDragging(t)},Un.prototype.getSegmentShape=function(t){return this._segmentShapes[t.pid]},Un.prototype.formatTime=function(t){return this._view.formatTime(t)},Un.prototype._onSegmentsUpdate=function(t,e){var n=this._view.getStartTime(),i=this._view.getEndTime(),r=this.getSegmentShape(t),o=t.isVisible(n,i);r&&!o?r.isDragging()||this._removeSegment(t):!r&&o?r=this._updateSegment(t):r&&o&&r.update(e)},Un.prototype._onSegmentsAdd=function(t){var e=this,n=e._view.getStartTime(),i=e._view.getEndTime();t.segments.forEach(function(t){t.isVisible(n,i)&&e._addSegmentShape(t).update()}),this.moveSegmentMarkersToTop()},Un.prototype._onSegmentsRemove=function(t){var e=this;t.segments.forEach(function(t){e._removeSegment(t)})},Un.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}},Un.prototype._onSegmentsDragged=function(t){this._updateSegment(t.segment)},Un.prototype._createSegmentShape=function(t){return new zn(t,this._peaks,this,this._view)},Un.prototype._addSegmentShape=function(t){var e=this._createSegmentShape(t);return e.addToLayer(this._layer),this._segmentShapes[t.pid]=e,e},Un.prototype.updateSegments=function(t,e){this._peaks.segments.find(t,e).forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(t,e)},Un.prototype._updateSegment=function(t){var e=this.getSegmentShape(t);e||(e=this._addSegmentShape(t)),e.update()},Un.prototype._removeInvisibleSegments=function(t,e){for(var n in this._segmentShapes)if(Ue(this._segmentShapes,n)){var i=this._segmentShapes[n].getSegment();i.isVisible(t,e)||this._removeSegment(i)}},Un.prototype._removeSegment=function(t){var e=this._segmentShapes[t.pid];e&&(e.destroy(),delete this._segmentShapes[t.pid])},Un.prototype.moveSegmentMarkersToTop=function(){for(var t in this._segmentShapes)Ue(this._segmentShapes,t)&&this._segmentShapes[t].moveMarkersToTop()},Un.prototype.setVisible=function(t){this._layer.setVisible(t)},Un.prototype.segmentClicked=function(t,e){var n=this._segmentShapes[e.segment.pid];n&&n.segmentClicked(t,e)},Un.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)},Un.prototype.fitToView=function(){for(var t in this._segmentShapes){if(Ue(this._segmentShapes,t))this._segmentShapes[t].fitToView()}},Un.prototype.draw=function(){this._layer.draw()},Un.prototype.getHeight=function(){return this._layer.getHeight()},Vn._buildFontString=function(t,e,n){return e||(e=11),t||(t="sans-serif"),n||(n="normal"),n+" "+e+"px "+t},Vn.prototype.addToLayer=function(t){t.add(this._axisShape)},Vn.prototype.showAxisLabels=function(t,e){this._showAxisLabels=t,e&&(Ue(e,"topMarkerHeight")&&(this._axisTopMarkerHeight=e.topMarkerHeight),Ue(e,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=e.bottomMarkerHeight))},Vn.prototype.setAxisLabelColor=function(t){this._axisLabelColor=t},Vn.prototype.setAxisGridlineColor=function(t){this._axisGridlineColor=t},Vn.prototype._getAxisLabelScale=function(t){for(var e,n=1,i=[1,2,5,10,20,30],r=0;;){if(e=n*i[r],!(t.timeToPixels(e)<60))break;++r===i.length&&(n*=60,r=0)}return e},Vn.prototype._drawAxis=function(t,e){var n=e.getStartTime(),i=this._getAxisLabelScale(e),r=function(t,e){if(0===e)return 0;var n=1;return t<0&&(n=-1,t=-t),n*((Math.ceil(t)+e-1)/e|0)*e}(n,i),o=r-n,a=e.timeToPixels(o);t.setAttr("strokeStyle",this._axisGridlineColor),t.setAttr("lineWidth",1),t.setAttr("font",this._axisLabelFont),t.setAttr("fillStyle",this._axisLabelColor),t.setAttr("textAlign","left"),t.setAttr("textBaseline","bottom");for(var s=e.getWidth(),h=e.getHeight(),l=r;;){var u=a+e.timeToPixels(l-r);if(u>=s)break;if(this._axisTopMarkerHeight>0&&(t.beginPath(),t.moveTo(u+.5,0),t.lineTo(u+.5,0+this._axisTopMarkerHeight),t.stroke()),this._axisBottomMarkerHeight>0&&(t.beginPath(),t.moveTo(u+.5,h),t.lineTo(u+.5,h-this._axisBottomMarkerHeight),t.stroke()),this._showAxisLabels){var c=this._formatAxisTime(l),d=u-t.measureText(c).width/2,f=h-1-this._axisBottomMarkerHeight;d>=0&&t.fillText(c,d,f)}l+=i}},Yn.prototype.getViewOptions=function(){return this._viewOptions},Yn.prototype.getWaveformData=function(){return this._data},Yn.prototype.setWaveformData=function(t){this._data=t},Yn.prototype.timeToPixels=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)},Yn.prototype.pixelsToTime=function(t){return t*this._data.scale/this._data.sample_rate},Yn.prototype.pixelOffsetToTime=function(t){return(this._frameOffset+t)*this._data.scale/this._data.sample_rate},Yn.prototype.timeToPixelOffset=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)-this._frameOffset},Yn.prototype.getFrameOffset=function(){return this._frameOffset},Yn.prototype.getWidth=function(){return this._width},Yn.prototype.getHeight=function(){return this._height},Yn.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)},Yn.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)},Yn.prototype._getDuration=function(){return this._peaks.player.getDuration()},Yn.prototype._createWaveform=function(){this._waveformLayer=new ee.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)},Yn.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new Nn({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var t=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:t},this._unplayedSegment={startTime:t,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new Nn({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},Yn.prototype.setWaveformColor=function(t){this._waveformColor=t,this._waveformShape.setWaveformColor(t)},Yn.prototype.setPlayedWaveformColor=function(t){this._playedWaveformColor=t,t?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(t)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},Yn.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},Yn.prototype._createAxisLabels=function(){this._axisLayer=new ee.Layer({listening:!1}),this._axis=new Vn(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},Yn.prototype.showAxisLabels=function(t,e){this._axis.showAxisLabels(t,e),this._axisLayer.draw()},Yn.prototype.setAxisLabelColor=function(t){this._axis.setAxisLabelColor(t),this._axisLayer.draw()},Yn.prototype.setAxisGridlineColor=function(t){this._axis.setAxisGridlineColor(t),this._axisLayer.draw()},Yn.prototype.showPlayheadTime=function(t){this._playheadLayer.showPlayheadTime(t)},Yn.prototype.setTimeLabelPrecision=function(t){this._timeLabelPrecision=t,this._playheadLayer.updatePlayheadText()},Yn.prototype.formatTime=function(t){return this._formatPlayheadTime(t)},Yn.prototype.setAmplitudeScale=function(t){if(!Ye(t)||("number"!=typeof(e=t)||e!=e||e===1/0||e===-1/0))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");var e;this._amplitudeScale=t,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()},Yn.prototype.getAmplitudeScale=function(){return this._amplitudeScale},Yn.prototype.enableSeek=function(t){this._enableSeek=t},Yn.prototype.isSeekEnabled=function(){return this._enableSeek},Yn.prototype._onClick=function(t){this._clickHandler(t,"click")},Yn.prototype._onDblClick=function(t){this._clickHandler(t,"dblclick")},Yn.prototype._onContextMenu=function(t){this._clickHandler(t,"contextmenu")},Yn.prototype._clickHandler=function(t,e){var n=t.evt.offsetX;n<0&&(n=0);var i=!0;if(t.target!==this._stage){var r=en(t.target);if(r)if("point-marker"===r.attrs.name){var o=r.getAttr("point");o&&this._peaks.emit("points."+e,{point:o,evt:t.evt,preventViewEvent:function(){i=!1}})}else if("segment-overlay"===r.attrs.name){var a=r.getAttr("segment");if(a){var s={segment:a,evt:t.evt,preventViewEvent:function(){i=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(e,s)}}}if(i){var h=this.pixelOffsetToTime(n),l=this.getName();this._peaks.emit(l+"."+e,{time:h,evt:t.evt})}},Yn.prototype.updatePlayheadTime=function(t){this._playheadLayer.updatePlayheadTime(t)},Yn.prototype.playheadPosChanged=function(t){this._playedWaveformShape&&(this._playedSegment.endTime=t,this._unplayedSegment.startTime=t,this.drawWaveformLayer())},Yn.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()},Yn.prototype.enableMarkerEditing=function(t){this._segmentsLayer&&this._segmentsLayer.enableEditing(t),this._pointsLayer&&this._pointsLayer.enableEditing(t)},Yn.prototype.dragSeek=function(t){this._segmentsLayer&&this._segmentsLayer.setListening(!t),this._pointsLayer&&this._pointsLayer.setListening(!t)},Yn.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var t=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),t=this.containerWidthChange());var e=!1;this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.setHeight(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this.containerHeightChange(),e=!0),t?this.updateWaveform(this._frameOffset,!0):e&&(this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView())}},Yn.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},Zn.prototype._mouseDown=function(t){var e=null;if("mousedown"!==t.type||0===t.evt.button){var n=en(t.target);if(n){if("point-marker"===n.attrs.name||"segment-marker"===n.attrs.name)return;"segment-overlay"===n.attrs.name&&(e=n)}if(this._lastMouseClientX=Math.floor("touchstart"===t.type?t.evt.touches[0].clientX:t.evt.clientX),this._handlers.onMouseDown){var i=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(i,e)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}},Zn.prototype._mouseMove=function(t){var e=Math.floor("touchmove"===t.type?t.changedTouches[0].clientX:t.clientX);if(e!==this._lastMouseClientX&&(this._lastMouseClientX=e,this._dragging=!0,this._handlers.onMouseMove)){var n=this._getMousePosX(e);this._handlers.onMouseMove(n)}},Zn.prototype._mouseUp=function(t){var e;if("touchend"===t.type?(e=Math.floor(t.changedTouches[0].clientX),t.cancelable&&t.preventDefault()):e=Math.floor(t.clientX),this._handlers.onMouseUp){var n=this._getMousePosX(e);this._handlers.onMouseUp(n)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1},Zn.prototype._getMousePosX=function(t){var e=this._stage.getContainer().getBoundingClientRect();return Math.floor(t-e.left)},Zn.prototype.isDragging=function(){return this._dragging},Zn.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)},Kn.prototype._onMouseDown=function(t){this._firstMove=!0,this._seek(t)},Kn.prototype._onMouseMove=function(t){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),this._seek(t)},Kn.prototype._onMouseUp=function(){this._view.dragSeek(!1)},Kn.prototype._seek=function(t){if(this._view.isSeekEnabled()){t=je(t,0,this._width);var e=this._view.pixelsToTime(t),n=this._peaks.player.getDuration();e>n&&(e=n),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)}},Kn.prototype.destroy=function(){this._mouseDragHandler.destroy()},qn.prototype=Object.create(Yn.prototype),qn.prototype.initWaveformData=function(){0!==this._width&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},qn.prototype.initHighlightLayer=function(){this._highlightLayer=new Rn(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)},qn.prototype.isSegmentDraggingEnabled=function(){return!1},qn.prototype.getName=function(){return"overview"},qn.prototype._onTimeUpdate=function(t){this._playheadLayer.updatePlayheadTime(t)},qn.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},qn.prototype._onPause=function(t){this._playheadLayer.stop(t)},qn.prototype._onZoomviewUpdate=function(t){this.showHighlight(t.startTime,t.endTime)},qn.prototype.showHighlight=function(t,e){this._highlightLayer.showHighlight(t,e)},qn.prototype.setWaveformData=function(t){this._originalWaveformData=t,0!==this._width?this._resampleAndSetWaveformData(t,this._width):this._data=t,this.updateWaveform()},qn.prototype._resampleAndSetWaveformData=function(t,e){try{return this._data=t.resample({width:e}),!0}catch(e){return this._data=t,!1}},qn.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()},qn.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var t=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(t),this._highlightLayer.updateHighlight();var e=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(0,e),this._segmentsLayer&&this._segmentsLayer.updateSegments(0,e)},qn.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},qn.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()},qn.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._mouseDragHandler.destroy(),Yn.prototype.destroy.call(this)},Jn.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},Jn.prototype._reset=function(){this._insertSegment=null,this._insertSegmentShape=null,this._segmentIsDraggable=!1,this._peaks.segments.setInserting(!1)},Jn.prototype._onMouseDown=function(t,e){if(this._reset(),this._segment=e,this._segment){if("overlap"!==this._view.getSegmentDragMode())return;this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1)}var n=this._view.pixelsToTime(t+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:n,endTime:n,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())},Jn.prototype._onMouseMove=function(){},Jn.prototype._onMouseUp=function(){this._insertSegment&&(this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1))},Jn.prototype.destroy=function(){this._mouseDragHandler.destroy()},Qn.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},Qn.prototype._onMouseDown=function(t,e){this._seeking=!1,this._firstMove=!0,e&&!e.attrs.draggable?this._segment=null:this._segment=e;var n=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(t-n)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){t=je(t,0,this._view.getWidth());var i=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(i)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=t},Qn.prototype._onMouseMove=function(t){if(!this._segment||this._seeking)if(this._seeking){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),t=je(t,0,this._view.getWidth());var e=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(e)}else if(!this._view.isAutoZoom()){var n=this._mouseDownX-t,i=this._initialFrameOffset+n;i!==this._initialFrameOffset&&this._view.updateWaveform(i)}},Qn.prototype._onMouseUp=function(){if(this._seeking)this._view.dragSeek(!1);else if(this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var t=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(t)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)},Qn.prototype._seek=function(t){var e=this._peaks.player.getDuration();t>e&&(t=e),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)},Qn.prototype.destroy=function(){this._mouseDragHandler.destroy()},$n.prototype=Object.create(Yn.prototype),$n.prototype.initWaveformData=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var t=this._peaks.zoom.getZoomLevel();this._resampleData({scale:t})},$n.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])},$n.prototype.initHighlightLayer=function(){},$n.prototype.setWheelMode=function(t,e){if(e||(e={}),(t!==this._wheelMode||e.captureVerticalScroll!==this._captureVerticalScroll)&&(this._stage.off("wheel"),this._wheelMode=t,this._captureVerticalScroll=e.captureVerticalScroll,"scroll"===t))e.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel)},$n.prototype._onWheel=function(t){var e,n=t.evt;if(n.shiftKey)if(0!==n.deltaY)e=n.deltaY;else{if(0===n.deltaX)return;e=n.deltaX}else{if(Math.abs(n.deltaX)<Math.abs(n.deltaY))return;e=n.deltaX}n.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._width),n.preventDefault();var i=je(this._frameOffset+Math.floor(e),0,this._pixelLength-this._width);this.updateWaveform(i,!1)},$n.prototype._onWheelCaptureVerticalScroll=function(t){var e=t.evt,n=Math.abs(e.deltaX)<Math.abs(e.deltaY)?e.deltaY:e.deltaX;e.preventDefault();var i=je(this._frameOffset+Math.floor(n),0,this._pixelLength-this._width);this.updateWaveform(i,!1)},$n.prototype.setWaveformDragMode=function(t){this._segmentsLayer&&(this._mouseDragHandler.destroy(),this.dragSeek(!1),this._mouseDragHandler="insert-segment"===t?new Jn(this._peaks,this):new Qn(this._peaks,this))},$n.prototype.enableSegmentDragging=function(t){this._enableSegmentDragging=t,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(t)},$n.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging},$n.prototype.setSegmentDragMode=function(t){this._segmentDragMode=t},$n.prototype.getSegmentDragMode=function(){return this._segmentDragMode},$n.prototype.getName=function(){return"zoomview"},$n.prototype._onTimeUpdate=function(t){this._mouseDragHandler.isDragging()||this._syncPlayhead(t)},$n.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},$n.prototype._onPause=function(t){this._playheadLayer.stop(t)},$n.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)},$n.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)},$n.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)},$n.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)},$n.prototype._keyboardScroll=function(t,e){var n;n=e?t*this._width:t*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:n})},$n.prototype.setWaveformData=function(t){this._originalWaveformData=t,this._initWaveformCache()},$n.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset},$n.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance},$n.prototype._syncPlayhead=function(t){if(this._playheadLayer.updatePlayheadTime(t),this._autoScroll&&!this._zoomLevelAuto){var e=this.timeToPixels(t),n=this._frameOffset+this._width-this._autoScrollOffset,i=this._frameOffset;(e>=n||e<i)&&((i=e-this._autoScrollOffset)<0&&(i=0),this.updateWaveform(i,!1))}},$n.prototype._getScale=function(t){return Math.floor(t*this._data.sample_rate/this._width)},$n.prototype.setZoom=function(t){var e;if(function(t){return Ue(t,"scale")&&"auto"===t.scale||Ue(t,"seconds")&&"auto"===t.seconds}(t)){var n=this._originalWaveformData.duration;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,e=this._getScale(n)}else{if(Ue(t,"scale"))this._zoomLevelSeconds=null,e=Math.floor(t.scale);else if(Ue(t,"seconds")){if(!Ze(t.seconds))return!1;this._zoomLevelSeconds=t.seconds,e=this._getScale(t.seconds)}this._zoomLevelAuto=!1}e<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),e=this._originalWaveformData.scale);var i,r=this._peaks.player.getCurrentTime(),o=this.getPlayheadOffset();o>=0&&o<this._width?i=r:(o=Math.floor(this._width/2),i=this.pixelOffsetToTime(o));var a=this._scale;this._resampleData({scale:e});var s=this.timeToPixels(i)-o;return this.updateWaveform(s,!0),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(r),this._peaks.emit("zoom.update",{currentZoom:e,previousZoom:a}),!0},$n.prototype._resampleData=function(t){var e=t.scale;if(this._enableWaveformCache){if(!this._waveformData.has(e)){for(var n=this._originalWaveformData,i=0;i<this._waveformScales.length&&this._waveformScales[i]<e;i++)n=this._waveformData.get(this._waveformScales[i]);this._waveformData.set(e,n.resample(t)),this._waveformScales.push(e),this._waveformScales.sort(function(t,e){return t-e})}this._data=this._waveformData.get(e)}else this._data=this._originalWaveformData.resample(t);this._scale=this._data.scale,this._pixelLength=this._data.length},$n.prototype.isAutoZoom=function(){return this._zoomLevelAuto},$n.prototype.setStartTime=function(t){t<0&&(t=0),this._zoomLevelAuto&&(t=0),this.updateWaveform(this.timeToPixels(t),!1)},$n.prototype.getPixelLength=function(){return this._pixelLength},$n.prototype.scrollWaveform=function(t){var e;if(Ue(t,"pixels"))e=Math.floor(t.pixels);else{if(!Ue(t,"seconds"))throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");e=this.timeToPixels(t.seconds)}this.updateWaveform(this._frameOffset+e,!1)},$n.prototype.updateWaveform=function(t,e){var n;if(this._pixelLength<this._width?(t=0,n=this._width):n=this._pixelLength-this._width,t=je(t,0,n),e||t!==this._frameOffset){this._frameOffset=t;var i=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(i)),this.drawWaveformLayer(),this._axisLayer.draw();var r=this.getStartTime(),o=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(r,o),this._segmentsLayer&&this._segmentsLayer.updateSegments(r,o),this._peaks.emit("zoomview.update",{startTime:r,endTime:o})}},$n.prototype.enableAutoScroll=function(t,e){e||(e={}),this._autoScroll=t,Ue(e,"offset")&&(this._autoScrollOffset=e.offset)},$n.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth},$n.prototype.setMinSegmentDragWidth=function(t){this._minSegmentDragWidth=t},$n.prototype.containerWidthChange=function(){var t,e=!1;if(this._zoomLevelAuto?(e=!0,t={width:this._width}):null!==this._zoomLevelSeconds&&(e=!0,t={scale:this._getScale(this._zoomLevelSeconds)}),e)try{this._resampleData(t)}catch(t){}return!0},$n.prototype.containerHeightChange=function(){},$n.prototype.getStage=function(){return this._stage},$n.prototype.getSegmentsLayer=function(){return this._segmentsLayer},$n.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._enableWaveformCache?(this._waveformData.clear(),delete this._waveformData,delete this._waveformScales):delete this._data,this._mouseDragHandler.destroy(),Yn.prototype.destroy.call(this)},ti.prototype.setZoomview=function(t){this._zoomview=t,this._updateScrollbarWidthAndPosition()},ti.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)},ti.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth},ti.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},ti.prototype._onScrollboxDragStart=function(){this._dragging=!0},ti.prototype._onScrollboxDragEnd=function(){this._dragging=!1},ti.prototype._onScrollboxDragMove=function(){var t=this._getScrollbarRange(),e=je(this._scrollbox.x(),0,t);this._scrollbox.x(e),e!==this._scrollboxX&&(this._scrollboxX=e,this._zoomview&&this._updateWaveform(e))},ti.prototype._onZoomviewUpdate=function(){this._dragging||this._updateScrollbarWidthAndPosition()},ti.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var t=this._zoomview.getStartTime(),e=this._zoomview.getPixelLength()-this._zoomview.getWidth(),n=Math.floor(this._zoomview.timeToPixels(t)*this._getScrollbarRange()/e);this._scrollbox.x(n),this._layer.draw()}},ti.prototype._onScrollbarClick=function(t){if(t.target===this._stage&&this._zoomview){var e=Math.floor(t.evt.offsetX-this._scrollboxWidth/2);e<0&&(e=0),this._updateWaveform(e)}},ti.prototype._updateWaveform=function(t){var e=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*t/this._getScrollbarRange());this._zoomview.updateWaveform(e)},ti.prototype.fitToContainer=function(){0===this._container.clientWidth&&0===this._container.clientHeight||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))},ti.prototype.destroy=function(){this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._layer.destroy(),this._stage.destroy(),this._stage=null},ei.prototype.createOverview=function(t){if(this._overview)return this._overview;var e=this._peaks.getWaveformData();return this._overview=new qn(e,t,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview},ei.prototype.createZoomview=function(t){if(this._zoomview)return this._zoomview;var e=this._peaks.getWaveformData();return this._zoomview=new $n(e,t,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview},ei.prototype.createScrollbar=function(t){return this._scrollbar=new ti(t,this._peaks),this._scrollbar},ei.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)},ei.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())},ei.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)},ei.prototype.getView=function(t){if(Je(t))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(t){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}},ei.prototype.getScrollbar=function(){return this._scrollbar},ni.prototype.setZoomLevels=function(t){this._zoomLevels=t,this.setZoom(0,!0)},ni.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1,!1)},ni.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1,!1)},ni.prototype.setZoom=function(t,e){if(t>=this._zoomLevels.length&&(t=this._zoomLevels.length-1),t<0&&(t=0),e||t!==this._zoomLevelIndex){this._zoomLevelIndex=t;var n=this._peaks.views.getView("zoomview");n&&n.setZoom({scale:this._zoomLevels[t]})}},ni.prototype.getZoom=function(){return this._zoomLevelIndex},ni.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var ii="withCredentials"in new XMLHttpRequest;function ri(t){this._peaks=t}function oi(t){var e=t.getResponseHeader("content-range");if(!e)return!1;var n=e.match(/^bytes (\d+)-(\d+)\/(\d+)$/);if(n&&4===n.length){var i=parseInt(n[1],10),r=parseInt(n[2],10),o=parseInt(n[3],10);return 0===i&&r+1===o}return!1}function ai(){return Ge.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:Dn,createSegmentLabel:On,createPointMarker:Ln,logger:console.error.bind(console)},this}ri.prototype.init=function(t,e){if(!(t.dataUri&&(t.webAudio||t.audioContext)||t.waveformData&&(t.webAudio||t.audioContext)||t.dataUri&&t.waveformData))return t.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),t.webAudio={audioContext:t.audioContext}),t.dataUri?this._getRemoteWaveformData(t,e):t.waveformData?this._buildWaveformFromLocalData(t,e):t.webAudio?t.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(t,e):this._buildWaveformDataUsingWebAudio(t,e):void e(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"));e(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."))},ri.prototype._getRemoteWaveformData=function(t,e){var n,i=this,r=null,o=null;Ke(t.dataUri)?(r=t.dataUri,["ArrayBuffer","JSON"].some(function(t){if(window[t])return o=t.toLowerCase(),n=r[o],Boolean(n)}),n?(i._xhr=i._createXHR(n,o,t.withCredentials,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&oi(this)){i._xhr=null;var n=Ae.create(t.target.response);1===n.channels||2===n.channels?8===n.bits?e(void 0,n):e(new Error("Peaks.init(): 16-bit waveform data is not supported")):e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"))}else e(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){e(new Error("XHR failed"))},function(){e(new Error("XHR aborted"))}),i._xhr.send()):e(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"))):e(new TypeError("Peaks.init(): The dataUri option must be an object"))},ri.prototype._buildWaveformFromLocalData=function(t,e){var n,i=null,r=null;if(Ke(t.waveformData))if(Ke((i=t.waveformData).json)?r=i.json:(n=i.arraybuffer,Object.prototype.toString.call(n).includes("ArrayBuffer")&&(r=i.arraybuffer)),r)try{var o=Ae.create(r);if(1!==o.channels&&2!==o.channels)return void e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));if(8!==o.bits)return void e(new Error("Peaks.init(): 16-bit waveform data is not supported"));e(void 0,o)}catch(t){e(t)}else e(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));else e(new Error("Peaks.init(): The waveformData option must be an object"))},ri.prototype._buildWaveformDataUsingWebAudio=function(t,e){var n=this,i=window.AudioContext||window.webkitAudioContext;if(t.webAudio.audioContext instanceof i){var r=t.webAudio;r.scale!==t.zoomLevels[0]&&(r.scale=t.zoomLevels[0]);var o=n._peaks.options.mediaElement.currentSrc;o?n._requestAudioAndBuildWaveformData(o,r,t.withCredentials,e):n._peaks.once("player.canplay",function(){n._requestAudioAndBuildWaveformData(n._peaks.options.mediaElement.currentSrc,r,t.withCredentials,e)})}else e(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"))},ri.prototype._buildWaveformDataFromAudioBuffer=function(t,e){var n=t.webAudio;n.scale!==t.zoomLevels[0]&&(n.scale=t.zoomLevels[0]);var i={audio_buffer:n.audioBuffer,split_channels:n.multiChannel,scale:n.scale,disable_worker:!0};Ae.createFromAudio(i,e)},ri.prototype._requestAudioAndBuildWaveformData=function(t,e,n,i){var r=this;t?(r._xhr=r._createXHR(t,"arraybuffer",n,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&oi(this)){r._xhr=null;var n={audio_context:e.audioContext,array_buffer:t.target.response,split_channels:e.multiChannel,scale:e.scale};Ae.createFromAudio(n,i)}else i(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){i(new Error("XHR failed"))},function(){i(new Error("XHR aborted"))}),r._xhr.send()):r._peaks._logger("Peaks.init(): The mediaElement src is invalid")},ri.prototype.abort=function(){this._xhr&&this._xhr.abort()},ri.prototype._createXHR=function(t,e,n,i,r,o){var a=new XMLHttpRequest;if(a.open("GET",t,!0),ii)try{a.responseType=e}catch(t){}return a.onload=i,a.onerror=r,ii&&n&&(a.withCredentials=!0),a.addEventListener("abort",o),a},ai.prototype=Object.create(Ge.prototype);var si={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,playheadWidth:1,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},hi={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},li={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},ui={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},ci={color:"#888888",minWidth:50};function di(t,e){for(var n in e)Ue(e,n)&&Ue(t,n)&&(t[n]=e[n]);return t}function fi(t){var e=t.zoomview.container,n=t.overview.container;return $e(e)||$e(n)?e&&(e.clientWidth<=0||e.clientHeight<=0)?new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height"):n&&(n.clientWidth<=0||n.clientHeight<=0)?new Error("Peaks.init(): The overview container must be visible and have non-zero width and height"):void 0:new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements")}ai.init=function(t,e){if(!e)throw new Error("Peaks.init(): Missing callback function");var n=new ai,i=n._setOptions(t);if(i||(i=fi(n.options)),i)e(i);else{var r=null;if(n.options.scrollbar){if(!$e(r=n.options.scrollbar.container))return void e(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));if(r.clientWidth<=0)return void e(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"))}t.keyboard&&(n._keyboardHandler=new kn(n));var o=t.player?t.player:new Tn(n.options.mediaElement);n.player=new En(n,o),n.segments=new Sn(n),n.points=new _n(n),n.zoom=new ni(n,n.options.zoomLevels),n.views=new ei(n),n._waveformBuilder=new ri(n),n.player.init(n).then(function(){n._waveformBuilder.init(n.options,function(i,o){if(i)e(i);else if(i=fi(n.options))e(i);else{n._waveformBuilder=null,n._waveformData=o;var a=n.options.zoomview.container,s=n.options.overview.container;a&&n.views.createZoomview(a),s&&n.views.createOverview(s),r&&n.views.createScrollbar(r),t.segments&&n.segments.add(t.segments),t.points&&n.points.add(t.points),t.emitCueEvents&&(n._cueEmitter=new un(n)),e(null,n)}})}).catch(function(t){e(t)})}},ai.prototype._setOptions=function(t){if(!Ke(t))return new TypeError("Peaks.init(): The options parameter should be an object");if(!t.player){if(!t.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(t.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}return t.logger&&"function"!=typeof t.logger?new TypeError("Peaks.init(): The logger option should be a function"):t.segments&&!Array.isArray(t.segments)?new TypeError("Peaks.init(): options.segments must be an array of segment objects"):t.points&&!Array.isArray(t.points)?new TypeError("Peaks.init(): options.points must be an array of point objects"):(di(this.options,t),this.options.overview=function(t){var e={};return t.overview&&t.overview.showPlayheadTime&&(e.showPlayheadTime=t.overview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.overview&&Ue(t.overview,n)?e[n]=t.overview[n]:Ue(t,n)?e[n]=t[n]:Ue(e,n)||(Ue(li,n)?e[n]=li[n]:Ue(si,n)&&(e[n]=si[n]))}),e}(t),this.options.zoomview=function(t){var e={};return t.showPlayheadTime?e.showPlayheadTime=t.showPlayheadTime:t.zoomview&&t.zoomview.showPlayheadTime&&(e.showPlayheadTime=t.zoomview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.zoomview&&Ue(t.zoomview,n)?e[n]=t.zoomview[n]:Ue(t,n)?e[n]=t[n]:Ue(e,n)||(Ue(hi,n)?e[n]=hi[n]:Ue(si,n)&&(e[n]=si[n]))}),e}(t),this.options.scrollbar=function(t){if(!Ue(t,"scrollbar"))return null;var e={};return["container","color","minWidth"].forEach(function(n){Ue(t.scrollbar,n)?e[n]=t.scrollbar[n]:e[n]=ci[n]}),e}(t),function(t,e){t.segmentOptions={},Ve(t.segmentOptions,ui),e.segmentOptions&&di(t.segmentOptions,e.segmentOptions),t.zoomview.segmentOptions={},Ve(t.zoomview.segmentOptions,t.segmentOptions),e.zoomview&&e.zoomview.segmentOptions&&di(t.zoomview.segmentOptions,e.zoomview.segmentOptions),t.overview.segmentOptions={},Ve(t.overview.segmentOptions,t.segmentOptions),e.overview&&e.overview.segmentOptions&&di(t.overview.segmentOptions,e.overview.segmentOptions)}(this.options,t),Array.isArray(this.options.zoomLevels)?0===this.options.zoomLevels.length?new Error("Peaks.init(): The zoomLevels array must not be empty"):function(t){if(0===t.length)return!0;for(var e=t[0],n=1;n<t.length;n++){if(e>=t[n])return!1;e=t[n]}return!0}(this.options.zoomLevels)?void(this._logger=this.options.logger):new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order"):new TypeError("Peaks.init(): The zoomLevels option should be an array"))},ai.prototype.setSource=function(t,e){var n=this;n.player._setSource(t).then(function(){t.zoomLevels||(t.zoomLevels=n.options.zoomLevels),n._waveformBuilder=new ri(n),n._waveformBuilder.init(t,function(i,r){i?e(i):(n._waveformBuilder=null,n._waveformData=r,["overview","zoomview"].forEach(function(t){var e=n.views.getView(t);e&&e.setWaveformData(r)}),n.zoom.setZoomLevels(t.zoomLevels),e())})}).catch(function(t){e(t)})},ai.prototype.getWaveformData=function(){return this._waveformData},ai.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};var pi,gi,mi="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_i={};function vi(){if(gi)return pi;gi=1;var t=function(t){return t&&t.Math===Math&&t};return pi=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof mi&&mi)||t("object"==typeof pi&&pi)||function(){return this}()||Function("return this")()}var yi,bi,wi,Si,xi,Ci,ki,Ti,Ai={};function Ii(){return bi?yi:(bi=1,yi=function(t){try{return!!t()}catch(t){return!0}})}function Ei(){if(Si)return wi;Si=1;var t=Ii();return wi=!t(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})}function Pi(){if(Ci)return xi;Ci=1;var t=Ii();return xi=!t(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})}function Mi(){if(Ti)return ki;Ti=1;var t=Pi(),e=Function.prototype.call;return ki=t?e.bind(e):function(){return e.apply(e,arguments)},ki}var Di,Oi,Li,Ri,Fi,Wi,Bi,Gi,Hi,Ni,zi,Xi,ji,Ui,Vi,Yi,Zi,Ki,qi,Ji,Qi,$i,tr,er,nr,ir,rr,or,ar,sr,hr,lr,ur,cr,dr,fr,pr,gr,mr,_r,vr,yr={};function br(){if(Di)return yr;Di=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return yr.f=n?function(t){var n=e(this,t);return!!n&&n.enumerable}:t,yr}function wr(){return Li?Oi:(Li=1,Oi=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}})}function Sr(){if(Fi)return Ri;Fi=1;var t=Pi(),e=Function.prototype,n=e.call,i=t&&e.bind.bind(n,n);return Ri=t?i:function(t){return function(){return n.apply(t,arguments)}},Ri}function xr(){if(Bi)return Wi;Bi=1;var t=Sr(),e=t({}.toString),n=t("".slice);return Wi=function(t){return n(e(t),8,-1)}}function Cr(){if(Hi)return Gi;Hi=1;var t=Sr(),e=Ii(),n=xr(),i=Object,r=t("".split);return Gi=e(function(){return!i("z").propertyIsEnumerable(0)})?function(t){return"String"===n(t)?r(t,""):i(t)}:i}function kr(){return zi?Ni:(zi=1,Ni=function(t){return null==t})}function Tr(){if(ji)return Xi;ji=1;var t=kr(),e=TypeError;return Xi=function(n){if(t(n))throw new e("Can't call method on "+n);return n}}function Ar(){if(Vi)return Ui;Vi=1;var t=Cr(),e=Tr();return Ui=function(n){return t(e(n))}}function Ir(){if(Zi)return Yi;Zi=1;var t="object"==typeof document&&document.all;return Yi=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(t){return"function"==typeof t}}function Er(){if(qi)return Ki;qi=1;var t=Ir();return Ki=function(e){return"object"==typeof e?null!==e:t(e)}}function Pr(){if(Qi)return Ji;Qi=1;var t=vi(),e=Ir();return Ji=function(n,i){return arguments.length<2?(r=t[n],e(r)?r:void 0):t[n]&&t[n][i];var r},Ji}function Mr(){if(tr)return $i;tr=1;var t=Sr();return $i=t({}.isPrototypeOf)}function Dr(){if(nr)return er;nr=1;var t=vi().navigator,e=t&&t.userAgent;return er=e?String(e):""}function Or(){if(rr)return ir;rr=1;var t,e,n=vi(),i=Dr(),r=n.process,o=n.Deno,a=r&&r.versions||o&&o.version,s=a&&a.v8;return s&&(e=(t=s.split("."))[0]>0&&t[0]<4?1:+(t[0]+t[1])),!e&&i&&(!(t=i.match(/Edge\/(\d+)/))||t[1]>=74)&&(t=i.match(/Chrome\/(\d+)/))&&(e=+t[1]),ir=e}function Lr(){if(ar)return or;ar=1;var t=Or(),e=Ii(),n=vi().String;return or=!!Object.getOwnPropertySymbols&&!e(function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&t&&t<41})}function Rr(){if(hr)return sr;hr=1;var t=Lr();return sr=t&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}function Fr(){if(ur)return lr;ur=1;var t=Pr(),e=Ir(),n=Mr(),i=Rr(),r=Object;return lr=i?function(t){return"symbol"==typeof t}:function(i){var o=t("Symbol");return e(o)&&n(o.prototype,r(i))}}function Wr(){if(dr)return cr;dr=1;var t=String;return cr=function(e){try{return t(e)}catch(t){return"Object"}}}function Br(){if(pr)return fr;pr=1;var t=Ir(),e=Wr(),n=TypeError;return fr=function(i){if(t(i))return i;throw new n(e(i)+" is not a function")}}function Gr(){if(mr)return gr;mr=1;var t=Br(),e=kr();return gr=function(n,i){var r=n[i];return e(r)?void 0:t(r)}}function Hr(){if(vr)return _r;vr=1;var t=Mi(),e=Ir(),n=Er(),i=TypeError;return _r=function(r,o){var a,s;if("string"===o&&e(a=r.toString)&&!n(s=t(a,r)))return s;if(e(a=r.valueOf)&&!n(s=t(a,r)))return s;if("string"!==o&&e(a=r.toString)&&!n(s=t(a,r)))return s;throw new i("Can't convert object to primitive value")}}var Nr,zr,Xr,jr,Ur,Vr,Yr,Zr,Kr,qr,Jr,Qr,$r,to,eo,no,io,ro,oo,ao,so,ho,lo,uo,co={exports:{}};function fo(){return zr?Nr:(zr=1,Nr=!1)}function po(){if(jr)return Xr;jr=1;var t=vi(),e=Object.defineProperty;return Xr=function(n,i){try{e(t,n,{value:i,configurable:!0,writable:!0})}catch(e){t[n]=i}return i}}function go(){if(Ur)return co.exports;Ur=1;var t=fo(),e=vi(),n=po(),i="__core-js_shared__",r=co.exports=e[i]||n(i,{});return(r.versions||(r.versions=[])).push({version:"3.47.0",mode:t?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"}),co.exports}function mo(){if(Yr)return Vr;Yr=1;var t=go();return Vr=function(e,n){return t[e]||(t[e]=n||{})}}function _o(){if(Kr)return Zr;Kr=1;var t=Tr(),e=Object;return Zr=function(n){return e(t(n))}}function vo(){if(Jr)return qr;Jr=1;var t=Sr(),e=_o(),n=t({}.hasOwnProperty);return qr=Object.hasOwn||function(t,i){return n(e(t),i)}}function yo(){if($r)return Qr;$r=1;var t=Sr(),e=0,n=Math.random(),i=t(1.1.toString);return Qr=function(t){return"Symbol("+(void 0===t?"":t)+")_"+i(++e+n,36)}}function bo(){if(eo)return to;eo=1;var t=vi(),e=mo(),n=vo(),i=yo(),r=Lr(),o=Rr(),a=t.Symbol,s=e("wks"),h=o?a.for||a:a&&a.withoutSetter||i;return to=function(t){return n(s,t)||(s[t]=r&&n(a,t)?a[t]:h("Symbol."+t)),s[t]}}function wo(){if(io)return no;io=1;var t=Mi(),e=Er(),n=Fr(),i=Gr(),r=Hr(),o=bo(),a=TypeError,s=o("toPrimitive");return no=function(o,h){if(!e(o)||n(o))return o;var l,u=i(o,s);if(u){if(void 0===h&&(h="default"),l=t(u,o,h),!e(l)||n(l))return l;throw new a("Can't convert object to primitive value")}return void 0===h&&(h="number"),r(o,h)}}function So(){if(oo)return ro;oo=1;var t=wo(),e=Fr();return ro=function(n){var i=t(n,"string");return e(i)?i:i+""}}function xo(){if(so)return ao;so=1;var t=vi(),e=Er(),n=t.document,i=e(n)&&e(n.createElement);return ao=function(t){return i?n.createElement(t):{}}}function Co(){if(lo)return ho;lo=1;var t=Ei(),e=Ii(),n=xo();return ho=!t&&!e(function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a})}function ko(){if(uo)return Ai;uo=1;var t=Ei(),e=Mi(),n=br(),i=wr(),r=Ar(),o=So(),a=vo(),s=Co(),h=Object.getOwnPropertyDescriptor;return Ai.f=t?h:function(t,l){if(t=r(t),l=o(l),s)try{return h(t,l)}catch(t){}if(a(t,l))return i(!e(n.f,t,l),t[l])},Ai}var To,Ao,Io,Eo,Po,Mo,Do,Oo={};function Lo(){if(Ao)return To;Ao=1;var t=Ei(),e=Ii();return To=t&&e(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})}function Ro(){if(Eo)return Io;Eo=1;var t=Er(),e=String,n=TypeError;return Io=function(i){if(t(i))return i;throw new n(e(i)+" is not an object")}}function Fo(){if(Po)return Oo;Po=1;var t=Ei(),e=Co(),n=Lo(),i=Ro(),r=So(),o=TypeError,a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,h="enumerable",l="configurable",u="writable";return Oo.f=t?n?function(t,e,n){if(i(t),e=r(e),i(n),"function"==typeof t&&"prototype"===e&&"value"in n&&u in n&&!n[u]){var o=s(t,e);o&&o[u]&&(t[e]=n.value,n={configurable:l in n?n[l]:o[l],enumerable:h in n?n[h]:o[h],writable:!1})}return a(t,e,n)}:a:function(t,n,s){if(i(t),n=r(n),i(s),e)try{return a(t,n,s)}catch(t){}if("get"in s||"set"in s)throw new o("Accessors not supported");return"value"in s&&(t[n]=s.value),t},Oo}function Wo(){if(Do)return Mo;Do=1;var t=Ei(),e=Fo(),n=wr();return Mo=t?function(t,i,r){return e.f(t,i,n(1,r))}:function(t,e,n){return t[e]=n,t}}var Bo,Go,Ho,No,zo,Xo,jo,Uo,Vo,Yo,Zo,Ko,qo,Jo,Qo,$o={exports:{}};function ta(){if(Go)return Bo;Go=1;var t=Ei(),e=vo(),n=Function.prototype,i=t&&Object.getOwnPropertyDescriptor,r=e(n,"name"),o=r&&"something"===function(){}.name,a=r&&(!t||t&&i(n,"name").configurable);return Bo={EXISTS:r,PROPER:o,CONFIGURABLE:a}}function ea(){if(No)return Ho;No=1;var t=Sr(),e=Ir(),n=go(),i=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(t){return i(t)}),Ho=n.inspectSource}function na(){if(Uo)return jo;Uo=1;var t=mo(),e=yo(),n=t("keys");return jo=function(t){return n[t]||(n[t]=e(t))}}function ia(){return Yo?Vo:(Yo=1,Vo={})}function ra(){if(Ko)return Zo;Ko=1;var t,e,n,i=function(){if(Xo)return zo;Xo=1;var t=vi(),e=Ir(),n=t.WeakMap;return zo=e(n)&&/native code/.test(String(n))}(),r=vi(),o=Er(),a=Wo(),s=vo(),h=go(),l=na(),u=ia(),c="Object already initialized",d=r.TypeError,f=r.WeakMap;if(i||h.state){var p=h.state||(h.state=new f);p.get=p.get,p.has=p.has,p.set=p.set,t=function(t,e){if(p.has(t))throw new d(c);return e.facade=t,p.set(t,e),e},e=function(t){return p.get(t)||{}},n=function(t){return p.has(t)}}else{var g=l("state");u[g]=!0,t=function(t,e){if(s(t,g))throw new d(c);return e.facade=t,a(t,g,e),e},e=function(t){return s(t,g)?t[g]:{}},n=function(t){return s(t,g)}}return Zo={set:t,get:e,has:n,enforce:function(i){return n(i)?e(i):t(i,{})},getterFor:function(t){return function(n){var i;if(!o(n)||(i=e(n)).type!==t)throw new d("Incompatible receiver, "+t+" required");return i}}}}function oa(){if(qo)return $o.exports;qo=1;var t=Sr(),e=Ii(),n=Ir(),i=vo(),r=Ei(),o=ta().CONFIGURABLE,a=ea(),s=ra(),h=s.enforce,l=s.get,u=String,c=Object.defineProperty,d=t("".slice),f=t("".replace),p=t([].join),g=r&&!e(function(){return 8!==c(function(){},"length",{value:8}).length}),m=String(String).split("String"),_=$o.exports=function(t,e,n){"Symbol("===d(u(e),0,7)&&(e="["+f(u(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!i(t,"name")||o&&t.name!==e)&&(r?c(t,"name",{value:e,configurable:!0}):t.name=e),g&&n&&i(n,"arity")&&t.length!==n.arity&&c(t,"length",{value:n.arity});try{n&&i(n,"constructor")&&n.constructor?r&&c(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var a=h(t);return i(a,"source")||(a.source=p(m,"string"==typeof e?e:"")),t};return Function.prototype.toString=_(function(){return n(this)&&l(this).source||a(this)},"toString"),$o.exports}function aa(){if(Qo)return Jo;Qo=1;var t=Ir(),e=Fo(),n=oa(),i=po();return Jo=function(r,o,a,s){s||(s={});var h=s.enumerable,l=void 0!==s.name?s.name:o;if(t(a)&&n(a,l,s),s.global)h?r[o]=a:i(o,a);else{try{s.unsafe?r[o]&&(h=!0):delete r[o]}catch(t){}h?r[o]=a:e.f(r,o,{value:a,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return r}}var sa,ha,la,ua,ca,da,fa,pa,ga,ma,_a,va,ya,ba,wa,Sa,xa,Ca={};function ka(){if(ua)return la;ua=1;var t=function(){if(ha)return sa;ha=1;var t=Math.ceil,e=Math.floor;return sa=Math.trunc||function(n){var i=+n;return(i>0?e:t)(i)}}();return la=function(e){var n=+e;return n!=n||0===n?0:t(n)}}function Ta(){if(da)return ca;da=1;var t=ka(),e=Math.max,n=Math.min;return ca=function(i,r){var o=t(i);return o<0?e(o+r,0):n(o,r)}}function Aa(){if(pa)return fa;pa=1;var t=ka(),e=Math.min;return fa=function(n){var i=t(n);return i>0?e(i,9007199254740991):0}}function Ia(){if(ma)return ga;ma=1;var t=Aa();return ga=function(e){return t(e.length)}}function Ea(){if(va)return _a;va=1;var t=Ar(),e=Ta(),n=Ia(),i=function(i){return function(r,o,a){var s=t(r),h=n(s);if(0===h)return!i&&-1;var l,u=e(a,h);if(i&&o!=o){for(;h>u;)if((l=s[u++])!=l)return!0}else for(;h>u;u++)if((i||u in s)&&s[u]===o)return i||u||0;return!i&&-1}};return _a={includes:i(!0),indexOf:i(!1)}}function Pa(){if(ba)return ya;ba=1;var t=Sr(),e=vo(),n=Ar(),i=Ea().indexOf,r=ia(),o=t([].push);return ya=function(t,a){var s,h=n(t),l=0,u=[];for(s in h)!e(r,s)&&e(h,s)&&o(u,s);for(;a.length>l;)e(h,s=a[l++])&&(~i(u,s)||o(u,s));return u}}function Ma(){return Sa?wa:(Sa=1,wa=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"])}function Da(){if(xa)return Ca;xa=1;var t=Pa(),e=Ma().concat("length","prototype");return Ca.f=Object.getOwnPropertyNames||function(n){return t(n,e)},Ca}var Oa,La,Ra,Fa,Wa,Ba,Ga,Ha,Na,za,Xa,ja,Ua,Va,Ya={};function Za(){return Oa||(Oa=1,Ya.f=Object.getOwnPropertySymbols),Ya}function Ka(){if(Wa)return Fa;Wa=1;var t=vo(),e=function(){if(Ra)return La;Ra=1;var t=Pr(),e=Sr(),n=Da(),i=Za(),r=Ro(),o=e([].concat);return La=t("Reflect","ownKeys")||function(t){var e=n.f(r(t)),a=i.f;return a?o(e,a(t)):e},La}(),n=ko(),i=Fo();return Fa=function(r,o,a){for(var s=e(o),h=i.f,l=n.f,u=0;u<s.length;u++){var c=s[u];t(r,c)||a&&t(a,c)||h(r,c,l(o,c))}},Fa}function qa(){if(Ga)return Ba;Ga=1;var t=Ii(),e=Ir(),n=/#|\.prototype\./,i=function(n,i){var h=o[r(n)];return h===s||h!==a&&(e(i)?t(i):!!i)},r=i.normalize=function(t){return String(t).replace(n,".").toLowerCase()},o=i.data={},a=i.NATIVE="N",s=i.POLYFILL="P";return Ba=i}function Ja(){if(Na)return Ha;Na=1;var t=vi(),e=ko().f,n=Wo(),i=aa(),r=po(),o=Ka(),a=qa();return Ha=function(s,h){var l,u,c,d,f,p=s.target,g=s.global,m=s.stat;if(l=g?t:m?t[p]||r(p,{}):t[p]&&t[p].prototype)for(u in h){if(d=h[u],c=s.dontCallGetSet?(f=e(l,u))&&f.value:l[u],!a(g?u:p+(m?".":"#")+u,s.forced)&&void 0!==c){if(typeof d==typeof c)continue;o(d,c)}(s.sham||c&&c.sham)&&n(d,"sham",!0),i(l,u,d,s)}}}function Qa(){if(Xa)return za;Xa=1;var t=xr(),e=Sr();return za=function(n){if("Function"===t(n))return e(n)}}function $a(){if(Ua)return ja;Ua=1;var t=Ii();return ja=function(e,n){var i=[][e];return!!i&&t(function(){i.call(null,n||function(){return 1},1)})}}!function(){if(Va)return _i;Va=1;var t=Ja(),e=Qa(),n=Ea().indexOf,i=$a(),r=e([].indexOf),o=!!r&&1/r([1],1,-0)<0;t({target:"Array",proto:!0,forced:o||!i("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return o?r(this,t,e)||0:n(this,t,e)}})}();var ts,es,ns,is,rs,os,as,ss,hs,ls,us,cs,ds,fs,ps,gs,ms,_s,vs,ys,bs,ws,Ss,xs,Cs,ks,Ts,As,Is,Es,Ps,Ms,Ds,Os,Ls,Rs={};function Fs(){if(es)return ts;es=1;var t=Pa(),e=Ma();return ts=Object.keys||function(n){return t(n,e)}}function Ws(){if(rs)return is;rs=1;var t=Pr();return is=t("document","documentElement")}function Bs(){if(as)return os;as=1;var t,e=Ro(),n=function(){if(ns)return Rs;ns=1;var t=Ei(),e=Lo(),n=Fo(),i=Ro(),r=Ar(),o=Fs();return Rs.f=t&&!e?Object.defineProperties:function(t,e){i(t);for(var a,s=r(e),h=o(e),l=h.length,u=0;l>u;)n.f(t,a=h[u++],s[a]);return t},Rs}(),i=Ma(),r=ia(),o=Ws(),a=xo(),s=na(),h="prototype",l="script",u=s("IE_PROTO"),c=function(){},d=function(t){return"<"+l+">"+t+"</"+l+">"},f=function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e},p=function(){try{t=new ActiveXObject("htmlfile")}catch(t){}var e,n,r;p="undefined"!=typeof document?document.domain&&t?f(t):(n=a("iframe"),r="java"+l+":",n.style.display="none",o.appendChild(n),n.src=String(r),(e=n.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F):f(t);for(var s=i.length;s--;)delete p[h][i[s]];return p()};return r[u]=!0,os=Object.create||function(t,i){var r;return null!==t?(c[h]=e(t),r=new c,c[h]=null,r[u]=t):r=p(),void 0===i?r:n.f(r,i)}}function Gs(){if(hs)return ss;hs=1;var t=bo(),e=Bs(),n=Fo().f,i=t("unscopables"),r=Array.prototype;return void 0===r[i]&&n(r,i,{configurable:!0,value:e(null)}),ss=function(t){r[i][t]=!0}}function Hs(){return us?ls:(us=1,ls={})}function Ns(){if(ps)return fs;ps=1;var t=vo(),e=Ir(),n=_o(),i=na(),r=function(){if(ds)return cs;ds=1;var t=Ii();return cs=!t(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})}(),o=i("IE_PROTO"),a=Object,s=a.prototype;return fs=r?a.getPrototypeOf:function(i){var r=n(i);if(t(r,o))return r[o];var h=r.constructor;return e(h)&&r instanceof h?h.prototype:r instanceof a?s:null}}function zs(){if(ms)return gs;ms=1;var t,e,n,i=Ii(),r=Ir(),o=Er(),a=Bs(),s=Ns(),h=aa(),l=bo(),u=fo(),c=l("iterator"),d=!1;return[].keys&&("next"in(n=[].keys())?(e=s(s(n)))!==Object.prototype&&(t=e):d=!0),!o(t)||i(function(){var e={};return t[c].call(e)!==e})?t={}:u&&(t=a(t)),r(t[c])||h(t,c,function(){return this}),gs={IteratorPrototype:t,BUGGY_SAFARI_ITERATORS:d}}function Xs(){if(vs)return _s;vs=1;var t=Fo().f,e=vo(),n=bo()("toStringTag");return _s=function(i,r,o){i&&!o&&(i=i.prototype),i&&!e(i,n)&&t(i,n,{configurable:!0,value:r})}}function js(){if(Cs)return xs;Cs=1;var t=Er();return xs=function(e){return t(e)||null===e}}function Us(){if(Ts)return ks;Ts=1;var t=js(),e=String,n=TypeError;return ks=function(i){if(t(i))return i;throw new n("Can't set "+e(i)+" as a prototype")}}function Vs(){if(Is)return As;Is=1;var t=function(){if(Ss)return ws;Ss=1;var t=Sr(),e=Br();return ws=function(n,i,r){try{return t(e(Object.getOwnPropertyDescriptor(n,i)[r]))}catch(t){}}}(),e=Er(),n=Tr(),i=Us();return As=Object.setPrototypeOf||("__proto__"in{}?function(){var r,o=!1,a={};try{(r=t(Object.prototype,"__proto__","set"))(a,[]),o=a instanceof Array}catch(t){}return function(t,a){return n(t),i(a),e(t)?(o?r(t,a):t.__proto__=a,t):t}}():void 0)}function Ys(){if(Ps)return Es;Ps=1;var t=Ja(),e=Mi(),n=fo(),i=ta(),r=Ir(),o=function(){if(bs)return ys;bs=1;var t=zs().IteratorPrototype,e=Bs(),n=wr(),i=Xs(),r=Hs(),o=function(){return this};return ys=function(a,s,h,l){var u=s+" Iterator";return a.prototype=e(t,{next:n(+!l,h)}),i(a,u,!1,!0),r[u]=o,a}}(),a=Ns(),s=Vs(),h=Xs(),l=Wo(),u=aa(),c=bo(),d=Hs(),f=zs(),p=i.PROPER,g=i.CONFIGURABLE,m=f.IteratorPrototype,_=f.BUGGY_SAFARI_ITERATORS,v=c("iterator"),y="keys",b="values",w="entries",S=function(){return this};return Es=function(i,c,f,x,C,k,T){o(f,c,x);var A,I,E,P=function(t){if(t===C&&R)return R;if(!_&&t&&t in O)return O[t];switch(t){case y:case b:case w:return function(){return new f(this,t)}}return function(){return new f(this)}},M=c+" Iterator",D=!1,O=i.prototype,L=O[v]||O["@@iterator"]||C&&O[C],R=!_&&L||P(C),F="Array"===c&&O.entries||L;if(F&&(A=a(F.call(new i)))!==Object.prototype&&A.next&&(n||a(A)===m||(s?s(A,m):r(A[v])||u(A,v,S)),h(A,M,!0,!0),n&&(d[M]=S)),p&&C===b&&L&&L.name!==b&&(!n&&g?l(O,"name",b):(D=!0,R=function(){return e(L,this)})),C)if(I={values:P(b),keys:k?R:P(y),entries:P(w)},T)for(E in I)(_||D||!(E in O))&&u(O,E,I[E]);else t({target:c,proto:!0,forced:_||D},I);return n&&!T||O[v]===R||u(O,v,R,{name:C}),d[c]=R,I}}function Zs(){return Ds?Ms:(Ds=1,Ms=function(t,e){return{value:t,done:e}})}function Ks(){if(Ls)return Os;Ls=1;var t=Ar(),e=Gs(),n=Hs(),i=ra(),r=Fo().f,o=Ys(),a=Zs(),s=fo(),h=Ei(),l="Array Iterator",u=i.set,c=i.getterFor(l);Os=o(Array,"Array",function(e,n){u(this,{type:l,target:t(e),index:0,kind:n})},function(){var t=c(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,a(void 0,!0);switch(t.kind){case"keys":return a(n,!1);case"values":return a(e[n],!1)}return a([n,e[n]],!1)},"values");var d=n.Arguments=n.Array;if(e("keys"),e("values"),e("entries"),!s&&h&&"values"!==d.name)try{r(d,"name",{value:"values"})}catch(t){}return Os}Ks();var qs,Js,Qs,$s,th,eh,nh,ih,rh,oh,ah,sh,hh,lh,uh,ch={};function dh(){if(Js)return qs;Js=1;var t=xr();return qs=Array.isArray||function(e){return"Array"===t(e)}}function fh(){if($s)return Qs;$s=1;var t={};return t[bo()("toStringTag")]="z",Qs="[object z]"===String(t)}function ph(){if(eh)return th;eh=1;var t=fh(),e=Ir(),n=xr(),i=bo()("toStringTag"),r=Object,o="Arguments"===n(function(){return arguments}());return th=t?n:function(t){var a,s,h;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(s=function(t,e){try{return t[e]}catch(t){}}(a=r(t),i))?s:o?n(a):"Object"===(h=n(a))&&e(a.callee)?"Arguments":h}}function gh(){if(ih)return nh;ih=1;var t=Sr(),e=Ii(),n=Ir(),i=ph(),r=Pr(),o=ea(),a=function(){},s=r("Reflect","construct"),h=/^\s*(?:class|function)\b/,l=t(h.exec),u=!h.test(a),c=function(t){if(!n(t))return!1;try{return s(a,[],t),!0}catch(t){return!1}},d=function(t){if(!n(t))return!1;switch(i(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!l(h,o(t))}catch(t){return!0}};return d.sham=!0,nh=!s||e(function(){var t;return c(c.call)||!c(Object)||!c(function(){t=!0})||t})?d:c}function mh(){if(oh)return rh;oh=1;var t=Ei(),e=Fo(),n=wr();return rh=function(i,r,o){t?e.f(i,r,n(0,o)):i[r]=o}}function _h(){if(sh)return ah;sh=1;var t=Ii(),e=bo(),n=Or(),i=e("species");return ah=function(e){return n>=51||!t(function(){var t=[];return(t.constructor={})[i]=function(){return{foo:1}},1!==t[e](Boolean).foo})}}function vh(){if(lh)return hh;lh=1;var t=Sr();return hh=t([].slice)}!function(){if(uh)return ch;uh=1;var t=Ja(),e=dh(),n=gh(),i=Er(),r=Ta(),o=Ia(),a=Ar(),s=mh(),h=bo(),l=_h(),u=vh(),c=l("slice"),d=h("species"),f=Array,p=Math.max;t({target:"Array",proto:!0,forced:!c},{slice:function(t,h){var l,c,g,m=a(this),_=o(m),v=r(t,_),y=r(void 0===h?_:h,_);if(e(m)&&(l=m.constructor,(n(l)&&(l===f||e(l.prototype))||i(l)&&null===(l=l[d]))&&(l=void 0),l===f||void 0===l))return u(m,v,y);for(c=new(void 0===l?f:l)(p(y-v,0)),g=0;v<y;v++,g++)v in m&&s(c,g,m[v]);return c.length=g,c}})}();var yh,bh,wh,Sh,xh,Ch,kh,Th,Ah,Ih,Eh,Ph={};function Mh(){if(Sh)return wh;Sh=1;var t=TypeError;return wh=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}}function Dh(){if(Ch)return xh;Ch=1;var t=dh(),e=gh(),n=Er(),i=bo()("species"),r=Array;return xh=function(o){var a;return t(o)&&(a=o.constructor,(e(a)&&(a===r||t(a.prototype))||n(a)&&null===(a=a[i]))&&(a=void 0)),void 0===a?r:a}}function Oh(){if(Th)return kh;Th=1;var t=Dh();return kh=function(e,n){return new(t(e))(0===n?0:n)}}function Lh(){if(Ih)return Ah;Ih=1;var t=Wr(),e=TypeError;return Ah=function(n,i){if(!delete n[i])throw new e("Cannot delete property "+t(i)+" of "+t(n))}}!function(){if(Eh)return Ph;Eh=1;var t=Ja(),e=_o(),n=Ta(),i=ka(),r=Ia(),o=function(){if(bh)return yh;bh=1;var t=Ei(),e=dh(),n=TypeError,i=Object.getOwnPropertyDescriptor,r=t&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();return yh=r?function(t,r){if(e(t)&&!i(t,"length").writable)throw new n("Cannot set read only .length");return t.length=r}:function(t,e){return t.length=e}}(),a=Mh(),s=Oh(),h=mh(),l=Lh(),u=_h()("splice"),c=Math.max,d=Math.min;t({target:"Array",proto:!0,forced:!u},{splice:function(t,u){var f,p,g,m,_,v,y=e(this),b=r(y),w=n(t,b),S=arguments.length;for(0===S?f=p=0:1===S?(f=0,p=b-w):(f=S-2,p=d(c(i(u),0),b-w)),a(b+f-p),g=s(y,p),m=0;m<p;m++)(_=w+m)in y&&h(g,m,y[_]);if(g.length=p,f<p){for(m=w;m<b-p;m++)v=m+f,(_=m+p)in y?y[v]=y[_]:l(y,v);for(m=b;m>b-p+f;m--)l(y,m-1)}else if(f>p)for(m=b-p;m>w;m--)v=m+f-1,(_=m+p-1)in y?y[v]=y[_]:l(y,v);for(m=0;m<f;m++)y[m+w]=arguments[m+2];return o(y,b-p+f),g}})}();var Rh,Fh,Wh,Bh={};!function(){if(Wh)return Bh;Wh=1;var t=fh(),e=aa(),n=function(){if(Fh)return Rh;Fh=1;var t=fh(),e=ph();return Rh=t?{}.toString:function(){return"[object "+e(this)+"]"}}();t||e(Object.prototype,"toString",n,{unsafe:!0})}();var Gh,Hh,Nh,zh,Xh,jh,Uh,Vh,Yh,Zh,Kh,qh,Jh,Qh,$h,tl,el,nl,il,rl,ol,al,sl,hl,ll,ul,cl,dl,fl,pl,gl,ml,_l,vl,yl,bl,wl,Sl,xl={exports:{}},Cl={};function kl(){if(Gh)return Cl;Gh=1;var t=xr(),e=Ar(),n=Da().f,i=vh(),r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];return Cl.f=function(o){return r&&"Window"===t(o)?function(t){try{return n(t)}catch(t){return i(r)}}(o):n(e(o))},Cl}function Tl(){if(Xh)return zh;Xh=1;var t=Ii(),e=Er(),n=xr(),i=function(){if(Nh)return Hh;Nh=1;var t=Ii();return Hh=t(function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})}(),r=Object.isExtensible,o=t(function(){});return zh=o||i?function(t){return!!e(t)&&((!i||"ArrayBuffer"!==n(t))&&(!r||r(t)))}:r}function Al(){if(Vh)return xl.exports;Vh=1;var t=Ja(),e=Sr(),n=ia(),i=Er(),r=vo(),o=Fo().f,a=Da(),s=kl(),h=Tl(),l=yo(),u=function(){if(Uh)return jh;Uh=1;var t=Ii();return jh=!t(function(){return Object.isExtensible(Object.preventExtensions({}))})}(),c=!1,d=l("meta"),f=0,p=function(t){o(t,d,{value:{objectID:"O"+f++,weakData:{}}})},g=xl.exports={enable:function(){g.enable=function(){},c=!0;var n=a.f,i=e([].splice),r={};r[d]=1,n(r).length&&(a.f=function(t){for(var e=n(t),r=0,o=e.length;r<o;r++)if(e[r]===d){i(e,r,1);break}return e},t({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:s.f}))},fastKey:function(t,e){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,d)){if(!h(t))return"F";if(!e)return"E";p(t)}return t[d].objectID},getWeakData:function(t,e){if(!r(t,d)){if(!h(t))return!0;if(!e)return!1;p(t)}return t[d].weakData},onFreeze:function(t){return u&&c&&h(t)&&!r(t,d)&&p(t),t}};return n[d]=!0,xl.exports}function Il(){if(Zh)return Yh;Zh=1;var t=Qa(),e=Br(),n=Pi(),i=t(t.bind);return Yh=function(t,r){return e(t),void 0===r?t:n?i(t,r):function(){return t.apply(r,arguments)}},Yh}function El(){if(qh)return Kh;qh=1;var t=bo(),e=Hs(),n=t("iterator"),i=Array.prototype;return Kh=function(t){return void 0!==t&&(e.Array===t||i[n]===t)}}function Pl(){if(Qh)return Jh;Qh=1;var t=ph(),e=Gr(),n=kr(),i=Hs(),r=bo()("iterator");return Jh=function(o){if(!n(o))return e(o,r)||e(o,"@@iterator")||i[t(o)]}}function Ml(){if(tl)return $h;tl=1;var t=Mi(),e=Br(),n=Ro(),i=Wr(),r=Pl(),o=TypeError;return $h=function(a,s){var h=arguments.length<2?r(a):s;if(e(h))return n(t(h,a));throw new o(i(a)+" is not iterable")},$h}function Dl(){if(nl)return el;nl=1;var t=Mi(),e=Ro(),n=Gr();return el=function(i,r,o){var a,s;e(i);try{if(!(a=n(i,"return"))){if("throw"===r)throw o;return o}a=t(a,i)}catch(t){s=!0,a=t}if("throw"===r)throw o;if(s)throw a;return e(a),o}}function Ol(){if(rl)return il;rl=1;var t=Il(),e=Mi(),n=Ro(),i=Wr(),r=El(),o=Ia(),a=Mr(),s=Ml(),h=Pl(),l=Dl(),u=TypeError,c=function(t,e){this.stopped=t,this.result=e},d=c.prototype;return il=function(f,p,g){var m,_,v,y,b,w,S,x=g&&g.that,C=!(!g||!g.AS_ENTRIES),k=!(!g||!g.IS_RECORD),T=!(!g||!g.IS_ITERATOR),A=!(!g||!g.INTERRUPTED),I=t(p,x),E=function(t){return m&&l(m,"normal"),new c(!0,t)},P=function(t){return C?(n(t),A?I(t[0],t[1],E):I(t[0],t[1])):A?I(t,E):I(t)};if(k)m=f.iterator;else if(T)m=f;else{if(!(_=h(f)))throw new u(i(f)+" is not iterable");if(r(_)){for(v=0,y=o(f);y>v;v++)if((b=P(f[v]))&&a(d,b))return b;return new c(!1)}m=s(f,_)}for(w=k?f.next:m.next;!(S=e(w,m)).done;){try{b=P(S.value)}catch(t){l(m,"throw",t)}if("object"==typeof b&&b&&a(d,b))return b}return new c(!1)}}function Ll(){if(al)return ol;al=1;var t=Mr(),e=TypeError;return ol=function(n,i){if(t(i,n))return n;throw new e("Incorrect invocation")}}function Rl(){if(hl)return sl;hl=1;var t=bo()("iterator"),e=!1;try{var n=0,i={next:function(){return{done:!!n++}},return:function(){e=!0}};i[t]=function(){return this},Array.from(i,function(){throw 2})}catch(t){}return sl=function(n,i){try{if(!i&&!e)return!1}catch(t){return!1}var r=!1;try{var o={};o[t]=function(){return{next:function(){return{done:r=!0}}}},n(o)}catch(t){}return r}}function Fl(){if(ul)return ll;ul=1;var t=Ir(),e=Er(),n=Vs();return ll=function(i,r,o){var a,s;return n&&t(a=r.constructor)&&a!==o&&e(s=a.prototype)&&s!==o.prototype&&n(i,s),i}}function Wl(){if(dl)return cl;dl=1;var t=Ja(),e=vi(),n=Sr(),i=qa(),r=aa(),o=Al(),a=Ol(),s=Ll(),h=Ir(),l=kr(),u=Er(),c=Ii(),d=Rl(),f=Xs(),p=Fl();return cl=function(g,m,_){var v=-1!==g.indexOf("Map"),y=-1!==g.indexOf("Weak"),b=v?"set":"add",w=e[g],S=w&&w.prototype,x=w,C={},k=function(t){var e=n(S[t]);r(S,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(y&&!u(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return y&&!u(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(y&&!u(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(i(g,!h(w)||!(y||S.forEach&&!c(function(){(new w).entries().next()}))))x=_.getConstructor(m,g,v,b),o.enable();else if(i(g,!0)){var T=new x,A=T[b](y?{}:-0,1)!==T,I=c(function(){T.has(1)}),E=d(function(t){new w(t)}),P=!y&&c(function(){for(var t=new w,e=5;e--;)t[b](e,e);return!t.has(-0)});E||((x=m(function(t,e){s(t,S);var n=p(new w,t,x);return l(e)||a(e,n[b],{that:n,AS_ENTRIES:v}),n})).prototype=S,S.constructor=x),(I||P)&&(k("delete"),k("has"),v&&k("get")),(P||A)&&k(b),y&&S.clear&&delete S.clear}return C[g]=x,t({global:!0,constructor:!0,forced:x!==w},C),f(x,g),y||_.setStrong(x,g,v),x}}function Bl(){if(pl)return fl;pl=1;var t=oa(),e=Fo();return fl=function(n,i,r){return r.get&&t(r.get,i,{getter:!0}),r.set&&t(r.set,i,{setter:!0}),e.f(n,i,r)}}function Gl(){if(ml)return gl;ml=1;var t=aa();return gl=function(e,n,i){for(var r in n)t(e,r,n[r],i);return e}}function Hl(){if(vl)return _l;vl=1;var t=Pr(),e=Bl(),n=bo(),i=Ei(),r=n("species");return _l=function(n){var o=t(n);i&&o&&!o[r]&&e(o,r,{configurable:!0,get:function(){return this}})}}function Nl(){if(bl)return yl;bl=1;var t=Bs(),e=Bl(),n=Gl(),i=Il(),r=Ll(),o=kr(),a=Ol(),s=Ys(),h=Zs(),l=Hl(),u=Ei(),c=Al().fastKey,d=ra(),f=d.set,p=d.getterFor;return yl={getConstructor:function(s,h,l,d){var g=s(function(e,n){r(e,m),f(e,{type:h,index:t(null),first:null,last:null,size:0}),u||(e.size=0),o(n)||a(n,e[d],{that:e,AS_ENTRIES:l})}),m=g.prototype,_=p(h),v=function(t,e,n){var i,r,o=_(t),a=y(t,e);return a?a.value=n:(o.last=a={index:r=c(e,!0),key:e,value:n,previous:i=o.last,next:null,removed:!1},o.first||(o.first=a),i&&(i.next=a),u?o.size++:t.size++,"F"!==r&&(o.index[r]=a)),t},y=function(t,e){var n,i=_(t),r=c(e);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key===e)return n};return n(m,{clear:function(){for(var e=_(this),n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=null),n=n.next;e.first=e.last=null,e.index=t(null),u?e.size=0:this.size=0},delete:function(t){var e=this,n=_(e),i=y(e,t);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first===i&&(n.first=r),n.last===i&&(n.last=o),u?n.size--:e.size--}return!!i},forEach:function(t){for(var e,n=_(this),r=i(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!y(this,t)}}),n(m,l?{get:function(t){var e=y(this,t);return e&&e.value},set:function(t,e){return v(this,0===t?0:t,e)}}:{add:function(t){return v(this,t=0===t?0:t,t)}}),u&&e(m,"size",{configurable:!0,get:function(){return _(this).size}}),g},setStrong:function(t,e,n){var i=e+" Iterator",r=p(e),o=p(i);s(t,e,function(t,e){f(this,{type:i,target:t,state:r(t),kind:e,last:null})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?h("keys"===e?n.key:"values"===e?n.value:[n.key,n.value],!1):(t.target=null,h(void 0,!0))},n?"entries":"values",!n,!0),l(e)}},yl}Sl||(Sl=1,wl||(wl=1,Wl()("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Nl())));var zl,Xl,jl,Ul,Vl,Yl={};function Zl(){if(Xl)return zl;Xl=1;var t=ph(),e=String;return zl=function(n){if("Symbol"===t(n))throw new TypeError("Cannot convert a Symbol value to a string");return e(n)}}function Kl(){if(Ul)return jl;Ul=1;var t=Sr(),e=ka(),n=Zl(),i=Tr(),r=t("".charAt),o=t("".charCodeAt),a=t("".slice),s=function(t){return function(s,h){var l,u,c=n(i(s)),d=e(h),f=c.length;return d<0||d>=f?t?"":void 0:(l=o(c,d))<55296||l>56319||d+1===f||(u=o(c,d+1))<56320||u>57343?t?r(c,d):l:t?a(c,d,d+2):u-56320+(l-55296<<10)+65536}};return jl={codeAt:s(!1),charAt:s(!0)}}!function(){if(Vl)return Yl;Vl=1;var t=Kl().charAt,e=Zl(),n=ra(),i=Ys(),r=Zs(),o="String Iterator",a=n.set,s=n.getterFor(o);i(String,"String",function(t){a(this,{type:o,string:e(t),index:0})},function(){var e,n=s(this),i=n.string,o=n.index;return o>=i.length?r(void 0,!0):(e=t(i,o),n.index+=e.length,r(e,!1))})}();var ql,Jl,Ql={};Jl||(Jl=1,function(){if(ql)return Ql;ql=1;var t=Ja(),e=vi();t({global:!0,forced:e.globalThis!==e},{globalThis:e})}());var $l,tu,eu,nu,iu,ru,ou,au,su,hu={};function lu(){return tu?$l:(tu=1,$l={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})}function uu(){if(nu)return eu;nu=1;var t=xo()("span").classList,e=t&&t.constructor&&t.constructor.prototype;return eu=e===Object.prototype?void 0:e}function cu(){if(ru)return iu;ru=1;var t=Il(),e=Sr(),n=Cr(),i=_o(),r=Ia(),o=Oh(),a=e([].push),s=function(e){var s=1===e,h=2===e,l=3===e,u=4===e,c=6===e,d=7===e,f=5===e||c;return function(p,g,m,_){for(var v,y,b=i(p),w=n(b),S=r(w),x=t(g,m),C=0,k=_||o,T=s?k(p,S):h||d?k(p,0):void 0;S>C;C++)if((f||C in w)&&(y=x(v=w[C],C,b),e))if(s)T[C]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return C;case 2:a(T,v)}else switch(e){case 4:return!1;case 7:a(T,v)}return c?-1:l||u?u:T}};return iu={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}}!function(){if(su)return hu;su=1;var t=vi(),e=lu(),n=uu(),i=function(){if(au)return ou;au=1;var t=cu().forEach,e=$a()("forEach");return ou=e?[].forEach:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)},ou}(),r=Wo(),o=function(t){if(t&&t.forEach!==i)try{r(t,"forEach",i)}catch(e){t.forEach=i}};for(var a in e)e[a]&&o(t[a]&&t[a].prototype);o(n)}();var du,fu={};!function(){if(du)return fu;du=1;var t=vi(),e=lu(),n=uu(),i=Ks(),r=Wo(),o=Xs(),a=bo()("iterator"),s=i.values,h=function(t,n){if(t){if(t[a]!==s)try{r(t,a,s)}catch(e){t[a]=s}if(o(t,n,!0),e[n])for(var h in i)if(t[h]!==i[h])try{r(t,h,i[h])}catch(e){t[h]=i[h]}}};for(var l in e)h(t[l]&&t[l].prototype,l);h(n,"DOMTokenList")}(),function(t){var e=!(!t.starmusConfig||!t.starmusConfig.debug);function n(){if(e)try{(console.log||function(){}).apply(console,arguments)}catch(t){}}var i="function"==typeof Set,r={},o={};void 0===t.StarmusHooks&&(t.StarmusHooks={}),t.StarmusHooks.subscribe=function(t,e,n){var o=t+"::"+(n||"*");return r[o]||(r[o]=i?new Set:[]),function(t,e){i?t.add(e):-1===t.indexOf(e)&&t.push(e)}(r[o],e),function(){r[o]&&function(t,e){if(i)t.delete(e);else{var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}(r[o],e)}},t.StarmusHooks.dispatch=function(t,e,a){e=e||{};var s=(a=a||{}).instanceId||"*",h=t+"::"+s;if(o[h])n("Prevented recursive dispatch:",t);else{o[h]=!0;try{var l=r[h]||r[t+"::*"]||r[t];if(!l)return;!function(t,e){if(i)t.forEach(e);else for(var n=t.slice(),r=0;r<n.length;r++)e(n[r])}(l,function(n){try{n(e,a)}catch(e){console.error("Error executing handler for command "+t+":",e)}})}finally{delete o[h]}}},t.StarmusHooks.debugLog=n}("undefined"!=typeof window?window:globalThis);var pu="undefined"!=typeof window?window:globalThis,gu=pu.StarmusHooks&&pu.StarmusHooks.debugLog||function(){},mu=pu.StarmusHooks&&pu.StarmusHooks.dispatch||function(){},_u=pu.StarmusHooks&&pu.StarmusHooks.subscribe||function(){};"undefined"!=typeof module&&module.exports&&(module.exports={debugLog:gu,subscribe:pu.StarmusHooks.subscribe,dispatch:pu.StarmusHooks.dispatch});var vu,yu={subscribe:_u,dispatch:mu,unsubscribeInstance:function(t){}},bu={};function wu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Su(t,e,n,i,r,o,a){try{var s=t[o](a),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function xu(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function a(t){Su(o,i,r,a,s,"next",t)}function s(t){Su(o,i,r,a,s,"throw",t)}a(void 0)})}}function Cu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ku(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Lu(i.key),i)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tu(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Fu(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Au(t,e,n){return(e=Lu(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Iu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Eu(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Iu(Object(n),!0).forEach(function(e){Au(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Iu(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Pu(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var h=i&&i.prototype instanceof s?i:s,l=Object.create(h.prototype);return Mu(l,"_invoke",function(n,i,r){var o,s,h,l=0,u=r||[],c=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,s=0,h=t,d.n=n,a}};function f(n,i){for(s=n,h=i,e=0;!c&&l&&!r&&e<u.length;e++){var r,o=u[e],f=d.p,p=o[2];n>3?(r=p===i)&&(h=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(s=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,s=0))}if(r||n>1)return a;throw c=!0,i}return function(r,u,p){if(l>1)throw TypeError("Generator is already running");for(c&&1===u&&f(u,p),s=u,h=p;(e=s<2?t:h)||!c;){o||(s?s<3?(s>1&&(d.n=-1),f(s,h)):d.n=h:d.v=h);try{if(l=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,h)))throw TypeError("iterator result is not an object");if(!e.done)return e;h=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(h=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(c=d.n<0)?h:n.call(i,d))!==a)break}catch(e){o=t,s=1,h=e}finally{l=1}}return{value:e,done:c}}}(n,r,o),!0),l}var a={};function s(){}function h(){}function l(){}e=Object.getPrototypeOf;var u=[][i]?e(e([][i]())):(Mu(e={},i,function(){return this}),e),c=l.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Mu(t,r,"GeneratorFunction")),t.prototype=Object.create(c),t}return h.prototype=l,Mu(c,"constructor",l),Mu(l,"constructor",h),h.displayName="GeneratorFunction",Mu(l,r,"GeneratorFunction"),Mu(c),Mu(c,r,"Generator"),Mu(c,i,function(){return this}),Mu(c,"toString",function(){return"[object Generator]"}),(Pu=function(){return{w:o,m:d}})()}function Mu(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Mu=function(t,e,n,i){function o(e,n){Mu(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Mu(t,e,n,i)}function Du(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(typeof t+" is not iterable")}function Ou(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],h=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e);else for(;!(h=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);h=!0);}catch(t){l=!0,r=t}finally{try{if(!h&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||Fu(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lu(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Ru(t){return Ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ru(t)}function Fu(t,e){if(t){if("string"==typeof t)return wu(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wu(t,e):void 0}}!function(){if(vu)return bu;vu=1;var t=Ei(),e=ta().EXISTS,n=Sr(),i=Bl(),r=Function.prototype,o=n(r.toString),a=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,s=n(a.exec);t&&!e&&i(r,"name",{configurable:!0,get:function(){try{return s(a,o(this))[1]}catch(t){return""}}})}(),function(t){var e={instanceId:null,env:{},tier:null,status:"uninitialized",step:1,error:null,source:{kind:null,blob:null,file:null,fileName:"",transcript:"",interimTranscript:""},calibration:{phase:null,message:"",volumePercent:0,complete:!1,gain:1},recorder:{duration:0,amplitude:0,isPlaying:!1,isPaused:!1},submission:{progress:0,isQueued:!1}};function n(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t,e){var i=n(t);for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}function r(t){var r=i(e,t||{}),o=[];return{getState:function(){return r},dispatch:function(t){r=function(t,r){if(!r||!r.type)return t;switch(!t.instanceId&&r.payload&&r.payload.instanceId&&(t=i(t,{instanceId:r.payload.instanceId})),r.type){case"starmus/tier-ready":return t.tier?t:i(t,{tier:r.payload&&r.payload.tier?r.payload.tier:t.tier});case"starmus/init":return i(t,i(r.payload||{},{status:"idle",error:null}));case"starmus/ui/step-continue":return i(t,{step:2,status:"idle",error:null});case"starmus/calibration-start":return i(t,{status:"calibrating"});case"starmus/calibration-update":return i(t,{calibration:i(t.calibration,{message:r.message,volumePercent:r.volumePercent})});case"starmus/calibration-complete":return i(t,{status:"ready",calibration:i(t.calibration,i(r.calibration||{},{complete:!0}))});case"starmus/mic-start":return i(t,{status:"recording",error:null,recorder:i(t.recorder,{duration:0,amplitude:0,isPaused:!1})});case"starmus/mic-pause":return i(t,{status:"paused",recorder:i(t.recorder,{isPaused:!0})});case"starmus/mic-resume":return i(t,{status:"recording",recorder:i(t.recorder,{isPaused:!1})});case"starmus/mic-stop":return i(t,{status:"processing"});case"starmus/recorder-tick":return i(t,{recorder:i(t.recorder,{duration:r.duration,amplitude:r.amplitude})});case"starmus/recording-available":return i(t,{status:"ready_to_submit",source:i(t.source,{kind:"blob",blob:r.payload.blob,fileName:r.payload.fileName})});case"starmus/recorder-playback-state":return i(t,{recorder:i(t.recorder,{isPlaying:r.isPlaying})});case"starmus/transcript-update":return i(t,{source:i(t.source,{transcript:r.transcript})});case"starmus/transcript-interim":return i(t,{source:i(t.source,{interimTranscript:r.interim})});case"starmus/env-update":return i(t,{env:i(t.env,r.payload||{}),tier:r.tier||t.tier});case"starmus/file-attached":return i(t,{status:"ready_to_submit",source:{kind:"file",file:r.file,fileName:r.file.name}});case"starmus/submit-start":return i(t,{status:"submitting",error:null});case"starmus/submit-progress":return i(t,{submission:i(t.submission,{progress:r.progress})});case"starmus/submit-complete":return i(t,{status:"complete",submission:{progress:1,isQueued:!1}});case"starmus/submit-queued":return i(t,{status:"complete",submission:{progress:0,isQueued:!0}});case"starmus/error":return i(t,{error:r.error||r.payload});case"starmus/reset":return i(n(e),{instanceId:t.instanceId,env:t.env,tier:t.tier,status:"idle",source:{kind:null,blob:null,file:null,fileName:"",transcript:"",interimTranscript:""}});default:return t}}(r,t);for(var a=0;a<o.length;a++)try{o[a](r)}catch(t){console.error(t)}},subscribe:function(t){return-1===o.indexOf(t)&&o.push(t),function(){var e=o.indexOf(t);-1!==e&&o.splice(e,1)}}}}t.StarmusStore=t.StarmusStore||{},t.StarmusStore.createStore=r,"undefined"!=typeof module&&module.exports&&(module.exports={createStore:r}),"undefined"!=typeof exports&&(exports.createStore=r)}("undefined"!=typeof window?window:globalThis);var Wu,Bu={};!function(){if(Wu)return Bu;Wu=1;var t=Ja(),e=Ii(),n=dh(),i=Er(),r=_o(),o=Ia(),a=Mh(),s=mh(),h=Oh(),l=_h(),u=bo(),c=Or(),d=u("isConcatSpreadable"),f=c>=51||!e(function(){var t=[];return t[d]=!1,t.concat()[0]!==t}),p=function(t){if(!i(t))return!1;var e=t[d];return void 0!==e?!!e:n(t)};t({target:"Array",proto:!0,arity:1,forced:!f||!l("concat")},{concat:function(t){var e,n,i,l,u,c=r(this),d=h(c,0),f=0;for(e=-1,i=arguments.length;e<i;e++)if(p(u=-1===e?c:arguments[e]))for(l=o(u),a(f+l),n=0;n<l;n++,f++)n in u&&s(d,f,u[n]);else a(f+1),s(d,f++,u);return d.length=f,d}})}();var Gu,Hu={};!function(){if(Gu)return Hu;Gu=1;var t=Ja(),e=Ea().includes,n=Ii(),i=Gs();t({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")}();var Nu,zu,Xu,ju,Uu,Vu={};function Yu(){if(zu)return Nu;zu=1;var t=Sr();return Nu=t(1.1.valueOf)}function Zu(){if(ju)return Xu;ju=1;var t=ka(),e=Zl(),n=Tr(),i=RangeError;return Xu=function(r){var o=e(n(this)),a="",s=t(r);if(s<0||s===1/0)throw new i("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(o+=o))1&s&&(a+=o);return a}}!function(){if(Uu)return Vu;Uu=1;var t=Ja(),e=Sr(),n=ka(),i=Yu(),r=Zu(),o=Ii(),a=RangeError,s=String,h=Math.floor,l=e(r),u=e("".slice),c=e(1.1.toFixed),d=function(t,e,n){return 0===e?n:e%2==1?d(t,e-1,n*t):d(t*t,e/2,n)},f=function(t,e,n){for(var i=-1,r=n;++i<6;)r+=e*t[i],t[i]=r%1e7,r=h(r/1e7)},p=function(t,e){for(var n=6,i=0;--n>=0;)i+=t[n],t[n]=h(i/e),i=i%e*1e7},g=function(t){for(var e=6,n="";--e>=0;)if(""!==n||0===e||0!==t[e]){var i=s(t[e]);n=""===n?i:n+l("0",7-i.length)+i}return n};t({target:"Number",proto:!0,forced:o(function(){return"0.000"!==c(8e-5,3)||"1"!==c(.9,0)||"1.25"!==c(1.255,2)||"1000000000000000128"!==c(0xde0b6b3a7640080,0)})||!o(function(){c({})})},{toFixed:function(t){var e,r,o,h,c=i(this),m=n(t),_=[0,0,0,0,0,0],v="",y="0";if(m<0||m>20)throw new a("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return s(c);if(c<0&&(v="-",c=-c),c>1e-21)if(r=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(c*d(2,69,1))-69)<0?c*d(2,-e,1):c/d(2,e,1),r*=4503599627370496,(e=52-e)>0){for(f(_,0,r),o=m;o>=7;)f(_,1e7,0),o-=7;for(f(_,d(10,o,1),0),o=e-1;o>=23;)p(_,1<<23),o-=23;p(_,1<<o),f(_,1,1),p(_,2),y=g(_)}else f(_,0,r),f(_,1<<-e,0),y=g(_)+l("0",m);return y=m>0?v+((h=y.length)<=m?"0."+l("0",m-h)+y:u(y,0,h-m)+"."+u(y,h-m)):v+y}})}();var Ku,qu,Ju,Qu,$u,tc,ec,nc={};function ic(){if(Qu)return Ju;Qu=1;var t=function(){if(qu)return Ku;qu=1;var t=Er(),e=xr(),n=bo()("match");return Ku=function(i){var r;return t(i)&&(void 0!==(r=i[n])?!!r:"RegExp"===e(i))}}(),e=TypeError;return Ju=function(n){if(t(n))throw new e("The method doesn't accept regular expressions");return n}}!function(){if(ec)return nc;ec=1;var t=Ja(),e=Sr(),n=ic(),i=Tr(),r=Zl(),o=function(){if(tc)return $u;tc=1;var t=bo()("match");return $u=function(e){var n=/./;try{"/./"[e](n)}catch(i){try{return n[t]=!1,"/./"[e](n)}catch(t){}}return!1}}(),a=e("".indexOf);t({target:"String",proto:!0,forced:!o("includes")},{includes:function(t){return!!~a(r(i(this)),r(n(t)),arguments.length>1?arguments[1]:void 0)}})}();var rc,oc,ac,sc,hc,lc,uc,cc={};function dc(){return oc?rc:(oc=1,rc="\t\n\v\f\r \u2028\u2029\ufeff")}function fc(){if(sc)return ac;sc=1;var t=Sr(),e=Tr(),n=Zl(),i=dc(),r=t("".replace),o=RegExp("^["+i+"]+"),a=RegExp("(^|[^"+i+"])["+i+"]+$"),s=function(t){return function(i){var s=n(e(i));return 1&t&&(s=r(s,o,"")),2&t&&(s=r(s,a,"$1")),s}};return ac={start:s(1),end:s(2),trim:s(3)}}!function(){if(uc)return cc;uc=1;var t=Ja(),e=fc().trim,n=function(){if(lc)return hc;lc=1;var t=ta().PROPER,e=Ii(),n=dc();return hc=function(i){return e(function(){return!!n[i]()||""!==""[i]()||t&&n[i].name!==i})}}();t({target:"String",proto:!0,forced:n("trim")},{trim:function(){return e(this)}})}();var pc,gc={};!function(){if(pc)return gc;pc=1;var t=Ja(),e=Sr(),n=Cr(),i=Ar(),r=$a(),o=e([].join);t({target:"Array",proto:!0,forced:n!==Object||!r("join",",")},{join:function(t){return o(i(this),void 0===t?",":t)}})}();var mc,_c,vc,yc,bc,wc,Sc,xc={};function Cc(){if(_c)return mc;_c=1;var t=Br(),e=_o(),n=Cr(),i=Ia(),r=TypeError,o="Reduce of empty array with no initial value",a=function(a){return function(s,h,l,u){var c=e(s),d=n(c),f=i(c);if(t(h),0===f&&l<2)throw new r(o);var p=a?f-1:0,g=a?-1:1;if(l<2)for(;;){if(p in d){u=d[p],p+=g;break}if(p+=g,a?p<0:f<=p)throw new r(o)}for(;a?p>=0:f>p;p+=g)p in d&&(u=h(u,d[p],p,c));return u}};return mc={left:a(!1),right:a(!0)}}function kc(){if(yc)return vc;yc=1;var t=vi(),e=Dr(),n=xr(),i=function(t){return e.slice(0,t.length)===t};return vc=i("Bun/")?"BUN":i("Cloudflare-Workers")?"CLOUDFLARE":i("Deno/")?"DENO":i("Node.js/")?"NODE":t.Bun&&"string"==typeof Bun.version?"BUN":t.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(t.process)?"NODE":t.window&&t.document?"BROWSER":"REST"}function Tc(){if(wc)return bc;wc=1;var t=kc();return bc="NODE"===t}!function(){if(Sc)return xc;Sc=1;var t=Ja(),e=Cc().left,n=$a(),i=Or();t({target:"Array",proto:!0,forced:!Tc()&&i>79&&i<83||!n("reduce")},{reduce:function(t){var n=arguments.length;return e(this,t,n,n>1?arguments[1]:void 0)}})}();var Ac,Ic,Ec,Pc={};!function(){if(Ec)return Pc;Ec=1;var t=Ja(),e=function(){if(Ic)return Ac;Ic=1;var t=Ei(),e=Ii(),n=Sr(),i=Ns(),r=Fs(),o=Ar(),a=n(br().f),s=n([].push),h=t&&e(function(){var t=Object.create(null);return t[2]=2,!a(t,2)}),l=function(e){return function(n){for(var l,u=o(n),c=r(u),d=h&&null===i(u),f=c.length,p=0,g=[];f>p;)l=c[p++],t&&!(d?l in u:a(u,l))||s(g,e?[l,u[l]]:u[l]);return g}};return Ac={entries:l(!0),values:l(!1)}}().entries;t({target:"Object",stat:!0},{entries:function(t){return e(t)}})}();var Mc,Dc={};!function(){if(Mc)return Dc;Mc=1;var t=Ja(),e=_o(),n=Fs();t({target:"Object",stat:!0,forced:Ii()(function(){n(1)})},{keys:function(t){return n(e(t))}})}();var Oc,Lc,Rc,Fc,Wc,Bc,Gc,Hc,Nc,zc,Xc,jc,Uc,Vc,Yc,Zc,Kc,qc,Jc,Qc,$c,td,ed,nd,id,rd,od,ad,sd,hd,ld,ud,cd={};function dd(){if(Lc)return Oc;Lc=1;var t=vi();return Oc=t}function fd(){if(Fc)return Rc;Fc=1;var t=gh(),e=Wr(),n=TypeError;return Rc=function(i){if(t(i))return i;throw new n(e(i)+" is not a constructor")}}function pd(){if(Bc)return Wc;Bc=1;var t=Ro(),e=fd(),n=kr(),i=bo()("species");return Wc=function(r,o){var a,s=t(r).constructor;return void 0===s||n(a=t(s)[i])?o:e(a)}}function gd(){if(Hc)return Gc;Hc=1;var t=Pi(),e=Function.prototype,n=e.apply,i=e.call;return Gc="object"==typeof Reflect&&Reflect.apply||(t?i.bind(n):function(){return i.apply(n,arguments)}),Gc}function md(){if(zc)return Nc;zc=1;var t=TypeError;return Nc=function(e,n){if(e<n)throw new t("Not enough arguments");return e}}function _d(){if(jc)return Xc;jc=1;var t=Dr();return Xc=/(?:ipad|iphone|ipod).*applewebkit/i.test(t)}function vd(){if(Vc)return Uc;Vc=1;var t,e,n,i,r=vi(),o=gd(),a=Il(),s=Ir(),h=vo(),l=Ii(),u=Ws(),c=vh(),d=xo(),f=md(),p=_d(),g=Tc(),m=r.setImmediate,_=r.clearImmediate,v=r.process,y=r.Dispatch,b=r.Function,w=r.MessageChannel,S=r.String,x=0,C={},k="onreadystatechange";l(function(){t=r.location});var T=function(t){if(h(C,t)){var e=C[t];delete C[t],e()}},A=function(t){return function(){T(t)}},I=function(t){T(t.data)},E=function(e){r.postMessage(S(e),t.protocol+"//"+t.host)};return m&&_||(m=function(t){f(arguments.length,1);var n=s(t)?t:b(t),i=c(arguments,1);return C[++x]=function(){o(n,void 0,i)},e(x),x},_=function(t){delete C[t]},g?e=function(t){v.nextTick(A(t))}:y&&y.now?e=function(t){y.now(A(t))}:w&&!p?(i=(n=new w).port2,n.port1.onmessage=I,e=a(i.postMessage,i)):r.addEventListener&&s(r.postMessage)&&!r.importScripts&&t&&"file:"!==t.protocol&&!l(E)?(e=E,r.addEventListener("message",I,!1)):e=k in d("script")?function(t){u.appendChild(d("script"))[k]=function(){u.removeChild(this),T(t)}}:function(t){setTimeout(A(t),0)}),Uc={set:m,clear:_}}function yd(){if(Zc)return Yc;Zc=1;var t=vi(),e=Ei(),n=Object.getOwnPropertyDescriptor;return Yc=function(i){if(!e)return t[i];var r=n(t,i);return r&&r.value}}function bd(){if(qc)return Kc;qc=1;var t=function(){this.head=null,this.tail=null};return t.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},Kc=t}function wd(){if(nd)return ed;nd=1;var t,e,n,i,r,o=vi(),a=yd(),s=Il(),h=vd().set,l=bd(),u=_d(),c=function(){if(Qc)return Jc;Qc=1;var t=Dr();return Jc=/ipad|iphone|ipod/i.test(t)&&"undefined"!=typeof Pebble}(),d=function(){if(td)return $c;td=1;var t=Dr();return $c=/web0s(?!.*chrome)/i.test(t)}(),f=Tc(),p=o.MutationObserver||o.WebKitMutationObserver,g=o.document,m=o.process,_=o.Promise,v=a("queueMicrotask");if(!v){var y=new l,b=function(){var e,n;for(f&&(e=m.domain)&&e.exit();n=y.get();)try{n()}catch(e){throw y.head&&t(),e}e&&e.enter()};u||f||d||!p||!g?!c&&_&&_.resolve?((i=_.resolve(void 0)).constructor=_,r=s(i.then,i),t=function(){r(b)}):f?t=function(){m.nextTick(b)}:(h=s(h,o),t=function(){h(b)}):(e=!0,n=g.createTextNode(""),new p(b).observe(n,{characterData:!0}),t=function(){n.data=e=!e}),v=function(e){y.head||t(),y.add(e)}}return ed=v}function Sd(){return rd||(rd=1,id=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}}),id}function xd(){return ad?od:(ad=1,od=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}})}function Cd(){if(hd)return sd;hd=1;var t=vi();return sd=t.Promise}function kd(){if(ud)return ld;ud=1;var t=vi(),e=Cd(),n=Ir(),i=qa(),r=ea(),o=bo(),a=kc(),s=fo(),h=Or(),l=e&&e.prototype,u=o("species"),c=!1,d=n(t.PromiseRejectionEvent),f=i("Promise",function(){var t=r(e),n=t!==String(e);if(!n&&66===h)return!0;if(s&&(!l.catch||!l.finally))return!0;if(!h||h<51||!/native code/.test(t)){var i=new e(function(t){t(1)}),o=function(t){t(function(){},function(){})};if((i.constructor={})[u]=o,!(c=i.then(function(){})instanceof o))return!0}return!(n||"BROWSER"!==a&&"DENO"!==a||d)});return ld={CONSTRUCTOR:f,REJECTION_EVENT:d,SUBCLASSING:c}}var Td,Ad,Id={};function Ed(){if(Td)return Id;Td=1;var t=Br(),e=TypeError,n=function(n){var i,r;this.promise=new n(function(t,n){if(void 0!==i||void 0!==r)throw new e("Bad Promise constructor");i=t,r=n}),this.resolve=t(i),this.reject=t(r)};return Id.f=function(t){return new n(t)},Id}var Pd,Md,Dd,Od={};function Ld(){if(Md)return Pd;Md=1;var t=Cd(),e=Rl(),n=kd().CONSTRUCTOR;return Pd=n||!e(function(e){t.all(e).then(void 0,function(){})})}var Rd,Fd={};var Wd,Bd={};var Gd,Hd={};var Nd,zd,Xd,jd,Ud={};function Vd(){if(zd)return Nd;zd=1;var t=Ro(),e=Er(),n=Ed();return Nd=function(i,r){if(t(i),e(r)&&r.constructor===i)return r;var o=n.f(i);return(0,o.resolve)(r),o.promise}}jd||(jd=1,function(){if(Ad)return cd;Ad=1;var t,e,n,i,r=Ja(),o=fo(),a=Tc(),s=vi(),h=dd(),l=Mi(),u=aa(),c=Vs(),d=Xs(),f=Hl(),p=Br(),g=Ir(),m=Er(),_=Ll(),v=pd(),y=vd().set,b=wd(),w=Sd(),S=xd(),x=bd(),C=ra(),k=Cd(),T=kd(),A=Ed(),I="Promise",E=T.CONSTRUCTOR,P=T.REJECTION_EVENT,M=T.SUBCLASSING,D=C.getterFor(I),O=C.set,L=k&&k.prototype,R=k,F=L,W=s.TypeError,B=s.document,G=s.process,H=A.f,N=H,z=!!(B&&B.createEvent&&s.dispatchEvent),X="unhandledrejection",j=function(t){var e;return!(!m(t)||!g(e=t.then))&&e},U=function(t,e){var n,i,r,o=e.value,a=1===e.state,s=a?t.ok:t.fail,h=t.resolve,u=t.reject,c=t.domain;try{s?(a||(2===e.rejection&&q(e),e.rejection=1),!0===s?n=o:(c&&c.enter(),n=s(o),c&&(c.exit(),r=!0)),n===t.promise?u(new W("Promise-chain cycle")):(i=j(n))?l(i,n,h,u):h(n)):u(o)}catch(t){c&&!r&&c.exit(),u(t)}},V=function(t,e){t.notified||(t.notified=!0,b(function(){for(var n,i=t.reactions;n=i.get();)U(n,t);t.notified=!1,e&&!t.rejection&&Z(t)}))},Y=function(t,e,n){var i,r;z?((i=B.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),s.dispatchEvent(i)):i={promise:e,reason:n},!P&&(r=s["on"+t])?r(i):t===X&&w("Unhandled promise rejection",n)},Z=function(t){l(y,s,function(){var e,n=t.facade,i=t.value;if(K(t)&&(e=S(function(){a?G.emit("unhandledRejection",i,n):Y(X,n,i)}),t.rejection=a||K(t)?2:1,e.error))throw e.value})},K=function(t){return 1!==t.rejection&&!t.parent},q=function(t){l(y,s,function(){var e=t.facade;a?G.emit("rejectionHandled",e):Y("rejectionhandled",e,t.value)})},J=function(t,e,n){return function(i){t(e,i,n)}},Q=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,V(t,!0))},$=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new W("Promise can't be resolved itself");var i=j(e);i?b(function(){var n={done:!1};try{l(i,e,J($,n,t),J(Q,n,t))}catch(e){Q(n,e,t)}}):(t.value=e,t.state=1,V(t,!1))}catch(e){Q({done:!1},e,t)}}};if(E&&(F=(R=function(e){_(this,F),p(e),l(t,this);var n=D(this);try{e(J($,n),J(Q,n))}catch(t){Q(n,t)}}).prototype,(t=function(t){O(this,{type:I,done:!1,notified:!1,parent:!1,reactions:new x,rejection:!1,state:0,value:null})}).prototype=u(F,"then",function(t,e){var n=D(this),i=H(v(this,R));return n.parent=!0,i.ok=!g(t)||t,i.fail=g(e)&&e,i.domain=a?G.domain:void 0,0===n.state?n.reactions.add(i):b(function(){U(i,n)}),i.promise}),e=function(){var e=new t,n=D(e);this.promise=e,this.resolve=J($,n),this.reject=J(Q,n)},A.f=H=function(t){return t===R||t===n?new e(t):N(t)},!o&&g(k)&&L!==Object.prototype)){i=L.then,M||u(L,"then",function(t,e){var n=this;return new R(function(t,e){l(i,n,t,e)}).then(t,e)},{unsafe:!0});try{delete L.constructor}catch(t){}c&&c(L,F)}r({global:!0,constructor:!0,wrap:!0,forced:E},{Promise:R}),n=h.Promise,d(R,I,!1,!0),f(I)}(),function(){if(Dd)return Od;Dd=1;var t=Ja(),e=Mi(),n=Br(),i=Ed(),r=xd(),o=Ol();t({target:"Promise",stat:!0,forced:Ld()},{all:function(t){var a=this,s=i.f(a),h=s.resolve,l=s.reject,u=r(function(){var i=n(a.resolve),r=[],s=0,u=1;o(t,function(t){var n=s++,o=!1;u++,e(i,a,t).then(function(t){o||(o=!0,r[n]=t,--u||h(r))},l)}),--u||h(r)});return u.error&&l(u.value),s.promise}})}(),function(){if(Rd)return Fd;Rd=1;var t=Ja(),e=fo(),n=kd().CONSTRUCTOR,i=Cd(),r=Pr(),o=Ir(),a=aa(),s=i&&i.prototype;if(t({target:"Promise",proto:!0,forced:n,real:!0},{catch:function(t){return this.then(void 0,t)}}),!e&&o(i)){var h=r("Promise").prototype.catch;s.catch!==h&&a(s,"catch",h,{unsafe:!0})}}(),function(){if(Wd)return Bd;Wd=1;var t=Ja(),e=Mi(),n=Br(),i=Ed(),r=xd(),o=Ol();t({target:"Promise",stat:!0,forced:Ld()},{race:function(t){var a=this,s=i.f(a),h=s.reject,l=r(function(){var i=n(a.resolve);o(t,function(t){e(i,a,t).then(s.resolve,h)})});return l.error&&h(l.value),s.promise}})}(),function(){if(Gd)return Hd;Gd=1;var t=Ja(),e=Ed();t({target:"Promise",stat:!0,forced:kd().CONSTRUCTOR},{reject:function(t){var n=e.f(this);return(0,n.reject)(t),n.promise}})}(),function(){if(Xd)return Ud;Xd=1;var t=Ja(),e=Pr(),n=fo(),i=Cd(),r=kd().CONSTRUCTOR,o=Vd(),a=e("Promise"),s=n&&!r;t({target:"Promise",stat:!0,forced:n||r},{resolve:function(t){return o(s&&this===a?i:this,t)}})}());var Yd,Zd={};!function(){if(Yd)return Zd;Yd=1;var t=Ja(),e=fo(),n=Cd(),i=Ii(),r=Pr(),o=Ir(),a=pd(),s=Vd(),h=aa(),l=n&&n.prototype;if(t({target:"Promise",proto:!0,real:!0,forced:!!n&&i(function(){l.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=a(this,r("Promise")),n=o(t);return this.then(n?function(n){return s(e,t()).then(function(){return n})}:t,n?function(n){return s(e,t()).then(function(){throw n})}:t)}}),!e&&o(n)){var u=r("Promise").prototype.finally;l.finally!==u&&h(l,"finally",u,{unsafe:!0})}}();var Kd,qd,Jd,Qd,$d,tf,ef,nf,rf,of,af,sf={};function hf(){if(qd)return Kd;qd=1;var t=Ro();return Kd=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n}}function lf(){if(of)return rf;of=1;var t,e,n=Mi(),i=Sr(),r=Zl(),o=hf(),a=function(){if(Qd)return Jd;Qd=1;var t=Ii(),e=vi().RegExp,n=t(function(){var t=e("a","y");return t.lastIndex=2,null!==t.exec("abcd")}),i=n||t(function(){return!e("a","y").sticky}),r=n||t(function(){var t=e("^r","gy");return t.lastIndex=2,null!==t.exec("str")});return Jd={BROKEN_CARET:r,MISSED_STICKY:i,UNSUPPORTED_Y:n}}(),s=mo(),h=Bs(),l=ra().get,u=function(){if(tf)return $d;tf=1;var t=Ii(),e=vi().RegExp;return $d=t(function(){var t=e(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)})}(),c=function(){if(nf)return ef;nf=1;var t=Ii(),e=vi().RegExp;return ef=t(function(){var t=e("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})}(),d=s("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,p=f,g=i("".charAt),m=i("".indexOf),_=i("".replace),v=i("".slice),y=(e=/b*/g,n(f,t=/a/,"a"),n(f,e,"a"),0!==t.lastIndex||0!==e.lastIndex),b=a.BROKEN_CARET,w=void 0!==/()??/.exec("")[1];return(y||w||b||u||c)&&(p=function(t){var e,i,a,s,u,c,S,x=this,C=l(x),k=r(t),T=C.raw;if(T)return T.lastIndex=x.lastIndex,e=n(p,T,k),x.lastIndex=T.lastIndex,e;var A=C.groups,I=b&&x.sticky,E=n(o,x),P=x.source,M=0,D=k;if(I&&(E=_(E,"y",""),-1===m(E,"g")&&(E+="g"),D=v(k,x.lastIndex),x.lastIndex>0&&(!x.multiline||x.multiline&&"\n"!==g(k,x.lastIndex-1))&&(P="(?: "+P+")",D=" "+D,M++),i=new RegExp("^(?:"+P+")",E)),w&&(i=new RegExp("^"+P+"$(?!\\s)",E)),y&&(a=x.lastIndex),s=n(f,I?i:x,D),I?s?(s.input=v(s.input,M),s[0]=v(s[0],M),s.index=x.lastIndex,x.lastIndex+=s[0].length):x.lastIndex=0:y&&s&&(x.lastIndex=x.global?s.index+s[0].length:a),w&&s&&s.length>1&&n(d,s[0],i,function(){for(u=1;u<arguments.length-2;u++)void 0===arguments[u]&&(s[u]=void 0)}),s&&A)for(s.groups=c=h(null),u=0;u<A.length;u++)c[(S=A[u])[0]]=s[S[1]];return s}),rf=p}function uf(){if(af)return sf;af=1;var t=Ja(),e=lf();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),sf}uf();var cf,df,ff,pf,gf,mf,_f,vf,yf,bf,wf,Sf,xf,Cf={};function kf(){if(pf)return ff;pf=1;var t=Kl().charAt;return ff=function(e,n,i){return n+(i?t(e,n).length:1)}}function Tf(){if(mf)return gf;mf=1;var t=Sr(),e=_o(),n=Math.floor,i=t("".charAt),r=t("".replace),o=t("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,s=/\$([$&'`]|\d{1,2})/g;return gf=function(t,h,l,u,c,d){var f=l+t.length,p=u.length,g=s;return void 0!==c&&(c=e(c),g=a),r(d,g,function(e,r){var a;switch(i(r,0)){case"$":return"$";case"&":return t;case"`":return o(h,0,l);case"'":return o(h,f);case"<":a=c[o(r,1,-1)];break;default:var s=+r;if(0===s)return e;if(s>p){var d=n(s/10);return 0===d?e:d<=p?void 0===u[d-1]?i(r,1):u[d-1]+i(r,1):e}a=u[s-1]}return void 0===a?"":a})}}function Af(){if(bf)return yf;bf=1;var t=Mi(),e=vo(),n=Mr(),i=function(){if(vf)return _f;vf=1;var t=vi(),e=Ii(),n=t.RegExp,i=!e(function(){var t=!0;try{n(".","d")}catch(e){t=!1}var e={},i="",r=t?"dgimsy":"gimsy",o=function(t,n){Object.defineProperty(e,t,{get:function(){return i+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in t&&(a.hasIndices="d"),a)o(s,a[s]);return Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(e)!==r||i!==r});return _f={correct:i}}(),r=hf(),o=RegExp.prototype;return yf=i.correct?function(t){return t.flags}:function(a){return i.correct||!n(o,a)||e(a,"flags")?a.flags:t(r,a)}}!function(){if(xf)return Cf;xf=1;var t=gd(),e=Mi(),n=Sr(),i=function(){if(df)return cf;df=1,uf();var t=Mi(),e=aa(),n=lf(),i=Ii(),r=bo(),o=Wo(),a=r("species"),s=RegExp.prototype;return cf=function(h,l,u,c){var d=r(h),f=!i(function(){var t={};return t[d]=function(){return 7},7!==""[h](t)}),p=f&&!i(function(){var t=!1,e=/a/;if("split"===h){var n={};n[a]=function(){return e},(e={constructor:n,flags:""})[d]=/./[d]}return e.exec=function(){return t=!0,null},e[d](""),!t});if(!f||!p||u){var g=/./[d],m=l(d,""[h],function(e,i,r,o,a){var h=i.exec;return h===n||h===s.exec?f&&!a?{done:!0,value:t(g,i,r,o)}:{done:!0,value:t(e,r,i,o)}:{done:!1}});e(String.prototype,h,m[0]),e(s,d,m[1])}c&&o(s[d],"sham",!0)}}(),r=Ii(),o=Ro(),a=Ir(),s=Er(),h=ka(),l=Aa(),u=Zl(),c=Tr(),d=kf(),f=Gr(),p=Tf(),g=Af(),m=function(){if(Sf)return wf;Sf=1;var t=Mi(),e=Ro(),n=Ir(),i=xr(),r=lf(),o=TypeError;return wf=function(a,s){var h=a.exec;if(n(h)){var l=t(h,a,s);return null!==l&&e(l),l}if("RegExp"===i(a))return t(r,a,s);throw new o("RegExp#exec called on incompatible receiver")}}(),_=bo()("replace"),v=Math.max,y=Math.min,b=n([].concat),w=n([].push),S=n("".indexOf),x=n("".slice),C=function(t){return void 0===t?t:String(t)},k="$0"==="a".replace(/./,"$0"),T=!!/./[_]&&""===/./[_]("a","$0");i("replace",function(n,i,r){var k=T?"$":"$0";return[function(t,n){var r=c(this),o=s(t)?f(t,_):void 0;return o?e(o,t,r,n):e(i,u(r),t,n)},function(e,n){var s=o(this),c=u(e);if("string"==typeof n&&-1===S(n,k)&&-1===S(n,"$<")){var f=r(i,s,c,n);if(f.done)return f.value}var _=a(n);_||(n=u(n));var T,A=u(g(s)),I=-1!==S(A,"g");I&&(T=-1!==S(A,"u"),s.lastIndex=0);for(var E,P=[];null!==(E=m(s,c))&&(w(P,E),I);){""===u(E[0])&&(s.lastIndex=d(c,l(s.lastIndex),T))}for(var M="",D=0,O=0;O<P.length;O++){for(var L,R=u((E=P[O])[0]),F=v(y(h(E.index),c.length),0),W=[],B=1;B<E.length;B++)w(W,C(E[B]));var G=E.groups;if(_){var H=b([R],W,F,c);void 0!==G&&w(H,G),L=u(t(n,void 0,H))}else L=p(R,c,F,W,G,n);F>=D&&(M+=x(c,D,F)+L,D=F+R.length)}return M+x(c,D)}]},!!r(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})||!k||T)}();var If={chunkSize:1048576,retryDelays:[0,3e3,5e3,1e4,2e4,6e4],maxChunkRetries:3};function Ef(){return window.starmusTus||window.starmusConfig||{}}function Pf(t){var e=("string"==typeof t?t:String(t)).replace(/[\r\n\t]/g," ");return e.length>500?e.slice(0,497)+"...":e}function Mf(t){return t&&"object"===Ru(t)?t:{}}function Df(t,e){return Of.apply(this,arguments)}function Of(){return Of=xu(Pu().m(function t(e,n){var i,r,o,a,s,h,l,u=arguments;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(i=u.length>2&&void 0!==u[2]?u[2]:{},r=u.length>3&&void 0!==u[3]?u[3]:{},o=u.length>4&&void 0!==u[4]?u[4]:"",a=u.length>5?u[5]:void 0,window.tus&&window.tus.Upload){t.n=1;break}throw gu("[TUS] No tus library  failing over"),new Error("TUS_NOT_AVAILABLE");case 1:if(s=Ef(),h=s.endpoint||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.tusUpload){t.n=2;break}throw new Error("TUS_ENDPOINT_NOT_CONFIGURED");case 2:if(l=Eu({filename:Pf(n),filetype:e.type||"audio/webm"},Object.entries(Mf(i)).reduce(function(t,e){var n=Ou(e,2),i=n[0],r=n[1];return t[i]=Pf(r),t},{})),r)try{l.starmus_meta=Pf(JSON.stringify(r))}catch(t){gu("[TUS] Metadata sanitization failed",t)}return t.a(2,new Promise(function(t,n){var i,r={endpoint:h,chunkSize:s.chunkSize||If.chunkSize,retryDelays:s.retryDelays||If.retryDelays,metadata:l,fingerprint:function(t){return["starmus",o,t.size,t.lastModified||""].join("-")},onError:function(t){gu("[TUS] Upload error",t),n(t)},onProgress:function(t,e){"function"==typeof a&&a(t,e)},onSuccess:function(){return xu(Pu().m(function n(){var o,a,h;return Pu().w(function(n){for(;;)switch(n.p=n.n){case 0:if(gu("[TUS] Upload success",i.url),!s.removeFingerprintOnSuccess||null===(o=window.tus)||void 0===o||null===(o=o.defaultOptions)||void 0===o||!o.removeFingerprint){n.n=5;break}return n.p=1,n.n=2,window.tus.defaultOptions.fingerprint(e,r);case 2:return a=n.v,n.n=3,window.tus.defaultOptions.removeFingerprint(a);case 3:n.n=5;break;case 4:n.p=4,h=n.v,gu("[TUS] Failed to remove fingerprint",h);case 5:t(i.url);case 6:return n.a(2)}},n,null,[[1,4]])}))()}};(i=new window.tus.Upload(e,r)).findPreviousUploads().then(function(t){t&&t.length>0&&(gu("[TUS] Resuming from previous upload",t[0].uploadUrl),i.resumeFromPreviousUpload(t[0]))}).finally(function(){i.start()})}))}},t)})),Of.apply(this,arguments)}function Lf(t,e){return Rf.apply(this,arguments)}function Rf(){return Rf=xu(Pu().m(function t(e,n){var i,r,o,a,s,h,l,u,c,d,f,p,g,m,_,v,y,b,w=arguments;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(b=function(){return b=xu(Pu().m(function t(n,i,r,o,a,s,h,l,u,c){return Pu().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,a){var f=new FormData;f.append("audio_chunk",i,"".concat(r,".part").concat(n)),f.append("chunk_index",n),f.append("total_chunks",d),s?f.append("upload_id",s):f.append("create_upload_id","1"),Object.entries(h).forEach(function(t){var e=Ou(t,2),n=e[0],i=e[1];return f.append(n,i)}),o&&f.append("_starmus_meta",JSON.stringify(o));var p=new XMLHttpRequest;p.open("POST",l,!0),p.setRequestHeader("X-WP-Nonce",u),p.upload&&"function"==typeof c&&(p.upload.onprogress=function(t){t.lengthComputable&&c(start+t.loaded,e.size)}),p.onload=function(){if(p.status>=200&&p.status<300)try{var e=JSON.parse(p.responseText);!s&&e.upload_id&&(window.lastUploadId=e.upload_id),t(e)}catch(t){a(new Error("Invalid JSON chunk response"))}else a(new Error("Chunk ".concat(n," failed: ").concat(p.status)))},p.onerror=function(){return a(new Error("Network error during chunk upload"))},p.send(f)}))},t)})),b.apply(this,arguments)},y=function(t,e,n,i,r,o,a,s,h,l){return b.apply(this,arguments)},i=w.length>2&&void 0!==w[2]?w[2]:{},r=w.length>3&&void 0!==w[3]?w[3]:{},o=w.length>4&&void 0!==w[4]?w[4]:"",a=w.length>5?w[5]:void 0,s=Ef(),h=s.chunkedUpload||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.chunkedUpload,l=s.nonce||window.starmusConfig&&window.starmusConfig.nonce||"",h){t.n=1;break}throw new Error("CHUNKED_UPLOAD_ENDPOINT_NOT_CONFIGURED");case 1:if(l){t.n=2;break}throw new Error("CHUNKED_UPLOAD_NONCE_MISSING");case 2:u=Mf(i),c=s.chunkSize||If.chunkSize,d=Math.ceil(e.size/c),f="starmus_chunked_".concat(o,"_").concat(n,"_").concat(e.size),p=localStorage.getItem(f)||null,g=Pu().m(function t(){var i,d,g,_,v,b;return Pu().w(function(t){for(;;)switch(t.p=t.n){case 0:i=0,d=!1,g=m*c,_=Math.min(g+c,e.size),v=e.slice(g,_);case 1:if(d||!(i<(s.maxChunkRetries||If.maxChunkRetries))){t.n=7;break}return t.p=2,t.n=3,y(m,v,n,r,o,p,u,h,l,a);case 3:d=!0,t.n=6;break;case 4:if(t.p=4,b=t.v,!(++i>=(s.maxChunkRetries||If.maxChunkRetries))){t.n=5;break}throw b;case 5:return t.n=6,new Promise(function(t){return setTimeout(t,300*i*i)});case 6:t.n=1;break;case 7:!p&&0===m&&window.lastUploadId&&(p=window.lastUploadId,localStorage.setItem(f,p));case 8:return t.a(2)}},t,null,[[2,4]])}),m=0;case 3:if(!(m<d)){t.n=5;break}return t.d(Du(g()),4);case 4:m++,t.n=3;break;case 5:return(_=new FormData).append("upload_id",p),_.append("finalize","1"),(v=new XMLHttpRequest).open("POST",h,!0),v.setRequestHeader("X-WP-Nonce",l),t.a(2,new Promise(function(t,e){v.onload=function(){if(v.status>=200&&v.status<300)try{var n=JSON.parse(v.responseText);localStorage.removeItem(f),t(n)}catch(t){e(new Error("Invalid JSON on finalize"))}else e(new Error("Finalize failed: ".concat(v.status)))},v.onerror=function(){return e(new Error("Network error on finalize"))},v.send(_)}))}},t)})),Rf.apply(this,arguments)}function Ff(t,e){return Wf.apply(this,arguments)}function Wf(){return Wf=xu(Pu().m(function t(e,n){var i,r,o,a,s,h,l,u=arguments;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(i=u.length>2&&void 0!==u[2]?u[2]:{},r=u.length>3&&void 0!==u[3]?u[3]:{},o=u.length>5?u[5]:void 0,a=Ef(),s=a.directUpload||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.directUpload,h=a.nonce||window.starmusConfig&&window.starmusConfig.nonce||"",s){t.n=1;break}throw new Error("DIRECT_UPLOAD_ENDPOINT_NOT_CONFIGURED");case 1:return l=Mf(i),t.a(2,new Promise(function(t,i){var a=new FormData;Object.entries(l).forEach(function(t){var e=Ou(t,2),n=e[0],i=e[1];return a.append(n,i)}),a.append("audio_file",e,n),null!=r&&r.transcript&&a.append("_starmus_transcript",r.transcript),null!=r&&r.calibration&&a.append("_starmus_calibration",JSON.stringify(r.calibration)),null!=r&&r.env&&a.append("_starmus_env",JSON.stringify(r.env));var u=new XMLHttpRequest;u.open("POST",s,!0),h&&u.setRequestHeader("X-WP-Nonce",h),u.upload&&"function"==typeof o&&(u.upload.onprogress=function(t){t.lengthComputable&&o(t.loaded,t.total)}),u.onload=function(){if(u.status>=200&&u.status<300)try{t(JSON.parse(u.responseText))}catch(t){i(new Error("Invalid JSON response"))}else i(new Error("Upload failed: ".concat(u.status)))},u.onerror=function(){return i(new Error("Network error on direct upload"))},u.send(a)}))}},t)})),Wf.apply(this,arguments)}function Bf(t,e,n,i,r,o){return Gf.apply(this,arguments)}function Gf(){return(Gf=xu(Pu().m(function t(e,n,i,r,o,a){var s,h;return Pu().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Df(e,n,i,r,o,a);case 1:case 4:case 6:return t.a(2,t.v);case 2:return t.p=2,s=t.v,gu("[Uploader] TUS failed, trying fallback",s),t.p=3,t.n=4,Lf(e,n,i,r,o,a);case 5:return t.p=5,h=t.v,gu("[Uploader] Chunked REST failed, trying direct",h),t.n=6,Ff(e,n,i,r,o,a)}},t,null,[[3,5],[0,2]])}))).apply(this,arguments)}function Hf(t,e){var n=null==e?void 0:e.downlink;n&&0!==n||(n={"slow-2g":.05,"2g":.15,"3g":.75,"4g":8}[null==e?void 0:e.effectiveType]||.5);var i=1e6*(n=Math.min(n,10))/8;return Math.ceil(t/i*1.5)}function Nf(t){return isFinite(t)?t<60?"~".concat(t,"s"):"~".concat(Math.ceil(t/60)," min"):"Calculating..."}var zf={uploadWithTus:Df,uploadWithChunkedRest:Lf,uploadDirect:Ff,uploadWithPriority:Bf,isTusAvailable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var e=Ef();return!!(window.tus&&window.tus.Upload&&e.endpoint&&t>1048576)}catch(t){return!1}},estimateUploadTime:Hf,formatUploadEstimate:Nf};"undefined"!=typeof window&&(window.StarmusTus=zf);var Xf,jf={};!function(){if(Xf)return jf;Xf=1;var t=Ja(),e=cu().map;t({target:"Array",proto:!0,forced:!_h()("map")},{map:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}();var Uf,Vf={};!function(){if(Uf)return Vf;Uf=1;var t=ta().PROPER,e=aa(),n=Ro(),i=Zl(),r=Ii(),o=Af(),a="toString",s=RegExp.prototype,h=s[a],l=r(function(){return"/a/b"!==h.call({source:"a",flags:"b"})}),u=t&&h.name!==a;(l||u)&&e(s,a,function(){var t=n(this);return"/"+i(t.source)+"/"+i(o(t))},{unsafe:!0})}();var Yf={dbName:"StarmusSubmissions",storeName:"pendingSubmissions",dbVersion:1,maxRetries:10,retryDelays:[0,5e3,1e4,3e4,6e4,12e4,3e5,6e5,12e5,18e5],maxBlobSize:41943040},Zf=function(){return ku(function t(){Cu(this,t),this.db=null,this.isProcessing=!1},[{key:"init",value:(o=xu(Pu().m(function t(){var e=this;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(window.indexedDB){t.n=1;break}return console.error("[Offline] IndexedDB not supported. Offline uploads disabled."),t.a(2);case 1:return t.a(2,new Promise(function(t){var n=indexedDB.open(Yf.dbName,Yf.dbVersion);n.onerror=function(e){gu("[Offline] DB open failed:",e),t()},n.onblocked=function(){gu("[Offline] DB open blocked  other tab open")},n.onsuccess=function(n){e.db=n.target.result,e.db.onversionchange=function(){e.db.close(),gu("[Offline] DB version changed  closed connection")},gu("[Offline] DB ready"),t()},n.onupgradeneeded=function(t){var e=t.target.result;if(!e.objectStoreNames.contains(Yf.storeName)){var n=e.createObjectStore(Yf.storeName,{keyPath:"id"});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("retryCount","retryCount",{unique:!1}),gu("[Offline] Created object store:",Yf.storeName)}}}))}},t)})),function(){return o.apply(this,arguments)})},{key:"add",value:(r=xu(Pu().m(function t(e,n,i){var r,o,a,s,h,l=this,u=arguments;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(r=u.length>3&&void 0!==u[3]?u[3]:{},o=u.length>4&&void 0!==u[4]?u[4]:{},this.db){t.n=1;break}throw new Error("OfflineQueue: DB not initialized");case 1:if(!(n.size>Yf.maxBlobSize)){t.n=2;break}throw a="Audio too large (".concat((n.size/1024/1024).toFixed(2),"MB)  exceeds limit of ").concat(Yf.maxBlobSize/1024/1024,"MB"),gu("[Offline] "+a),new Error(a);case 2:return s=new Blob([n],{type:n.type}),h={id:"starmus-offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),instanceId:e,fileName:i,timestamp:Date.now(),audioBlob:s,formFields:r,metadata:o,retryCount:0,lastAttempt:null,error:null},t.a(2,new Promise(function(t,e){var n=l.db.transaction([Yf.storeName],"readwrite");n.objectStore(Yf.storeName).add(h),n.oncomplete=function(){gu("[Offline] Queued submission:",h.id),l._notifyQueueUpdate(),t(h.id)},n.onerror=function(t){var n=t.target.error;n&&"QuotaExceededError"===n.name?(gu("[Offline] IndexedDB quota exceeded  cannot save offline"),e(new Error("IndexedDB quota exceeded  cannot store offline"))):(gu("[Offline] Transaction error:",n),e(n))}}))}},t,this)})),function(t,e,n){return r.apply(this,arguments)})},{key:"getAll",value:(i=xu(Pu().m(function t(){var e=this;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2,[]);case 1:return t.a(2,new Promise(function(t,n){var i=e.db.transaction([Yf.storeName],"readonly").objectStore(Yf.storeName).getAll();i.onsuccess=function(){return t(i.result||[])},i.onerror=function(){return n(i.error)}}))}},t,this)})),function(){return i.apply(this,arguments)})},{key:"remove",value:(n=xu(Pu().m(function t(e){var n=this;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,i){var r=n.db.transaction([Yf.storeName],"readwrite");r.objectStore(Yf.storeName).delete(e),r.oncomplete=function(){gu("[Offline] Removed from queue:",e),n._notifyQueueUpdate(),t()},r.onerror=function(t){return i(t.target.error)}}))}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"_updateRetry",value:(e=xu(Pu().m(function t(e,n,i){var r=this;return Pu().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,o){var a=r.db.transaction([Yf.storeName],"readwrite"),s=a.objectStore(Yf.storeName),h=s.get(e);h.onsuccess=function(){var t=h.result;t&&(t.retryCount=n,t.lastAttempt=Date.now(),t.error=i||null,s.put(t))},h.onerror=function(t){return o(t.target.error)},a.oncomplete=function(){return t()}}))}},t,this)})),function(t,n,i){return e.apply(this,arguments)})},{key:"processQueue",value:(t=xu(Pu().m(function t(){var e,n,i,r,o,a,s,h,l,u,c,d,f,p,g,m,_;return Pu().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isProcessing&&navigator.onLine){t.n=1;break}return t.a(2);case 1:return this.isProcessing=!0,gu("[Offline] Processing queue..."),t.p=2,t.n=3,this.getAll();case 3:e=t.v,gu("[Offline] ".concat(e.length," submissions pending")),n=Tu(e),t.p=4,n.s();case 5:if((i=n.n()).done){t.n=14;break}if(r=i.value,o=r.id,a=r.audioBlob,s=r.fileName,h=r.formFields,l=r.metadata,u=r.retryCount,c=r.instanceId,!(u>=Yf.maxRetries)){t.n=6;break}return gu("[Offline] Max retries exceeded for",o),t.a(3,13);case 6:if(null===r.lastAttempt){t.n=7;break}if(d=Yf.retryDelays[Math.min(u,Yf.retryDelays.length-1)],!(Date.now()-r.lastAttempt<d)){t.n=7;break}return t.a(3,13);case 7:return t.p=7,gu("[Offline] Uploading queued item",o),t.n=8,Bf(a,s,h,l,c,null);case 8:return f=t.v,gu("[Offline] Upload succeeded for",o,f),t.n=9,this.remove(o);case 9:t.n=13;break;case 10:if(t.p=10,g=t.v,gu("[Offline] Upload failed for",o,g),p=g&&g.message?g.message:String(g),/400|Invalid JSON|QuotaExceeded/i.test(p)){t.n=12;break}return t.n=11,this._updateRetry(o,u+1,p);case 11:t.n=13;break;case 12:gu("[Offline] Nonretryable error, leaving in queue for manual review:",o);case 13:t.n=5;break;case 14:t.n=16;break;case 15:t.p=15,m=t.v,n.e(m);case 16:return t.p=16,n.f(),t.f(16);case 17:t.n=19;break;case 18:t.p=18,_=t.v,console.error("[Offline] Queue processing error:",_);case 19:return t.p=19,this.isProcessing=!1,t.f(19);case 20:return t.a(2)}},t,this,[[7,10],[4,15,16,17],[2,18,19,20]])})),function(){return t.apply(this,arguments)})},{key:"setupNetworkListeners",value:function(){var t=this;window.addEventListener("online",function(){gu("[Offline] Network online  processing queue"),t.processQueue()}),window.addEventListener("offline",function(){gu("[Offline] Network offline  queue paused")}),setInterval(function(){navigator.onLine&&t.processQueue().catch(function(t){return gu("[Offline] Retry error",t)})},6e4)}},{key:"_notifyQueueUpdate",value:function(){var t=window.CommandBus||window.StarmusHooks;t&&"function"==typeof t.dispatch&&this.getAll().then(function(e){t.dispatch("starmus/offline/queue_updated",{queue:e.map(function(t){return{id:t.id,fileName:t.fileName,retryCount:t.retryCount,error:t.error,timestamp:t.timestamp}})})}).catch(function(t){return gu("[Offline] Queue notification failed",t)})}}]);var t,e,n,i,r,o}(),Kf=new Zf;function qf(){return Jf.apply(this,arguments)}function Jf(){return(Jf=xu(Pu().m(function t(){return Pu().w(function(t){for(;;)switch(t.n){case 0:if(Kf.db){t.n=2;break}return t.n=1,Kf.init();case 1:Kf.setupNetworkListeners();case 2:return t.a(2,Kf)}},t)}))).apply(this,arguments)}function Qf(t,e,n,i,r){return $f.apply(this,arguments)}function $f(){return($f=xu(Pu().m(function t(e,n,i,r,o){var a;return Pu().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,qf();case 1:return a=t.v,t.a(2,a.add(e,n,i,r,o))}},t)}))).apply(this,arguments)}function tp(){return ep.apply(this,arguments)}function ep(){return(ep=xu(Pu().m(function t(){var e,n;return Pu().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,qf();case 1:return e=t.v,t.n=2,e.getAll();case 2:return n=t.v,t.a(2,n.length)}},t)}))).apply(this,arguments)}function np(){return qf()}"undefined"!=typeof window&&(window.initOffline=np);var ip=window.StarmusHooks||{},rp=ip.subscribe||function(){},op=ip.debugLog||function(){};function ap(t,e,n){op("[StarmusCore] initCore",e,n);try{window.dispatchEvent(new CustomEvent("starmus-ready",{detail:{instanceId:e}})),op("[StarmusCore] dispatched starmus-ready event")}catch(t){op("[StarmusCore] failed to dispatch starmus-ready",t)}function i(t){return r.apply(this,arguments)}function r(){return(r=xu(Pu().m(function i(r){var o,a,s,h,l,u,c,d,f,p,g,m,_,v,y,b,w;return Pu().w(function(i){for(;;)switch(i.p=i.n){case 0:if(a=t.getState(),s=a.source||{},h=a.calibration||{},l=a.env||n||{},u=s.blob||s.file,c=s.fileName||s.file&&s.file.name||"recording.webm",u){i.n=1;break}return t.dispatch({type:"starmus/error",error:{message:"Please record or attach audio before submitting.",retryable:!1},status:a.status}),i.a(2);case 1:if(d={transcript:(null===(o=s.transcript)||void 0===o?void 0:o.trim())||null,calibration:h.complete?{gain:h.gain,snr:h.snr,noiseFloor:h.noiseFloor,speechLevel:h.speechLevel,timestamp:h.timestamp||(new Date).toISOString()}:null,env:l},f=Hf(u.size,l.network),op("[StarmusCore] Upload size: ".concat((u.size/1024/1024).toFixed(2),"MB, estimated time: ").concat(Nf(f))),t.dispatch({type:"starmus/submit-start"}),p=function(e,n){t.dispatch({type:"starmus/submit-progress",progress:e/n})},i.p=2,navigator.onLine){i.n=3;break}throw new Error("OFFLINE_FAST_PATH");case 3:return i.n=4,Bf({blob:u,fileName:c,formFields:r,metadata:d,instanceId:e,onProgress:p});case 4:g=i.v,op("[StarmusCore] Upload succeeded via",g.method,g),t.dispatch({type:"starmus/submit-complete",payload:g});try{window.dispatchEvent(new CustomEvent("starmus-upload-finished",{detail:{instanceId:e,method:g.method}}))}catch(t){}i.n=12;break;case 5:if(i.p=5,b=i.v,op("[StarmusCore] Upload error",b),m=(null==b?void 0:b.message)||"",_=m.includes("not configured"),"OFFLINE_FAST_PATH"!==b.message&&_){i.n=11;break}return op("[StarmusCore] Saving submission to offline queue for retry"),i.p=6,i.n=7,Qf(e,u,c,r,d);case 7:return v=i.v,t.dispatch({type:"starmus/submit-queued",submissionId:v}),i.n=8,tp();case 8:y=i.v,op("[StarmusCore] Offline queue count: ".concat(y)),window.dispatchEvent(new CustomEvent("starmus-offline-queued",{detail:{instanceId:e,pending:y}})),i.n=10;break;case 9:i.p=9,w=i.v,console.error("[StarmusCore] Failed to save offline submission",w),t.dispatch({type:"starmus/error",error:{message:"Upload failed and could not be saved offline.",retryable:!1},status:"ready_to_submit"});case 10:i.n=12;break;case 11:t.dispatch({type:"starmus/error",error:{message:b.message||"Upload failed.",retryable:!1},status:"ready_to_submit"});case 12:return i.a(2)}},i,null,[[6,9],[2,5]])}))).apply(this,arguments)}return rp("submit",function(t,n){n&&n.instanceId===e&&i(t.formFields||{})},e),rp("reset",function(n,i){i&&i.instanceId===e&&t.dispatch({type:"starmus/reset"})},e),rp("continue",function(n,i){i&&i.instanceId===e&&t.dispatch({type:"starmus/ui/step-continue"})},e),{handleSubmit:i}}"undefined"!=typeof window&&(window.initCore=ap),"undefined"!=typeof module&&module.exports&&(module.exports={initCore:ap});var sp,hp,lp;function up(){if(hp)return sp;hp=1;var t=vi().isFinite;return sp=Number.isFinite||function(e){return"number"==typeof e&&t(e)}}lp||(lp=1,Ja()({target:"Number",stat:!0},{isFinite:up()}));var cp,dp={};!function(){if(cp)return dp;cp=1;var t=Ja(),e=Ol(),n=mh();t({target:"Object",stat:!0},{fromEntries:function(t){var i={};return e(t,function(t,e){n(i,t,e)},{AS_ENTRIES:!0}),i}})}();var fp,pp,gp,mp,_p,vp={};function yp(t,e,n){if(!t)return null;var i=t.cloneNode(!0);return i.style.pointerEvents="auto",t.parentNode&&t.parentNode.replaceChild(i,t),i.addEventListener(e,function(t){t.preventDefault(),t.stopPropagation(),console.log("[StarmusUI] Click detected on",i.dataset.starmusAction||"button"),n(t)}),i}function bp(t,e){if(e){var n=t.status,i=t.step,r=t.recorder,o=void 0===r?{}:r,a=t.calibration,s=void 0===a?{}:a;if(e.step1&&e.step2){var h=2===i||"idle"!==n&&"uninitialized"!==n&&"ready"!==n;e.step1.style.display=h?"none":"block",e.step2.style.display=h?"block":"none"}if("C"===t.tier||t.fallbackActive)return e.fallbackContainer&&(e.fallbackContainer.style.display="block"),void(e.recorderContainer&&(e.recorderContainer.style.display="none"));var l=function(t){if(!Number.isFinite(t))return"00m 00s";var e=Math.floor(t/60),n=Math.floor(t%60);return"".concat(e.toString().padStart(2,"0"),"m ").concat(n.toString().padStart(2,"0"),"s")}(o.duration||0);e.timerElapsed&&(e.timerElapsed.textContent=l),e.timer&&(e.timer.textContent=l,"recording"===n?e.timer.classList.add("starmus-timer--recording"):e.timer.classList.remove("starmus-timer--recording"));var u="recording"===n,c="paused"===n,d="ready"===n||"ready_to_record"===n||"idle"===n,f=s&&!0===s.complete;e.recordBtn&&(e.recordBtn.style.display=d&&f&&!u&&!c?"inline-flex":"none"),e.pauseBtn&&(e.pauseBtn.style.display=u?"inline-flex":"none"),e.resumeBtn&&(e.resumeBtn.style.display=c?"inline-flex":"none"),e.stopBtn&&(e.stopBtn.style.display=u||c?"inline-flex":"none",e.stopBtn.disabled="calibrating"===n),e.submitBtn&&("submitting"===n?(e.submitBtn.textContent="Uploading...",e.submitBtn.disabled=!0):(e.submitBtn.textContent="Submit Recording",e.submitBtn.disabled="ready_to_submit"!==n))}}function wp(t){var e,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)||(null==t||null===(e=t.getState())||void 0===e?void 0:e.instanceId),i=document;if(n)i=document.querySelector('[data-starmus-instance="'.concat(n,'"]'))||document;else{var r=document.querySelector("form[data-starmus-instance]");r&&(n=r.getAttribute("data-starmus-instance"),i=r)}console.log("[StarmusUI] Initializing for ID:",n);var o=window.CommandBus||window.StarmusHooks,a={step1:i.querySelector('[data-starmus-step="1"]'),step2:i.querySelector('[data-starmus-step="2"]'),timer:i.querySelector("[data-starmus-timer]"),timerElapsed:i.querySelector(".starmus-timer-elapsed"),fallbackContainer:i.querySelector("[data-starmus-fallback-container]"),recorderContainer:i.querySelector("[data-starmus-recorder-container]")},s=i.querySelector('[data-starmus-action="next"]');s&&yp(s,"click",function(){var e=a.step1?a.step1.querySelectorAll("[required]"):[],n=!0;e.forEach(function(t){t.value.trim()||t.checked?t.style.borderColor="":(n=!1,t.style.borderColor="red")}),n?t.dispatch({type:"starmus/ui/step-continue"}):alert("Please fill in all required fields.")});var h=i.querySelector('[data-starmus-action="setup-mic"]');h&&(a.setupMicBtn=yp(h,"click",function(){return null==o?void 0:o.dispatch("setup-mic",{},{instanceId:n})}));var l=i.querySelector('[data-starmus-action="record"]');l&&(a.recordBtn=yp(l,"click",function(){return null==o?void 0:o.dispatch("start-recording",{},{instanceId:n})}));var u=i.querySelector('[data-starmus-action="pause"]');u&&(a.pauseBtn=yp(u,"click",function(){return null==o?void 0:o.dispatch("pause-mic",{},{instanceId:n})}));var c=i.querySelector('[data-starmus-action="resume"]');c&&(a.resumeBtn=yp(c,"click",function(){return null==o?void 0:o.dispatch("resume-mic",{},{instanceId:n})}));var d=i.querySelector('[data-starmus-action="stop"]');d&&(a.stopBtn=yp(d,"click",function(){return null==o?void 0:o.dispatch("stop-mic",{},{instanceId:n})}));var f=i.querySelector('[data-starmus-action="submit"]');f&&(a.submitBtn=yp(f,"click",function(t){var e=t.target.closest("form"),i=e?Object.fromEntries(new FormData(e).entries()):{};null==o||o.dispatch("submit",{formFields:i},{instanceId:n})})),t.dispatch({type:"starmus/init",payload:{instanceId:n}});var p=t.subscribe(function(t){return bp(t,a)});return bp(t.getState(),a),p}!function(){if(_p)return vp;_p=1;var t=Ja(),e=function(){if(pp)return fp;pp=1;var t=Sr(),e=Aa(),n=Zl(),i=Zu(),r=Tr(),o=t(i),a=t("".slice),s=Math.ceil,h=function(t){return function(i,h,l){var u,c,d=n(r(i)),f=e(h),p=d.length,g=void 0===l?" ":n(l);return f<=p||""===g?d:((c=o(g,s((u=f-p)/g.length))).length>u&&(c=a(c,0,u)),t?d+c:c+d)}};return fp={start:h(!1),end:h(!0)}}().start;t({target:"String",proto:!0,forced:function(){if(mp)return gp;mp=1;var t=Dr();return gp=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)}()},{padStart:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}(),"undefined"!=typeof window&&(window.initUI=wp);var Sp,xp,Cp,kp,Tp,Ap,Ip,Ep,Pp,Mp,Dp,Op,Lp,Rp,Fp,Wp,Bp,Gp,Hp,Np={};function zp(){return xp?Sp:(xp=1,Sp="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView)}function Xp(){if(kp)return Cp;kp=1;var t=ka(),e=Aa(),n=RangeError;return Cp=function(i){if(void 0===i)return 0;var r=t(i),o=e(r);if(r!==o)throw new n("Wrong length or index");return o}}function jp(){if(Mp)return Pp;Mp=1;var t=Ap?Tp:(Ap=1,Tp=Math.sign||function(t){var e=+t;return 0===e||e!=e?e:e<0?-1:1}),e=function(){if(Ep)return Ip;Ep=1;var t=4503599627370496;return Ip=function(e){return e+t-t}}(),n=Math.abs;return Pp=function(i,r,o,a){var s=+i,h=n(s),l=t(s);if(h<a)return l*e(h/a/r)*a*r;var u=(1+r/2220446049250313e-31)*h,c=u-(u-h);return c>o||c!=c?l*(1/0):l*c}}function Up(){if(Rp)return Lp;Rp=1;var t=Array,e=Math.abs,n=Math.pow,i=Math.floor,r=Math.log,o=Math.LN2;return Lp={pack:function(a,s,h){var l,u,c,d=t(h),f=8*h-s-1,p=(1<<f)-1,g=p>>1,m=23===s?n(2,-24)-n(2,-77):0,_=a<0||0===a&&1/a<0?1:0,v=0;for((a=e(a))!=a||a===1/0?(u=a!=a?1:0,l=p):(l=i(r(a)/o),a*(c=n(2,-l))<1&&(l--,c*=2),(a+=l+g>=1?m/c:m*n(2,1-g))*c>=2&&(l++,c/=2),l+g>=p?(u=0,l=p):l+g>=1?(u=(a*c-1)*n(2,s),l+=g):(u=a*n(2,g-1)*n(2,s),l=0));s>=8;)d[v++]=255&u,u/=256,s-=8;for(l=l<<s|u,f+=s;f>0;)d[v++]=255&l,l/=256,f-=8;return d[v-1]|=128*_,d},unpack:function(t,e){var i,r=t.length,o=8*r-e-1,a=(1<<o)-1,s=a>>1,h=o-7,l=r-1,u=t[l--],c=127&u;for(u>>=7;h>0;)c=256*c+t[l--],h-=8;for(i=c&(1<<-h)-1,c>>=-h,h+=e;h>0;)i=256*i+t[l--],h-=8;if(0===c)c=1-s;else{if(c===a)return i?NaN:u?-1/0:1/0;i+=n(2,e),c-=s}return(u?-1:1)*i*n(2,c-e)}}}function Vp(){if(Wp)return Fp;Wp=1;var t=_o(),e=Ta(),n=Ia();return Fp=function(i){for(var r=t(this),o=n(r),a=arguments.length,s=e(a>1?arguments[1]:void 0,o),h=a>2?arguments[2]:void 0,l=void 0===h?o:e(h,o);l>s;)r[s++]=i;return r},Fp}function Yp(){if(Gp)return Bp;Gp=1;var t=vi(),e=Sr(),n=Ei(),i=zp(),r=ta(),o=Wo(),a=Bl(),s=Gl(),h=Ii(),l=Ll(),u=ka(),c=Aa(),d=Xp(),f=function(){if(Op)return Dp;Op=1;var t=jp();return Dp=Math.fround||function(e){return t(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}}(),p=Up(),g=Ns(),m=Vs(),_=Vp(),v=vh(),y=Fl(),b=Ka(),w=Xs(),S=ra(),x=r.PROPER,C=r.CONFIGURABLE,k="ArrayBuffer",T="DataView",A="prototype",I="Wrong index",E=S.getterFor(k),P=S.getterFor(T),M=S.set,D=t[k],O=D,L=O&&O[A],R=t[T],F=R&&R[A],W=Object.prototype,B=t.Array,G=t.RangeError,H=e(_),N=e([].reverse),z=p.pack,X=p.unpack,j=function(t){return[255&t]},U=function(t){return[255&t,t>>8&255]},V=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Y=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Z=function(t){return z(f(t),23,4)},K=function(t){return z(t,52,8)},q=function(t,e,n){a(t[A],e,{configurable:!0,get:function(){return n(this)[e]}})},J=function(t,e,n,i){var r=P(t),o=d(n),a=!!i;if(o+e>r.byteLength)throw new G(I);var s=r.bytes,h=o+r.byteOffset,l=v(s,h,h+e);return a?l:N(l)},Q=function(t,e,n,i,r,o){var a=P(t),s=d(n),h=i(+r),l=!!o;if(s+e>a.byteLength)throw new G(I);for(var u=a.bytes,c=s+a.byteOffset,f=0;f<e;f++)u[c+f]=h[l?f:e-f-1]};if(i){var $=x&&D.name!==k;h(function(){D(1)})&&h(function(){new D(-1)})&&!h(function(){return new D,new D(1.5),new D(NaN),1!==D.length||$&&!C})?$&&C&&o(D,"name",k):((O=function(t){return l(this,L),y(new D(d(t)),this,O)})[A]=L,L.constructor=O,b(O,D)),m&&g(F)!==W&&m(F,W);var tt=new R(new O(2)),et=e(F.setInt8);tt.setInt8(0,2147483648),tt.setInt8(1,2147483649),!tt.getInt8(0)&&tt.getInt8(1)||s(F,{setInt8:function(t,e){et(this,t,e<<24>>24)},setUint8:function(t,e){et(this,t,e<<24>>24)}},{unsafe:!0})}else L=(O=function(t){l(this,L);var e=d(t);M(this,{type:k,bytes:H(B(e),0),byteLength:e}),n||(this.byteLength=e,this.detached=!1)})[A],F=(R=function(t,e,i){l(this,F),l(t,L);var r=E(t),o=r.byteLength,a=u(e);if(a<0||a>o)throw new G("Wrong offset");if(a+(i=void 0===i?o-a:c(i))>o)throw new G("Wrong length");M(this,{type:T,buffer:t,byteLength:i,byteOffset:a,bytes:r.bytes}),n||(this.buffer=t,this.byteLength=i,this.byteOffset=a)})[A],n&&(q(O,"byteLength",E),q(R,"buffer",P),q(R,"byteLength",P),q(R,"byteOffset",P)),s(F,{getInt8:function(t){return J(this,1,t)[0]<<24>>24},getUint8:function(t){return J(this,1,t)[0]},getInt16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))},getUint32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(t){return X(J(this,4,t,arguments.length>1&&arguments[1]),23)},getFloat64:function(t){return X(J(this,8,t,arguments.length>1&&arguments[1]),52)},setInt8:function(t,e){Q(this,1,t,j,e)},setUint8:function(t,e){Q(this,1,t,j,e)},setInt16:function(t,e){Q(this,2,t,U,e,arguments.length>2&&arguments[2])},setUint16:function(t,e){Q(this,2,t,U,e,arguments.length>2&&arguments[2])},setInt32:function(t,e){Q(this,4,t,V,e,arguments.length>2&&arguments[2])},setUint32:function(t,e){Q(this,4,t,V,e,arguments.length>2&&arguments[2])},setFloat32:function(t,e){Q(this,4,t,Z,e,arguments.length>2&&arguments[2])},setFloat64:function(t,e){Q(this,8,t,K,e,arguments.length>2&&arguments[2])}});return w(O,k),w(R,T),Bp={ArrayBuffer:O,DataView:R}}!function(){if(Hp)return Np;Hp=1;var t=Ja(),e=vi(),n=Yp(),i=Hl(),r="ArrayBuffer",o=n[r];t({global:!0,constructor:!0,forced:e[r]!==o},{ArrayBuffer:o}),i(r)}();var Zp,Kp={};!function(){if(Zp)return Kp;Zp=1;var t=Ja(),e=Qa(),n=Ii(),i=Yp(),r=Ro(),o=Ta(),a=Aa(),s=i.ArrayBuffer,h=i.DataView,l=h.prototype,u=e(s.prototype.slice),c=e(l.getUint8),d=e(l.setUint8);t({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:n(function(){return!new s(2).slice(1,void 0).byteLength})},{slice:function(t,e){if(u&&void 0===e)return u(r(this),t);for(var n=r(this).byteLength,i=o(t,n),l=o(void 0===e?n:e,n),f=new s(a(l-i)),p=new h(this),g=new h(f),m=0;i<l;)d(g,m++,c(p,i++));return f}})}();var qp,Jp;Jp||(Jp=1,qp||(qp=1,Wl()("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Nl())));var Qp,$p,tg,eg={};!function(){if(tg)return eg;tg=1;var t=Ja(),e=function(){if($p)return Qp;$p=1;var t=vi(),e=Ii(),n=Sr(),i=Zl(),r=fc().trim,o=dc(),a=n("".charAt),s=t.parseFloat,h=t.Symbol,l=h&&h.iterator,u=1/s(o+"-0")!=-1/0||l&&!e(function(){s(Object(l))});return Qp=u?function(t){var e=r(i(t)),n=s(e);return 0===n&&"-"===a(e,0)?-0:n}:s}();t({global:!0,forced:parseFloat!==e},{parseFloat:e})}();var ng,ig,rg,og,ag,sg,hg,lg,ug,cg,dg,fg,pg,gg,mg,_g,vg,yg,bg,wg,Sg,xg,Cg={exports:{}};function kg(){if(ig)return ng;ig=1;var t,e,n,i=zp(),r=Ei(),o=vi(),a=Ir(),s=Er(),h=vo(),l=ph(),u=Wr(),c=Wo(),d=aa(),f=Bl(),p=Mr(),g=Ns(),m=Vs(),_=bo(),v=yo(),y=ra(),b=y.enforce,w=y.get,S=o.Int8Array,x=S&&S.prototype,C=o.Uint8ClampedArray,k=C&&C.prototype,T=S&&g(S),A=x&&g(x),I=Object.prototype,E=o.TypeError,P=_("toStringTag"),M=v("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",O=i&&!!m&&"Opera"!==l(o.opera),L=!1,R={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},W=function(t){var e=g(t);if(s(e)){var n=w(e);return n&&h(n,D)?n[D]:W(e)}},B=function(t){if(!s(t))return!1;var e=l(t);return h(R,e)||h(F,e)};for(t in R)(n=(e=o[t])&&e.prototype)?b(n)[D]=e:O=!1;for(t in F)(n=(e=o[t])&&e.prototype)&&(b(n)[D]=e);if((!O||!a(T)||T===Function.prototype)&&(T=function(){throw new E("Incorrect invocation")},O))for(t in R)o[t]&&m(o[t],T);if((!O||!A||A===I)&&(A=T.prototype,O))for(t in R)o[t]&&m(o[t].prototype,A);if(O&&g(k)!==A&&m(k,A),r&&!h(A,P))for(t in L=!0,f(A,P,{configurable:!0,get:function(){return s(this)?this[M]:void 0}}),R)o[t]&&c(o[t],M,t);return ng={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:L&&M,aTypedArray:function(t){if(B(t))return t;throw new E("Target is not a typed array")},aTypedArrayConstructor:function(t){if(a(t)&&(!m||p(T,t)))return t;throw new E(u(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n,i){if(r){if(n)for(var a in R){var s=o[a];if(s&&h(s.prototype,t))try{delete s.prototype[t]}catch(n){try{s.prototype[t]=e}catch(t){}}}A[t]&&!n||d(A,t,n?e:O&&x[t]||e,i)}},exportTypedArrayStaticMethod:function(t,e,n){var i,a;if(r){if(m){if(n)for(i in R)if((a=o[i])&&h(a,t))try{delete a[t]}catch(t){}if(T[t]&&!n)return;try{return d(T,t,n?e:O&&T[t]||e)}catch(t){}}for(i in R)!(a=o[i])||a[t]&&!n||d(a,t,e)}},getTypedArrayConstructor:W,isView:function(t){if(!s(t))return!1;var e=l(t);return"DataView"===e||h(R,e)||h(F,e)},isTypedArray:B,TypedArray:T,TypedArrayPrototype:A}}function Tg(){if(sg)return ag;sg=1;var t=Er(),e=Math.floor;return ag=Number.isInteger||function(n){return!t(n)&&isFinite(n)&&e(n)===n}}function Ag(){if(lg)return hg;lg=1;var t=ka(),e=RangeError;return hg=function(n){var i=t(n);if(i<0)throw new e("The argument can't be less than 0");return i}}function Ig(){if(cg)return ug;cg=1;var t=Ag(),e=RangeError;return ug=function(n,i){var r=t(n);if(r%i)throw new e("Wrong offset");return r}}function Eg(){if(fg)return dg;fg=1;var t=Math.round;return dg=function(e){var n=t(e);return n<0?0:n>255?255:255&n}}function Pg(){if(gg)return pg;gg=1;var t=ph();return pg=function(e){var n=t(e);return"BigInt64Array"===n||"BigUint64Array"===n}}function Mg(){if(_g)return mg;_g=1;var t=wo(),e=TypeError;return mg=function(n){var i=t(n,"number");if("number"==typeof i)throw new e("Can't convert number to bigint");return BigInt(i)}}function Dg(){if(yg)return vg;yg=1;var t=Il(),e=Mi(),n=fd(),i=_o(),r=Ia(),o=Ml(),a=Pl(),s=El(),h=Pg(),l=kg().aTypedArrayConstructor,u=Mg();return vg=function(c){var d,f,p,g,m,_,v,y,b=n(this),w=i(c),S=arguments.length,x=S>1?arguments[1]:void 0,C=void 0!==x,k=a(w);if(k&&!s(k))for(y=(v=o(w,k)).next,w=[];!(_=e(y,v)).done;)w.push(_.value);for(C&&S>2&&(x=t(x,arguments[2])),f=r(w),p=new(l(b))(f),g=h(p),d=0;f>d;d++)m=C?x(w[d],d):w[d],p[d]=g?u(m):+m;return p},vg}function Og(){if(wg)return bg;wg=1;var t=Ia();return bg=function(e,n,i){for(var r=0,o=arguments.length>2?i:t(n),a=new e(o);o>r;)a[r]=n[r++];return a},bg}function Lg(){if(Sg)return Cg.exports;Sg=1;var t=Ja(),e=vi(),n=Mi(),i=Ei(),r=function(){if(og)return rg;og=1;var t=vi(),e=Ii(),n=Rl(),i=kg().NATIVE_ARRAY_BUFFER_VIEWS,r=t.ArrayBuffer,o=t.Int8Array;return rg=!i||!e(function(){o(1)})||!e(function(){new o(-1)})||!n(function(t){new o,new o(null),new o(1.5),new o(t)},!0)||e(function(){return 1!==new o(new r(2),1,void 0).length})}(),o=kg(),a=Yp(),s=Ll(),h=wr(),l=Wo(),u=Tg(),c=Aa(),d=Xp(),f=Ig(),p=Eg(),g=So(),m=vo(),_=ph(),v=Er(),y=Fr(),b=Bs(),w=Mr(),S=Vs(),x=Da().f,C=Dg(),k=cu().forEach,T=Hl(),A=Bl(),I=Fo(),E=ko(),P=Og(),M=ra(),D=Fl(),O=M.get,L=M.set,R=M.enforce,F=I.f,W=E.f,B=e.RangeError,G=a.ArrayBuffer,H=G.prototype,N=a.DataView,z=o.NATIVE_ARRAY_BUFFER_VIEWS,X=o.TYPED_ARRAY_TAG,j=o.TypedArray,U=o.TypedArrayPrototype,V=o.isTypedArray,Y="BYTES_PER_ELEMENT",Z="Wrong length",K=function(t,e){A(t,e,{configurable:!0,get:function(){return O(this)[e]}})},q=function(t){var e;return w(H,t)||"ArrayBuffer"===(e=_(t))||"SharedArrayBuffer"===e},J=function(t,e){return V(t)&&!y(e)&&e in t&&u(+e)&&e>=0},Q=function(t,e){return e=g(e),J(t,e)?h(2,t[e]):W(t,e)},$=function(t,e,n){return e=g(e),!(J(t,e)&&v(n)&&m(n,"value"))||m(n,"get")||m(n,"set")||n.configurable||m(n,"writable")&&!n.writable||m(n,"enumerable")&&!n.enumerable?F(t,e,n):(t[e]=n.value,t)};return i?(z||(E.f=Q,I.f=$,K(U,"buffer"),K(U,"byteOffset"),K(U,"byteLength"),K(U,"length")),t({target:"Object",stat:!0,forced:!z},{getOwnPropertyDescriptor:Q,defineProperty:$}),Cg.exports=function(i,o,a){var h=i.match(/\d+/)[0]/8,u=i+(a?"Clamped":"")+"Array",g="get"+i,m="set"+i,_=e[u],y=_,w=y&&y.prototype,A={},I=function(t,e){F(t,e,{get:function(){return function(t,e){var n=O(t);return n.view[g](e*h+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,n){var i=O(t);i.view[m](e*h+i.byteOffset,a?p(n):n,!0)}(this,e,t)},enumerable:!0})};z?r&&(y=o(function(t,e,i,r){return s(t,w),D(v(e)?q(e)?void 0!==r?new _(e,f(i,h),r):void 0!==i?new _(e,f(i,h)):new _(e):V(e)?P(y,e):n(C,y,e):new _(d(e)),t,y)}),S&&S(y,j),k(x(_),function(t){t in y||l(y,t,_[t])}),y.prototype=w):(y=o(function(t,e,i,r){s(t,w);var o,a,l,u=0,p=0;if(v(e)){if(!q(e))return V(e)?P(y,e):n(C,y,e);o=e,p=f(i,h);var g=e.byteLength;if(void 0===r){if(g%h)throw new B(Z);if((a=g-p)<0)throw new B(Z)}else if((a=c(r)*h)+p>g)throw new B(Z);l=a/h}else l=d(e),o=new G(a=l*h);for(L(t,{buffer:o,byteOffset:p,byteLength:a,length:l,view:new N(o)});u<l;)I(t,u++)}),S&&S(y,j),w=y.prototype=b(U)),w.constructor!==y&&l(w,"constructor",y),R(w).TypedArrayConstructor=y,X&&l(w,X,u);var E=y!==_;A[u]=y,t({global:!0,constructor:!0,forced:E,sham:!z},A),Y in y||l(y,Y,h),Y in w||l(w,Y,h),T(u)}):Cg.exports=function(){},Cg.exports}xg||(xg=1,Lg()("Float32",function(t){return function(e,n,i){return t(this,e,n,i)}}));var Rg,Fg,Wg,Bg={};!function(){if(Wg)return Bg;Wg=1;var t=Sr(),e=kg(),n=function(){if(Fg)return Rg;Fg=1;var t=_o(),e=Ta(),n=Ia(),i=Lh(),r=Math.min;return Rg=[].copyWithin||function(o,a){var s=t(this),h=n(s),l=e(o,h),u=e(a,h),c=arguments.length>2?arguments[2]:void 0,d=r((void 0===c?h:e(c,h))-u,h-l),f=1;for(u<l&&l<u+d&&(f=-1,u+=d-1,l+=d-1);d-- >0;)u in s?s[l]=s[u]:i(s,l),l+=f,u+=f;return s},Rg}(),i=t(n),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("copyWithin",function(t,e){return i(r(this),t,e,arguments.length>2?arguments[2]:void 0)})}();var Gg,Hg={};!function(){if(Gg)return Hg;Gg=1;var t=kg(),e=cu().every,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("every",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Ng,zg={};!function(){if(Ng)return zg;Ng=1;var t=kg(),e=Vp(),n=Mg(),i=ph(),r=Mi(),o=Sr(),a=Ii(),s=t.aTypedArray,h=t.exportTypedArrayMethod,l=o("".slice);h("fill",function(t){var o=arguments.length;s(this);var a="Big"===l(i(this),0,3)?n(t):+t;return r(e,this,a,o>1?arguments[1]:void 0,o>2?arguments[2]:void 0)},a(function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t}))}();var Xg,jg,Ug,Vg={};!function(){if(Ug)return Vg;Ug=1;var t=kg(),e=cu().filter,n=function(){if(jg)return Xg;jg=1;var t=Og(),e=kg().getTypedArrayConstructor;return Xg=function(n,i){return t(e(n),i)}}(),i=t.aTypedArray;(0,t.exportTypedArrayMethod)("filter",function(t){var r=e(i(this),t,arguments.length>1?arguments[1]:void 0);return n(this,r)})}();var Yg,Zg={};!function(){if(Yg)return Zg;Yg=1;var t=kg(),e=cu().find,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("find",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Kg,qg={};!function(){if(Kg)return qg;Kg=1;var t=kg(),e=cu().findIndex,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("findIndex",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Jg,Qg={};!function(){if(Jg)return Qg;Jg=1;var t=kg(),e=cu().forEach,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("forEach",function(t){e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var $g,tm={};!function(){if($g)return tm;$g=1;var t=kg(),e=Ea().includes,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("includes",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var em,nm={};!function(){if(em)return nm;em=1;var t=kg(),e=Ea().indexOf,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("indexOf",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var im,rm={};!function(){if(im)return rm;im=1;var t=vi(),e=Ii(),n=Sr(),i=kg(),r=Ks(),o=bo()("iterator"),a=t.Uint8Array,s=n(r.values),h=n(r.keys),l=n(r.entries),u=i.aTypedArray,c=i.exportTypedArrayMethod,d=a&&a.prototype,f=!e(function(){d[o].call([1])}),p=!!d&&d.values&&d[o]===d.values&&"values"===d.values.name,g=function(){return s(u(this))};c("entries",function(){return l(u(this))},f),c("keys",function(){return h(u(this))},f),c("values",g,f||!p,{name:"values"}),c(o,g,f||!p,{name:"values"})}();var om,am={};!function(){if(om)return am;om=1;var t=kg(),e=Sr(),n=t.aTypedArray,i=t.exportTypedArrayMethod,r=e([].join);i("join",function(t){return r(n(this),t)})}();var sm,hm,lm,um={};!function(){if(lm)return um;lm=1;var t=kg(),e=gd(),n=function(){if(hm)return sm;hm=1;var t=gd(),e=Ar(),n=ka(),i=Ia(),r=$a(),o=Math.min,a=[].lastIndexOf,s=!!a&&1/[1].lastIndexOf(1,-0)<0,h=r("lastIndexOf");return sm=s||!h?function(r){if(s)return t(a,this,arguments)||0;var h=e(this),l=i(h);if(0===l)return-1;var u=l-1;for(arguments.length>1&&(u=o(u,n(arguments[1]))),u<0&&(u=l+u);u>=0;u--)if(u in h&&h[u]===r)return u||0;return-1}:a,sm}(),i=t.aTypedArray;(0,t.exportTypedArrayMethod)("lastIndexOf",function(t){var r=arguments.length;return e(n,i(this),r>1?[t,arguments[1]]:[t])})}();var cm,dm={};!function(){if(cm)return dm;cm=1;var t=kg(),e=cu().map,n=t.aTypedArray,i=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("map",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0,function(t,e){return new(i(t))(e)})})}();var fm,pm={};!function(){if(fm)return pm;fm=1;var t=kg(),e=Cc().left,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduce",function(t){var i=arguments.length;return e(n(this),t,i,i>1?arguments[1]:void 0)})}();var gm,mm={};!function(){if(gm)return mm;gm=1;var t=kg(),e=Cc().right,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduceRight",function(t){var i=arguments.length;return e(n(this),t,i,i>1?arguments[1]:void 0)})}();var _m,vm={};!function(){if(_m)return vm;_m=1;var t=kg(),e=t.aTypedArray,n=t.exportTypedArrayMethod,i=Math.floor;n("reverse",function(){for(var t,n=this,r=e(n).length,o=i(r/2),a=0;a<o;)t=n[a],n[a++]=n[--r],n[r]=t;return n})}();var ym,bm={};!function(){if(ym)return bm;ym=1;var t=vi(),e=Mi(),n=kg(),i=Ia(),r=Ig(),o=_o(),a=Ii(),s=t.RangeError,h=t.Int8Array,l=h&&h.prototype,u=l&&l.set,c=n.aTypedArray,d=n.exportTypedArrayMethod,f=!a(function(){var t=new Uint8ClampedArray(2);return e(u,t,{length:1,0:3},1),3!==t[1]}),p=f&&n.NATIVE_ARRAY_BUFFER_VIEWS&&a(function(){var t=new h(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]});d("set",function(t){c(this);var n=r(arguments.length>1?arguments[1]:void 0,1),a=o(t);if(f)return e(u,this,a,n);var h=this.length,l=i(a),d=0;if(l+n>h)throw new s("Wrong length");for(;d<l;)this[n+d]=a[d++]},!f||p)}();var wm,Sm={};!function(){if(wm)return Sm;wm=1;var t=kg(),e=Ii(),n=vh(),i=t.aTypedArray,r=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("slice",function(t,e){for(var o=n(i(this),t,e),a=r(this),s=0,h=o.length,l=new a(h);h>s;)l[s]=o[s++];return l},e(function(){new Int8Array(1).slice()}))}();var xm,Cm={};!function(){if(xm)return Cm;xm=1;var t=kg(),e=cu().some,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("some",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var km,Tm,Am,Im,Em,Pm,Mm,Dm,Om,Lm={};!function(){if(Om)return Lm;Om=1;var t=vi(),e=Qa(),n=Ii(),i=Br(),r=function(){if(Tm)return km;Tm=1;var t=vh(),e=Math.floor,n=function(i,r){var o=i.length;if(o<8)for(var a,s,h=1;h<o;){for(s=h,a=i[h];s&&r(i[s-1],a)>0;)i[s]=i[--s];s!==h++&&(i[s]=a)}else for(var l=e(o/2),u=n(t(i,0,l),r),c=n(t(i,l),r),d=u.length,f=c.length,p=0,g=0;p<d||g<f;)i[p+g]=p<d&&g<f?r(u[p],c[g])<=0?u[p++]:c[g++]:p<d?u[p++]:c[g++];return i};return km=n}(),o=kg(),a=function(){if(Im)return Am;Im=1;var t=Dr().match(/firefox\/(\d+)/i);return Am=!!t&&+t[1]}(),s=function(){if(Pm)return Em;Pm=1;var t=Dr();return Em=/MSIE|Trident/.test(t)}(),h=Or(),l=function(){if(Dm)return Mm;Dm=1;var t=Dr().match(/AppleWebKit\/(\d+)\./);return Mm=!!t&&+t[1]}(),u=o.aTypedArray,c=o.exportTypedArrayMethod,d=t.Uint16Array,f=d&&e(d.prototype.sort),p=!(!f||n(function(){f(new d(2),null)})&&n(function(){f(new d(2),{})})),g=!!f&&!n(function(){if(h)return h<74;if(a)return a<67;if(s)return!0;if(l)return l<602;var t,e,n=new d(516),i=Array(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,i[t]=t-2*e+3;for(f(n,function(t,e){return(t/4|0)-(e/4|0)}),t=0;t<516;t++)if(n[t]!==i[t])return!0});c("sort",function(t){return void 0!==t&&i(t),g?f(this,t):r(u(this),function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t))},!g||p)}();var Rm,Fm={};!function(){if(Rm)return Fm;Rm=1;var t=kg(),e=Aa(),n=Ta(),i=t.aTypedArray,r=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("subarray",function(t,o){var a=i(this),s=a.length,h=n(t,s);return new(r(a))(a.buffer,a.byteOffset+h*a.BYTES_PER_ELEMENT,e((void 0===o?s:n(o,s))-h))})}();var Wm,Bm={};!function(){if(Wm)return Bm;Wm=1;var t=vi(),e=gd(),n=kg(),i=Ii(),r=vh(),o=t.Int8Array,a=n.aTypedArray,s=n.exportTypedArrayMethod,h=[].toLocaleString,l=!!o&&i(function(){h.call(new o(1))});s("toLocaleString",function(){return e(h,l?r(a(this)):a(this),r(arguments))},i(function(){return[1,2].toLocaleString()!==new o([1,2]).toLocaleString()})||!i(function(){o.prototype.toLocaleString.call([1,2])}))}();var Gm,Hm={};!function(){if(Gm)return Hm;Gm=1;var t=kg().exportTypedArrayMethod,e=Ii(),n=vi(),i=Sr(),r=n.Uint8Array,o=r&&r.prototype||{},a=[].toString,s=i([].join);e(function(){a.call({})})&&(a=function(){return s(this)});var h=o.toString!==a;t("toString",a,h)}();var Nm=new Map,zm=null;function Xm(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{window.StarmusHooks&&"function"==typeof window.StarmusHooks.doAction&&window.StarmusHooks.doAction("starmus_event",{instanceId:t,event:e,severity:n.severity||"info",message:n.message||"",data:n.data||{}})}catch(t){console.warn("[Starmus] Telemetry emit failed:",t)}}function jm(t){return Um.apply(this,arguments)}function Um(){return(Um=xu(Pu().m(function t(e){var n,i;return Pu().w(function(t){for(;;)switch(t.n){case 0:if((n=e.getAudioTracks&&e.getAudioTracks()||[]).length){t.n=1;break}return t.a(2);case 1:if("live"!==(i=n[0]).readyState){t.n=2;break}return t.a(2);case 2:return t.a(2,new Promise(function(t){var e=0,n=setInterval(function(){("live"===i.readyState||e>100)&&(clearInterval(n),t()),e+=1},50);setTimeout(function(){clearInterval(n),t()},5e3)}))}},t)}))).apply(this,arguments)}function Vm(){var t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("AudioContext not supported in this browser");if((!zm||"closed"===zm.state)&&(zm=new t({latencyHint:"interactive"}),gu("[Recorder] Created AudioContext, state:",zm.state),"function"!=typeof zm.createMediaStreamSource))throw new Error("AudioContext lacks createMediaStreamSource");return zm}function Ym(t){var e=Vm(),n=e.createMediaStreamSource(t);try{var i=function(t){var e=t.createMediaStreamDestination||t.createMediaStreamAudioDestination;if("function"!=typeof e)throw new Error("MediaStreamDestination not supported");var n=e.call(t);if(!n||!n.stream)throw new Error("Destination stream invalid");return n}(e),r=e.createBiquadFilter();r.type="highpass",r.frequency.value=85;var o=e.createDynamicsCompressor();o.threshold.value=-20,o.knee.value=40,o.ratio.value=12,o.attack.value=0,o.release.value=.25;var a=e.createAnalyser();return a.fftSize=2048,n.connect(r),r.connect(o),o.connect(a),a.connect(i),{audioContext:e,destinationStream:i.stream,analyser:a,nodes:[n,r,o,a,i],fallbackActive:!1}}catch(i){gu("[Recorder] Audio graph failed  fallback to raw stream:",i.message);var s=e.createAnalyser();return s.fftSize=2048,n.connect(s),{audioContext:e,destinationStream:t,analyser:s,nodes:[n,s],fallbackActive:!0}}}function Zm(t,e){return Km.apply(this,arguments)}function Km(){return(Km=xu(Pu().m(function t(e,n){var i,r,o,a,s,h;return Pu().w(function(t){for(;;)if(0===t.n)return i=Vm(),(r=i.createAnalyser()).fftSize=2048,(o=i.createMediaStreamSource(e)).connect(r),a=new Float32Array(r.fftSize),s=[],h=performance.now(),t.a(2,new Promise(function(t){!function e(){if("running"===i.state){r.getFloatTimeDomainData(a);for(var l=0,u=0;u<a.length;u++)l+=a[u]*a[u];var c=Math.sqrt(l/a.length);if(isFinite(c)){s.push(c);var d=Math.min(100,2e3*c);n&&n("",d,!1),performance.now()-h<15e3?requestAnimationFrame(e):function(){var e=Math.max(1,Math.floor(s.length/3)),i=s.slice(0,e),a=s.slice(e,2*e),h=function(t){return t.length?t.reduce(function(t,e){return t+e},0)/t.length:0},l=h(i),u=h(a),c=u/Math.max(l,1e-6),d=c<3?6:Math.max(1,Math.min(4,.1/Math.max(u,1e-6))),f={gain:parseFloat(d.toFixed(3)),snr:parseFloat(c.toFixed(3)),noiseFloor:parseFloat(l.toFixed(6)),speechLevel:parseFloat(u.toFixed(6)),timestamp:(new Date).toISOString()};try{o.disconnect()}catch(t){}try{r.disconnect()}catch(t){}n&&n("",null,!0);t(f)}()}else requestAnimationFrame(e)}else requestAnimationFrame(e)}()}))},t)}))).apply(this,arguments)}function qm(t,e){yu.unsubscribeInstance&&yu.unsubscribeInstance(e),yu.subscribe("start-recording",function(n,i){i.instanceId===e&&t.dispatch({type:"starmus/mic-start",payload:{instanceId:i.instanceId}})},e),yu.subscribe("pause-mic",function(n,i){i.instanceId===e&&t.dispatch({type:"starmus/mic-pause",payload:{instanceId:i.instanceId}})},e),yu.subscribe("resume-mic",function(n,i){i.instanceId===e&&t.dispatch({type:"starmus/mic-resume",payload:{instanceId:i.instanceId}})},e),yu.subscribe("stop-mic",function(n,i){i.instanceId===e&&t.dispatch({type:"starmus/mic-stop",payload:{instanceId:i.instanceId}})},e),yu.subscribe("setup-mic",function(){var n=xu(Pu().m(function n(i,r){var o,a,s,h,l;return Pu().w(function(n){for(;;)switch(n.p=n.n){case 0:if(r.instanceId===e){n.n=1;break}return n.a(2);case 1:if(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia){n.n=2;break}return Xm(e,"E_RECORDER_UNSUPPORTED",{severity:"error",message:o="Microphone not supported."}),t.dispatch({type:"starmus/error",payload:{message:o,retryable:!1}}),n.a(2);case 2:return n.p=2,n.n=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:return a=n.v,Xm(e,"E_MIC_ACCESS",{severity:"info",message:"Mic access granted  calibrating"}),t.dispatch({type:"starmus/calibration-start"}),n.n=4,Zm(a,function(e,n,i){t.dispatch({type:"starmus/calibration-update",message:e,volumePercent:n})});case 4:s=n.v,a.getTracks().forEach(function(t){return t.stop()}),t.dispatch({type:"starmus/calibration-complete",payload:{calibration:s},calibration:s}),n.n=6;break;case 5:n.p=5,l=n.v,h="NotAllowedError"===l.name?"Microphone permission denied.":"Failed to access microphone.",Xm(e,"E_MIC_ACCESS",{severity:"error",message:h,data:{error:l.message}}),t.dispatch({type:"starmus/error",payload:{message:h,retryable:!0}});case 6:return n.a(2)}},n,null,[[2,5]])}));return function(t,e){return n.apply(this,arguments)}}(),e),yu.subscribe("start-recording",function(){var n=xu(Pu().m(function n(i,r){var o,a,s,h,l,u,c,d,f,p,g;return Pu().w(function(n){for(;;)switch(n.p=n.n){case 0:if(r.instanceId===e){n.n=1;break}return n.a(2);case 1:if("calibrating"!==(o=t.getState()).status){n.n=2;break}return t.dispatch({type:"starmus/error",payload:{message:"Please wait for calibration to complete.",retryable:!0}}),n.a(2);case 2:if(o.calibration&&o.calibration.complete){n.n=3;break}return t.dispatch({type:"starmus/error",payload:{message:"Please setup your microphone first.",retryable:!0}}),n.a(2);case 3:return n.p=3,a=function(){var n=Nm.get(e);if(n&&"recording"===n.mediaRecorder.state){try{d.getFloatTimeDomainData(f);for(var i=0,r=0;r<f.length;r++)i+=f[r]*f[r];var o=Math.sqrt(i/f.length),s=Math.min(100,4e3*o),h=(performance.now()-p)/1e3;t.dispatch({type:"starmus/recorder-tick",duration:h,amplitude:s})}catch(t){}n.rafId=requestAnimationFrame(a)}},n.n=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:if(s=n.v,"suspended"!==(h=Ym(s)).audioContext.state){n.n=5;break}return n.n=5,h.audioContext.resume();case 5:return n.n=6,jm(h.destinationStream);case 6:if(l=h.destinationStream,l.getAudioTracks().length){n.n=7;break}throw new Error("No audio tracks available");case 7:u=new MediaRecorder(l),c=[],u.ondataavailable=function(t){t.data&&t.data.size>0&&c.push(t.data)},u.onstop=function(){var n=Nm.get(e);if(n){n.rafId&&cancelAnimationFrame(n.rafId);var i=new Blob(c,{type:u.mimeType||"audio/webm"}),r="starmus-recording-".concat(Date.now(),".webm");Xm(e,"REC_COMPLETE",{severity:"info",message:"Recording stopped and blob created",data:{mimeType:u.mimeType||"audio/webm",chunkCount:c.length}}),t.dispatch({type:"starmus/recording-available",payload:{blob:i,fileName:r}}),s.getTracks().forEach(function(t){return t.stop()}),l.getTracks().forEach(function(t){return t.stop()}),h.nodes.forEach(function(t){try{t.disconnect()}catch(t){}}),Nm.delete(e)}},Nm.set(e,{mediaRecorder:u,rawStream:s,graph:h,rafId:null}),u.start(3e3),t.dispatch({type:"starmus/mic-start"}),d=h.analyser,f=new Float32Array(d.fftSize),p=performance.now(),requestAnimationFrame(a),n.n=9;break;case 8:n.p=8,g=n.v,console.error("[Recorder] ERROR start-recording:",g),Xm(e,"E_RECORDER_START_FAIL",{severity:"error",message:g.message}),t.dispatch({type:"starmus/error",payload:{message:"Recording failed to start.",retryable:!0}});case 9:return n.a(2)}},n,null,[[3,8]])}));return function(t,e){return n.apply(this,arguments)}}(),e),yu.subscribe("stop-mic",function(n,i){if(i.instanceId===e){var r=Nm.get(e);r&&r.mediaRecorder&&"recording"===r.mediaRecorder.state&&(r.mediaRecorder.stop(),t.dispatch({type:"starmus/mic-stop"}))}},e),yu.subscribe("pause-mic",function(n,i){if(i.instanceId===e){var r=Nm.get(e);r&&r.mediaRecorder&&"recording"===r.mediaRecorder.state&&"function"==typeof r.mediaRecorder.pause&&(t.dispatch({type:"starmus/mic-pause"}),r.mediaRecorder.pause())}},e),yu.subscribe("resume-mic",function(n,i){if(i.instanceId===e){var r=Nm.get(e);r&&r.mediaRecorder&&"paused"===r.mediaRecorder.state&&"function"==typeof r.mediaRecorder.resume&&(t.dispatch({type:"starmus/mic-resume"}),r.mediaRecorder.resume())}},e),yu.subscribe("reset",function(t,n){if(n.instanceId===e){var i=Nm.get(e);if(i){try{i.mediaRecorder&&"inactive"!==i.mediaRecorder.state&&i.mediaRecorder.stop()}catch(t){}i.rafId&&cancelAnimationFrame(i.rafId),i.rawStream&&i.rawStream.getTracks().forEach(function(t){return t.stop()}),i.graph&&i.graph.destinationStream&&i.graph.destinationStream.getTracks().forEach(function(t){return t.stop()}),i.graph&&i.graph.nodes&&i.graph.nodes.forEach(function(t){try{t.disconnect()}catch(t){}}),Nm.delete(e)}}},e)}var Jm,Qm,$m,t_={};!function(){if($m)return t_;$m=1;var t=Ja(),e=function(){if(Qm)return Jm;Qm=1;var t=Ei(),e=Sr(),n=Mi(),i=Ii(),r=Fs(),o=Za(),a=br(),s=_o(),h=Cr(),l=Object.assign,u=Object.defineProperty,c=e([].concat);return Jm=!l||i(function(){if(t&&1!==l({b:1},l(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},n={},i=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(t){n[t]=t}),7!==l({},e)[i]||r(l({},n)).join("")!==o})?function(e,i){for(var l=s(e),u=arguments.length,d=1,f=o.f,p=a.f;u>d;)for(var g,m=h(arguments[d++]),_=f?c(r(m),f(m)):r(m),v=_.length,y=0;v>y;)g=_[y++],t&&!n(p,m,g)||(l[g]=m[g]);return l}:l,Jm}();t({target:"Object",stat:!0,arity:2,forced:Object.assign!==e},{assign:e})}();var e_=["starmus_title","starmus_language","starmus_recording_type","audio_file_type","agreement_to_terms","_starmus_calibration","_starmus_env","first_pass_transcription","recording_metadata","waveform_json","session_date","session_start_time","session_end_time","location","gps_coordinates","contributor_id","interviewers_recorders","recording_equipment","audio_files_originals","media_condition_notes","related_consent_agreement","usage_restrictions_rights","audio_quality_score","access_level","device"];function n_(t,e,n){return t&&null!=t[e]?t[e]:n}function i_(t,e){if(!t||"object"!==Ru(t))return t;var n=Array.isArray(t)?t.slice():Object.assign({},t);return e.forEach(function(t){t in n&&delete n[t]}),n}function r_(t,e,n){if(t&&"function"==typeof t.getState&&"function"==typeof t.subscribe){if(e instanceof HTMLFormElement){var i=n||{},r=Array.isArray(i.trigger)?i.trigger:[i.trigger||"ready_to_submit"],o=Array.isArray(i.clearOn)?i.clearOn:[i.clearOn||"reset"],a=Array.isArray(i.requiredFields)?i.requiredFields:[],s=null,h=t.subscribe(l);return l(),h}console.warn("[StarmusMetadataAuto] Invalid form")}else console.warn("[StarmusMetadataAuto] Invalid store");function l(){var n=t.getState(),i=n.status;if(-1!==o.indexOf(i)&&function(t){e_.forEach(function(e){var n=t.querySelector('input[name="'+e+'"]');n&&t.contains(n)&&n.parentNode.removeChild(n)})}(e),i!==s&&-1!==r.indexOf(i)){var h=function(t){var e=(new Date).toISOString(),n=e.split("T")[0],i=n_(t,"source",{}),r=n_(t,"submission",{}),o=n_(t,"user",{}),a=n_(t,"env",{}),s=n_(t,"calibration",{}),h=n_(t,"recorder",{});return{starmus_title:n_(i,"title",""),starmus_language:n_(i,"language",""),starmus_recording_type:n_(i,"type",""),audio_file_type:r.blob&&r.blob.type?r.blob.type:"audio/webm",agreement_to_terms:o.agreedToTerms?"1":"0",_starmus_calibration:i_(s,["volumePercent","phase"]),_starmus_env:i_(a,["build","debug","flags"]),first_pass_transcription:n_(i,"transcript",""),recording_metadata:i_(n_(i,"metadata",{}),["debug","transient"]),waveform_json:i_(n_(i,"waveform",{}),["peaks","pcm"]),session_date:n,session_start_time:n_(h,"startTime",e),session_end_time:n_(h,"endTime",e),location:n_(i,"location",""),gps_coordinates:n_(i,"gps",""),contributor_id:n_(o,"id",""),interviewers_recorders:n_(i,"interviewers",""),recording_equipment:n_(i,"equipment",""),audio_files_originals:n_(i,"originals",[]),media_condition_notes:n_(i,"conditionNotes",""),related_consent_agreement:n_(i,"consent",""),usage_restrictions_rights:n_(i,"usageRights",""),audio_quality_score:n_(r,"qualityScore",""),access_level:n_(r,"accessLevel",""),device:navigator.userAgent}}(n);if(a.length){var l=function(t,e){var n=[];return e.forEach(function(e){var i=t[e];(null==i||"string"==typeof i&&""===i.trim()||Array.isArray(i)&&0===i.length)&&n.push(e)}),{valid:0===n.length,missing:n}}(h,a),u=l.valid,c=l.missing;u||console.warn("[StarmusMetadataAuto] Missing:",c)}!function(t,e){e_.forEach(function(n){var i=t[n],r=e.querySelector('input[name="'+n+'"]');if(r||((r=document.createElement("input")).type="hidden",r.name=n,e.appendChild(r)),null==i)r.value="";else if("string"==typeof i||"number"==typeof i||"boolean"==typeof i)r.value=String(i);else try{r.value=JSON.stringify(i)}catch(t){console.warn("[StarmusMetadataAuto] Serialize fail for",n,t.message),r.value=""}})}(h,e)}s=i}}"undefined"!=typeof window&&(window.StarmusMetadataAuto={initAutoMetadata:r_});var o_=window.CommandBus||window.StarmusHooks,a_=o_&&o_.debugLog?o_.debugLog:function(){},s_=function(){return ku(function t(e,n,i){Cu(this,t),this.peaks=e,this.container=document.getElementById(n),this.data=Array.isArray(i)?i:[],this.activeTokenIndex=-1,this.isUserScrolling=!1,this.scrollTimeout=null,this.boundOnTimeUpdate=null,this.boundOnSeeked=null,this.boundOnClick=null,this.boundOnScroll=null,this.init()},[{key:"init",value:function(){this.container?(this.render(),this.bindEvents()):console.warn("[StarmusTranscript] Container not found. Transcript sync disabled.")}},{key:"render",value:function(){var t=this,e=document.createDocumentFragment();this.data.forEach(function(n,i){var r=document.createElement("span");r.textContent=n.text,r.className="starmus-word",r.dataset.index=i,r.dataset.start=n.start,r.dataset.end=n.end,"confidence"in n&&n.confidence<.8&&(r.dataset.confidence="low",r.title="Low confidence: ".concat(Math.round(100*n.confidence),"%")),e.appendChild(r),i<t.data.length-1&&e.appendChild(document.createTextNode(" "))}),this.container.innerHTML="",this.container.appendChild(e),this.activeTokenIndex=-1}},{key:"bindEvents",value:function(){var t=this;this.boundOnClick=function(e){var n=e.target;if(n.classList.contains("starmus-word")){var i=parseFloat(n.dataset.start);t.peaks&&t.peaks.player&&"function"==typeof t.peaks.player.seek&&(t.peaks.player.seek(i),o_&&"function"==typeof o_.dispatch&&o_.dispatch("starmus/transcript/seek",{time:i},{instanceId:t.peaks.instanceId}))}},this.container.addEventListener("click",this.boundOnClick),this.boundOnScroll=function(){t.isUserScrolling=!0,t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(function(){t.isUserScrolling=!1},1e3)},this.container.addEventListener("scroll",this.boundOnScroll);var e=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;e&&"function"==typeof e.addEventListener?(this.boundOnTimeUpdate=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("seeked",this.boundOnSeeked)):a_("[StarmusTranscript] Player media element not found  sync disabled")}},{key:"findTokenIndex",value:function(t){if("number"!=typeof t||0===this.data.length)return-1;for(var e=0,n=this.data.length-1;e<=n;){var i=e+n>>1,r=this.data[i];if(t>=r.start&&t<=r.end)return i;t<r.start?n=i-1:e=i+1}return-1}},{key:"syncHighlight",value:function(t){var e=this.findTokenIndex(t);-1===e?this.clearHighlight():e!==this.activeTokenIndex&&this.updateDOM(e)}},{key:"updateDOM",value:function(t){var e=this.container.querySelectorAll(".starmus-word");this.activeTokenIndex>=0&&e[this.activeTokenIndex]&&e[this.activeTokenIndex].classList.remove("is-active"),this.activeTokenIndex=t;var n=e[t];n&&(n.classList.add("is-active"),this.isUserScrolling||this.scrollToWord(n))}},{key:"clearHighlight",value:function(){var t=this.container.querySelector(".starmus-word.is-active");t&&t.classList.remove("is-active"),this.activeTokenIndex=-1}},{key:"scrollToWord",value:function(t){t.scrollIntoView&&t.scrollIntoView({block:"center",behavior:"smooth"})}},{key:"updateData",value:function(t){this.data=Array.isArray(t)?t:[],this.render(),this.unbindEvents(),this.bindEvents()}},{key:"unbindEvents",value:function(){if(this.container){this.boundOnClick&&this.container.removeEventListener("click",this.boundOnClick),this.boundOnScroll&&this.container.removeEventListener("scroll",this.boundOnScroll);var t=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;t&&"function"==typeof t.removeEventListener&&(this.boundOnTimeUpdate&&t.removeEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked&&t.removeEventListener("seeked",this.boundOnSeeked))}}},{key:"destroy",value:function(){this.unbindEvents(),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.container&&(this.container.innerHTML=""),this.data=[],this.activeTokenIndex=-1,this.isUserScrolling=!1}}])}();function h_(t,e,n){return new s_(t,e,n)}"undefined"!=typeof window&&(window.StarmusTranscript=s_,window.StarmusTranscriptController={StarmusTranscript:s_,init:h_}),"undefined"!=typeof module&&module.exports&&(module.exports={StarmusTranscript:s_,init:h_});var l_={StarmusTranscript:s_,init:h_};window.Starmus=window.Starmus||{},window.Starmus.Integrator=!0,window.StarmusDetected=!0,window.Peaks&&!window.Starmus.Peaks?window.Starmus.Peaks=window.Peaks:window.Peaks||(console.warn("[StarmusIntegrator] Peaks missing, null bridge installed"),window.Peaks={init:function(){return null}},window.Starmus.Peaks=window.Peaks),"SpeechRecognition"in window||"webkitSpeechRecognition"in window||(window.SpeechRecognition=function(){},console.log("[StarmusIntegrator] Speech API stubbed")),document.addEventListener("click",function(){try{var t=window.StarmusAudioContext;t&&"suspended"===t.state&&t.resume()}catch(t){}},{once:!0}),window.addEventListener("load",function(){var t=window.StarmusQueueSubmission;if("function"==typeof t){var e=!1;window.StarmusQueueSubmission=function(){if(e)return console.warn("[StarmusIntegrator] Double submit blocked");e=!0;try{return t.apply(null,arguments)}finally{setTimeout(function(){return e=!1},1500)}}}}),console.log("[StarmusIntegrator] Passive mode active"),window.Peaks||(window.Peaks=ai);var u_,c_=window.StarmusStore.createStore(u_);window.StarmusStore=c_,console.log("[StarmusMain] Store initialized"),document.addEventListener("DOMContentLoaded",function(){try{var t=document.querySelector("form[data-starmus-instance]"),e=t?t.getAttribute("data-starmus-instance"):null;if(!e)return void console.warn("[StarmusMain]  No Starmus form found. UI will not initialize.");console.log("[StarmusMain] Booting for Instance ID:",e),ap(c_,e),wp(c_,{},e),qm(c_,e),np(),t&&r_(c_,t,{trigger:"ready_to_submit"})}catch(t){console.error("[StarmusMain] Boot failed:",t)}}),window.StarmusRecorder=qm,window.StarmusTus={queueSubmission:Qf},window.StarmusOfflineQueue=qf,window.StarmusTranscriptController=l_,console.log("[StarmusMain] Bundle Loaded")}();
