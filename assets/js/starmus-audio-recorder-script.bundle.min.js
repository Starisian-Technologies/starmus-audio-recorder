!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var n,i={exports:{}},r={},o={};function a(){return n||(n=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const n=Math.PI/180;e.glob=void 0!==t?t:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},e.Konva={_global:e.glob,version:"9.3.22",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>e.Konva.angleDeg?t*n:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>e.Konva.DD.isDragging,isTransforming(){var t;return null===(t=e.Konva.Transformer)||void 0===t?void 0:t.isTransforming()},isDragReady:()=>!!e.Konva.DD.node,releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(t){e.glob.Konva=t}};e._registerNode=t=>{e.Konva[t.prototype.getClassName()]=t},e.Konva._injectGlobal(e.Konva)}(o)),o}var s,l={};function h(){return s||(s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=a();class n{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){const e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.m[0]*e+this.m[2]*n,r=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,a=this.m[1]*-n+this.m[3]*e;return this.m[0]=i,this.m[1]=r,this.m[2]=o,this.m[3]=a,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){const n=this.m[0]+this.m[2]*e,i=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=i,this.m[2]=r,this.m[3]=o,this}multiply(t){const e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=a,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=o,this.m[5]=a,this}getMatrix(){return this.m}decompose(){const e=this.m[0],n=this.m[1],i=this.m[2],r=this.m[3],o=e*r-n*i,a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=e||0!=n){const t=Math.sqrt(e*e+n*n);a.rotation=n>0?Math.acos(e/t):-Math.acos(e/t),a.scaleX=t,a.scaleY=o/t,a.skewX=(e*i+n*r)/o,a.skewY=0}else if(0!=i||0!=r){const t=Math.sqrt(i*i+r*r);a.rotation=Math.PI/2-(r>0?Math.acos(-i/t):-Math.acos(i/t)),a.scaleX=o/t,a.scaleY=t,a.skewX=0,a.skewY=(e*i+n*r)/o}return a.rotation=t.Util._getRotation(a.rotation),a}}t.Transform=n;const i=Math.PI/180,r=180/Math.PI,o="Konva error: ",s={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},l=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let h=[];const u="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)};t.Util={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;const e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){h.push(t),1===h.length&&u(function(){const t=h;h=[],t.forEach(function(t){t()})})},createCanvasElement(){const t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>document.createElement("img"),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(e,n){const i=t.Util.createImageElement();i.onload=function(){n(i)},i.src=e},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){let t=(16777215*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return"#"+t},getRGB(t){let e;return t in s?(e=s[t],{r:e[0],g:e[1],b:e[2]}):"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=l.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:e=>(e=e||"black",t.Util._namedColorToRBA(e)||t.Util._hex3ColorToRGBA(e)||t.Util._hex4ColorToRGBA(e)||t.Util._hex6ColorToRGBA(e)||t.Util._hex8ColorToRGBA(e)||t.Util._rgbColorToRGBA(e)||t.Util._rgbaColorToRGBA(e)||t.Util._hslColorToRGBA(e)),_namedColorToRBA(t){const e=s[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){const e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){const e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),i=Number(n[0])/360,r=Number(n[1])/100,o=Number(n[2])/100;let a,s,l;if(0===r)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};a=o<.5?o*(1+r):o+r-o*r;const h=2*o-a,u=[0,0,0];for(let t=0;t<3;t++)s=i+1/3*-(t-1),s<0&&s++,s>1&&s--,l=6*s<1?h+6*(a-h)*s:2*s<1?a:3*s<2?h+(a-h)*(2/3-s)*6:h,u[t]=255*l;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){const e={};for(const n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*i,radToDeg:t=>t*r,_degToRad:e=>(t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(e)),_radToDeg:e=>(t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(e)),_getRotation:n=>e.Konva.angleDeg?t.Util.radToDeg(n):n,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(o+t)},error(t){console.error(o+t)},warn(t){e.Konva.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(const n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,i,r,o){let a,s,l;const h=(t-n)*(t-n)+(e-i)*(e-i);if(0==h)a=t,s=e,l=(r-n)*(r-n)+(o-i)*(o-i);else{const u=((r-t)*(n-t)+(o-e)*(i-e))/h;u<0?(a=t,s=e,l=(t-r)*(t-r)+(e-o)*(e-o)):u>1?(a=n,s=i,l=(n-r)*(n-r)+(i-o)*(i-o)):(a=t+u*(n-t),s=e+u*(i-e),l=(a-r)*(a-r)+(s-o)*(s-o))}return[a,s,l]},_getProjectionToLine(e,n,i){const r=t.Util.cloneObject(e);let o=Number.MAX_VALUE;return n.forEach(function(a,s){if(!i&&s===n.length-1)return;const l=n[(s+1)%n.length],h=t.Util._getProjectionToSegment(a.x,a.y,l.x,l.y,e.x,e.y),u=h[0],c=h[1],d=h[2];d<o&&(r.x=u,r.y=c,o=d)}),r},_prepareArrayForTween(e,n,i){const r=[],o=[];if(e.length>n.length){const t=n;n=e,e=t}for(let t=0;t<e.length;t+=2)r.push({x:e[t],y:e[t+1]});for(let t=0;t<n.length;t+=2)o.push({x:n[t],y:n[t+1]});const a=[];return o.forEach(function(e){const n=t.Util._getProjectionToLine(e,r,i);a.push(n.x),a.push(n.y)}),a},_prepareToStringify(e){let n;e.visitedByCircularReferenceRemoval=!0;for(const i in e)if(e.hasOwnProperty(i)&&e[i]&&"object"==typeof e[i])if(n=Object.getOwnPropertyDescriptor(e,i),e[i].visitedByCircularReferenceRemoval||t.Util._isElement(e[i])){if(!n.configurable)return null;delete e[i]}else if(null===t.Util._prepareToStringify(e[i])){if(!n.configurable)return null;delete e[i]}return delete e.visitedByCircularReferenceRemoval,e},_assign(t,e){for(const n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){e.Konva.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,n,i){let r=0,o=0,a=0,s=0;"number"==typeof i?r=o=a=s=Math.min(i,e/2,n/2):(r=Math.min(i[0]||0,e/2,n/2),o=Math.min(i[1]||0,e/2,n/2),s=Math.min(i[2]||0,e/2,n/2),a=Math.min(i[3]||0,e/2,n/2)),t.moveTo(r,0),t.lineTo(e-o,0),t.arc(e-o,o,o,3*Math.PI/2,0,!1),t.lineTo(e,n-s),t.arc(e-s,n-s,s,0,Math.PI/2,!1),t.lineTo(a,n),t.arc(a,n-a,a,Math.PI/2,Math.PI,!1),t.lineTo(0,r),t.arc(r,r,r,Math.PI,3*Math.PI/2,!1)}}}(l)),l}var u,c,d={},f={},p={};function g(){if(u)return p;u=1,Object.defineProperty(p,"__esModule",{value:!0}),p.HitContext=p.SceneContext=p.Context=void 0;const t=h(),e=a();const n=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let i=class{constructor(t){this.canvas=t,e.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(e,n){let i,r,o,a,s=this.traceArr,l=s.length,h="";for(i=0;i<l;i++)r=s[i],o=r.method,o?(a=r.args,h+=o,e?h+="()":t.Util._isArray(a[0])?h+="(["+a.join(",")+"])":(n&&(a=a.map(t=>"number"==typeof t?Math.floor(t):t)),h+="("+a.join(",")+")")):(h+=r.property,e||(h+="="+r.val)),h+=";";return h}clearTrace(){this.traceArr=[]}_trace(t){let e,n=this.traceArr;n.push(t),e=n.length,e>=100&&n.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){const e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,i,r,o){this._context.arc(t,e,n,i,r,o)}arcTo(t,e,n,i,r){this._context.arcTo(t,e,n,i,r)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,i,r,o){this._context.bezierCurveTo(t,e,n,i,r,o)}clearRect(t,e,n,i){this._context.clearRect(t,e,n,i)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){const n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,i){return this._context.createLinearGradient(t,e,n,i)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,i,r,o){return this._context.createRadialGradient(t,e,n,i,r,o)}drawImage(t,e,n,i,r,o,a,s,l){const h=arguments,u=this._context;3===h.length?u.drawImage(t,e,n):5===h.length?u.drawImage(t,e,n,i,r):9===h.length&&u.drawImage(t,e,n,i,r,o,a,s,l)}ellipse(t,e,n,i,r,o,a,s){this._context.ellipse(t,e,n,i,r,o,a,s)}isPointInPath(t,e,n,i){return n?this._context.isPointInPath(n,t,e,i):this._context.isPointInPath(t,e,i)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,n,i){this._context.fillRect(t,e,n,i)}strokeRect(t,e,n,i){this._context.strokeRect(t,e,n,i)}fillText(t,e,n,i){i?this._context.fillText(t,e,n,i):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,i){return this._context.getImageData(t,e,n,i)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,i){this._context.rect(t,e,n,i)}roundRect(t,e,n,i,r){this._context.roundRect(t,e,n,i,r)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,i){this._context.quadraticCurveTo(t,e,n,i)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,i,r,o){this._context.setTransform(t,e,n,i,r,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,i){this._context.strokeText(t,e,n,i)}transform(t,e,n,i,r,o){this._context.transform(t,e,n,i,r,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let e,i,r=this,o=n.length,a=this.setAttr;const s=function(e){let n,o=r[e];r[e]=function(){return i=function(e){const n=[],i=e.length,r=t.Util;for(let t=0;t<i;t++){let i=e[t];r._isNumber(i)?i=Math.round(1e3*i)/1e3:r._isString(i)||(i+=""),n.push(i)}return n}(Array.prototype.slice.call(arguments,0)),n=o.apply(r,arguments),r._trace({method:e,args:i}),n}};for(e=0;e<o;e++)s(n[e]);r.setAttr=function(){a.apply(r,arguments);const t=arguments[0];let e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),r._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}};p.Context=i,["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach(function(t){Object.defineProperty(i.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});p.SceneContext=class extends i{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){const e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)return void this._fillColor(t);const i=t.getFillPatternImage();if(i&&"pattern"===n)return void this._fillPattern(t);const r=t.getFillLinearGradientColorStops();if(r&&"linear-gradient"===n)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):i?this._fillPattern(t):r?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),i=t.getStrokeLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,n.x,n.y);if(i){for(let t=0;t<i.length;t+=2)r.addColorStop(i[t],i[t+1]);this.setAttr("strokeStyle",r)}}_stroke(t){const e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,i;const r=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,a=null!==(i=t.getShadowOffset())&&void 0!==i?i:{x:0,y:0},s=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),h=s.x*l,u=s.y*l;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",o*Math.min(Math.abs(h),Math.abs(u))),this.setAttr("shadowOffsetX",a.x*h),this.setAttr("shadowOffsetY",a.y*u)}};return p.HitContext=class extends i{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const e=t.getStrokeScaleEnabled();if(!e){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t);const n=t.hitStrokeWidth(),i="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}},p}function m(){if(c)return f;c=1,Object.defineProperty(f,"__esModule",{value:!0}),f.HitCanvas=f.SceneCanvas=f.Canvas=void 0;const t=h(),e=g(),n=a();let i;let r=class{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||n.Konva.pixelRatio||function(){if(i)return i;const e=t.Util.createCanvasElement(),r=e.getContext("2d");return i=(n.Konva._global.devicePixelRatio||1)/(r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1),t.Util.releaseCanvas(e),i}();this.pixelRatio=r,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(e,n){try{return this._canvas.toDataURL(e,n)}catch(e){try{return this._canvas.toDataURL()}catch(e){return t.Util.error("Unable to get data URL. "+e.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};f.Canvas=r;f.SceneCanvas=class extends r{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new e.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}};return f.HitCanvas=class extends r{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new e.HitContext(this),this.setSize(t.width,t.height)}},f}var v,_={};function y(){return v||(v=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=a(),n=h();t.DD={get isDragging(){let e=!1;return t.DD._dragElements.forEach(t=>{"dragging"===t.dragStatus&&(e=!0)}),e},justDragged:!1,get node(){let e;return t.DD._dragElements.forEach(t=>{e=t.node}),e},_dragElements:new Map,_drag(e){const i=[];t.DD._dragElements.forEach((t,r)=>{const{node:o}=t,a=o.getStage();a.setPointersPositions(e),void 0===t.pointerId&&(t.pointerId=n.Util._getFirstPointerId(e));const s=a._changedPointerPositions.find(e=>e.id===t.pointerId);if(s){if("dragging"!==t.dragStatus){const n=o.dragDistance();if(Math.max(Math.abs(s.x-t.startPointerPos.x),Math.abs(s.y-t.startPointerPos.y))<n)return;if(o.startDrag({evt:e}),!o.isDragging())return}o._setDragPosition(e,t),i.push(o)}}),i.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:e},!0)})},_endDragBefore(n){const i=[];t.DD._dragElements.forEach(r=>{const{node:o}=r,a=o.getStage();n&&a.setPointersPositions(n);if(!a._changedPointerPositions.find(t=>t.id===r.pointerId))return;"dragging"!==r.dragStatus&&"stopped"!==r.dragStatus||(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,r.dragStatus="stopped");const s=r.node.getLayer()||r.node instanceof e.Konva.Stage&&r.node;s&&-1===i.indexOf(s)&&i.push(s)}),i.forEach(t=>{t.draw()})},_endDragAfter(e){t.DD._dragElements.forEach((n,i)=>{"stopped"===n.dragStatus&&n.node.fire("dragend",{type:"dragend",target:n.node,evt:e},!0),"dragging"!==n.dragStatus&&t.DD._dragElements.delete(i)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("touchcancel",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1),window.addEventListener("touchcancel",t.DD._endDragAfter,!1))}(_)),_}var b,w,S,C={},x={};function k(){if(b)return x;b=1,Object.defineProperty(x,"__esModule",{value:!0}),x.RGBComponent=function(t){if(t>255)return 255;if(t<0)return 0;return Math.round(t)},x.alphaComponent=function(t){if(t>1)return 1;if(t<1e-4)return 1e-4;return t},x.getNumberValidator=function(){if(t.Konva.isUnminified)return function(t,i){return e.Util._isNumber(t)||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a number.'),t}},x.getNumberOrArrayOfNumbersValidator=function(i){if(t.Konva.isUnminified)return function(t,r){let o=e.Util._isNumber(t),a=e.Util._isArray(t)&&t.length==i;return o||a||e.Util.warn(n(t)+' is a not valid value for "'+r+'" attribute. The value should be a number or Array<number>('+i+")"),t}},x.getNumberOrAutoValidator=function(){if(t.Konva.isUnminified)return function(t,i){return e.Util._isNumber(t)||"auto"===t||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a number or "auto".'),t}},x.getStringValidator=function(){if(t.Konva.isUnminified)return function(t,i){return e.Util._isString(t)||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a string.'),t}},x.getStringOrGradientValidator=function(){if(t.Konva.isUnminified)return function(t,i){const r=e.Util._isString(t),o="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return r||o||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a string or a native gradient.'),t}},x.getFunctionValidator=function(){if(t.Konva.isUnminified)return function(t,i){return e.Util._isFunction(t)||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a function.'),t}},x.getNumberArrayValidator=function(){if(t.Konva.isUnminified)return function(t,i){const r=Int8Array?Object.getPrototypeOf(Int8Array):null;return r&&t instanceof r||(e.Util._isArray(t)?t.forEach(function(t){e.Util._isNumber(t)||e.Util.warn('"'+i+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a array of numbers.')),t}},x.getBooleanValidator=function(){if(t.Konva.isUnminified)return function(t,i){return!0===t||!1===t||e.Util.warn(n(t)+' is a not valid value for "'+i+'" attribute. The value should be a boolean.'),t}},x.getComponentValidator=function(i){if(t.Konva.isUnminified)return function(t,r){return null==t||e.Util.isObject(t)||e.Util.warn(n(t)+' is a not valid value for "'+r+'" attribute. The value should be an object with properties '+i),t}};const t=a(),e=h();function n(t){return e.Util._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||e.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}return x}function T(){return w||(w=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=h(),n=k(),i="get",r="set";t.Factory={addGetterSetter(e,n,i,r,o){t.Factory.addGetter(e,n,i),t.Factory.addSetter(e,n,r,o),t.Factory.addOverloadedGetterSetter(e,n)},addGetter(t,n,r){const o=i+e.Util._capitalize(n);t.prototype[o]=t.prototype[o]||function(){const t=this.attrs[n];return void 0===t?r:t}},addSetter(n,i,o,a){const s=r+e.Util._capitalize(i);n.prototype[s]||t.Factory.overWriteSetter(n,i,o,a)},overWriteSetter(t,n,i,o){const a=r+e.Util._capitalize(n);t.prototype[a]=function(t){return i&&null!=t&&(t=i.call(this,t,n)),this._setAttr(n,t),o&&o.call(this),this}},addComponentsGetterSetter(o,a,s,l,h){const u=s.length,c=e.Util._capitalize,d=i+c(a),f=r+c(a);o.prototype[d]=function(){const t={};for(let e=0;e<u;e++){const n=s[e];t[n]=this.getAttr(a+c(n))}return t};const p=(0,n.getComponentValidator)(s);o.prototype[f]=function(t){const e=this.attrs[a];l&&(t=l.call(this,t,a)),p&&p.call(this,t,a);for(const e in t)t.hasOwnProperty(e)&&this._setAttr(a+c(e),t[e]);return t||s.forEach(t=>{this._setAttr(a+c(t),void 0)}),this._fireChangeEvent(a,e,t),h&&h.call(this),this},t.Factory.addOverloadedGetterSetter(o,a)},addOverloadedGetterSetter(t,n){const o=e.Util._capitalize(n),a=r+o,s=i+o;t.prototype[n]=function(){return arguments.length?(this[a](arguments[0]),this):this[s]()}},addDeprecatedGetterSetter(n,r,o,a){e.Util.error("Adding deprecated "+r);const s=i+e.Util._capitalize(r),l=r+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[s]=function(){e.Util.error(l);const t=this.attrs[r];return void 0===t?o:t},t.Factory.addSetter(n,r,a,function(){e.Util.error(l)}),t.Factory.addOverloadedGetterSetter(n,r)},backCompat(t,n){e.Util.each(n,function(n,o){const a=t.prototype[o],s=i+e.Util._capitalize(n),l=r+e.Util._capitalize(n);function h(){a.apply(this,arguments),e.Util.error('"'+n+'" method is deprecated and will be removed soon. Use ""'+o+'" instead.')}t.prototype[n]=h,t.prototype[s]=h,t.prototype[l]=h})},afterSetFilter(){this._filterUpToDate=!1}}}(C)),C}function A(){if(S)return d;S=1,Object.defineProperty(d,"__esModule",{value:!0}),d.Node=void 0;const t=m(),e=y(),n=T(),i=a(),r=h(),o=k(),s="absoluteOpacity",l="allEventListeners",u="absoluteTransform",c="absoluteScale",f="canvas",p="listening",g="Shape",v=" ",_="stage",b="transform",w="visible",C=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(v);let x=1,A=class n{constructor(t){this._id=x++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==b&&t!==u||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){let n=this._cache.get(t);return(void 0===n||(t===b||t===u)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map(t=>t+"Change.konva").join(v);this.on(n,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(f)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===u&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(f)){const{scene:t,filter:e,hit:n,buffer:i}=this._cache.get(f);r.Util.releaseCanvas(t,e,n,i),this._cache.delete(f)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const n=e||{};let i={};void 0!==n.x&&void 0!==n.y&&void 0!==n.width&&void 0!==n.height||(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let o=Math.ceil(n.width||i.width),a=Math.ceil(n.height||i.height),l=n.pixelRatio,h=void 0===n.x?Math.floor(i.x):n.x,u=void 0===n.y?Math.floor(i.y):n.y,d=n.offset||0,p=n.drawBorder||!1,g=n.hitCanvasPixelRatio||1;if(!o||!a)return void r.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");o+=2*d+(Math.abs(Math.round(i.x)-h)>.5?1:0),a+=2*d+(Math.abs(Math.round(i.y)-u)>.5?1:0),h-=d,u-=d;const m=new t.SceneCanvas({pixelRatio:l,width:o,height:a}),v=new t.SceneCanvas({pixelRatio:l,width:0,height:0,willReadFrequently:!0}),_=new t.HitCanvas({pixelRatio:g,width:o,height:a}),y=m.getContext(),b=_.getContext(),w=new t.SceneCanvas({width:m.width/m.pixelRatio+Math.abs(h),height:m.height/m.pixelRatio+Math.abs(u),pixelRatio:m.pixelRatio}),S=w.getContext();return _.isCache=!0,m.isCache=!0,this._cache.delete(f),this._filterUpToDate=!1,!1===n.imageSmoothingEnabled&&(m.getContext()._context.imageSmoothingEnabled=!1,v.getContext()._context.imageSmoothingEnabled=!1),y.save(),b.save(),S.save(),y.translate(-h,-u),b.translate(-h,-u),S.translate(-h,-u),w.x=h,w.y=u,this._isUnderCache=!0,this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(c),this.drawScene(m,this,w),this.drawHit(_,this),this._isUnderCache=!1,y.restore(),b.restore(),p&&(y.save(),y.beginPath(),y.rect(0,0,o,a),y.closePath(),y.setAttr("strokeStyle","red"),y.setAttr("lineWidth",5),y.stroke(),y.restore()),this._cache.set(f,{scene:m,filter:v,hit:_,buffer:w,x:h,y:u}),this._requestDraw(),this}isCached(){return this._cache.has(f)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){const n=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let i=1/0,r=1/0,o=-1/0,a=-1/0;const s=this.getAbsoluteTransform(e);return n.forEach(function(t){const e=s.point(t);void 0===i&&(i=o=e.x,r=a=e.y),i=Math.min(i,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y)}),{x:i,y:r,width:o-i,height:a-r}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);const n=this._getCachedSceneCanvas(),i=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/i,n.height/i),t.restore()}_drawCachedHitCanvas(t){const e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t,e,n,i,o=this.filters(),a=this._getCanvasCache(),s=a.scene,l=a.filter,h=l.getContext();if(o){if(!this._filterUpToDate){const a=s.pixelRatio;l.setSize(s.width/s.pixelRatio,s.height/s.pixelRatio);try{for(t=o.length,h.clear(),h.drawImage(s._canvas,0,0,s.getWidth()/a,s.getHeight()/a),e=h.getImageData(0,0,l.getWidth(),l.getHeight()),n=0;n<t;n++)i=o[n],"function"==typeof i?(i.call(this,e),h.putImageData(e,0,0)):r.Util.error("Filter should be type of function, but got "+typeof i+" instead. Please check correct filters")}catch(t){r.Util.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return l}return s}on(t,e){if(this._cache&&this._cache.delete(l),3===arguments.length)return this._delegate.apply(this,arguments);const n=t.split(v);for(let t=0;t<n.length;t++){const i=n[t].split("."),r=i[0],o=i[1]||"";this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:o,handler:e})}return this}off(t,e){let n,i,r,o,a,s,h=(t||"").split(v),u=h.length;if(this._cache&&this._cache.delete(l),!t)for(i in this.eventListeners)this._off(i);for(n=0;n<u;n++)if(r=h[n],o=r.split("."),a=o[0],s=o[1],a)this.eventListeners[a]&&this._off(a,s,e);else for(i in this.eventListeners)this._off(i,s,e);return this}dispatchEvent(t){const e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){const i=this;this.on(t,function(t){const o=t.target.findAncestors(e,!0,i);for(let e=0;e<o.length;e++)(t=r.Util.cloneObject(t)).currentTarget=o[e],n.call(o[e],t)})}remove(){return this.isDragging()&&this.stopDrag(),e.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(u),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(_),this._clearSelfAndDescendantCache(w),this._clearSelfAndDescendantCache(p)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const e="get"+r.Util._capitalize(t);return r.Util._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];for(;t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+r.Util._capitalize(e),r.Util._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(p,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(w,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,n=!1){if(t)return this._isVisible(t)&&this._isListening(t);const r=this.getLayer();let o=!1;e.DD._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===r)&&(o=!0)});const a=!n&&!i.Konva.hitOnDragEnabled&&(o||i.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!a}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t,e,n,i,r=this.getDepth(),o=this,a=0;const s=this.getStage();return"Stage"!==o.nodeType&&s&&function s(l){for(t=[],e=l.length,n=0;n<e;n++)i=l[n],a++,i.nodeType!==g&&(t=t.concat(i.getChildren().slice())),i._id===o._id&&(n=e);t.length>0&&t[0].getDepth()<=r&&s(t)}(s.getChildren()),a}getDepth(){let t=0,e=this.parent;for(;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(b),this._clearSelfAndDescendantCache(u)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const e=t.getPointerPosition();if(!e)return null;const n=this.getAbsoluteTransform().copy();return n.invert(),n.point(e)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);const i=this.getAbsoluteTransform(t).getMatrix(),o=new r.Transform,a=this.offset();return o.m=i.slice(),o.translate(a.x,a.y),o.getTranslation()}setAbsolutePosition(t){const{x:e,y:n,...i}=this._clearTransform();this.attrs.x=e,this.attrs.y=n,this._clearCache(b);const r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(t.x,t.y),t={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(i),this.setPosition({x:t.x,y:t.y}),this._clearCache(b),this._clearSelfAndDescendantCache(u),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let e=t.x,n=t.y,i=this.x(),r=this.y();return void 0!==e&&(i+=e),void 0!==n&&(r+=n),this.setPosition({x:i,y:r}),this}_eachAncestorReverse(t,e){let n,i,r=[],o=this.getParent();if(!e||e._id!==this._id){for(r.unshift(this);o&&(!e||o._id!==e._id);)r.unshift(o),o=o.parent;for(n=r.length,i=0;i<n;i++)t(r[i])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return r.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return r.Util.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return r.Util.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return r.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return r.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&r.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(s,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t,e,n,i,o,a=this.getAttrs();const s={attrs:{},className:this.getClassName()};for(t in a)e=a[t],o=r.Util.isObject(e)&&!r.Util._isPlainObject(e)&&!r.Util._isArray(e),o||(n="function"==typeof this[t]&&this[t],delete a[t],i=n?n.call(this):null,a[t]=e,i!==e&&(s.attrs[t]=e));return r.Util._prepareToStringify(s)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){const i=[];e&&this._isMatch(t)&&i.push(this);let r=this.parent;for(;r;){if(r===n)return i;r._isMatch(t)&&i.push(r),r=r.parent}return i}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);let e,n,i=t.replace(/ /g,"").split(","),o=i.length;for(e=0;e<o;e++)if(n=i[e],r.Util.isValidSelector(n)||(r.Util.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),r.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),r.Util.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(_,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(u,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new r.Transform,this._eachAncestorReverse(function(t){const n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())},t),e;{e=this._cache.get(u)||new r.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();const t=this.transformsEnabled();if("all"===t)e.multiply(this.getTransform());else if("position"===t){const t=this.attrs.x||0,n=this.attrs.y||0,i=this.attrs.offsetX||0,r=this.attrs.offsetY||0;e.translate(t-i,n-r)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;for(;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(b,this._getTransform)}_getTransform(){var t,e;const n=this._cache.get(b)||new r.Transform;n.reset();const o=this.x(),a=this.y(),s=i.Konva.getAngle(this.rotation()),l=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,h=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,u=this.attrs.skewX||0,c=this.attrs.skewY||0,d=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===o&&0===a||n.translate(o,a),0!==s&&n.rotate(s),0===u&&0===c||n.skew(u,c),1===l&&1===h||n.scale(l,h),0===d&&0===f||n.translate(-1*d,-1*f),n.dirty=!1,n}clone(t){let e,n,i,o,a,s=r.Util.cloneObject(this.attrs);for(e in t)s[e]=t[e];const l=new this.constructor(s);for(e in this.eventListeners)for(n=this.eventListeners[e],i=n.length,o=0;o<i;o++)a=n[o],a.name.indexOf("konva")<0&&(l.eventListeners[e]||(l.eventListeners[e]=[]),l.eventListeners[e].push(a));return l}_toKonvaCanvas(e){e=e||{};const n=this.getClientRect(),i=this.getStage(),r=void 0!==e.x?e.x:Math.floor(n.x),o=void 0!==e.y?e.y:Math.floor(n.y),a=e.pixelRatio||1,s=new t.SceneCanvas({width:e.width||Math.ceil(n.width)||(i?i.width():0),height:e.height||Math.ceil(n.height)||(i?i.height():0),pixelRatio:a}),l=s.getContext(),h=new t.SceneCanvas({width:s.width/s.pixelRatio+Math.abs(r),height:s.height/s.pixelRatio+Math.abs(o),pixelRatio:s.pixelRatio});return!1===e.imageSmoothingEnabled&&(l._context.imageSmoothingEnabled=!1),l.save(),(r||o)&&l.translate(-1*r,-1*o),this.drawScene(s,void 0,h),l.restore(),s}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){const e=(t=t||{}).mimeType||null,n=t.quality||null,i=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(i),i}toImage(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,r.Util._urlToImage(this.toDataURL(t),function(t){e(t),null==n||n(t)})}catch(t){n(t)}})}toBlob(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==n||n(t)},null==t?void 0:t.mimeType,null==t?void 0:t.quality)}catch(t){n(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():i.Konva.dragDistance}_off(t,e,n){let i,r,o,a=this.eventListeners[t];for(i=0;i<a.length;i++)if(r=a[i].name,o=a[i].handler,!("konva"===r&&"konva"!==e||e&&r!==e||n&&n!==o)){if(a.splice(i,1),0===a.length){delete this.eventListeners[t];break}i--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){const e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;return-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){const e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){const n=this["set"+r.Util._capitalize(t)];return r.Util._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(i.Konva.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){const n=this.attrs[t];(n!==e||r.Util.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){let i;void 0!==n&&(i=this.attrs[t],i||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,i,n))}_fireAndBubble(t,e,n){e&&this.nodeType===g&&(e.target=this);const i=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(!(-1!==i.indexOf(t)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(t,e);const r=-1!==i.indexOf(t)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!r&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,n,i;const r=null!==(e=this._cache.get(l))&&void 0!==e?e:{};let o=null==r?void 0:r[t];if(void 0===o){o=[];let e=Object.getPrototypeOf(this);for(;e;){const r=null!==(i=null===(n=e.eventListeners)||void 0===n?void 0:n[t])&&void 0!==i?i:[];o.push(...r),e=Object.getPrototypeOf(e)}r[t]=o,this._cache.set(l,r)}return o}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(let t=0;t<n.length;t++)n[t].handler.call(this,e);const i=this.eventListeners[t];if(i)for(let t=0;t<i.length;t++)i[t].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const n=t?t.pointerId:void 0,i=this.getStage(),r=this.getAbsolutePosition();if(!i)return;const o=i._getPointerById(n)||i._changedPointerPositions[0]||r;e.DD._dragElements.set(this._id,{node:this,startPointerPos:o,offset:{x:o.x-r.x,y:o.y-r.y},dragStatus:"ready",pointerId:n})}startDrag(t,n=!0){e.DD._dragElements.has(this._id)||this._createDragElement(t);e.DD._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},n)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(!n)return;let i={x:n.x-e.offset.x,y:n.y-e.offset.y};const o=this.dragBoundFunc();if(void 0!==o){const e=o.call(this,i,t);e?i=e:r.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(t){const n=e.DD._dragElements.get(this._id);n&&(n.dragStatus="stopped"),e.DD._endDragBefore(t),e.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=e.DD._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(!(void 0!==t.evt.button)||i.Konva.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let n=!1;e.DD._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(n=!0)}),n||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();if(!this.getStage())return;const t=e.DD._dragElements.get(this._id),n=t&&"dragging"===t.dragStatus,i=t&&"ready"===t.dragStatus;n?this.stopDrag():i&&e.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return r.Util.haveIntersection(n,this.getClientRect())}static create(t,e){return r.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){let o,a,s,l=n.prototype.getClassName.call(t),h=t.children;e&&(t.attrs.container=e),i.Konva[l]||(r.Util.warn('Can not find a node with class name "'+l+'". Fallback to "Shape".'),l="Shape");if(o=new(0,i.Konva[l])(t.attrs),h)for(a=h.length,s=0;s<a;s++)o.add(n._createNode(h[s]));return o}};d.Node=A,A.prototype.nodeType="Node",A.prototype._attrsAffectingSize=[],A.prototype.eventListeners={},A.prototype.on.call(A.prototype,C,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(b),this._clearSelfAndDescendantCache(u))}),A.prototype.on.call(A.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(w)}),A.prototype.on.call(A.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(p)}),A.prototype.on.call(A.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(s)});const P=n.Factory.addGetterSetter;return P(A,"zIndex"),P(A,"absolutePosition"),P(A,"position"),P(A,"x",0,(0,o.getNumberValidator)()),P(A,"y",0,(0,o.getNumberValidator)()),P(A,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),P(A,"opacity",1,(0,o.getNumberValidator)()),P(A,"name","",(0,o.getStringValidator)()),P(A,"id","",(0,o.getStringValidator)()),P(A,"rotation",0,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(A,"scale",["x","y"]),P(A,"scaleX",1,(0,o.getNumberValidator)()),P(A,"scaleY",1,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(A,"skew",["x","y"]),P(A,"skewX",0,(0,o.getNumberValidator)()),P(A,"skewY",0,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(A,"offset",["x","y"]),P(A,"offsetX",0,(0,o.getNumberValidator)()),P(A,"offsetY",0,(0,o.getNumberValidator)()),P(A,"dragDistance",void 0,(0,o.getNumberValidator)()),P(A,"width",0,(0,o.getNumberValidator)()),P(A,"height",0,(0,o.getNumberValidator)()),P(A,"listening",!0,(0,o.getBooleanValidator)()),P(A,"preventDefault",!0,(0,o.getBooleanValidator)()),P(A,"filters",void 0,function(t){return this._filterUpToDate=!1,t}),P(A,"visible",!0,(0,o.getBooleanValidator)()),P(A,"transformsEnabled","all",(0,o.getStringValidator)()),P(A,"size"),P(A,"dragBoundFunc"),P(A,"draggable",!1,(0,o.getBooleanValidator)()),n.Factory.backCompat(A,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),d}var P,E={};function I(){if(P)return E;P=1,Object.defineProperty(E,"__esModule",{value:!0}),E.Container=void 0;const t=T(),e=A(),n=k();let i=class extends e.Node{constructor(){super(...arguments),this.children=[]}getChildren(t){const e=this.children||[];return t?e.filter(t):e}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(let e=0;e<t.length;e++)this.add(t[e]);return this}const e=t[0];return e.getParent()?(e.moveTo(this),this):(this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){const n=[];return this._descendants(i=>{const r=i._isMatch(t);return r&&n.push(i),!(!r||!e)}),n}_descendants(t){let e=!1;const n=this.getChildren();for(const i of n){if(e=t(i),e)return!0;if(i.hasChildren()&&(e=i._descendants(t),e))return!0}return!1}toObject(){const t=e.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();for(;e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){const n=e.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(t){n.add(t.clone())}),n}getAllIntersections(t){const e=[];return this.find("Shape").forEach(n=>{n.isVisible()&&n.intersects(t)&&e.push(n)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach(function(e){e._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach(function(t,e){t.index=e}),this._requestDraw()}drawScene(t,e,n){const i=this.getLayer(),r=t||i&&i.getCanvas(),o=r&&r.getContext(),a=this._getCanvasCache(),s=a&&a.scene,l=r&&r.isCache;if(!this.isVisible()&&!l)return this;if(s){o.save();const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",r,e,n);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;const n=this.getLayer(),i=t||n&&n.hitCanvas,r=i&&i.getContext(),o=this._getCanvasCache();if(o&&o.hit){r.save();const t=this.getAbsoluteTransform(e).getMatrix();r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(r),r.restore()}else this._drawChildren("drawHit",i,e);return this}_drawChildren(t,e,n,i){var r;const o=e&&e.getContext(),a=this.clipWidth(),s=this.clipHeight(),l=this.clipFunc(),h="number"==typeof a&&"number"==typeof s||l,u=n===this;if(h){o.save();const t=this.getAbsoluteTransform(n);let e,i=t.getMatrix();if(o.transform(i[0],i[1],i[2],i[3],i[4],i[5]),o.beginPath(),l)e=l.call(this,o,this);else{const t=this.clipX(),e=this.clipY();o.rect(t||0,e||0,a,s)}o.clip.apply(o,e),i=t.copy().invert().getMatrix(),o.transform(i[0],i[1],i[2],i[3],i[4],i[5])}const c=!u&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;c&&(o.save(),o._applyGlobalCompositeOperation(this)),null===(r=this.children)||void 0===r||r.forEach(function(r){r[t](e,n,i)}),c&&o.restore(),h&&o.restore()}getClientRect(t={}){var e;const n=t.skipTransform,i=t.relativeTo;let r,o,a,s,l={x:1/0,y:1/0,width:0,height:0};const h=this;null===(e=this.children)||void 0===e||e.forEach(function(e){if(!e.visible())return;const n=e.getClientRect({relativeTo:h,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===n.width&&0===n.height||(void 0===r?(r=n.x,o=n.y,a=n.x+n.width,s=n.y+n.height):(r=Math.min(r,n.x),o=Math.min(o,n.y),a=Math.max(a,n.x+n.width),s=Math.max(s,n.y+n.height)))});const u=this.find("Shape");let c=!1;for(let t=0;t<u.length;t++){if(u[t]._isVisible(this)){c=!0;break}}return l=c&&void 0!==r?{x:r,y:o,width:a-r,height:s-o}:{x:0,y:0,width:0,height:0},n?l:this._transformedRect(l,i)}};return E.Container=i,t.Factory.addComponentsGetterSetter(i,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(i,"clipX",void 0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(i,"clipY",void 0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(i,"clipWidth",void 0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(i,"clipHeight",void 0,(0,n.getNumberValidator)()),t.Factory.addGetterSetter(i,"clipFunc"),E}var D,M,L={},O={};function R(){if(D)return O;D=1,Object.defineProperty(O,"__esModule",{value:!0}),O.getCapturedShape=function(t){return e.get(t)},O.createEvent=i,O.hasPointerCapture=function(t,n){return e.get(t)===n},O.setPointerCapture=function(t,o){r(t);if(!o.getStage())return;e.set(t,o),n&&o._fire("gotpointercapture",i(new PointerEvent("gotpointercapture")))},O.releaseCapture=r;const t=a(),e=new Map,n=void 0!==t.Konva._global.PointerEvent;function i(t){return{evt:t,pointerId:t.pointerId}}function r(t,r){const o=e.get(t);if(!o)return;const a=o.getStage();a&&a.content,e.delete(t),n&&o._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return O}var F,B,W={},U={};function G(){return F||(F=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=a(),n=h(),i=T(),r=A(),o=k(),s=a(),l=R(),u="hasShadow",c="shadowRGBA",d="patternImage",f="linearGradient",p="radialGradient";let g;function m(){return g||(g=n.Util.createCanvasElement().getContext("2d"),g)}t.shapes={};class v extends r.Node{constructor(e){let i;for(super(e);i=n.Util.getRandomColor(),!i||i in t.shapes;);this.colorKey=i,t.shapes[i]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(u,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(d,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=m().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const i=new n.Transform;i.translate(this.fillPatternX(),this.fillPatternY()),i.rotate(e.Konva.getAngle(this.fillPatternRotation())),i.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),i.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const r=i.getMatrix(),o="undefined"==typeof DOMMatrix?{a:r[0],b:r[1],c:r[2],d:r[3],e:r[4],f:r[5]}:new DOMMatrix(r);t.setTransform(o)}return t}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){const t=this.fillLinearGradientColorStops();if(t){const e=m(),n=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),r=e.createLinearGradient(n.x,n.y,i.x,i.y);for(let e=0;e<t.length;e+=2)r.addColorStop(t[e],t[e+1]);return r}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){const t=this.fillRadialGradientColorStops();if(t){const e=m(),n=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),r=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius());for(let e=0;e<t.length;e+=2)r.addColorStop(t[e],t[e+1]);return r}}getShadowRGBA(){return this._getCache(c,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const t=n.Util.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){const e=this.getStage();if(!e)return!1;const n=e.bufferHitCanvas;n.getContext().clear(),this.drawHit(n,void 0,!0);return n.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return r.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const n=t||this.hasFill(),i=this.hasStroke(),r=1!==this.getAbsoluteOpacity();if(n&&i&&r)return!0;const o=this.hasShadow(),a=this.shadowForStrokeEnabled();return!!(n&&i&&o&&a)}setStrokeHitEnabled(t){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,n=this.getParent();for(;n;){if(n.isCached()){e=!0;break}n=n.getParent()}const i=t.skipTransform,r=t.relativeTo||e&&this.getStage()||void 0,o=this.getSelfRect(),a=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,s=o.width+a,l=o.height+a,h=!t.skipShadow&&this.hasShadow(),u=h?this.shadowOffsetX():0,c=h?this.shadowOffsetY():0,d=s+Math.abs(u),f=l+Math.abs(c),p=h&&this.shadowBlur()||0,g={width:d+2*p,height:f+2*p,x:-(a/2+p)+Math.min(u,0)+o.x,y:-(a/2+p)+Math.min(c,0)+o.y};return i?g:this._transformedRect(g,r)}drawScene(t,e,n){const i=this.getLayer(),r=(t||i.getCanvas()).getContext(),o=this._getCanvasCache(),a=this.getSceneFunc(),s=this.hasShadow();let l;const h=e===this;if(!this.isVisible()&&!h)return this;if(o){r.save();const t=this.getAbsoluteTransform(e).getMatrix();return r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(r),r.restore(),this}if(!a)return this;if(r.save(),this._useBufferCanvas()){l=this.getStage();const t=n||l.bufferCanvas,i=t.getContext();i.clear(),i.save(),i._applyLineJoin(this);const o=this.getAbsoluteTransform(e).getMatrix();i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),a.call(this,i,this),i.restore();const h=t.pixelRatio;s&&r._applyShadow(this),r._applyOpacity(this),r._applyGlobalCompositeOperation(this),r.drawImage(t._canvas,t.x||0,t.y||0,t.width/h,t.height/h)}else{if(r._applyLineJoin(this),!h){const t=this.getAbsoluteTransform(e).getMatrix();r.transform(t[0],t[1],t[2],t[3],t[4],t[5]),r._applyOpacity(this),r._applyGlobalCompositeOperation(this)}s&&r._applyShadow(this),a.call(this,r,this)}return r.restore(),this}drawHit(t,e,i=!1){if(!this.shouldDrawHit(e,i))return this;const r=this.getLayer(),o=t||r.hitCanvas,a=o&&o.getContext(),s=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),h=l&&l.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),h){a.save();const t=this.getAbsoluteTransform(e).getMatrix();return a.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(a),a.restore(),this}if(!s)return this;a.save(),a._applyLineJoin(this);if(!(this===e)){const t=this.getAbsoluteTransform(e).getMatrix();a.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return s.call(this,a,this),a.restore(),this}drawHitFromCache(t=0){const e=this._getCanvasCache(),i=this._getCachedSceneCanvas(),r=e.hit,o=r.getContext(),a=r.getWidth(),s=r.getHeight();o.clear(),o.drawImage(i._canvas,0,0,a,s);try{const e=o.getImageData(0,0,a,s),i=e.data,r=i.length,l=n.Util._hexToRgb(this.colorKey);for(let e=0;e<r;e+=4){i[e+3]>t?(i[e]=l.r,i[e+1]=l.g,i[e+2]=l.b,i[e+3]=255):i[e+3]=0}o.putImageData(e,0,0)}catch(t){n.Util.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return l.hasPointerCapture(t,this)}setPointerCapture(t){l.setPointerCapture(t,this)}releaseCapture(t){l.releaseCapture(t,this)}}t.Shape=v,v.prototype._fillFunc=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},v.prototype._strokeFunc=function(t){t.stroke()},v.prototype._fillFuncHit=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},v.prototype._strokeFuncHit=function(t){t.stroke()},v.prototype._centroid=!1,v.prototype.nodeType="Shape",(0,s._registerNode)(v),v.prototype.eventListeners={},v.prototype.on.call(v.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(u)}),v.prototype.on.call(v.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(c)}),v.prototype.on.call(v.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(d)}),v.prototype.on.call(v.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(f)}),v.prototype.on.call(v.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(p)}),i.Factory.addGetterSetter(v,"stroke",void 0,(0,o.getStringOrGradientValidator)()),i.Factory.addGetterSetter(v,"strokeWidth",2,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillAfterStrokeEnabled",!1),i.Factory.addGetterSetter(v,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),i.Factory.addGetterSetter(v,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),i.Factory.addGetterSetter(v,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),i.Factory.addGetterSetter(v,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),i.Factory.addGetterSetter(v,"lineJoin"),i.Factory.addGetterSetter(v,"lineCap"),i.Factory.addGetterSetter(v,"sceneFunc"),i.Factory.addGetterSetter(v,"hitFunc"),i.Factory.addGetterSetter(v,"dash"),i.Factory.addGetterSetter(v,"dashOffset",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"shadowColor",void 0,(0,o.getStringValidator)()),i.Factory.addGetterSetter(v,"shadowBlur",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"shadowOpacity",1,(0,o.getNumberValidator)()),i.Factory.addComponentsGetterSetter(v,"shadowOffset",["x","y"]),i.Factory.addGetterSetter(v,"shadowOffsetX",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"shadowOffsetY",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillPatternImage"),i.Factory.addGetterSetter(v,"fill",void 0,(0,o.getStringOrGradientValidator)()),i.Factory.addGetterSetter(v,"fillPatternX",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillPatternY",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillLinearGradientColorStops"),i.Factory.addGetterSetter(v,"strokeLinearGradientColorStops"),i.Factory.addGetterSetter(v,"fillRadialGradientStartRadius",0),i.Factory.addGetterSetter(v,"fillRadialGradientEndRadius",0),i.Factory.addGetterSetter(v,"fillRadialGradientColorStops"),i.Factory.addGetterSetter(v,"fillPatternRepeat","repeat"),i.Factory.addGetterSetter(v,"fillEnabled",!0),i.Factory.addGetterSetter(v,"strokeEnabled",!0),i.Factory.addGetterSetter(v,"shadowEnabled",!0),i.Factory.addGetterSetter(v,"dashEnabled",!0),i.Factory.addGetterSetter(v,"strokeScaleEnabled",!0),i.Factory.addGetterSetter(v,"fillPriority","color"),i.Factory.addComponentsGetterSetter(v,"fillPatternOffset",["x","y"]),i.Factory.addGetterSetter(v,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),i.Factory.addComponentsGetterSetter(v,"fillPatternScale",["x","y"]),i.Factory.addGetterSetter(v,"fillPatternScaleX",1,(0,o.getNumberValidator)()),i.Factory.addGetterSetter(v,"fillPatternScaleY",1,(0,o.getNumberValidator)()),i.Factory.addComponentsGetterSetter(v,"fillLinearGradientStartPoint",["x","y"]),i.Factory.addComponentsGetterSetter(v,"strokeLinearGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(v,"fillLinearGradientStartPointX",0),i.Factory.addGetterSetter(v,"strokeLinearGradientStartPointX",0),i.Factory.addGetterSetter(v,"fillLinearGradientStartPointY",0),i.Factory.addGetterSetter(v,"strokeLinearGradientStartPointY",0),i.Factory.addComponentsGetterSetter(v,"fillLinearGradientEndPoint",["x","y"]),i.Factory.addComponentsGetterSetter(v,"strokeLinearGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(v,"fillLinearGradientEndPointX",0),i.Factory.addGetterSetter(v,"strokeLinearGradientEndPointX",0),i.Factory.addGetterSetter(v,"fillLinearGradientEndPointY",0),i.Factory.addGetterSetter(v,"strokeLinearGradientEndPointY",0),i.Factory.addComponentsGetterSetter(v,"fillRadialGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(v,"fillRadialGradientStartPointX",0),i.Factory.addGetterSetter(v,"fillRadialGradientStartPointY",0),i.Factory.addComponentsGetterSetter(v,"fillRadialGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(v,"fillRadialGradientEndPointX",0),i.Factory.addGetterSetter(v,"fillRadialGradientEndPointY",0),i.Factory.addGetterSetter(v,"fillPatternRotation",0),i.Factory.addGetterSetter(v,"fillRule",void 0,(0,o.getStringValidator)()),i.Factory.backCompat(v,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(U)),U}function N(){if(B)return W;B=1,Object.defineProperty(W,"__esModule",{value:!0}),W.Layer=void 0;const t=h(),e=I(),n=A(),i=T(),r=m(),o=k(),s=G(),l=a(),u=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],c=u.length;let d=class extends e.Container{constructor(t){super(t),this.canvas=new r.SceneCanvas,this.hitCanvas=new r.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!n.Node.prototype.moveUp.call(this))return!1;const t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),e&&e.parentNode&&t.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(e){const n=e.getType();"Group"!==n&&"Shape"!==n&&t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,n=!1;for(;;){for(let i=0;i<c;i++){const r=u[i],o=this._getIntersection({x:t.x+r.x*e,y:t.y+r.y*e}),a=o.shape;if(a)return a;if(n=!!o.antialiased,!o.antialiased)break}if(!n)return null;e+=1}}_getIntersection(e){const n=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(e.x*n),Math.round(e.y*n),1,1).data,r=i[3];if(255===r){const e=t.Util._rgbToHex(i[0],i[1],i[2]),n=s.shapes["#"+e];return n?{shape:n}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}drawScene(t,n,i){const r=this.getLayer(),o=t||r&&r.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&o.getContext().clear(),e.Container.prototype.drawScene.call(this,o,n,i),this._fire("draw",{node:this}),this}drawHit(t,n){const i=this.getLayer(),r=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),e.Container.prototype.drawHit.call(this,r,n),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return W.Layer=d,d.prototype.nodeType="Layer",(0,l._registerNode)(d),i.Factory.addGetterSetter(d,"imageSmoothingEnabled",!0),i.Factory.addGetterSetter(d,"clearBeforeDraw",!0),i.Factory.addGetterSetter(d,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),W}var z,H={};var V,j={};var X,Y={};function Z(){if(X)return Y;X=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.Animation=void 0;const t=a(),e=h(),n=t.glob.performance&&t.glob.performance.now?function(){return t.glob.performance.now()}:function(){return(new Date).getTime()};let i=class t{constructor(e,i){this.id=t.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=e,this.setLayers(i)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,n=e.length;for(let i=0;i<n;i++)if(e[i]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const e=t.animations,n=e.length;for(let t=0;t<n;t++)if(e[t].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),t._addAnimation(this),this}stop(){return t._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,n=this.animations,i=n.length;for(let t=0;t<i;t++)if(n[t].id===e){this.animations.splice(t,1);break}}static _runFrames(){const t={},e=this.animations;for(let i=0;i<e.length;i++){const r=e[i],o=r.layers,a=r.func;r._updateFrameObject(n());const s=o.length;let l;if(l=!a||!1!==a.call(r,r.frame),l)for(let e=0;e<s;e++){const n=o[e];void 0!==n._id&&(t[n._id]=n)}}for(const e in t)t.hasOwnProperty(e)&&t[e].batchDraw()}static _animationLoop(){const n=t;n.animations.length?(n._runFrames(),e.Util.requestAnimFrame(n._animationLoop)):n.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,e.Util.requestAnimFrame(this._animationLoop))}};return Y.Animation=i,i.animations=[],i.animIdCounter=0,i.animRunning=!1,Y}var K,q,J,Q={};function $(){return q||(q=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=a(),n=h(),i=A(),r=I(),o=(M||(M=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=h(),n=T(),i=I(),r=a(),o=m(),s=y(),l=a(),u=R(),c="mouseleave",d="mouseover",f="mouseenter",p="mousemove",g="mousedown",v="mouseup",_="pointermove",b="pointerdown",w="pointerup",S="pointercancel",C="pointerout",x="pointerleave",k="pointerover",A="pointerenter",P="contextmenu",E="touchstart",D="touchend",M="touchmove",L="touchcancel",O="wheel",F=[[f,"_pointerenter"],[g,"_pointerdown"],[p,"_pointermove"],[v,"_pointerup"],[c,"_pointerleave"],[E,"_pointerdown"],[M,"_pointermove"],[D,"_pointerup"],[L,"_pointercancel"],[d,"_pointerover"],[O,"_wheel"],[P,"_contextmenu"],[b,"_pointerdown"],[_,"_pointermove"],[w,"_pointerup"],[S,"_pointercancel"],[x,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],B={mouse:{[C]:"mouseout",[x]:c,[k]:d,[A]:f,[_]:p,[b]:g,[w]:v,[S]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[C]:"touchout",[x]:"touchleave",[k]:"touchover",[A]:"touchenter",[_]:M,[b]:E,[w]:D,[S]:L,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[C]:C,[x]:x,[k]:k,[A]:A,[_]:_,[b]:b,[w]:w,[S]:S,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},W=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",U=t=>{const e=W(t);return"pointer"===e?r.Konva.pointerEventsEnabled&&B.pointer:"touch"===e?B.touch:"mouse"===e?B.mouse:void 0};function G(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}t.stages=[];class N extends i.Container{constructor(e){super(G(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{G(this.attrs)}),this._checkVisibility()}_validateAdd(t){const n="Layer"===t.getType(),i="FastLayer"===t.getType();n||i||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){let e;if("."===t.charAt(0)){const e=t.slice(1);t=document.getElementsByClassName(e)[0]}else e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e);if(!t)throw"Can not find container in document with id "+e}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const t=this.children,e=t.length;for(let n=0;n<e;n++)t[n].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),i.Container.prototype.clone.call(this,t)}destroy(){super.destroy();const n=this.content;n&&e.Util._isInDocument(n)&&this.container().removeChild(n);const i=t.stages.indexOf(this);return i>-1&&t.stages.splice(i,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(e.Util.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();const e=new o.SceneCanvas({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,i=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),i.forEach(function(e){if(!e.isVisible())return;const i=e._toKonvaCanvas(t);n.drawImage(i._canvas,t.x,t.y,i.getWidth()/i.getPixelRatio(),i.getHeight()/i.getPixelRatio())}),e}getIntersection(t){if(!t)return null;const e=this.children;for(let n=e.length-1;n>=0;n--){const i=e[n].getIntersection(t);if(i)return i}return null}_resizeDOM(){const t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(n=>{n.setSize({width:t,height:e}),n.draw()})}add(t,...n){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}super.add(t);const i=this.children.length;return i>5&&e.Util.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),r.Konva.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return u.hasPointerCapture(t,this)}setPointerCapture(t){u.setPointerCapture(t,this)}releaseCapture(t){u.releaseCapture(t,this)}getLayers(){return this.children}_bindContentEvents(){r.Konva.isBrowser&&F.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=U(t.type);e&&this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=U(t.type);e&&this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=U(t.type),n=W(t.type);if(!e)return;this.setPointersPositions(t);const i=this._getTargetShape(n),o=!(r.Konva.isDragging()||r.Konva.isTransforming())||r.Konva.hitOnDragEnabled;i&&o?(i._fireAndBubble(e.pointerout,{evt:t}),i._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[n+"targetShape"]=null):o&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){const e=U(t.type),n=W(t.type);if(!e)return;this.setPointersPositions(t);let i=!1;this._changedPointerPositions.forEach(o=>{const a=this.getIntersection(o);if(s.DD.justDragged=!1,r.Konva["_"+n+"ListenClick"]=!0,!a||!a.isListening())return void(this[n+"ClickStartShape"]=void 0);r.Konva.capturePointerEventsEnabled&&a.setPointerCapture(o.id),this[n+"ClickStartShape"]=a,a._fireAndBubble(e.pointerdown,{evt:t,pointerId:o.id}),i=!0;const l=t.type.indexOf("touch")>=0;a.preventDefault()&&t.cancelable&&l&&t.preventDefault()}),i||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){const e=U(t.type),n=W(t.type);if(!e)return;if(r.Konva.isDragging()&&s.DD.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t),(r.Konva.isDragging()||r.Konva.isTransforming())&&!r.Konva.hitOnDragEnabled)return;const i={};let o=!1;const a=this._getTargetShape(n);this._changedPointerPositions.forEach(r=>{const s=u.getCapturedShape(r.id)||this.getIntersection(r),l=r.id,h={evt:t,pointerId:l},c=a!==s;if(c&&a&&(a._fireAndBubble(e.pointerout,{...h},s),a._fireAndBubble(e.pointerleave,{...h},s)),s){if(i[s._id])return;i[s._id]=!0}s&&s.isListening()?(o=!0,c&&(s._fireAndBubble(e.pointerover,{...h},a),s._fireAndBubble(e.pointerenter,{...h},a),this[n+"targetShape"]=s),s._fireAndBubble(e.pointermove,{...h})):a&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[n+"targetShape"]=null)}),o||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=U(t.type),n=W(t.type);if(!e)return;this.setPointersPositions(t);const i=this[n+"ClickStartShape"],o=this[n+"ClickEndShape"],a={};let l=!1;this._changedPointerPositions.forEach(h=>{const c=u.getCapturedShape(h.id)||this.getIntersection(h);if(c){if(c.releaseCapture(h.id),a[c._id])return;a[c._id]=!0}const d=h.id,f={evt:t,pointerId:d};let p=!1;r.Konva["_"+n+"InDblClickWindow"]?(p=!0,clearTimeout(this[n+"DblTimeout"])):s.DD.justDragged||(r.Konva["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout(function(){r.Konva["_"+n+"InDblClickWindow"]=!1},r.Konva.dblClickWindow),c&&c.isListening()?(l=!0,this[n+"ClickEndShape"]=c,c._fireAndBubble(e.pointerup,{...f}),r.Konva["_"+n+"ListenClick"]&&i&&i===c&&(c._fireAndBubble(e.pointerclick,{...f}),p&&o&&o===c&&c._fireAndBubble(e.pointerdblclick,{...f}))):(this[n+"ClickEndShape"]=null,r.Konva["_"+n+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:d}),p&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:d}))}),l||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r.Konva["_"+n+"ListenClick"]=!1,t.cancelable&&"touch"!==n&&"pointer"!==n&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(P,{evt:t}):this._fire(P,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(O,{evt:t}):this._fire(O,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=u.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(w,u.createEvent(t)),u.releaseCapture(t.pointerId)}_lostpointercapture(t){u.releaseCapture(t.pointerId)}setPointersPositions(t){const n=this._getContentPosition();let i=null,r=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-n.left)/n.scaleX,y:(t.clientY-n.top)/n.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-n.left)/n.scaleX,y:(t.clientY-n.top)/n.scaleY})})):(i=(t.clientX-n.left)/n.scaleX,r=(t.clientY-n.top)/n.scaleY,this.pointerPos={x:i,y:r},this._pointerPositions=[{x:i,y:r,id:e.Util._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:r,id:e.Util._getFirstPointerId(t)}])}_setPointerPosition(t){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!r.Konva.isBrowser)return;const t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}t.Stage=N,N.prototype.nodeType="Stage",(0,l._registerNode)(N),n.Factory.addGetterSetter(N,"container"),r.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{t.stages.forEach(t=>{t.batchDraw()})})}(L)),L),s=N(),l=function(){if(z)return H;z=1,Object.defineProperty(H,"__esModule",{value:!0}),H.FastLayer=void 0;const t=h(),e=N(),n=a();let i=class extends e.Layer{constructor(e){super(e),this.listening(!1),t.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return H.FastLayer=i,i.prototype.nodeType="FastLayer",(0,n._registerNode)(i),H}(),u=function(){if(V)return j;V=1,Object.defineProperty(j,"__esModule",{value:!0}),j.Group=void 0;const t=h(),e=I(),n=a();let i=class extends e.Container{_validateAdd(e){const n=e.getType();"Group"!==n&&"Shape"!==n&&t.Util.throw("You may only add groups and shapes to groups.")}};return j.Group=i,i.prototype.nodeType="Group",(0,n._registerNode)(i),j}(),c=y(),d=G(),f=Z(),p=(K||(K=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=h(),n=Z(),i=A(),r=a(),o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=["fill","stroke","shadowColor"];let l=0;class u{constructor(t,e,n,i,r,o,a){this.prop=t,this.propFunc=e,this.begin=i,this._pos=i,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=r-this.begin,this.pause()}fire(t){const e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class c{constructor(i){const a=this,s=i.node,h=s._id,d=i.easing||t.Easings.Linear,f=!!i.yoyo;let p,g;p=void 0===i.duration?.3:0===i.duration?.001:i.duration,this.node=s,this._id=l++;const m=s.getLayer()||(s instanceof r.Konva.Stage?s.getLayers():null);for(g in m||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){a.tween.onEnterFrame()},m),this.tween=new u(g,function(t){a._tweenFunc(t)},d,0,1,1e3*p,f),this._addListeners(),c.attrs[h]||(c.attrs[h]={}),c.attrs[h][this._id]||(c.attrs[h][this._id]={}),c.tweens[h]||(c.tweens[h]={}),i)void 0===o[g]&&this._addAttr(g,i[g]);this.reset(),this.onFinish=i.onFinish,this.onReset=i.onReset,this.onUpdate=i.onUpdate}_addAttr(t,n){const i=this.node,r=i._id;let o,a,l,h,u;const d=c.tweens[r][t];d&&delete c.attrs[r][d][t];let f=i.getAttr(t);if(e.Util._isArray(n))if(o=[],a=Math.max(n.length,f.length),"points"===t&&n.length!==f.length&&(n.length>f.length?(h=f,f=e.Util._prepareArrayForTween(f,n,i.closed())):(l=n,n=e.Util._prepareArrayForTween(n,f,i.closed()))),0===t.indexOf("fill"))for(let t=0;t<a;t++)if(t%2==0)o.push(n[t]-f[t]);else{const i=e.Util.colorToRGBA(f[t]);u=e.Util.colorToRGBA(n[t]),f[t]=i,o.push({r:u.r-i.r,g:u.g-i.g,b:u.b-i.b,a:u.a-i.a})}else for(let t=0;t<a;t++)o.push(n[t]-f[t]);else-1!==s.indexOf(t)?(f=e.Util.colorToRGBA(f),u=e.Util.colorToRGBA(n),o={r:u.r-f.r,g:u.g-f.g,b:u.b-f.b,a:u.a-f.a}):o=n-f;c.attrs[r][this._id][t]={start:f,diff:o,end:n,trueEnd:l,trueStart:h},c.tweens[r][t]=this._id}_tweenFunc(t){const n=this.node,i=c.attrs[n._id][this._id];let r,o,a,l,h,u,d,f;for(r in i){if(o=i[r],a=o.start,l=o.diff,f=o.end,e.Util._isArray(a))if(h=[],d=Math.max(a.length,f.length),0===r.indexOf("fill"))for(u=0;u<d;u++)u%2==0?h.push((a[u]||0)+l[u]*t):h.push("rgba("+Math.round(a[u].r+l[u].r*t)+","+Math.round(a[u].g+l[u].g*t)+","+Math.round(a[u].b+l[u].b*t)+","+(a[u].a+l[u].a*t)+")");else for(u=0;u<d;u++)h.push((a[u]||0)+l[u]*t);else h=-1!==s.indexOf(r)?"rgba("+Math.round(a.r+l.r*t)+","+Math.round(a.g+l.g*t)+","+Math.round(a.b+l.b*t)+","+(a.a+l.a*t)+")":a+l*t;n.setAttr(r,h)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const t=this.node,e=c.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const t=this.node,e=c.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const t=this.node._id,e=this._id,n=c.tweens[t];this.pause(),this.anim&&this.anim.stop();for(const e in n)delete c.tweens[t][e];delete c.attrs[t][e],c.tweens[t]&&(0===Object.keys(c.tweens[t]).length&&delete c.tweens[t],0===Object.keys(c.attrs[t]).length&&delete c.attrs[t])}}t.Tween=c,c.attrs={},c.tweens={},i.Node.prototype.to=function(t){const e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new c(t).play()},t.Easings={BackEaseIn(t,e,n,i){const r=1.70158;return n*(t/=i)*t*((r+1)*t-r)+e},BackEaseOut(t,e,n,i){const r=1.70158;return n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut(t,e,n,i){let r=1.70158;return(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn(t,e,n,i,r,o){let a=0;return 0===t?e:1===(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,n,i,r,o){let a=0;return 0===t?e:1===(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-a)*(2*Math.PI)/o)+n+e)},ElasticEaseInOut(t,e,n,i,r,o){let a=0;return 0===t?e:2==(t/=i/2)?e+n:(o||(o=i*(.3*1.5)),!r||r<Math.abs(n)?(r=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)*.5+n+e)},BounceEaseOut:(t,e,n,i)=>(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(e,n,i,r)=>i-t.Easings.BounceEaseOut(r-e,0,i,r)+n,BounceEaseInOut:(e,n,i,r)=>e<r/2?.5*t.Easings.BounceEaseIn(2*e,0,i,r)+n:.5*t.Easings.BounceEaseOut(2*e-r,0,i,r)+.5*i+n,EaseIn:(t,e,n,i)=>n*(t/=i)*t+e,EaseOut:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,EaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,i)=>n*(t/=i)*t*t*t*t+e,StrongEaseOut:(t,e,n,i)=>n*((t=t/i-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,i)=>n*t/i+e}}(Q)),Q),v=g(),_=m();t.Konva=n.Util._assign(e.Konva,{Util:n.Util,Transform:n.Transform,Node:i.Node,Container:r.Container,Stage:o.Stage,stages:o.stages,Layer:s.Layer,FastLayer:l.FastLayer,Group:u.Group,DD:c.DD,Shape:d.Shape,shapes:d.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:v.Context,Canvas:_.Canvas}),t.default=t.Konva}(r)),r}var tt,et=e((J||(J=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var n=$();Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return n.Konva}});const i=$();t.exports=i.Konva}(i,i.exports)),i.exports)),nt={};var it,rt=function(){if(tt)return nt;tt=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.Line=void 0;const t=T(),e=a(),n=G(),i=k();function r(t,e,n,i,r,o,a){const s=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2)),l=Math.sqrt(Math.pow(r-n,2)+Math.pow(o-i,2)),h=a*s/(s+l),u=a*l/(s+l);return[n-h*(r-t),i-h*(o-e),n+u*(r-t),i+u*(o-e)]}function o(t,e){const n=t.length,i=[];for(let o=2;o<n-2;o+=2){const n=r(t[o-2],t[o-1],t[o],t[o+1],t[o+2],t[o+3],e);isNaN(n[0])||(i.push(n[0]),i.push(n[1]),i.push(t[o]),i.push(t[o+1]),i.push(n[2]),i.push(n[3]))}return i}let s=class extends n.Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){const e=this.points(),n=e.length,i=this.tension(),r=this.closed(),o=this.bezier();if(!n)return;let a=0;if(t.beginPath(),t.moveTo(e[0],e[1]),0!==i&&n>4){const i=this.getTensionPoints(),o=i.length;for(a=r?0:4,r||t.quadraticCurveTo(i[0],i[1],i[2],i[3]);a<o-2;)t.bezierCurveTo(i[a++],i[a++],i[a++],i[a++],i[a++],i[a++]);r||t.quadraticCurveTo(i[o-2],i[o-1],e[n-2],e[n-1])}else if(o)for(a=2;a<n;)t.bezierCurveTo(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);else for(a=2;a<n;a+=2)t.lineTo(e[a],e[a+1]);r?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),e=t.length,n=this.tension(),i=r(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),a=r(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),s=o(t,n);return[i[2],i[3]].concat(s).concat([a[0],a[1],t[e-2],t[e-1],a[2],a[3],i[0],i[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points();let e,n,i=t[0],r=t[0],o=t[1],a=t[1];for(let s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],i=Math.min(i,e),r=Math.max(r,e),o=Math.min(o,n),a=Math.max(a,n);return{x:i,y:o,width:r-i,height:a-o}}};return nt.Line=s,s.prototype.className="Line",s.prototype._attrsAffectingSize=["points","bezier","tension"],(0,e._registerNode)(s),t.Factory.addGetterSetter(s,"closed",!1),t.Factory.addGetterSetter(s,"bezier",!1),t.Factory.addGetterSetter(s,"tension",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(s,"points",[],(0,i.getNumberArrayValidator)()),nt}(),ot={};var at,st=function(){if(it)return ot;it=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.Rect=void 0;const t=T(),e=G(),n=a(),i=h(),r=k();let o=class extends e.Shape{_sceneFunc(t){const e=this.cornerRadius(),n=this.width(),r=this.height();t.beginPath(),e?i.Util.drawRoundedRectPath(t,n,r,e):t.rect(0,0,n,r),t.closePath(),t.fillStrokeShape(this)}};return ot.Rect=o,o.prototype.className="Rect",(0,n._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,r.getNumberOrArrayOfNumbersValidator)(4)),ot}(),lt={};var ht=function(){if(at)return lt;at=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.Text=void 0,lt.stringToArray=s;const t=h(),e=T(),n=G(),i=a(),r=k(),o=a();function s(t){return[...t].reduce((t,e,n,i)=>{if(/\p{Emoji}/u.test(e)){const r=i[n+1];r&&/\p{Emoji_Modifier}|\u200D/u.test(r)?(t.push(e+r),i[n+1]=""):t.push(e)}else/\p{Regional_Indicator}{2}/u.test(e+(i[n+1]||""))?t.push(e+i[n+1]):n>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(e)?t[t.length-1]+=e:e&&t.push(e);return t},[])}const l="auto",u="inherit",c="justify",d="left",f="middle",p="normal",g=" ",m="none",v=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],_=v.length;let y;function b(){return y||(y=t.Util.createCanvasElement().getContext("2d"),y)}let w=class extends n.Shape{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<_;t++)this.on(v[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){const e=this.textArr,n=e.length;if(!this.text())return;let r,o=this.padding(),a=this.fontSize(),l=this.lineHeight()*a,h=this.verticalAlign(),p=this.direction(),g=0,m=this.align(),v=this.getWidth(),_=this.letterSpacing(),y=this.fill(),b=this.textDecoration(),w=-1!==b.indexOf("underline"),S=-1!==b.indexOf("line-through");p=p===u?t.direction:p;let C=l/2,x=f;if(i.Konva._fixTextRendering){const t=this.measureSize("M");x="alphabetic",C=(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)/2+l/2}for("rtl"===p&&t.setAttr("direction",p),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",x),t.setAttr("textAlign",d),h===f?g=(this.getHeight()-n*l-2*o)/2:"bottom"===h&&(g=this.getHeight()-n*l-2*o),t.translate(o,g+o),r=0;r<n;r++){let h=0,u=0;const d=e[r],f=d.text,g=d.width,b=d.lastInParagraph;if(t.save(),"right"===m?h+=v-g-2*o:"center"===m&&(h+=(v-g-2*o)/2),w){t.save(),t.beginPath();const e=h,n=C+u+(i.Konva._fixTextRendering?Math.round(a/4):Math.round(a/2));t.moveTo(e,n);const r=m!==c||b?g:v-2*o;t.lineTo(e+Math.round(r),n),t.lineWidth=a/15;const s=this._getLinearGradient();t.strokeStyle=s||y,t.stroke(),t.restore()}if(S){t.save(),t.beginPath();const e=i.Konva._fixTextRendering?-Math.round(a/4):0;t.moveTo(h,C+u+e);const n=m!==c||b?g:v-2*o;t.lineTo(h+Math.round(n),C+u+e),t.lineWidth=a/15;const r=this._getLinearGradient();t.strokeStyle=r||y,t.stroke(),t.restore()}if("rtl"===p||0===_&&m!==c)0!==_&&t.setAttr("letterSpacing",`${_}px`),this._partialTextX=h,this._partialTextY=C+u,this._partialText=f,t.fillStrokeShape(this);else{const e=f.split(" ").length-1,n=s(f);for(let i=0;i<n.length;i++){const r=n[i];" "!==r||b||m!==c||(h+=(v-2*o-g)/e),this._partialTextX=h,this._partialTextY=C+u,this._partialText=r,t.fillStrokeShape(this),h+=this.measureSize(r).width+_}}t.restore(),n>1&&(C+=l)}}_hitFunc(t){const e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(e){const n=t.Util._isString(e)?e:null==e?"":e+"";return this._setAttr("text",n),this}getWidth(){return this.attrs.width===l||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===l||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return t.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n,i,r,o,a,s,l,h,u,c;let d,f=b(),p=this.fontSize();f.save(),f.font=this._getContextFont(),d=f.measureText(t),f.restore();const g=p/100;return{actualBoundingBoxAscent:null!==(e=d.actualBoundingBoxAscent)&&void 0!==e?e:71.58203125*g,actualBoundingBoxDescent:null!==(n=d.actualBoundingBoxDescent)&&void 0!==n?n:0,actualBoundingBoxLeft:null!==(i=d.actualBoundingBoxLeft)&&void 0!==i?i:-7.421875*g,actualBoundingBoxRight:null!==(r=d.actualBoundingBoxRight)&&void 0!==r?r:75.732421875*g,alphabeticBaseline:null!==(o=d.alphabeticBaseline)&&void 0!==o?o:0,emHeightAscent:null!==(a=d.emHeightAscent)&&void 0!==a?a:100*g,emHeightDescent:null!==(s=d.emHeightDescent)&&void 0!==s?s:-20*g,fontBoundingBoxAscent:null!==(l=d.fontBoundingBoxAscent)&&void 0!==l?l:91*g,fontBoundingBoxDescent:null!==(h=d.fontBoundingBoxDescent)&&void 0!==h?h:21*g,hangingBaseline:null!==(u=d.hangingBaseline)&&void 0!==u?u:72.80000305175781*g,ideographicBaseline:null!==(c=d.ideographicBaseline)&&void 0!==c?c:-21*g,width:d.width,height:p}}_getContextFont(){return this.fontStyle()+g+this.fontVariant()+g+(this.fontSize()+"px ")+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){this.align()===c&&(t=t.trim());const e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){const e=this.letterSpacing(),n=t.length;return b().measureText(t).width+e*n}_setTextData(){let t=this.text().split("\n"),e=+this.fontSize(),n=0,i=this.lineHeight()*e,r=this.attrs.width,o=this.attrs.height,a=r!==l&&void 0!==r,h=o!==l&&void 0!==o,u=this.padding(),c=r-2*u,d=o-2*u,f=0,p=this.wrap(),v="char"!==p&&p!==m,_=this.ellipsis();this.textArr=[],b().font=this._getContextFont();const y=_?this._getTextWidth(""):0;for(let e=0,r=t.length;e<r;++e){let o=t[e],l=this._getTextWidth(o);if(a&&l>c)for(;o.length>0;){let t=0,e=s(o).length,r="",a=0;for(;t<e;){const n=t+e>>>1,l=s(o).slice(0,n+1).join(""),u=this._getTextWidth(l);(_&&h&&f+i>d?u+y:u)<=c?(t=n+1,r=l,a=u):e=n}if(!r)break;if(v){const e=s(o),n=s(r),i=e[n.length];let l;if((i===g||"-"===i)&&a<=c)l=n.length;else{const t=n.lastIndexOf(g),e=n.lastIndexOf("-");l=Math.max(t,e)+1}l>0&&(t=l,r=e.slice(0,t).join(""),a=this._getTextWidth(r))}r=r.trimRight(),this._addTextLine(r),n=Math.max(n,a),f+=i;if(this._shouldHandleEllipsis(f)){this._tryToAddEllipsisToLastLine();break}if(o=s(o).slice(t).join("").trimLeft(),o.length>0&&(l=this._getTextWidth(o),l<=c)){this._addTextLine(o),f+=i,n=Math.max(n,l);break}}else this._addTextLine(o),f+=i,n=Math.max(n,l),this._shouldHandleEllipsis(f)&&e<r-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),h&&f+i>d)break}this.textHeight=e,this.textWidth=n}_shouldHandleEllipsis(t){const e=+this.fontSize(),n=this.lineHeight()*e,i=this.attrs.height,r=i!==l&&void 0!==i,o=i-2*this.padding();return!(this.wrap()!==m)||r&&t+n>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,e=t!==l&&void 0!==t,n=t-2*this.padding(),i=this.ellipsis(),r=this.textArr[this.textArr.length-1];if(r&&i){if(e){this._getTextWidth(r.text+"")<n||(r.text=r.text.slice(0,r.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(r.text+"")}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas()}};return lt.Text=w,w.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},w.prototype._strokeFunc=function(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},w.prototype.className="Text",w.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(w),e.Factory.overWriteSetter(w,"width",(0,r.getNumberOrAutoValidator)()),e.Factory.overWriteSetter(w,"height",(0,r.getNumberOrAutoValidator)()),e.Factory.addGetterSetter(w,"direction",u),e.Factory.addGetterSetter(w,"fontFamily","Arial"),e.Factory.addGetterSetter(w,"fontSize",12,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(w,"fontStyle",p),e.Factory.addGetterSetter(w,"fontVariant",p),e.Factory.addGetterSetter(w,"padding",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(w,"align",d),e.Factory.addGetterSetter(w,"verticalAlign","top"),e.Factory.addGetterSetter(w,"lineHeight",1,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(w,"wrap","word"),e.Factory.addGetterSetter(w,"ellipsis",!1,(0,r.getBooleanValidator)()),e.Factory.addGetterSetter(w,"letterSpacing",0,(0,r.getNumberValidator)()),e.Factory.addGetterSetter(w,"text","",(0,r.getStringValidator)()),e.Factory.addGetterSetter(w,"textDecoration",""),lt}(),ut=Z();function ct(t,e){this._waveformData=t,this._channelIndex=e}ct.prototype.min_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._at(e)},ct.prototype.max_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._at(e)},ct.prototype.set_min_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._set_at(n,e)},ct.prototype.set_max_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._set_at(n,e)},ct.prototype.min_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.min_sample(n));return e},ct.prototype.max_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.max_sample(n));return e};function dt(t){for(var e=t.scale,n=t.amplitude_scale,i=t.split_channels,r=t.length,o=t.sample_rate,a=t.channels.map(function(t){return new Float32Array(t)}),s=i?a.length:1,l=function(t,e){var n=Math.floor(t/e);return t-n*e>0&&n++,n}(r,e),h=8===t.bits?1:2,u=new ArrayBuffer(24+2*l*h*s),c=new DataView(u),d=0,f=24,p=new Array(s),g=new Array(s),m=0;m<s;m++)p[m]=1/0,g[m]=-1/0;var v=8===t.bits?-128:-32768,_=8===t.bits?127:32767;c.setInt32(0,2,!0),c.setUint32(4,8===t.bits,!0),c.setInt32(8,o,!0),c.setInt32(12,e,!0),c.setInt32(16,l,!0),c.setInt32(20,s,!0);for(var y=0;y<r;y++){var b=0;if(1===s){for(var w=0;w<a.length;++w)b+=a[w][y];(b=Math.floor(_*b*n/a.length))<p[0]&&(p[0]=b,p[0]<v&&(p[0]=v)),b>g[0]&&(g[0]=b,g[0]>_&&(g[0]=_))}else for(var S=0;S<s;++S)(b=Math.floor(_*a[S][y]*n))<p[S]&&(p[S]=b,p[S]<v&&(p[S]=v)),b>g[S]&&(g[S]=b,g[S]>_&&(g[S]=_));if(++d===e){for(var C=0;C<s;C++)8===t.bits?(c.setInt8(f++,p[C]),c.setInt8(f++,g[C])):(c.setInt16(f,p[C],!0),c.setInt16(f+2,g[C],!0),f+=4),p[C]=1/0,g[C]=-1/0;d=0}}if(d>0)for(var x=0;x<s;x++)8===t.bits?(c.setInt8(f++,p[x]),c.setInt8(f++,g[x])):(c.setInt16(f,p[x],!0),c.setInt16(f+2,g[x],!0));return u}function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function pt(t){return null==t}function gt(t,e,n){var i=function(t){return atob(t)}(t),r=i.indexOf("\n",10)+1,o=i.substring(r)+"",a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}function mt(t,e,n){var i;return function(e){return i=i||gt(t),new Worker(i,e)}}var vt=mt("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgdmFyIElOVDE2X01BWCA9IDMyNzY3OwogIHZhciBJTlQxNl9NSU4gPSAtMzI3Njg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgaGVhZGVyX3NpemUgPSAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciBieXRlc19wZXJfc2FtcGxlID0gb3B0aW9ucy5iaXRzID09PSA4ID8gMSA6IDI7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogYnl0ZXNfcGVyX3NhbXBsZSAqIG91dHB1dF9jaGFubmVsczsKICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxfc2l6ZSk7CiAgICB2YXIgZGF0YV92aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB2YXIgc2NhbGVfY291bnRlciA9IDA7CiAgICB2YXIgb2Zmc2V0ID0gaGVhZGVyX3NpemU7CiAgICB2YXIgbWluX3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICB2YXIgbWF4X3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICBmb3IgKHZhciBjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CiAgICB2YXIgcmFuZ2VfbWluID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NSU4gOiBJTlQxNl9NSU47CiAgICB2YXIgcmFuZ2VfbWF4ID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NQVggOiBJTlQxNl9NQVg7CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMCwgMiwgdHJ1ZSk7IC8vIFZlcnNpb24KICAgIGRhdGFfdmlldy5zZXRVaW50MzIoNCwgb3B0aW9ucy5iaXRzID09PSA4LCB0cnVlKTsgLy8gSXMgOCBiaXQ/CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoOCwgc2FtcGxlX3JhdGUsIHRydWUpOyAvLyBTYW1wbGUgcmF0ZQogICAgZGF0YV92aWV3LnNldEludDMyKDEyLCBzY2FsZSwgdHJ1ZSk7IC8vIFNjYWxlCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTYsIGRhdGFfbGVuZ3RoLCB0cnVlKTsgLy8gTGVuZ3RoCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMjAsIG91dHB1dF9jaGFubmVscywgdHJ1ZSk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzYW1wbGUgPSAwOwogICAgICBpZiAob3V0cHV0X2NoYW5uZWxzID09PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwgPSAwOyBfY2hhbm5lbCA8IGNoYW5uZWxzLmxlbmd0aDsgKytfY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlICs9IGNoYW5uZWxzW19jaGFubmVsXVtpXTsKICAgICAgICB9CiAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBzYW1wbGUgKiBhbXBsaXR1ZGVfc2NhbGUgLyBjaGFubmVscy5sZW5ndGgpOwogICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbMF0pIHsKICAgICAgICAgIG1pbl92YWx1ZVswXSA9IHNhbXBsZTsKICAgICAgICAgIGlmIChtaW5fdmFsdWVbMF0gPCByYW5nZV9taW4pIHsKICAgICAgICAgICAgbWluX3ZhbHVlWzBdID0gcmFuZ2VfbWluOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlWzBdKSB7CiAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWF4X3ZhbHVlWzBdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgIG1heF92YWx1ZVswXSA9IHJhbmdlX21heDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwyID0gMDsgX2NoYW5uZWwyIDwgb3V0cHV0X2NoYW5uZWxzOyArK19jaGFubmVsMikgewogICAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBjaGFubmVsc1tfY2hhbm5lbDJdW2ldICogYW1wbGl0dWRlX3NjYWxlKTsKICAgICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtaW5fdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtfY2hhbm5lbDJdIDwgcmFuZ2VfbWluKSB7CiAgICAgICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9taW47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzYW1wbGUgPiBtYXhfdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtYXhfdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1heF92YWx1ZVtfY2hhbm5lbDJdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgICAgbWF4X3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9tYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKHZhciBfY2hhbm5lbDMgPSAwOyBfY2hhbm5lbDMgPCBvdXRwdXRfY2hhbm5lbHM7IF9jaGFubmVsMysrKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtaW5fdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50MTYob2Zmc2V0LCBtaW5fdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQxNihvZmZzZXQgKyAyLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgfQogICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsM10gPSBJbmZpbml0eTsKICAgICAgICAgIG1heF92YWx1ZVtfY2hhbm5lbDNdID0gLUluZmluaXR5OwogICAgICAgIH0KICAgICAgICBzY2FsZV9jb3VudGVyID0gMDsKICAgICAgfQogICAgfQogICAgaWYgKHNjYWxlX2NvdW50ZXIgPiAwKSB7CiAgICAgIGZvciAodmFyIF9jaGFubmVsNCA9IDA7IF9jaGFubmVsNCA8IG91dHB1dF9jaGFubmVsczsgX2NoYW5uZWw0KyspIHsKICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWluX3ZhbHVlW19jaGFubmVsNF0pOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtfY2hhbm5lbDRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW19jaGFubmVsNF0sIHRydWUpOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCArIDIsIG1heF92YWx1ZVtfY2hhbm5lbDRdLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBidWZmZXI7CiAgfQoKICBvbm1lc3NhZ2UgPSBmdW5jdGlvbiBvbm1lc3NhZ2UoZXZ0KSB7CiAgICB2YXIgYnVmZmVyID0gZ2VuZXJhdGVXYXZlZm9ybURhdGEoZXZ0LmRhdGEpOwoKICAgIC8vIFRyYW5zZmVyIGJ1ZmZlciB0byB0aGUgY2FsbGluZyB0aHJlYWQKICAgIHRoaXMucG9zdE1lc3NhZ2UoYnVmZmVyLCBbYnVmZmVyXSk7CiAgICB0aGlzLmNsb3NlKCk7CiAgfTsKCn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdhdmVmb3JtLWRhdGEtd29ya2VyLmpzLm1hcAoK");function _t(t){if(function(t){return t&&"object"===ft(t)&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t}(t)&&(t=function(t){var e=t.data,n=t.channels||1,i=8===t.bits?1:2,r=2*t.length*n;if(e.length!==r)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var o=24+e.length*i,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===t.bits,!0),s.setInt32(8,t.sample_rate,!0),s.setInt32(12,t.samples_per_pixel,!0),s.setInt32(16,t.length,!0),s.setInt32(20,n,!0);var l=24;if(8===t.bits)for(var h=0;h<e.length;h++)s.setInt8(l++,e[h],!0);else for(var u=0;u<e.length;u++)s.setInt16(l,e[u],!0),l+=2;return a}(t)),!function(t){var e=t&&"object"===ft(t)&&"byteLength"in t;if(e){var n=new DataView(t).getInt32(0,!0);if(1!==n&&2!==n)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}(t))throw new TypeError("WaveformData.create(): Unknown data format");this._data=new DataView(t),this._offset=2===this._version()?24:20,this._channels=[];for(var e=0;e<this.channels;e++)this._channels[e]=new ct(this,e)}var yt=512,bt=8,wt=1,St=!1,Ct=!1;function xt(t,e,n){var i=function(t){for(var e=[],n=0;n<t.numberOfChannels;++n)e.push(t.getChannelData(n).buffer);return e}(t);if(e.disable_worker){var r=dt({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:i});n(void 0,new _t(r),t)}else{var o=new vt;o.onmessage=function(e){n(void 0,new _t(e.data),t)},o.postMessage({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:i},i)}}function kt(t){this._inputData=t.waveformData,this._output_samples_per_pixel=t.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var e=this._input_buffer_size*this._inputData.scale,n=Math.ceil(e/this._output_samples_per_pixel),i=8===this._inputData.bits?1:2,r=24+2*n*this._inputData.channels*i;this._output_data=new ArrayBuffer(r),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,8===this._inputData.bits,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,n,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new _t(this._output_data),this._input_index=0,this._output_index=0;var o=this._inputData.channels;this._min=new Array(o),this._max=new Array(o);for(var a=0;a<o;++a)this._input_buffer_size>0?(this._min[a]=this._inputData.channel(a).min_sample(this._input_index),this._max[a]=this._inputData.channel(a).max_sample(this._input_index)):(this._min[a]=0,this._max[a]=0);this._min_value=8===this._inputData.bits?-128:-32768,this._max_value=8===this._inputData.bits?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}function Tt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}_t.create=function(t){return new _t(t)},_t.createFromAudio=function(t,e){var n=function(t){return{scale:t.scale||yt,bits:t.bits||bt,amplitude_scale:t.amplitude_scale||wt,split_channels:t.split_channels||St,disable_worker:t.disable_worker||Ct}}(t);if(t.audio_context&&t.array_buffer)return function(t,e,n,i){function r(t){t||(t=new DOMException("EncodingError")),i(t),i=function(){}}var o=t.decodeAudioData(e,function(t){xt(t,n,i)},r);o&&o.catch(r)}(t.audio_context,t.array_buffer,n,e);if(t.audio_buffer)return xt(t.audio_buffer,n,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")},kt.prototype.sample_at_pixel=function(t){return Math.floor(t*this._output_samples_per_pixel)},kt.prototype.next=function(){for(var t,e=0,n=this._inputData.channels;this._input_index<this._input_buffer_size&&e<1e3;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(var i=0;i<n;++i)(t=this._outputWaveformData.channel(i)).set_min_sample(this._output_index-1,this._min[i]),t.set_max_sample(this._output_index-1,this._max[i]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(var r=0;r<n;++r)this._min[r]=this._max_value,this._max[r]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(var o=0;o<n;++o){var a=(t=this._inputData.channel(o)).min_sample(this._input_index);a<this._min[o]&&(this._min[o]=a),(a=t.max_sample(this._input_index))>this._max[o]&&(this._max[o]=a)}this._input_index++}e++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(var s=0;s<n;++s)(t=this._outputWaveformData.channel(s)).set_min_sample(this._output_index-1,this._min[s]),t.set_max_sample(this._output_index-1,this._max[s]);return!0},kt.prototype.getOutputData=function(){return this._output_data},_t.prototype={_getResampleOptions:function(t){var e={};if(e.scale=t.scale,e.width=t.width,!pt(e.width)&&("number"!=typeof e.width||e.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(!pt(e.scale)&&("number"!=typeof e.scale||e.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!e.scale&&!e.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(e.width&&(e.scale=Math.floor(this.duration*this.sample_rate/e.width)),e.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+e.scale+" too low, minimum: "+this.scale);return e.abortSignal=t.abortSignal,e},resample:function(t){(t=this._getResampleOptions(t)).waveformData=this;for(var e=new kt(t);!e.next(););return new _t(e.getOutputData())},concat:function(){var t=this,e=Array.prototype.slice.call(arguments);e.forEach(function(e){if(t.channels!==e.channels||t.sample_rate!==e.sample_rate||t.bits!==e.bits||t.scale!==e.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")});var n=this._concatBuffers.apply(this,e);return _t.create(n)},_concatBuffers:function(){for(var t=Array.prototype.slice.call(arguments),e=this._offset,n=e,i=0,r=[this].concat(t).map(function(t){return t._data.buffer}),o=0;o<r.length;o++){var a=r[o],s=new DataView(a).getInt32(16,!0);n+=a.byteLength-e,i+=s}for(var l=new ArrayBuffer(n),h=new DataView(r[0]),u=new DataView(l),c=0;c<e;c++)u.setUint8(c,h.getUint8(c));u.setInt32(16,i,!0);for(var d=0,f=new Uint8Array(l,e),p=0;p<r.length;p++){var g=r[p];f.set(new Uint8Array(g,e),d),d+=g.byteLength-e}return l},slice:function(t){var e=0,n=0;if(pt(t.startIndex)||pt(t.endIndex)?pt(t.startTime)||pt(t.endTime)||(e=this.at_time(t.startTime),n=this.at_time(t.endTime)):(e=t.startIndex,n=t.endIndex),e<0)throw new RangeError("startIndex or startTime must not be negative");if(n<0)throw new RangeError("endIndex or endTime must not be negative");e>this.length&&(e=this.length),n>this.length&&(n=this.length),e>n&&(e=n);var i=n-e,r=8===this.bits?1:2,o=24+2*i*this.channels*r,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===this.bits,!0),s.setInt32(8,this.sample_rate,!0),s.setInt32(12,this.scale,!0),s.setInt32(16,i,!0),s.setInt32(20,this.channels,!0);for(var l=0;l<i*this.channels*2;l++){var h=this._at(e*this.channels*2+l);8===this.bits?s.setInt8(24+l,h):s.setInt16(24+2*l,h,!0)}return new _t(a)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return 2===this._version()?this._data.getInt32(20,!0):1},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return 8===this.bits?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+2*t,!0)},_set_at:function(t,e){return 8===this.bits?this._data.setInt8(this._offset+t,e):this._data.setInt16(this._offset+2*t,e,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},e=0;e<this.length;e++)for(var n=0;n<this.channels;n++)t.data.push(this.channel(n).min_sample(e)),t.data.push(this.channel(n).max_sample(e));return t},toArrayBuffer:function(){return this._data.buffer}};var At,Pt={exports:{}};var Et=(At||(At=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,i,o,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,o||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,i,r=[];if(0===this._eventsCount)return r;for(i in t=this._events)e.call(t,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=new Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},s.prototype.emit=function(t,e,i,r,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var l,h,u=this._events[s],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,r),!0;case 5:return u.fn.call(u.context,e,i,r,o),!0;case 6:return u.fn.call(u.context,e,i,r,o,a),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d,f=u.length;for(h=0;h<f;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,i);break;case 4:u[h].fn.call(u[h].context,e,i,r);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u[h].fn.apply(u[h].context,l)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,i,r){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var l=0,h=[],u=s.length;l<u;l++)(s[l].fn!==e||r&&!s[l].once||i&&s[l].context!==i)&&h.push(s[l]);h.length?this._events[o]=1===h.length?h[0]:h:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(Pt)),Pt.exports),It=Tt(Et);function Dt(t){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(t)}function Mt(t,e,n){this.time=t,this.type=e,this.id=n}function Lt(t,e){for(t=t.toString();t.length<e;)t="0"+t;return t}function Ot(t,e){var n=[],i=Math.floor(t%1*Math.pow(10,e)),r=Math.floor(t),o=Math.floor(r/60),a=Math.floor(o/60);a>0&&n.push(a),n.push(o%60),n.push(r%60);for(var s=0;s<n.length;s++)n[s]=Lt(n[s],2);return n=n.join(":"),e>0&&(n+="."+Lt(i,e)),n}function Rt(t,e,n){return t<e?e:t>n?n:t}function Ft(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Bt(t,e){for(var n in e)Ft(e,n)&&(t[n]=e[n]);return t}function Wt(t){return"number"==typeof t}function Ut(t){return"number"==typeof t&&Number.isFinite(t)}function Gt(t){return null!==t&&"object"===Dt(t)&&!Array.isArray(t)}function Nt(t){return"string"==typeof t}function zt(t){return null==t}function Ht(t){return!0===t||!1===t}function Vt(t){return t instanceof HTMLElement}function jt(t){return Gt(t)&&Ft(t,"linearGradientStart")&&Ft(t,"linearGradientEnd")&&Ft(t,"linearGradientColorStops")&&Wt(t.linearGradientStart)&&Wt(t.linearGradientEnd)&&function(t){return Array.isArray(t)}(t.linearGradientColorStops)&&2===t.linearGradientColorStops.length}function Xt(t){for(;null!==t.parent;){if(t.parent instanceof et.Layer)return t;t=t.parent}return null}Mt.POINT=0,Mt.SEGMENT_START=1,Mt.SEGMENT_END=2,Mt.sorter=function(t,e){return t.time-e.time};var Yt=/HeadlessChrome/.test(navigator.userAgent);var Zt=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Kt=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,qt={forward:{},reverse:{}};qt.forward[Mt.POINT]=0,qt.forward[Mt.SEGMENT_START]=1,qt.forward[Mt.SEGMENT_END]=2,qt.reverse[Mt.POINT]=0,qt.reverse[Mt.SEGMENT_START]=2,qt.reverse[Mt.SEGMENT_END]=1;var Jt={0:"points.enter",1:"segments.enter",2:"segments.exit"},Qt={};function $t(t,e){switch(e.type){case Mt.POINT:return t.points.getPoint(e.id);case Mt.SEGMENT_START:case Mt.SEGMENT_END:return t.segments.getSegment(e.id);default:throw new Error("getPointOrSegment: id not found?")}}function te(t){this._cues=[],this._peaks=t,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}function ee(t){return function(e){return e.id===t}}Qt[0]="point",Qt[1]="segment",Qt[2]="segment",te.prototype._updateCues=function(){var t=this,e=t._peaks.points.getPoints(),n=t._peaks.segments.getSegments();t._cues.length=0,e.forEach(function(e){t._cues.push(new Mt(e.time,Mt.POINT,e.id))}),n.forEach(function(e){t._cues.push(new Mt(e.startTime,Mt.SEGMENT_START,e.id)),t._cues.push(new Mt(e.endTime,Mt.SEGMENT_END,e.id))}),t._cues.sort(Mt.sorter);var i=t._peaks.player.getCurrentTime();t._updateActiveSegments(i)},te.prototype._onUpdate=function(t,e){var n,i,r,o=t>e;o?(n=0,i=this._cues.length,r=1):(n=this._cues.length-1,i=-1,r=-1);for(var a=n;o?a<i:a>i;a+=r){var s=this._cues[a];if(o?s.time>e:s.time<e){if(o?s.time>t:s.time<t)break;var l=$t(this._peaks,s),h=o?qt.forward[s.type]:qt.reverse[s.type];1===h?this._activeSegments[l.id]=l:2===h&&delete this._activeSegments[l.id];var u={time:t};u[Qt[h]]=l,this._peaks.emit(Jt[h],u)}}},te.prototype._onTimeUpdate=function(t){(Yt||navigator.webdriver||"object"!==("undefined"==typeof document?"undefined":Dt(document))||!("visibilityState"in document)||"visible"!==document.visibilityState)&&(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(t,this._previousTime),this._previousTime=t)},te.prototype._onAnimationFrame=function(){var t=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(t,this._previousTime),this._previousTime=t,this._peaks.player.isPlaying()&&(this._rAFHandle=Zt(this._onAnimationFrame))},te.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=Zt(this._onAnimationFrame)},te.prototype._onSeeked=function(t){this._previousTime=t,this._updateActiveSegments(t)},te.prototype._updateActiveSegments=function(t){var e=this,n=e._peaks.segments.getSegmentsAtTime(t);for(var i in e._activeSegments){if(Ft(e._activeSegments,i))n.find(ee(i))||(e._peaks.emit("segments.exit",{segment:e._activeSegments[i],time:t}),delete e._activeSegments[i])}n.forEach(function(n){n.id in e._activeSegments||(e._activeSegments[n.id]=n,e._peaks.emit("segments.enter",{segment:n,time:t}))})};var ne=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];te.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var t=0;t<ne.length;t++)this._peaks.on(ne[t],this._updateCues);this._updateCues()},te.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var t=0;t<ne.length;t++)this._peaks.off(ne[t],this._updateCues)},te.prototype.destroy=function(){this._rAFHandle&&(Kt(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var ie=["id","pid","time","labelText","color","editable"],re=["update","isVisible","peaks","pid"];function oe(t,e){var n=e?"update()":"add()";if((!e||e&&Ft(t,"time"))&&!Ut(t.time))throw new TypeError("peaks.points."+n+": time should be a numeric value");if(t.time<0)throw new RangeError("peaks.points."+n+": time should not be negative");if(Ft(t,"labelText")&&!Nt(t.labelText))throw new TypeError("peaks.points."+n+": labelText must be a string");if(Ft(t,"editable")&&!Ht(t.editable))throw new TypeError("peaks.points."+n+": editable must be true or false");if(Ft(t,"color")&&!Nt(t.color)&&!jt(t.color))throw new TypeError("peaks.points."+n+": color must be a string or a valid linear gradient object");re.forEach(function(e){if(Ft(t,e))throw new Error("peaks.points."+n+": invalid option name: "+e)}),ie.forEach(function(e){if(Ft(t,"_"+e))throw new Error("peaks.points."+n+": invalid option name: _"+e)})}function ae(t,e,n){this._peaks=t,this._pid=e,this._setUserData(n)}function se(t){this._peaks=t,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}ae.prototype._setUserData=function(t){for(var e in t)Ft(t,e)&&(-1===ie.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(ae.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),ae.prototype.update=function(t){if(oe(t,!0),Ft(t,"id")){if(zt(t.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,t.id)}this._setUserData(t),this._peaks.emit("points.update",this,t)},ae.prototype.isVisible=function(t,e){return this.time>=t&&this.time<e},ae.prototype._setTime=function(t){this._time=t},se.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++},se.prototype._getNextPid=function(){return this._pointPid++},se.prototype._addPoint=function(t){this._points.push(t),this._pointsById[t.id]=t,this._pointsByPid[t.pid]=t},se.prototype._createPoint=function(t){var e={};Bt(e,t),zt(e.id)&&(e.id=this._getNextPointId());var n=this._getNextPid();return function(t,e){zt(t.labelText)&&(t.labelText=""),zt(t.editable)&&(t.editable=!1),zt(t.color)&&(t.color=e.pointMarkerColor)}(e,this._peaks.options),oe(e,!1),new ae(this._peaks,n,e)},se.prototype.getPoints=function(){return this._points},se.prototype.getPoint=function(t){return this._pointsById[t]},se.prototype.find=function(t,e){return this._points.filter(function(n){return n.isVisible(t,e)})},se.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createPoint(e);if(Ft(t._pointsById,n.id))throw new Error("peaks.points.add(): duplicate id");return n}),n.forEach(function(e){t._addPoint(e)}),this._peaks.emit("points.add",{points:n}),e?n:n[0]},se.prototype.updatePointId=function(t,e){if(this._pointsById[t.id]){if(this._pointsById[e])throw new Error("point.update(): duplicate id");delete this._pointsById[t.id],this._pointsById[e]=t}},se.prototype._findPoint=function(t){for(var e=[],n=0,i=this._points.length;n<i;n++)t(this._points[n])&&e.push(n);return e},se.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n]-e.length,r=this._points.splice(i,1)[0];delete this._pointsById[r.id],delete this._pointsByPid[r.pid],e.push(r)}return e},se.prototype._removePoints=function(t){var e=this._findPoint(t),n=this._removeIndexes(e);return this._peaks.emit("points.remove",{points:n}),n},se.prototype.remove=function(t){return this._removePoints(function(e){return e===t})},se.prototype.removeById=function(t){return this._removePoints(function(e){return e.id===t})},se.prototype.removeByTime=function(t){return this._removePoints(function(e){return e.time===t})},se.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var le=["id","pid","startTime","endTime","labelText","color","borderColor","markers","overlay","editable"],he=["update","isVisible","peaks","pid"];function ue(t,e){var n=e?"update()":"add()";if(Ft(t,"startTime")&&!Ut(t.startTime))throw new TypeError("peaks.segments."+n+": startTime should be a valid number");if(Ft(t,"endTime")&&!Ut(t.endTime))throw new TypeError("peaks.segments."+n+": endTime should be a valid number");if(!(e||Ft(t,"startTime")&&Ft(t,"endTime")))throw new TypeError("peaks.segments."+n+": missing startTime or endTime");if(t.startTime<0)throw new RangeError("peaks.segments."+n+": startTime should not be negative");if(t.endTime<0)throw new RangeError("peaks.segments."+n+": endTime should not be negative");if(t.endTime<t.startTime)throw new RangeError("peaks.segments."+n+": endTime should not be less than startTime");if(Ft(t,"labelText")&&!Nt(t.labelText))throw new TypeError("peaks.segments."+n+": labelText must be a string");if(e&&Ft(t,"markers"))throw new TypeError("peaks.segments."+n+": cannot update markers attribute");if(Ft(t,"markers")&&!Ht(t.markers))throw new TypeError("peaks.segments."+n+": markers must be true or false");if(e&&Ft(t,"overlay"))throw new TypeError("peaks.segments."+n+": cannot update overlay attribute");if(Ft(t,"overlay")&&!Ht(t.overlay))throw new TypeError("peaks.segments."+n+": overlay must be true or false");if(Ft(t,"editable")&&!Ht(t.editable))throw new TypeError("peaks.segments."+n+": editable must be true or false");if(Ft(t,"color")&&!Nt(t.color)&&!jt(t.color))throw new TypeError("peaks.segments."+n+": color must be a string or a valid linear gradient object");if(Ft(t,"borderColor")&&!Nt(t.borderColor))throw new TypeError("peaks.segments."+n+": borderColor must be a string");he.forEach(function(e){if(Ft(t,e))throw new Error("peaks.segments."+n+": invalid option name: "+e)}),le.forEach(function(e){if(Ft(t,"_"+e))throw new Error("peaks.segments."+n+": invalid option name: _"+e)})}function ce(t,e,n){this._peaks=t,this._pid=e,this._id=n.id,this._startTime=n.startTime,this._endTime=n.endTime,this._labelText=n.labelText,this._color=n.color,this._borderColor=n.borderColor,this._editable=n.editable,this._markers=n.markers,this._overlay=n.overlay,this._setUserData(n)}function de(t){this._peaks=t,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}ce.prototype._setUserData=function(t){for(var e in t)Ft(t,e)&&(-1===le.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(ce.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},markers:{enumerable:!0,get:function(){return this._markers}},overlay:{enumerable:!0,get:function(){return this._overlay}},editable:{enumerable:!0,get:function(){return this._editable}}}),ce.prototype.update=function(t){if(ue(t,!0),Ft(t,"id")){if(zt(t.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,t.id)}this._setUserData(t),this._peaks.emit("segments.update",this,t)},ce.prototype.isVisible=function(t,e){return this.startTime===this.endTime&&this.startTime===t||!(this.endTime<=t)&&!(this.startTime>=e)},ce.prototype._setStartTime=function(t){this._startTime=t},ce.prototype._setEndTime=function(t){this._endTime=t},de.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++},de.prototype._getNextPid=function(){return this._segmentPid++},de.prototype._addSegment=function(t){this._segments.push(t),this._segmentsById[t.id]=t,this._segmentsByPid[t.pid]=t},de.prototype._createSegment=function(t){var e={};Bt(e,t),zt(e.id)&&(e.id=this._getNextSegmentId());var n=this._getNextPid();return function(t,e){zt(t.color)&&(e.overlay?t.color=e.overlayColor:t.color=e.waveformColor),zt(t.borderColor)&&(t.borderColor=e.overlayBorderColor),zt(t.labelText)&&(t.labelText=""),zt(t.markers)&&(t.markers=e.markers),zt(t.overlay)&&(t.overlay=e.overlay),zt(t.editable)&&(t.editable=!1)}(e,this._peaks.options.segmentOptions),ue(e,!1),new ce(this._peaks,n,e)},de.prototype.getSegments=function(){return this._segments},de.prototype.getSegment=function(t){return this._segmentsById[t]},de.prototype.getSegmentsAtTime=function(t){return this._segments.filter(function(e){return t>=e.startTime&&t<e.endTime})},de.prototype.find=function(t,e){return this._segments.filter(function(n){return n.isVisible(t,e)})},de.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(t,e){return t.startTime-e.startTime})},de.prototype.findPreviousSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n-1]},de.prototype.findNextSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n+1]},de.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createSegment(e);if(Ft(t._segmentsById,n.id))throw new Error("peaks.segments.add(): duplicate id");return n}),n.forEach(function(e){t._addSegment(e)}),this._peaks.emit("segments.add",{segments:n,insert:this._isInserting}),e?n:n[0]},de.prototype.updateSegmentId=function(t,e){if(this._segmentsById[t.id]){if(this._segmentsById[e])throw new Error("segment.update(): duplicate id");delete this._segmentsById[t.id],this._segmentsById[e]=t}},de.prototype._findSegment=function(t){for(var e=[],n=0,i=this._segments.length;n<i;n++)t(this._segments[n])&&e.push(n);return e},de.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n]-e.length,r=this._segments.splice(i,1)[0];delete this._segmentsById[r.id],delete this._segmentsByPid[r.pid],e.push(r)}return e},de.prototype._removeSegments=function(t){var e=this._findSegment(t),n=this._removeIndexes(e);return this._peaks.emit("segments.remove",{segments:n}),n},de.prototype.remove=function(t){return this._removeSegments(function(e){return e===t})},de.prototype.removeById=function(t){return this._removeSegments(function(e){return e.id===t})},de.prototype.removeByTime=function(t,e){var n;return n=(e="number"==typeof e?e:0)>0?function(n){return n.startTime===t&&n.endTime===e}:function(e){return e.startTime===t},this._removeSegments(n)},de.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")},de.prototype.setInserting=function(t){this._isInserting=t},de.prototype.isInserting=function(){return this._isInserting};var fe=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],pe=[32,9,37,39];function ge(t){this.eventEmitter=t,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}function me(t){this._mediaElement=t}function ve(t,e){this._eventEmitter=t,this._mediaElement=e,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}function _e(t){var e=function(t){for(var e=[],n=t;n;)Object.getOwnPropertyNames(n).forEach(function(t){e.push(t)}),n=Object.getPrototypeOf(n);return e}(t);["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"].forEach(function(n){if(!e.includes(n))throw new TypeError("Peaks.init(): Player method "+n+" is undefined");if("function"!=typeof t[n])throw new TypeError("Peaks.init(): Player method "+n+" is not a function")})}function ye(t,e){this._peaks=t,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),_e(e),this._adapter=e}function be(t){this._options=t,this._draggable=t.editable}function we(t){this._options=t,this._editable=t.editable}function Se(t){return"zoomview"===t.view?new we(t):null}function Ce(t){return new ht.Text({x:12,y:12,text:t.segment.labelText,textAlign:"center",fontFamily:t.fontFamily||"sans-serif",fontSize:t.fontSize||12,fontStyle:t.fontStyle||"normal",fill:"#000"})}function xe(t){return new be(t)}function ke(t,e){this._view=t,this._offset=e.highlightOffset,this._color=e.highlightColor,this._layer=new et.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=e.highlightStrokeColor,this._opacity=e.highlightOpacity,this._cornerRadius=e.highlightCornerRadius}function Te(t){this._point=t.point,this._marker=t.marker,this._draggable=t.draggable,this._onDragStart=t.onDragStart,this._onDragMove=t.onDragMove,this._onDragEnd=t.onDragEnd,this._dragBoundFunc=t.dragBoundFunc,this._onMouseEnter=t.onMouseEnter,this._onMouseLeave=t.onMouseLeave,this._group=new et.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:t.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}function Ae(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._pointMarkers={},this._layer=new et.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}function Pe(t,e,n){this._player=t,this._view=e,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=n.playheadColor,this._playheadTextColor=n.playheadTextColor,this._playheadBackgroundColor=n.playheadBackgroundColor,this._playheadPadding=n.playheadPadding,this._playheadWidth=n.playheadWidth,this._playheadFontFamily=n.playheadFontFamily,this._playheadFontSize=n.playheadFontSize,this._playheadFontStyle=n.playheadFontStyle,this._playheadLayer=new et.Layer({listening:!1}),this._createPlayhead(),n.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}function Ee(t){this._options=t}function Ie(t){var e=this;e._segment=t.segment,e._marker=t.marker,e._segmentShape=t.segmentShape,e._editable=t.editable,e._startMarker=t.startMarker,e._onClick=t.onClick,e._onDragStart=t.onDragStart,e._onDragMove=t.onDragMove,e._onDragEnd=t.onDragEnd,e._group=new et.Group({name:"segment-marker",segment:e._segment,draggable:e._editable,visible:e._editable,dragBoundFunc:function(n){return t.dragBoundFunc(e,n)}}),e._bindDefaultEventHandlers(),e._marker.init(e._group)}function De(t){this._color=t.color;var e={};if(Nt(t.color))e.fill=t.color;else{if(!jt(t.color))throw new TypeError("Unknown type for color property");var n=t.view._height*(t.color.linearGradientStart/100),i=t.view._height*(t.color.linearGradientEnd/100);e.fillLinearGradientStartPointY=n,e.fillLinearGradientEndPointY=i,e.fillLinearGradientColorStops=[0,t.color.linearGradientColorStops[0],1,t.color.linearGradientColorStops[1]]}this._shape=new et.Shape(e),this._view=t.view,this._segment=t.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}function Me(t,e,n,i){this._segment=t,this._peaks=e,this._layer=n,this._view=i,this._label=null,this._startMarker=null,this._endMarker=null,this._color=t.color,this._borderColor=t.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var r=i.getViewOptions(),o=r.segmentOptions;this._overlayOffset=o.overlayOffset,t.overlay||(this._waveformShape=new De({color:t.color,view:i,segment:t})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerClick=this._onSegmentMarkerClick.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:t,view:this._view.getName(),layer:this._layer,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle}),this._label&&this._label.hide();var a,s,l,h,u,c=this._view.timeToPixelOffset(this._segment.startTime),d=this._view.timeToPixelOffset(this._segment.endTime),f=Rt(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new et.Group({name:"segment-overlay",segment:this._segment,x:c,y:0,width:d-c,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:d-c,clipHeight:f,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),t.overlay&&(a=this._borderColor||o.overlayBorderColor,s=o.overlayBorderWidth,l=this._color||o.overlayColor,h=o.overlayOpacity,u=o.overlayCornerRadius),this._overlayRect=new et.Rect({x:0,y:this._overlayOffset,width:d-c,stroke:a,strokeWidth:s,height:f,fill:l,opacity:h,cornerRadius:u}),this._overlay.add(this._overlayRect),t.overlay&&(this._overlayText=new et.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:o.overlayFontFamily,fontSize:o.overlayFontSize,fontStyle:o.overlayFontStyle,fill:o.overlayLabelColor,listening:!1,align:o.overlayLabelAlign,width:d-c,verticalAlign:o.overlayLabelVerticalAlign,height:f,padding:o.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function Le(t){return new Ee(t)}function Oe(t){return t.endTime-t.startTime}function Re(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._segmentShapes={},this._layer=new et.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}function Fe(t,e){var n=this;n._axisGridlineColor=e.axisGridlineColor,n._axisLabelColor=e.axisLabelColor,n._showAxisLabels=e.showAxisLabels,n._axisTopMarkerHeight=e.axisTopMarkerHeight,n._axisBottomMarkerHeight=e.axisBottomMarkerHeight,e.formatAxisTime?n._formatAxisTime=e.formatAxisTime:n._formatAxisTime=function(t){return Ot(t,0)},n._axisLabelFont=Fe._buildFontString(e.fontFamily,e.fontSize,e.fontStyle),n._axisShape=new et.Shape({sceneFunc:function(e){n._drawAxis(e,t)}})}function Be(t,e,n,i){var r=this;r._container=e,r._peaks=n,r._options=n.options,r._viewOptions=i,r._originalWaveformData=t,r._data=t,r._frameOffset=0,r._width=e.clientWidth,r._height=e.clientHeight,r._amplitudeScale=1,r._waveformColor=r._viewOptions.waveformColor,r._playedWaveformColor=r._viewOptions.playedWaveformColor,r._timeLabelPrecision=r._viewOptions.timeLabelPrecision,r._viewOptions.formatPlayheadTime?r._formatPlayheadTime=r._viewOptions.formatPlayheadTime:r._formatPlayheadTime=function(t){return Ot(t,r._timeLabelPrecision)},r._enableSeek=!0,r.initWaveformData(),et.showWarnings=!1,r._stage=new et.Stage({container:e,width:r._width,height:r._height}),r._createWaveform(),r._viewOptions.enableSegments&&(r._segmentsLayer=new Re(n,r,r._viewOptions.enableEditing),r._segmentsLayer.addToStage(r._stage)),r._viewOptions.enablePoints&&(r._pointsLayer=new Ae(n,r,r._viewOptions.enableEditing),r._pointsLayer.addToStage(r._stage)),r.initHighlightLayer(),r._createAxisLabels(),r._playheadLayer=new Pe(r._peaks.player,r,r._viewOptions),r._playheadLayer.addToStage(r._stage),r._onClick=r._onClick.bind(r),r._onDblClick=r._onDblClick.bind(r),r._onContextMenu=r._onContextMenu.bind(r),r._stage.on("click",r._onClick),r._stage.on("dblclick",r._onDblClick),r._stage.on("contextmenu",r._onContextMenu)}function We(t,e){this._stage=t,this._handlers=e,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}function Ue(t,e){this._peaks=t,this._view=e,this._firstMove=!1,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new We(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function Ge(t,e,n){var i=this;Be.call(i,t,e,n,n.options.overview),i._onTimeUpdate=i._onTimeUpdate.bind(i),i._onPlaying=i._onPlaying.bind(i),i._onPause=i._onPause.bind(i),i._onZoomviewUpdate=i._onZoomviewUpdate.bind(i),n.on("player.timeupdate",i._onTimeUpdate),n.on("player.playing",i._onPlaying),n.on("player.pause",i._onPause),n.on("zoomview.update",i._onZoomviewUpdate);var r=i._peaks.player.getCurrentTime();i._playheadLayer.updatePlayheadTime(r),i._mouseDragHandler=new Ue(n,i);var o=n.views.getView("zoomview");o&&i._highlightLayer.showHighlight(o.getStartTime(),o.getEndTime())}function Ne(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new We(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function ze(t,e){this._peaks=t,this._view=e,this._seeking=!1,this._firstMove=!1,this._segment=null,this._segmentIsDraggable=!1,this._initialFrameOffset=0,this._mouseDownX=0,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new We(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function He(t,e,n){var i=this;Be.call(i,t,e,n,n.options.zoomview),i._onTimeUpdate=i._onTimeUpdate.bind(i),i._onPlaying=i._onPlaying.bind(i),i._onPause=i._onPause.bind(i),i._onKeyboardLeft=i._onKeyboardLeft.bind(i),i._onKeyboardRight=i._onKeyboardRight.bind(i),i._onKeyboardShiftLeft=i._onKeyboardShiftLeft.bind(i),i._onKeyboardShiftRight=i._onKeyboardShiftRight.bind(i),i._peaks.on("player.timeupdate",i._onTimeUpdate),i._peaks.on("player.playing",i._onPlaying),i._peaks.on("player.pause",i._onPause),i._peaks.on("keyboard.left",i._onKeyboardLeft),i._peaks.on("keyboard.right",i._onKeyboardRight),i._peaks.on("keyboard.shift_left",i._onKeyboardShiftLeft),i._peaks.on("keyboard.shift_right",i._onKeyboardShiftRight),i._autoScroll=i._viewOptions.autoScroll,i._autoScrollOffset=i._viewOptions.autoScrollOffset,i._enableSegmentDragging=!1,i._segmentDragMode="overlap",i._minSegmentDragWidth=0,i._insertSegmentShape=null,i._playheadClickTolerance=i._viewOptions.playheadClickTolerance,i._zoomLevelAuto=!1,i._zoomLevelSeconds=null;var r=i._peaks.player.getCurrentTime();i._syncPlayhead(r),i._mouseDragHandler=new ze(n,i),i._onWheel=i._onWheel.bind(i),i._onWheelCaptureVerticalScroll=i._onWheelCaptureVerticalScroll.bind(i),i.setWheelMode(i._viewOptions.wheelMode),i._peaks.emit("zoomview.update",{startTime:0,endTime:i.getEndTime()})}function Ve(t,e){this._container=t,this._peaks=e,this._options=e.options.scrollbar,this._zoomview=e.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewUpdate=this._onZoomviewUpdate.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),this._peaks.on("zoomview.update",this._onZoomviewUpdate),this._width=t.clientWidth,this._height=t.clientHeight,this._stage=new et.Stage({container:t,width:this._width,height:this._height}),this._layer=new et.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new et.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new st.Rect({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._updateScrollbarWidthAndPosition()}function je(t){this._peaks=t,this._overview=null,this._zoomview=null,this._scrollbar=null}function Xe(t,e){this._peaks=t,this._zoomLevels=e,this._zoomLevelIndex=0}ge.prototype._handleKeyEvent=function(t){if(-1===fe.indexOf(t.target.nodeName))if(pe.indexOf(t.type)>-1&&t.preventDefault(),"keydown"===t.type||"keypress"===t.type)switch(t.keyCode){case 32:this.eventEmitter.emit("keyboard.space");break;case 9:this.eventEmitter.emit("keyboard.tab")}else if("keyup"===t.type)switch(t.keyCode){case 37:t.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case 39:t.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right")}},ge.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)},me.prototype._addMediaListener=function(t,e){this._listeners.push({type:t,callback:e}),this._mediaElement.addEventListener(t,e)},me.prototype.init=function(t){var e,n=this;return n._eventEmitter=t,n._listeners=[],n._duration=n.getDuration(),n._addMediaListener("timeupdate",function(){n._eventEmitter.emit("player.timeupdate",n.getCurrentTime())}),n._addMediaListener("playing",function(){n._eventEmitter.emit("player.playing",n.getCurrentTime())}),n._addMediaListener("pause",function(){n._eventEmitter.emit("player.pause",n.getCurrentTime())}),n._addMediaListener("ended",function(){n._eventEmitter.emit("player.ended")}),n._addMediaListener("seeked",function(){n._eventEmitter.emit("player.seeked",n.getCurrentTime())}),n._addMediaListener("canplay",function(){n._eventEmitter.emit("player.canplay")}),n._addMediaListener("error",function(t){n._eventEmitter.emit("player.error",t.target.error)}),n._interval=null,(e=n._mediaElement).src||e.querySelector("source")?n._mediaElement.error&&n._mediaElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?Promise.reject(n._mediaElement.error):new Promise(function(t,e){function i(r){n._mediaElement.removeEventListener("loadedmetadata",i),n._mediaElement.removeEventListener("error",i),"loadedmetadata"===r.type?t():e(r.target.error)}n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(n._mediaElement.addEventListener("loadedmetadata",i),n._mediaElement.addEventListener("error",i),n._mediaElement.load()):t()}):Promise.resolve()},me.prototype.destroy=function(){for(var t=0;t<this._listeners.length;t++){var e=this._listeners[t];this._mediaElement.removeEventListener(e.type,e.callback)}this._listeners.length=0,this._mediaElement=null},me.prototype.play=function(){return this._mediaElement.play()},me.prototype.pause=function(){this._mediaElement.pause()},me.prototype.isPlaying=function(){return!this._mediaElement.paused},me.prototype.isSeeking=function(){return this._mediaElement.seeking},me.prototype.getCurrentTime=function(){return this._mediaElement.currentTime},me.prototype.getDuration=function(){return this._mediaElement.duration},me.prototype.seek=function(t){this._mediaElement.currentTime=t},ve.prototype.setSource=function(t,e){var n=this;return n._options=t,n._callback=e,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),new Promise(function(e,i){n._resolve=e,n._reject=i,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),n._mediaElement.setAttribute("src",t.mediaUrl),n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&n._mediaElement.load()})},ve.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)},ve.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()},ve.prototype._playerErrorHandler=function(t){this._reset(),this._reject(t)},me.prototype.setSource=function(t){return t.mediaUrl?new ve(this._eventEmitter,this._mediaElement).setSource(t):Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"))},ye.prototype.init=function(){return this._adapter.init(this._peaks)},ye.prototype.destroy=function(){this._adapter.destroy()},ye.prototype.play=function(){return this._adapter.play()},ye.prototype.pause=function(){this._adapter.pause()},ye.prototype.isPlaying=function(){return this._adapter.isPlaying()},ye.prototype.isSeeking=function(){return this._adapter.isSeeking()},ye.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()},ye.prototype.getDuration=function(){return this._adapter.getDuration()},ye.prototype.seek=function(t){Ut(t)?this._adapter.seek(t):this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds")},ye.prototype.playSegment=function(t,e){var n=this;return t&&Ut(t.startTime)&&Ut(t.endTime)?(n._segment=t,n._loop=e,n.seek(t.startTime),n._peaks.once("player.playing",function(){n._playingSegment||(n._playingSegment=!0,window.requestAnimationFrame(n._playSegmentTimerCallback))}),n.play()):Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object"))},ye.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime){if(!this._loop)return this.pause(),this._peaks.emit("player.ended"),void(this._playingSegment=!1);this.seek(this._segment.startTime)}window.requestAnimationFrame(this._playSegmentTimerCallback)}else this._playingSegment=!1},ye.prototype._setSource=function(t){return this._adapter.setSource(t)},be.prototype.init=function(t){"zoomview"===this._options.view&&(this._label=new ht.Text({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new st.Rect({x:-4.5,y:0,width:10,height:20,fill:this._options.color,visible:this._draggable}),this._line=new rt.Line({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new ht.Text({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),t.add(this._handle),t.add(this._line),this._label&&t.add(this._label),t.add(this._time),this.fitToView(),this.bindEventHandlers(t)},be.prototype.bindEventHandlers=function(t){var e=this;e._handle.on("mouseover touchstart",function(){e._draggable&&(e._time.setX(-24-e._time.getWidth()),e._time.show())}),e._handle.on("mouseout touchend",function(){e._draggable&&e._time.hide()}),t.on("dragstart",function(){e._time.setX(-24-e._time.getWidth()),e._time.show()}),t.on("dragend",function(){e._time.hide()})},be.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._line.points([.5,0,.5,t]),this._label&&this._label.y(12),this._handle&&this._handle.y(t/2-10.5),this._time&&this._time.y(t/2-5)},be.prototype.update=function(t){void 0!==t.time&&this._time&&this._time.setText(this._options.layer.formatTime(t.time)),void 0!==t.labelText&&this._label&&this._label.text(t.labelText),void 0!==t.color&&(this._handle&&this._handle.fill(t.color),this._line.stroke(t.color)),void 0!==t.editable&&(this._draggable=t.editable,this._handle.visible(this._draggable))},we.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ht.Text({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new st.Rect({x:-4.5,y:0,width:10,height:20,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new rt.Line({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),t.add(this._label),t.add(this._line),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},we.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),e._handle.on("mouseout touchend",function(){e._label.hide()})},we.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._label.y(t/2-5),this._handle.y(t/2-10.5),this._line.points([.5,0,.5,t])},we.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime)),void 0!==t.editable&&(this._editable=t.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))},ke.prototype.addToStage=function(t){t.add(this._layer)},ke.prototype.showHighlight=function(t,e){this._highlightRect||this._createHighlightRect(t,e),this._update(t,e)},ke.prototype._update=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),i=this._view.timeToPixels(e);this._highlightRect.setAttrs({x:n,width:i-n})},ke.prototype._createHighlightRect=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),i=this._view.timeToPixels(e);this._highlightRect=new st.Rect({x:n,y:0,width:i-n,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)},ke.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)},ke.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)},ke.prototype.fitToView=function(){if(this._highlightRect){var t=this._view.getHeight(),e=Rt(this._offset,0,Math.floor(t/2));this._highlightRect.setAttrs({y:e,height:t-2*e})}},Te.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("dragstart",function(e){t._onDragStart(e,t._point)}),t._group.on("dragmove",function(e){t._onDragMove(e,t._point)}),t._group.on("dragend",function(e){t._onDragEnd(e,t._point)}),t._group.on("mouseenter",function(e){t._onMouseEnter(e,t._point)}),t._group.on("mouseleave",function(e){t._onMouseLeave(e,t._point)})},Te.prototype.addToLayer=function(t){t.add(this._group)},Te.prototype.fitToView=function(){this._marker.fitToView()},Te.prototype.getPoint=function(){return this._point},Te.prototype.getX=function(){return this._group.getX()},Te.prototype.setX=function(t){this._group.setX(t)},Te.prototype.getWidth=function(){return this._group.getWidth()},Te.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},Te.prototype.update=function(t){void 0!==t.editable&&this._group.draggable(t.editable),this._marker.update&&this._marker.update(t)},Te.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},Ae.prototype.addToStage=function(t){t.add(this._layer)},Ae.prototype.setListening=function(t){this._layer.listening(t)},Ae.prototype.enableEditing=function(t){this._enableEditing=t},Ae.prototype.getPointMarker=function(t){return this._pointMarkers[t.pid]},Ae.prototype.formatTime=function(t){return this._view.formatTime(t)},Ae.prototype._onPointsUpdate=function(t,e){var n=this._view.getStartTime(),i=this._view.getEndTime(),r=this.getPointMarker(t),o=t.isVisible(n,i);if(r&&!o)this._removePoint(t);else if(!r&&o)this._updatePoint(t);else if(r&&o){if(Ft(e,"time")){var a=this._view.timeToPixels(t.time)-this._view.getFrameOffset();r.setX(a)}r.update(e)}},Ae.prototype._onPointsAdd=function(t){var e=this,n=e._view.getStartTime(),i=e._view.getEndTime();t.points.forEach(function(t){t.isVisible(n,i)&&e._updatePoint(t)})},Ae.prototype._onPointsRemove=function(t){var e=this;t.points.forEach(function(t){e._removePoint(t)})},Ae.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}},Ae.prototype._createPointMarker=function(t){var e=this._enableEditing&&t.editable,n=this._view.getViewOptions();return new Te({point:t,draggable:e,marker:this._peaks.options.createPointMarker({point:t,editable:e,color:t.color,fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,layer:this,view:this._view.getName()}),onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})},Ae.prototype.getHeight=function(){return this._view.getHeight()},Ae.prototype._addPointMarker=function(t){var e=this._createPointMarker(t);return this._pointMarkers[t.pid]=e,e.addToLayer(this._layer),e},Ae.prototype._onPointsDrag=function(t){this._updatePoint(t.point).update({time:t.point.time})},Ae.prototype._onPointMarkerMouseEnter=function(t,e){this._peaks.emit("points.mouseenter",{point:e,evt:t.evt})},Ae.prototype._onPointMarkerMouseLeave=function(t,e){this._peaks.emit("points.mouseleave",{point:e,evt:t.evt})},Ae.prototype._onPointMarkerDragStart=function(t,e){this._dragPointMarker=this.getPointMarker(e),this._peaks.emit("points.dragstart",{point:e,evt:t.evt})},Ae.prototype._onPointMarkerDragMove=function(t,e){var n=this._pointMarkers[e.pid],i=n.getX()+n.getWidth();e._setTime(this._view.pixelOffsetToTime(i)),this._peaks.emit("points.dragmove",{point:e,evt:t.evt})},Ae.prototype._onPointMarkerDragEnd=function(t,e){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:e,evt:t.evt})},Ae.prototype._pointMarkerDragBoundFunc=function(t){return{x:Rt(t.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}},Ae.prototype.updatePoints=function(t,e){this._peaks.points.find(t,e).forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(t,e)},Ae.prototype._updatePoint=function(t){var e=this.getPointMarker(t);e||(e=this._addPointMarker(t));var n=this._view.timeToPixels(t.time)-this._view.getFrameOffset();return e.setX(n),e},Ae.prototype._removeInvisiblePoints=function(t,e){for(var n in this._pointMarkers)if(Ft(this._pointMarkers,n)){var i=this._pointMarkers[n].getPoint();i.isVisible(t,e)||this._removePoint(i)}},Ae.prototype._removePoint=function(t){var e=this.getPointMarker(t);e&&(e.destroy(),delete this._pointMarkers[t.pid])},Ae.prototype.setVisible=function(t){this._layer.setVisible(t)},Ae.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)},Ae.prototype.fitToView=function(){for(var t in this._pointMarkers){if(Ft(this._pointMarkers,t))this._pointMarkers[t].fitToView()}},Ae.prototype.draw=function(){this._layer.draw()},Pe.prototype.addToStage=function(t){t.add(this._playheadLayer)},Pe.prototype.zoomLevelChanged=function(){var t=this._view.timeToPixels(1);if(this._useAnimation=t>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var e=this._player.getCurrentTime();this.stop(e)}},Pe.prototype.fitToView=function(){var t=this._view.getHeight();this._playheadLine.points([.5,0,.5,t]),this._playheadText&&this._playheadText.y(12)},Pe.prototype._createPlayhead=function(){this._playheadLine=new rt.Line({stroke:this._playheadColor,strokeWidth:this._playheadWidth}),this._playheadGroup=new et.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)},Pe.prototype._createPlayheadText=function(){var t=this,e=t._player.getCurrentTime(),n=t._view.formatTime(e);t._playheadText=new ht.Text({x:0,y:0,padding:t._playheadPadding,text:n,fontSize:t._playheadFontSize,fontFamily:t._playheadFontFamily,fontStyle:t._playheadFontStyle,fill:t._playheadTextColor,align:"right",sceneFunc:function(e,n){var i=n.width(),r=n.height()+2*t._playheadPadding;e.fillStyle=t._playheadBackgroundColor,e.fillRect(0,-t._playheadPadding,i,r),n._sceneFunc(e)}}),t._playheadGroup.add(t._playheadText)},Pe.prototype.updatePlayheadTime=function(t){this._syncPlayhead(t),this._player.isPlaying()&&this._start()},Pe.prototype._syncPlayhead=function(t){var e=this._view.timeToPixels(t),n=this._view.getFrameOffset(),i=this._view.getWidth(),r=e>=n&&e<=n+i;if(this._playheadPixel=e,r){var o=this._playheadPixel-n;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(o),this._playheadText){var a=this._view.formatTime(t),s=this._playheadText.width();this._playheadText.setText(a),s+o>i-2?this._playheadText.setX(-s):s+o<i&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(t)},Pe.prototype._start=function(){var t=this;if(t._playheadLineAnimation&&(t._playheadLineAnimation.stop(),t._playheadLineAnimation=null),t._useAnimation){var e=null;t._playheadLineAnimation=new ut.Animation(function(){var n=t._player.getCurrentTime(),i=t._view.timeToPixels(n);i!==e&&(t._syncPlayhead(n),e=i)},t._playheadLayer),t._playheadLineAnimation.start()}},Pe.prototype.stop=function(t){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(t)},Pe.prototype.getPlayheadPixel=function(){return this._playheadPixel},Pe.prototype.showPlayheadTime=function(t){t?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)},Pe.prototype.updatePlayheadText=function(){if(this._playheadText){var t=this._player.getCurrentTime(),e=this._view.formatTime(t);this._playheadText.setText(e)}},Pe.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)},Ee.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new ht.Text({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new st.Rect({x:-4.5,y:0,width:10,height:20}),t.add(this._label),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},Ee.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show(),document.body.style.cursor="ew-resize"}),e._handle.on("mouseout touchend",function(){e._label.hide(),document.body.style.cursor="default"})},Ee.prototype.fitToView=function(){var t=this._options.layer.getHeight(),e=this._options.segmentOptions.overlayOffset,n=Rt(0,t-2*e);this._label.y(t/2-5),this._handle.y(e),this._handle.height(n)},Ee.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime))},Ie.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("click",function(e){t._onClick(t,e)}),t._group.on("dragstart",function(e){t._onDragStart(t,e)}),t._group.on("dragmove",function(e){t._onDragMove(t,e)}),t._group.on("dragend",function(e){t._onDragEnd(t,e)})},Ie.prototype.addToLayer=function(t){t.add(this._group)},Ie.prototype.moveToTop=function(){this._group.moveToTop()},Ie.prototype.fitToView=function(){this._marker.fitToView()},Ie.prototype.getSegment=function(){return this._segment},Ie.prototype.getX=function(){return this._group.getX()},Ie.prototype.setX=function(t){this._group.setX(t)},Ie.prototype.getWidth=function(){return this._group.getWidth()},Ie.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},Ie.prototype.isStartMarker=function(){return this._startMarker},Ie.prototype.update=function(t){void 0!==t.editable&&(this._group.visible(t.editable),this._group.draggable(t.editable)),this._marker.update&&this._marker.update(t)},Ie.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},Ie.prototype.startDrag=function(){this._group.startDrag()},Ie.prototype.stopDrag=function(){this._group.stopDrag()},De.prototype.getX=function(){return this._shape.getX()},De.prototype.setX=function(t){return this._shape.setX(t)},De.prototype.setSegment=function(t){this._segment=t},De.prototype.setWaveformColor=function(t){if(Nt(t))this._shape.fill(t),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else{if(!jt(t))throw new TypeError("Unknown type for color property");this._shape.fill(null);var e=this._view._height*(t.linearGradientStart/100),n=this._view._height*(t.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(e),this._shape.fillLinearGradientEndPointY(n),this._shape.fillLinearGradientColorStops([0,t.linearGradientColorStops[0],1,t.linearGradientColorStops[1]])}},De.prototype.fitToView=function(){this.setWaveformColor(this._color)},De.prototype._sceneFunc=function(t){var e=this._view.getFrameOffset(),n=this._view.getWidth(),i=this._view.getHeight();this._drawWaveform(t,this._view.getWaveformData(),e,this._segment?this._view.timeToPixels(this._segment.startTime):e,this._segment?this._view.timeToPixels(this._segment.endTime):e+n,n,i)},De.prototype._drawWaveform=function(t,e,n,i,r,o,a){i<n&&(i=n);var s=n+o;r>s&&(r=s),r>e.length-1&&(r=e.length-1);for(var l=e.channels,h=0,u=Math.floor(a/l),c=0;c<l;c++)c===l-1&&(u=a-(l-1)*u),this._drawChannel(t,e.channel(c),n,i,r,h,u),h+=u},De.prototype._drawChannel=function(t,e,n,i,r,o,a){var s,l,h,u,c=this._view.getAmplitudeScale();for(t.beginPath(),s=i;s<=r;s++)l=e.min_sample(s),h=s-n+.5,u=o+De.scaleY(l,a,c)+.5,t.lineTo(h,u);for(s=r;s>=i;s--)l=e.max_sample(s),h=s-n+.5,u=o+De.scaleY(l,a,c)+1,t.lineTo(h,u);t.closePath(),t.fillShape(this._shape)},De.prototype.addToLayer=function(t){t.add(this._shape)},De.prototype.destroy=function(){this._shape.destroy(),this._shape=null},De.prototype.on=function(t,e){this._shape.on(t,e)},De.prototype.off=function(t,e){this._shape.off(t,e)},De.scaleY=function(t,e,n){var i=-(e-1)*(t*n+128)/255+(e-1);return Rt(Math.floor(i),0,e-1)},Me.prototype._createMarkers=function(){var t,e,n,i=this._layer.isEditingEnabled()&&this._segment.editable,r=this._view.getViewOptions(),o=r.segmentOptions;this._segment.markers?t=this._peaks.options.createSegmentMarker:this._segment.overlay&&(t=Le),t&&(e=t({segment:this._segment,editable:i,startMarker:!0,color:o.startMarkerColor,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),e&&(this._startMarker=new Ie({segment:this._segment,segmentShape:this,editable:i,startMarker:!0,marker:e,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc})),t&&(n=t({segment:this._segment,editable:i,startMarker:!1,color:o.endMarkerColor,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),n&&(this._endMarker=new Ie({segment:this._segment,segmentShape:this,editable:i,startMarker:!1,marker:n,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))},Me.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},Me.prototype.update=function(t){var e,n=this._view.timeToPixelOffset(this._segment.startTime),i=this._view.timeToPixelOffset(this._segment.endTime),r=i-n;(e=this.getStartMarker())&&(e.setX(n-e.getWidth()),t&&e.update(t)),(e=this.getEndMarker())&&(e.setX(i),t&&e.update(t)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._label&&this._label.text(this._segment.labelText),this._overlayText&&this._overlayText.text(this._segment.labelText),this._segment.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:n,width:r,clipWidth:r<1?1:r}),this._overlayRect.setAttrs({x:0,width:r}),this._overlayText&&this._overlayText.setAttrs({width:r}))},Me.prototype.getSegment=function(){return this._segment},Me.prototype.getStartMarker=function(){return this._startMarker},Me.prototype.getEndMarker=function(){return this._endMarker},Me.prototype.addToLayer=function(t){this._waveformShape&&this._waveformShape.addToLayer(t),this._label&&t.add(this._label),this._overlay&&t.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(t),this._endMarker&&this._endMarker.addToLayer(t)},Me.prototype.isDragging=function(){return this._dragging},Me.prototype._onMouseEnter=function(t){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:t.evt})},Me.prototype._onMouseLeave=function(t){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:t.evt})},Me.prototype._onMouseDown=function(t){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:t.evt})},Me.prototype._onMouseUp=function(t){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:t.evt})},Me.prototype.segmentClicked=function(t,e){this._moveToTop(),this._peaks.emit("segments."+t,e)},Me.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()},Me.prototype.enableSegmentDragging=function(t){this._segment.editable&&(!this._draggable&&t?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!t&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(t),this._draggable=t)},Me.prototype._setPreviousAndNextSegments=function(){"overlap"!==this._view.getSegmentDragMode()?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)},Me.prototype._onSegmentDragStart=function(t){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},Me.prototype._onSegmentDragMove=function(t){var e,n=this._overlay.getX()-this._dragStartX,i=this._view.pixelsToTime(n),r=this._dragStartTime+i,o=this._dragEndTime+i,a=this._segment.endTime-this._segment.startTime,s=this._view.getMinSegmentDragWidth(),l=this._view.pixelsToTime(s),h=!1,u=!1;if(r<0&&(r=0,o=a,this._overlay.setX(this._view.timeToPixelOffset(r))),this._previousSegment){var c=this._view.timeToPixelOffset(this._previousSegment.endTime);if(r<this._previousSegment.endTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._previousSegment.editable)o=(r=this._previousSegment.endTime)+a,this._overlay.setX(c);else if("compress"===e){var d=r,f=this._previousSegment.startTime+l;d<f&&(d=f,c=this._view.timeToPixelOffset(d),this._overlay.setX(c),o=(r=d)+a),this._previousSegment.update({endTime:d}),h=!0}}if(this._nextSegment){var p=this._view.timeToPixelOffset(this._nextSegment.startTime);if(o>this._nextSegment.startTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._nextSegment.editable)r=(o=this._nextSegment.startTime)-a,this._overlay.setX(p-this._overlay.getWidth());else if("compress"===e){var g=o,m=this._nextSegment.endTime-l;g>m&&(g=m,p=this._view.timeToPixelOffset(g),this._overlay.setX(p-this._overlay.getWidth()),r=(o=g)-a),this._nextSegment.update({startTime:g}),u=!0}}this._segment._setStartTime(r),this._segment._setEndTime(o),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt}),h?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:t.evt}):u&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:t.evt})},Me.prototype._onSegmentDragEnd=function(t){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},Me.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()},Me.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()},Me.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()},Me.prototype._onSegmentMarkerDragStart=function(t,e){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:t.isStartMarker(),evt:e.evt})},Me.prototype._onSegmentMarkerDragMove=function(t,e){t.isStartMarker()?(this._segmentStartMarkerDragMove(t,e),t.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(t,e),t.update({endTime:this._segment.endTime}))},Me.prototype._segmentStartMarkerDragMove=function(t,e){var n=this._view.getWidth(),i=this._startMarker.getX(),r=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._endMarker.getX()-a;s>n&&(s=n);var l,h=!1,u=!1;if(this._previousSegment&&(h=(l=this._view.timeToPixelOffset(this._previousSegment.endTime))>=0),i>s)t.setX(s),this._overlay.clipWidth(s-r),0===a&&s<n?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(s));else if(this._previousSegment&&h){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._previousSegment.editable,f="compress"===c&&this._previousSegment.editable;if(i<=l){if(d)t.setX(l),this._overlay.clipWidth(l-r),this._segment._setStartTime(this._previousSegment.endTime);else if(f){var p=Oe(this._previousSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._previousSegment.startTime+o);i<g&&(i=g),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(i)}),u=!0}}else i<0&&(i=0),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i))}else i<0&&(i=0),t.setX(i),this._overlay.clipWidth(r-i),this._segment._setStartTime(this._view.pixelOffsetToTime(i));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:e.evt})},Me.prototype._segmentEndMarkerDragMove=function(t,e){var n=this._view.getWidth(),i=this._startMarker.getX(),r=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._startMarker.getX()+a;s<0&&(s=0);var l,h=!1,u=!1;if(this._nextSegment&&(h=(l=this._view.timeToPixelOffset(this._nextSegment.startTime))<n),r<s)t.setX(s),this._overlay.clipWidth(s-i),0===a&&s>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(s));else if(this._nextSegment&&h){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._nextSegment.editable,f="compress"===c&&this._nextSegment.editable;if(r>=l){if(d)t.setX(l),this._overlay.clipWidth(l-i),this._segment._setEndTime(this._nextSegment.startTime);else if(f){var p=Oe(this._nextSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._nextSegment.endTime-o);r>g&&(r=g),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(r)}),u=!0}}else r>n&&(r=n),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r))}else r>n&&(r=n),t.setX(r),this._overlay.clipWidth(r-i),this._segment._setEndTime(this._view.pixelOffsetToTime(r));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:e.evt})},Me.prototype._onSegmentMarkerDragEnd=function(t,e){this._nextSegment=null,this._previousSegment=null;var n=t.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:n,evt:e.evt})},Me.prototype._segmentMarkerDragBoundFunc=function(t,e){return{x:e.x,y:t.getAbsolutePosition().y}},Me.prototype._onSegmentMarkerClick=function(){this._moveToTop()},Me.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var t=this._view.getHeight(),e=Rt(0,t-2*this._overlayOffset);this._overlay.setAttrs({y:0,height:t,clipY:this._overlayOffset,clipHeight:e}),this._overlayRect.setAttrs({y:this._overlayOffset,height:e}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:e})}},Me.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()},Re.prototype.addToStage=function(t){t.add(this._layer)},Re.prototype.setListening=function(t){this._layer.listening(t)},Re.prototype.enableEditing=function(t){this._enableEditing=t},Re.prototype.isEditingEnabled=function(){return this._enableEditing},Re.prototype.enableSegmentDragging=function(t){for(var e in this._segmentShapes)Ft(this._segmentShapes,e)&&this._segmentShapes[e].enableSegmentDragging(t)},Re.prototype.getSegmentShape=function(t){return this._segmentShapes[t.pid]},Re.prototype.formatTime=function(t){return this._view.formatTime(t)},Re.prototype._onSegmentsUpdate=function(t,e){var n=this._view.getStartTime(),i=this._view.getEndTime(),r=this.getSegmentShape(t),o=t.isVisible(n,i);r&&!o?r.isDragging()||this._removeSegment(t):!r&&o?r=this._updateSegment(t):r&&o&&r.update(e)},Re.prototype._onSegmentsAdd=function(t){var e=this,n=e._view.getStartTime(),i=e._view.getEndTime();t.segments.forEach(function(t){t.isVisible(n,i)&&e._addSegmentShape(t).update()}),this.moveSegmentMarkersToTop()},Re.prototype._onSegmentsRemove=function(t){var e=this;t.segments.forEach(function(t){e._removeSegment(t)})},Re.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}},Re.prototype._onSegmentsDragged=function(t){this._updateSegment(t.segment)},Re.prototype._createSegmentShape=function(t){return new Me(t,this._peaks,this,this._view)},Re.prototype._addSegmentShape=function(t){var e=this._createSegmentShape(t);return e.addToLayer(this._layer),this._segmentShapes[t.pid]=e,e},Re.prototype.updateSegments=function(t,e){this._peaks.segments.find(t,e).forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(t,e)},Re.prototype._updateSegment=function(t){var e=this.getSegmentShape(t);e||(e=this._addSegmentShape(t)),e.update()},Re.prototype._removeInvisibleSegments=function(t,e){for(var n in this._segmentShapes)if(Ft(this._segmentShapes,n)){var i=this._segmentShapes[n].getSegment();i.isVisible(t,e)||this._removeSegment(i)}},Re.prototype._removeSegment=function(t){var e=this._segmentShapes[t.pid];e&&(e.destroy(),delete this._segmentShapes[t.pid])},Re.prototype.moveSegmentMarkersToTop=function(){for(var t in this._segmentShapes)Ft(this._segmentShapes,t)&&this._segmentShapes[t].moveMarkersToTop()},Re.prototype.setVisible=function(t){this._layer.setVisible(t)},Re.prototype.segmentClicked=function(t,e){var n=this._segmentShapes[e.segment.pid];n&&n.segmentClicked(t,e)},Re.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)},Re.prototype.fitToView=function(){for(var t in this._segmentShapes){if(Ft(this._segmentShapes,t))this._segmentShapes[t].fitToView()}},Re.prototype.draw=function(){this._layer.draw()},Re.prototype.getHeight=function(){return this._layer.getHeight()},Fe._buildFontString=function(t,e,n){return e||(e=11),t||(t="sans-serif"),n||(n="normal"),n+" "+e+"px "+t},Fe.prototype.addToLayer=function(t){t.add(this._axisShape)},Fe.prototype.showAxisLabels=function(t,e){this._showAxisLabels=t,e&&(Ft(e,"topMarkerHeight")&&(this._axisTopMarkerHeight=e.topMarkerHeight),Ft(e,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=e.bottomMarkerHeight))},Fe.prototype.setAxisLabelColor=function(t){this._axisLabelColor=t},Fe.prototype.setAxisGridlineColor=function(t){this._axisGridlineColor=t},Fe.prototype._getAxisLabelScale=function(t){for(var e,n=1,i=[1,2,5,10,20,30],r=0;;){if(e=n*i[r],!(t.timeToPixels(e)<60))break;++r===i.length&&(n*=60,r=0)}return e},Fe.prototype._drawAxis=function(t,e){var n=e.getStartTime(),i=this._getAxisLabelScale(e),r=function(t,e){if(0===e)return 0;var n=1;return t<0&&(n=-1,t=-t),n*((Math.ceil(t)+e-1)/e|0)*e}(n,i),o=r-n,a=e.timeToPixels(o);t.setAttr("strokeStyle",this._axisGridlineColor),t.setAttr("lineWidth",1),t.setAttr("font",this._axisLabelFont),t.setAttr("fillStyle",this._axisLabelColor),t.setAttr("textAlign","left"),t.setAttr("textBaseline","bottom");for(var s=e.getWidth(),l=e.getHeight(),h=r;;){var u=a+e.timeToPixels(h-r);if(u>=s)break;if(this._axisTopMarkerHeight>0&&(t.beginPath(),t.moveTo(u+.5,0),t.lineTo(u+.5,0+this._axisTopMarkerHeight),t.stroke()),this._axisBottomMarkerHeight>0&&(t.beginPath(),t.moveTo(u+.5,l),t.lineTo(u+.5,l-this._axisBottomMarkerHeight),t.stroke()),this._showAxisLabels){var c=this._formatAxisTime(h),d=u-t.measureText(c).width/2,f=l-1-this._axisBottomMarkerHeight;d>=0&&t.fillText(c,d,f)}h+=i}},Be.prototype.getViewOptions=function(){return this._viewOptions},Be.prototype.getWaveformData=function(){return this._data},Be.prototype.setWaveformData=function(t){this._data=t},Be.prototype.timeToPixels=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)},Be.prototype.pixelsToTime=function(t){return t*this._data.scale/this._data.sample_rate},Be.prototype.pixelOffsetToTime=function(t){return(this._frameOffset+t)*this._data.scale/this._data.sample_rate},Be.prototype.timeToPixelOffset=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)-this._frameOffset},Be.prototype.getFrameOffset=function(){return this._frameOffset},Be.prototype.getWidth=function(){return this._width},Be.prototype.getHeight=function(){return this._height},Be.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)},Be.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)},Be.prototype._getDuration=function(){return this._peaks.player.getDuration()},Be.prototype._createWaveform=function(){this._waveformLayer=new et.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)},Be.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new De({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var t=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:t},this._unplayedSegment={startTime:t,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new De({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},Be.prototype.setWaveformColor=function(t){this._waveformColor=t,this._waveformShape.setWaveformColor(t)},Be.prototype.setPlayedWaveformColor=function(t){this._playedWaveformColor=t,t?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(t)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},Be.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},Be.prototype._createAxisLabels=function(){this._axisLayer=new et.Layer({listening:!1}),this._axis=new Fe(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},Be.prototype.showAxisLabels=function(t,e){this._axis.showAxisLabels(t,e),this._axisLayer.draw()},Be.prototype.setAxisLabelColor=function(t){this._axis.setAxisLabelColor(t),this._axisLayer.draw()},Be.prototype.setAxisGridlineColor=function(t){this._axis.setAxisGridlineColor(t),this._axisLayer.draw()},Be.prototype.showPlayheadTime=function(t){this._playheadLayer.showPlayheadTime(t)},Be.prototype.setTimeLabelPrecision=function(t){this._timeLabelPrecision=t,this._playheadLayer.updatePlayheadText()},Be.prototype.formatTime=function(t){return this._formatPlayheadTime(t)},Be.prototype.setAmplitudeScale=function(t){if(!Wt(t)||("number"!=typeof(e=t)||e!=e||e===1/0||e===-1/0))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");var e;this._amplitudeScale=t,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()},Be.prototype.getAmplitudeScale=function(){return this._amplitudeScale},Be.prototype.enableSeek=function(t){this._enableSeek=t},Be.prototype.isSeekEnabled=function(){return this._enableSeek},Be.prototype._onClick=function(t){this._clickHandler(t,"click")},Be.prototype._onDblClick=function(t){this._clickHandler(t,"dblclick")},Be.prototype._onContextMenu=function(t){this._clickHandler(t,"contextmenu")},Be.prototype._clickHandler=function(t,e){var n=t.evt.offsetX;n<0&&(n=0);var i=!0;if(t.target!==this._stage){var r=Xt(t.target);if(r)if("point-marker"===r.attrs.name){var o=r.getAttr("point");o&&this._peaks.emit("points."+e,{point:o,evt:t.evt,preventViewEvent:function(){i=!1}})}else if("segment-overlay"===r.attrs.name){var a=r.getAttr("segment");if(a){var s={segment:a,evt:t.evt,preventViewEvent:function(){i=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(e,s)}}}if(i){var l=this.pixelOffsetToTime(n),h=this.getName();this._peaks.emit(h+"."+e,{time:l,evt:t.evt})}},Be.prototype.updatePlayheadTime=function(t){this._playheadLayer.updatePlayheadTime(t)},Be.prototype.playheadPosChanged=function(t){this._playedWaveformShape&&(this._playedSegment.endTime=t,this._unplayedSegment.startTime=t,this.drawWaveformLayer())},Be.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()},Be.prototype.enableMarkerEditing=function(t){this._segmentsLayer&&this._segmentsLayer.enableEditing(t),this._pointsLayer&&this._pointsLayer.enableEditing(t)},Be.prototype.dragSeek=function(t){this._segmentsLayer&&this._segmentsLayer.setListening(!t),this._pointsLayer&&this._pointsLayer.setListening(!t)},Be.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var t=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),t=this.containerWidthChange());var e=!1;this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.setHeight(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this.containerHeightChange(),e=!0),t?this.updateWaveform(this._frameOffset,!0):e&&(this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView())}},Be.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},We.prototype._mouseDown=function(t){var e=null;if("mousedown"!==t.type||0===t.evt.button){var n=Xt(t.target);if(n){if("point-marker"===n.attrs.name||"segment-marker"===n.attrs.name)return;"segment-overlay"===n.attrs.name&&(e=n)}if(this._lastMouseClientX=Math.floor("touchstart"===t.type?t.evt.touches[0].clientX:t.evt.clientX),this._handlers.onMouseDown){var i=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(i,e)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}},We.prototype._mouseMove=function(t){var e=Math.floor("touchmove"===t.type?t.changedTouches[0].clientX:t.clientX);if(e!==this._lastMouseClientX&&(this._lastMouseClientX=e,this._dragging=!0,this._handlers.onMouseMove)){var n=this._getMousePosX(e);this._handlers.onMouseMove(n)}},We.prototype._mouseUp=function(t){var e;if("touchend"===t.type?(e=Math.floor(t.changedTouches[0].clientX),t.cancelable&&t.preventDefault()):e=Math.floor(t.clientX),this._handlers.onMouseUp){var n=this._getMousePosX(e);this._handlers.onMouseUp(n)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1},We.prototype._getMousePosX=function(t){var e=this._stage.getContainer().getBoundingClientRect();return Math.floor(t-e.left)},We.prototype.isDragging=function(){return this._dragging},We.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)},Ue.prototype._onMouseDown=function(t){this._firstMove=!0,this._seek(t)},Ue.prototype._onMouseMove=function(t){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),this._seek(t)},Ue.prototype._onMouseUp=function(){this._view.dragSeek(!1)},Ue.prototype._seek=function(t){if(this._view.isSeekEnabled()){t=Rt(t,0,this._width);var e=this._view.pixelsToTime(t),n=this._peaks.player.getDuration();e>n&&(e=n),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)}},Ue.prototype.destroy=function(){this._mouseDragHandler.destroy()},Ge.prototype=Object.create(Be.prototype),Ge.prototype.initWaveformData=function(){0!==this._width&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},Ge.prototype.initHighlightLayer=function(){this._highlightLayer=new ke(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)},Ge.prototype.isSegmentDraggingEnabled=function(){return!1},Ge.prototype.getName=function(){return"overview"},Ge.prototype._onTimeUpdate=function(t){this._playheadLayer.updatePlayheadTime(t)},Ge.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},Ge.prototype._onPause=function(t){this._playheadLayer.stop(t)},Ge.prototype._onZoomviewUpdate=function(t){this.showHighlight(t.startTime,t.endTime)},Ge.prototype.showHighlight=function(t,e){this._highlightLayer.showHighlight(t,e)},Ge.prototype.setWaveformData=function(t){this._originalWaveformData=t,0!==this._width?this._resampleAndSetWaveformData(t,this._width):this._data=t,this.updateWaveform()},Ge.prototype._resampleAndSetWaveformData=function(t,e){try{return this._data=t.resample({width:e}),!0}catch(e){return this._data=t,!1}},Ge.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()},Ge.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var t=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(t),this._highlightLayer.updateHighlight();var e=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(0,e),this._segmentsLayer&&this._segmentsLayer.updateSegments(0,e)},Ge.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},Ge.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()},Ge.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._mouseDragHandler.destroy(),Be.prototype.destroy.call(this)},Ne.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},Ne.prototype._reset=function(){this._insertSegment=null,this._insertSegmentShape=null,this._segmentIsDraggable=!1,this._peaks.segments.setInserting(!1)},Ne.prototype._onMouseDown=function(t,e){if(this._reset(),this._segment=e,this._segment){if("overlap"!==this._view.getSegmentDragMode())return;this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1)}var n=this._view.pixelsToTime(t+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:n,endTime:n,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())},Ne.prototype._onMouseMove=function(){},Ne.prototype._onMouseUp=function(){this._insertSegment&&(this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1))},Ne.prototype.destroy=function(){this._mouseDragHandler.destroy()},ze.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},ze.prototype._onMouseDown=function(t,e){this._seeking=!1,this._firstMove=!0,e&&!e.attrs.draggable?this._segment=null:this._segment=e;var n=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(t-n)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){t=Rt(t,0,this._view.getWidth());var i=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(i)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=t},ze.prototype._onMouseMove=function(t){if(!this._segment||this._seeking)if(this._seeking){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),t=Rt(t,0,this._view.getWidth());var e=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(e)}else if(!this._view.isAutoZoom()){var n=this._mouseDownX-t,i=this._initialFrameOffset+n;i!==this._initialFrameOffset&&this._view.updateWaveform(i)}},ze.prototype._onMouseUp=function(){if(this._seeking)this._view.dragSeek(!1);else if(this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var t=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(t)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)},ze.prototype._seek=function(t){var e=this._peaks.player.getDuration();t>e&&(t=e),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)},ze.prototype.destroy=function(){this._mouseDragHandler.destroy()},He.prototype=Object.create(Be.prototype),He.prototype.initWaveformData=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var t=this._peaks.zoom.getZoomLevel();this._resampleData({scale:t})},He.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])},He.prototype.initHighlightLayer=function(){},He.prototype.setWheelMode=function(t,e){if(e||(e={}),(t!==this._wheelMode||e.captureVerticalScroll!==this._captureVerticalScroll)&&(this._stage.off("wheel"),this._wheelMode=t,this._captureVerticalScroll=e.captureVerticalScroll,"scroll"===t))e.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel)},He.prototype._onWheel=function(t){var e,n=t.evt;if(n.shiftKey)if(0!==n.deltaY)e=n.deltaY;else{if(0===n.deltaX)return;e=n.deltaX}else{if(Math.abs(n.deltaX)<Math.abs(n.deltaY))return;e=n.deltaX}n.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._width),n.preventDefault();var i=Rt(this._frameOffset+Math.floor(e),0,this._pixelLength-this._width);this.updateWaveform(i,!1)},He.prototype._onWheelCaptureVerticalScroll=function(t){var e=t.evt,n=Math.abs(e.deltaX)<Math.abs(e.deltaY)?e.deltaY:e.deltaX;e.preventDefault();var i=Rt(this._frameOffset+Math.floor(n),0,this._pixelLength-this._width);this.updateWaveform(i,!1)},He.prototype.setWaveformDragMode=function(t){this._segmentsLayer&&(this._mouseDragHandler.destroy(),this.dragSeek(!1),this._mouseDragHandler="insert-segment"===t?new Ne(this._peaks,this):new ze(this._peaks,this))},He.prototype.enableSegmentDragging=function(t){this._enableSegmentDragging=t,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(t)},He.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging},He.prototype.setSegmentDragMode=function(t){this._segmentDragMode=t},He.prototype.getSegmentDragMode=function(){return this._segmentDragMode},He.prototype.getName=function(){return"zoomview"},He.prototype._onTimeUpdate=function(t){this._mouseDragHandler.isDragging()||this._syncPlayhead(t)},He.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},He.prototype._onPause=function(t){this._playheadLayer.stop(t)},He.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)},He.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)},He.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)},He.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)},He.prototype._keyboardScroll=function(t,e){var n;n=e?t*this._width:t*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:n})},He.prototype.setWaveformData=function(t){this._originalWaveformData=t,this._initWaveformCache()},He.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset},He.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance},He.prototype._syncPlayhead=function(t){if(this._playheadLayer.updatePlayheadTime(t),this._autoScroll&&!this._zoomLevelAuto){var e=this.timeToPixels(t),n=this._frameOffset+this._width-this._autoScrollOffset,i=this._frameOffset;(e>=n||e<i)&&((i=e-this._autoScrollOffset)<0&&(i=0),this.updateWaveform(i,!1))}},He.prototype._getScale=function(t){return Math.floor(t*this._data.sample_rate/this._width)},He.prototype.setZoom=function(t){var e;if(function(t){return Ft(t,"scale")&&"auto"===t.scale||Ft(t,"seconds")&&"auto"===t.seconds}(t)){var n=this._originalWaveformData.duration;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,e=this._getScale(n)}else{if(Ft(t,"scale"))this._zoomLevelSeconds=null,e=Math.floor(t.scale);else if(Ft(t,"seconds")){if(!Ut(t.seconds))return!1;this._zoomLevelSeconds=t.seconds,e=this._getScale(t.seconds)}this._zoomLevelAuto=!1}e<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),e=this._originalWaveformData.scale);var i,r=this._peaks.player.getCurrentTime(),o=this.getPlayheadOffset();o>=0&&o<this._width?i=r:(o=Math.floor(this._width/2),i=this.pixelOffsetToTime(o));var a=this._scale;this._resampleData({scale:e});var s=this.timeToPixels(i)-o;return this.updateWaveform(s,!0),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(r),this._peaks.emit("zoom.update",{currentZoom:e,previousZoom:a}),!0},He.prototype._resampleData=function(t){var e=t.scale;if(this._enableWaveformCache){if(!this._waveformData.has(e)){for(var n=this._originalWaveformData,i=0;i<this._waveformScales.length&&this._waveformScales[i]<e;i++)n=this._waveformData.get(this._waveformScales[i]);this._waveformData.set(e,n.resample(t)),this._waveformScales.push(e),this._waveformScales.sort(function(t,e){return t-e})}this._data=this._waveformData.get(e)}else this._data=this._originalWaveformData.resample(t);this._scale=this._data.scale,this._pixelLength=this._data.length},He.prototype.isAutoZoom=function(){return this._zoomLevelAuto},He.prototype.setStartTime=function(t){t<0&&(t=0),this._zoomLevelAuto&&(t=0),this.updateWaveform(this.timeToPixels(t),!1)},He.prototype.getPixelLength=function(){return this._pixelLength},He.prototype.scrollWaveform=function(t){var e;if(Ft(t,"pixels"))e=Math.floor(t.pixels);else{if(!Ft(t,"seconds"))throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");e=this.timeToPixels(t.seconds)}this.updateWaveform(this._frameOffset+e,!1)},He.prototype.updateWaveform=function(t,e){var n;if(this._pixelLength<this._width?(t=0,n=this._width):n=this._pixelLength-this._width,t=Rt(t,0,n),e||t!==this._frameOffset){this._frameOffset=t;var i=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(i)),this.drawWaveformLayer(),this._axisLayer.draw();var r=this.getStartTime(),o=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(r,o),this._segmentsLayer&&this._segmentsLayer.updateSegments(r,o),this._peaks.emit("zoomview.update",{startTime:r,endTime:o})}},He.prototype.enableAutoScroll=function(t,e){e||(e={}),this._autoScroll=t,Ft(e,"offset")&&(this._autoScrollOffset=e.offset)},He.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth},He.prototype.setMinSegmentDragWidth=function(t){this._minSegmentDragWidth=t},He.prototype.containerWidthChange=function(){var t,e=!1;if(this._zoomLevelAuto?(e=!0,t={width:this._width}):null!==this._zoomLevelSeconds&&(e=!0,t={scale:this._getScale(this._zoomLevelSeconds)}),e)try{this._resampleData(t)}catch(t){}return!0},He.prototype.containerHeightChange=function(){},He.prototype.getStage=function(){return this._stage},He.prototype.getSegmentsLayer=function(){return this._segmentsLayer},He.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._enableWaveformCache?(this._waveformData.clear(),delete this._waveformData,delete this._waveformScales):delete this._data,this._mouseDragHandler.destroy(),Be.prototype.destroy.call(this)},Ve.prototype.setZoomview=function(t){this._zoomview=t,this._updateScrollbarWidthAndPosition()},Ve.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)},Ve.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth},Ve.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},Ve.prototype._onScrollboxDragStart=function(){this._dragging=!0},Ve.prototype._onScrollboxDragEnd=function(){this._dragging=!1},Ve.prototype._onScrollboxDragMove=function(){var t=this._getScrollbarRange(),e=Rt(this._scrollbox.x(),0,t);this._scrollbox.x(e),e!==this._scrollboxX&&(this._scrollboxX=e,this._zoomview&&this._updateWaveform(e))},Ve.prototype._onZoomviewUpdate=function(){this._dragging||this._updateScrollbarWidthAndPosition()},Ve.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var t=this._zoomview.getStartTime(),e=this._zoomview.getPixelLength()-this._zoomview.getWidth(),n=Math.floor(this._zoomview.timeToPixels(t)*this._getScrollbarRange()/e);this._scrollbox.x(n),this._layer.draw()}},Ve.prototype._onScrollbarClick=function(t){if(t.target===this._stage&&this._zoomview){var e=Math.floor(t.evt.offsetX-this._scrollboxWidth/2);e<0&&(e=0),this._updateWaveform(e)}},Ve.prototype._updateWaveform=function(t){var e=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*t/this._getScrollbarRange());this._zoomview.updateWaveform(e)},Ve.prototype.fitToContainer=function(){0===this._container.clientWidth&&0===this._container.clientHeight||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))},Ve.prototype.destroy=function(){this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._layer.destroy(),this._stage.destroy(),this._stage=null},je.prototype.createOverview=function(t){if(this._overview)return this._overview;var e=this._peaks.getWaveformData();return this._overview=new Ge(e,t,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview},je.prototype.createZoomview=function(t){if(this._zoomview)return this._zoomview;var e=this._peaks.getWaveformData();return this._zoomview=new He(e,t,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview},je.prototype.createScrollbar=function(t){return this._scrollbar=new Ve(t,this._peaks),this._scrollbar},je.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)},je.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())},je.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)},je.prototype.getView=function(t){if(zt(t))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(t){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}},je.prototype.getScrollbar=function(){return this._scrollbar},Xe.prototype.setZoomLevels=function(t){this._zoomLevels=t,this.setZoom(0,!0)},Xe.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1,!1)},Xe.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1,!1)},Xe.prototype.setZoom=function(t,e){if(t>=this._zoomLevels.length&&(t=this._zoomLevels.length-1),t<0&&(t=0),e||t!==this._zoomLevelIndex){this._zoomLevelIndex=t;var n=this._peaks.views.getView("zoomview");n&&n.setZoom({scale:this._zoomLevels[t]})}},Xe.prototype.getZoom=function(){return this._zoomLevelIndex},Xe.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var Ye="withCredentials"in new XMLHttpRequest;function Ze(t){this._peaks=t}function Ke(t){var e=t.getResponseHeader("content-range");if(!e)return!1;var n=e.match(/^bytes (\d+)-(\d+)\/(\d+)$/);if(n&&4===n.length){var i=parseInt(n[1],10),r=parseInt(n[2],10),o=parseInt(n[3],10);return 0===i&&r+1===o}return!1}function qe(){return It.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:Se,createSegmentLabel:Ce,createPointMarker:xe,logger:console.error.bind(console)},this}Ze.prototype.init=function(t,e){if(!(t.dataUri&&(t.webAudio||t.audioContext)||t.waveformData&&(t.webAudio||t.audioContext)||t.dataUri&&t.waveformData))return t.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),t.webAudio={audioContext:t.audioContext}),t.dataUri?this._getRemoteWaveformData(t,e):t.waveformData?this._buildWaveformFromLocalData(t,e):t.webAudio?t.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(t,e):this._buildWaveformDataUsingWebAudio(t,e):void e(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"));e(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."))},Ze.prototype._getRemoteWaveformData=function(t,e){var n,i=this,r=null,o=null;Gt(t.dataUri)?(r=t.dataUri,["ArrayBuffer","JSON"].some(function(t){if(window[t])return o=t.toLowerCase(),n=r[o],Boolean(n)}),n?(i._xhr=i._createXHR(n,o,t.withCredentials,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&Ke(this)){i._xhr=null;var n=_t.create(t.target.response);1===n.channels||2===n.channels?8===n.bits?e(void 0,n):e(new Error("Peaks.init(): 16-bit waveform data is not supported")):e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"))}else e(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){e(new Error("XHR failed"))},function(){e(new Error("XHR aborted"))}),i._xhr.send()):e(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"))):e(new TypeError("Peaks.init(): The dataUri option must be an object"))},Ze.prototype._buildWaveformFromLocalData=function(t,e){var n,i=null,r=null;if(Gt(t.waveformData))if(Gt((i=t.waveformData).json)?r=i.json:(n=i.arraybuffer,Object.prototype.toString.call(n).includes("ArrayBuffer")&&(r=i.arraybuffer)),r)try{var o=_t.create(r);if(1!==o.channels&&2!==o.channels)return void e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));if(8!==o.bits)return void e(new Error("Peaks.init(): 16-bit waveform data is not supported"));e(void 0,o)}catch(t){e(t)}else e(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));else e(new Error("Peaks.init(): The waveformData option must be an object"))},Ze.prototype._buildWaveformDataUsingWebAudio=function(t,e){var n=this,i=window.AudioContext||window.webkitAudioContext;if(t.webAudio.audioContext instanceof i){var r=t.webAudio;r.scale!==t.zoomLevels[0]&&(r.scale=t.zoomLevels[0]);var o=n._peaks.options.mediaElement.currentSrc;o?n._requestAudioAndBuildWaveformData(o,r,t.withCredentials,e):n._peaks.once("player.canplay",function(){n._requestAudioAndBuildWaveformData(n._peaks.options.mediaElement.currentSrc,r,t.withCredentials,e)})}else e(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"))},Ze.prototype._buildWaveformDataFromAudioBuffer=function(t,e){var n=t.webAudio;n.scale!==t.zoomLevels[0]&&(n.scale=t.zoomLevels[0]);var i={audio_buffer:n.audioBuffer,split_channels:n.multiChannel,scale:n.scale,disable_worker:!0};_t.createFromAudio(i,e)},Ze.prototype._requestAudioAndBuildWaveformData=function(t,e,n,i){var r=this;t?(r._xhr=r._createXHR(t,"arraybuffer",n,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&Ke(this)){r._xhr=null;var n={audio_context:e.audioContext,array_buffer:t.target.response,split_channels:e.multiChannel,scale:e.scale};_t.createFromAudio(n,i)}else i(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){i(new Error("XHR failed"))},function(){i(new Error("XHR aborted"))}),r._xhr.send()):r._peaks._logger("Peaks.init(): The mediaElement src is invalid")},Ze.prototype.abort=function(){this._xhr&&this._xhr.abort()},Ze.prototype._createXHR=function(t,e,n,i,r,o){var a=new XMLHttpRequest;if(a.open("GET",t,!0),Ye)try{a.responseType=e}catch(t){}return a.onload=i,a.onerror=r,Ye&&n&&(a.withCredentials=!0),a.addEventListener("abort",o),a},qe.prototype=Object.create(It.prototype);var Je={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,playheadWidth:1,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},Qe={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},$e={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},tn={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},en={color:"#888888",minWidth:50};function nn(t,e){for(var n in e)Ft(e,n)&&Ft(t,n)&&(t[n]=e[n]);return t}function rn(t){var e=t.zoomview.container,n=t.overview.container;return Vt(e)||Vt(n)?e&&(e.clientWidth<=0||e.clientHeight<=0)?new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height"):n&&(n.clientWidth<=0||n.clientHeight<=0)?new Error("Peaks.init(): The overview container must be visible and have non-zero width and height"):void 0:new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements")}qe.init=function(t,e){if(!e)throw new Error("Peaks.init(): Missing callback function");var n=new qe,i=n._setOptions(t);if(i||(i=rn(n.options)),i)e(i);else{var r=null;if(n.options.scrollbar){if(!Vt(r=n.options.scrollbar.container))return void e(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));if(r.clientWidth<=0)return void e(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"))}t.keyboard&&(n._keyboardHandler=new ge(n));var o=t.player?t.player:new me(n.options.mediaElement);n.player=new ye(n,o),n.segments=new de(n),n.points=new se(n),n.zoom=new Xe(n,n.options.zoomLevels),n.views=new je(n),n._waveformBuilder=new Ze(n),n.player.init(n).then(function(){n._waveformBuilder.init(n.options,function(i,o){if(i)e(i);else if(i=rn(n.options))e(i);else{n._waveformBuilder=null,n._waveformData=o;var a=n.options.zoomview.container,s=n.options.overview.container;a&&n.views.createZoomview(a),s&&n.views.createOverview(s),r&&n.views.createScrollbar(r),t.segments&&n.segments.add(t.segments),t.points&&n.points.add(t.points),t.emitCueEvents&&(n._cueEmitter=new te(n)),e(null,n)}})}).catch(function(t){e(t)})}},qe.prototype._setOptions=function(t){if(!Gt(t))return new TypeError("Peaks.init(): The options parameter should be an object");if(!t.player){if(!t.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(t.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}return t.logger&&"function"!=typeof t.logger?new TypeError("Peaks.init(): The logger option should be a function"):t.segments&&!Array.isArray(t.segments)?new TypeError("Peaks.init(): options.segments must be an array of segment objects"):t.points&&!Array.isArray(t.points)?new TypeError("Peaks.init(): options.points must be an array of point objects"):(nn(this.options,t),this.options.overview=function(t){var e={};return t.overview&&t.overview.showPlayheadTime&&(e.showPlayheadTime=t.overview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.overview&&Ft(t.overview,n)?e[n]=t.overview[n]:Ft(t,n)?e[n]=t[n]:Ft(e,n)||(Ft($e,n)?e[n]=$e[n]:Ft(Je,n)&&(e[n]=Je[n]))}),e}(t),this.options.zoomview=function(t){var e={};return t.showPlayheadTime?e.showPlayheadTime=t.showPlayheadTime:t.zoomview&&t.zoomview.showPlayheadTime&&(e.showPlayheadTime=t.zoomview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.zoomview&&Ft(t.zoomview,n)?e[n]=t.zoomview[n]:Ft(t,n)?e[n]=t[n]:Ft(e,n)||(Ft(Qe,n)?e[n]=Qe[n]:Ft(Je,n)&&(e[n]=Je[n]))}),e}(t),this.options.scrollbar=function(t){if(!Ft(t,"scrollbar"))return null;var e={};return["container","color","minWidth"].forEach(function(n){Ft(t.scrollbar,n)?e[n]=t.scrollbar[n]:e[n]=en[n]}),e}(t),function(t,e){t.segmentOptions={},Bt(t.segmentOptions,tn),e.segmentOptions&&nn(t.segmentOptions,e.segmentOptions),t.zoomview.segmentOptions={},Bt(t.zoomview.segmentOptions,t.segmentOptions),e.zoomview&&e.zoomview.segmentOptions&&nn(t.zoomview.segmentOptions,e.zoomview.segmentOptions),t.overview.segmentOptions={},Bt(t.overview.segmentOptions,t.segmentOptions),e.overview&&e.overview.segmentOptions&&nn(t.overview.segmentOptions,e.overview.segmentOptions)}(this.options,t),Array.isArray(this.options.zoomLevels)?0===this.options.zoomLevels.length?new Error("Peaks.init(): The zoomLevels array must not be empty"):function(t){if(0===t.length)return!0;for(var e=t[0],n=1;n<t.length;n++){if(e>=t[n])return!1;e=t[n]}return!0}(this.options.zoomLevels)?void(this._logger=this.options.logger):new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order"):new TypeError("Peaks.init(): The zoomLevels option should be an array"))},qe.prototype.setSource=function(t,e){var n=this;n.player._setSource(t).then(function(){t.zoomLevels||(t.zoomLevels=n.options.zoomLevels),n._waveformBuilder=new Ze(n),n._waveformBuilder.init(t,function(i,r){i?e(i):(n._waveformBuilder=null,n._waveformData=r,["overview","zoomview"].forEach(function(t){var e=n.views.getView(t);e&&e.setWaveformData(r)}),n.zoom.setZoomLevels(t.zoomLevels),e())})}).catch(function(t){e(t)})},qe.prototype.getWaveformData=function(){return this._waveformData},qe.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};var on,an,sn={};function ln(){if(an)return on;an=1;var e=function(t){return t&&t.Math===Math&&t};return on=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||e("object"==typeof on&&on)||function(){return this}()||Function("return this")()}var hn,un,cn,dn,fn,pn,gn,mn,vn={};function _n(){return un?hn:(un=1,hn=function(t){try{return!!t()}catch(t){return!0}})}function yn(){if(dn)return cn;dn=1;var t=_n();return cn=!t(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})}function bn(){if(pn)return fn;pn=1;var t=_n();return fn=!t(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})}function wn(){if(mn)return gn;mn=1;var t=bn(),e=Function.prototype.call;return gn=t?e.bind(e):function(){return e.apply(e,arguments)},gn}var Sn,Cn,xn,kn,Tn,An,Pn,En,In,Dn,Mn,Ln,On,Rn,Fn,Bn,Wn,Un,Gn,Nn,zn,Hn,Vn,jn,Xn,Yn,Zn,Kn,qn,Jn,Qn,$n,ti,ei,ni,ii,ri,oi,ai,si,li,hi={};function ui(){if(Sn)return hi;Sn=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return hi.f=n?function(t){var n=e(this,t);return!!n&&n.enumerable}:t,hi}function ci(){return xn?Cn:(xn=1,Cn=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}})}function di(){if(Tn)return kn;Tn=1;var t=bn(),e=Function.prototype,n=e.call,i=t&&e.bind.bind(n,n);return kn=t?i:function(t){return function(){return n.apply(t,arguments)}},kn}function fi(){if(Pn)return An;Pn=1;var t=di(),e=t({}.toString),n=t("".slice);return An=function(t){return n(e(t),8,-1)}}function pi(){if(In)return En;In=1;var t=di(),e=_n(),n=fi(),i=Object,r=t("".split);return En=e(function(){return!i("z").propertyIsEnumerable(0)})?function(t){return"String"===n(t)?r(t,""):i(t)}:i}function gi(){return Mn?Dn:(Mn=1,Dn=function(t){return null==t})}function mi(){if(On)return Ln;On=1;var t=gi(),e=TypeError;return Ln=function(n){if(t(n))throw new e("Can't call method on "+n);return n}}function vi(){if(Fn)return Rn;Fn=1;var t=pi(),e=mi();return Rn=function(n){return t(e(n))}}function _i(){if(Wn)return Bn;Wn=1;var t="object"==typeof document&&document.all;return Bn=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(t){return"function"==typeof t}}function yi(){if(Gn)return Un;Gn=1;var t=_i();return Un=function(e){return"object"==typeof e?null!==e:t(e)}}function bi(){if(zn)return Nn;zn=1;var t=ln(),e=_i();return Nn=function(n,i){return arguments.length<2?(r=t[n],e(r)?r:void 0):t[n]&&t[n][i];var r},Nn}function wi(){if(Vn)return Hn;Vn=1;var t=di();return Hn=t({}.isPrototypeOf)}function Si(){if(Xn)return jn;Xn=1;var t=ln().navigator,e=t&&t.userAgent;return jn=e?String(e):""}function Ci(){if(Zn)return Yn;Zn=1;var t,e,n=ln(),i=Si(),r=n.process,o=n.Deno,a=r&&r.versions||o&&o.version,s=a&&a.v8;return s&&(e=(t=s.split("."))[0]>0&&t[0]<4?1:+(t[0]+t[1])),!e&&i&&(!(t=i.match(/Edge\/(\d+)/))||t[1]>=74)&&(t=i.match(/Chrome\/(\d+)/))&&(e=+t[1]),Yn=e}function xi(){if(qn)return Kn;qn=1;var t=Ci(),e=_n(),n=ln().String;return Kn=!!Object.getOwnPropertySymbols&&!e(function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&t&&t<41})}function ki(){if(Qn)return Jn;Qn=1;var t=xi();return Jn=t&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}function Ti(){if(ti)return $n;ti=1;var t=bi(),e=_i(),n=wi(),i=ki(),r=Object;return $n=i?function(t){return"symbol"==typeof t}:function(i){var o=t("Symbol");return e(o)&&n(o.prototype,r(i))}}function Ai(){if(ni)return ei;ni=1;var t=String;return ei=function(e){try{return t(e)}catch(t){return"Object"}}}function Pi(){if(ri)return ii;ri=1;var t=_i(),e=Ai(),n=TypeError;return ii=function(i){if(t(i))return i;throw new n(e(i)+" is not a function")}}function Ei(){if(ai)return oi;ai=1;var t=Pi(),e=gi();return oi=function(n,i){var r=n[i];return e(r)?void 0:t(r)}}function Ii(){if(li)return si;li=1;var t=wn(),e=_i(),n=yi(),i=TypeError;return si=function(r,o){var a,s;if("string"===o&&e(a=r.toString)&&!n(s=t(a,r)))return s;if(e(a=r.valueOf)&&!n(s=t(a,r)))return s;if("string"!==o&&e(a=r.toString)&&!n(s=t(a,r)))return s;throw new i("Can't convert object to primitive value")}}var Di,Mi,Li,Oi,Ri,Fi,Bi,Wi,Ui,Gi,Ni,zi,Hi,Vi,ji,Xi,Yi,Zi,Ki,qi,Ji,Qi,$i,tr,er={exports:{}};function nr(){return Mi?Di:(Mi=1,Di=!1)}function ir(){if(Oi)return Li;Oi=1;var t=ln(),e=Object.defineProperty;return Li=function(n,i){try{e(t,n,{value:i,configurable:!0,writable:!0})}catch(e){t[n]=i}return i}}function rr(){if(Ri)return er.exports;Ri=1;var t=nr(),e=ln(),n=ir(),i="__core-js_shared__",r=er.exports=e[i]||n(i,{});return(r.versions||(r.versions=[])).push({version:"3.47.0",mode:t?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"}),er.exports}function or(){if(Bi)return Fi;Bi=1;var t=rr();return Fi=function(e,n){return t[e]||(t[e]=n||{})}}function ar(){if(Ui)return Wi;Ui=1;var t=mi(),e=Object;return Wi=function(n){return e(t(n))}}function sr(){if(Ni)return Gi;Ni=1;var t=di(),e=ar(),n=t({}.hasOwnProperty);return Gi=Object.hasOwn||function(t,i){return n(e(t),i)}}function lr(){if(Hi)return zi;Hi=1;var t=di(),e=0,n=Math.random(),i=t(1.1.toString);return zi=function(t){return"Symbol("+(void 0===t?"":t)+")_"+i(++e+n,36)}}function hr(){if(ji)return Vi;ji=1;var t=ln(),e=or(),n=sr(),i=lr(),r=xi(),o=ki(),a=t.Symbol,s=e("wks"),l=o?a.for||a:a&&a.withoutSetter||i;return Vi=function(t){return n(s,t)||(s[t]=r&&n(a,t)?a[t]:l("Symbol."+t)),s[t]}}function ur(){if(Yi)return Xi;Yi=1;var t=wn(),e=yi(),n=Ti(),i=Ei(),r=Ii(),o=hr(),a=TypeError,s=o("toPrimitive");return Xi=function(o,l){if(!e(o)||n(o))return o;var h,u=i(o,s);if(u){if(void 0===l&&(l="default"),h=t(u,o,l),!e(h)||n(h))return h;throw new a("Can't convert object to primitive value")}return void 0===l&&(l="number"),r(o,l)}}function cr(){if(Ki)return Zi;Ki=1;var t=ur(),e=Ti();return Zi=function(n){var i=t(n,"string");return e(i)?i:i+""}}function dr(){if(Ji)return qi;Ji=1;var t=ln(),e=yi(),n=t.document,i=e(n)&&e(n.createElement);return qi=function(t){return i?n.createElement(t):{}}}function fr(){if($i)return Qi;$i=1;var t=yn(),e=_n(),n=dr();return Qi=!t&&!e(function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a})}function pr(){if(tr)return vn;tr=1;var t=yn(),e=wn(),n=ui(),i=ci(),r=vi(),o=cr(),a=sr(),s=fr(),l=Object.getOwnPropertyDescriptor;return vn.f=t?l:function(t,h){if(t=r(t),h=o(h),s)try{return l(t,h)}catch(t){}if(a(t,h))return i(!e(n.f,t,h),t[h])},vn}var gr,mr,vr,_r,yr,br,wr,Sr={};function Cr(){if(mr)return gr;mr=1;var t=yn(),e=_n();return gr=t&&e(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})}function xr(){if(_r)return vr;_r=1;var t=yi(),e=String,n=TypeError;return vr=function(i){if(t(i))return i;throw new n(e(i)+" is not an object")}}function kr(){if(yr)return Sr;yr=1;var t=yn(),e=fr(),n=Cr(),i=xr(),r=cr(),o=TypeError,a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,l="enumerable",h="configurable",u="writable";return Sr.f=t?n?function(t,e,n){if(i(t),e=r(e),i(n),"function"==typeof t&&"prototype"===e&&"value"in n&&u in n&&!n[u]){var o=s(t,e);o&&o[u]&&(t[e]=n.value,n={configurable:h in n?n[h]:o[h],enumerable:l in n?n[l]:o[l],writable:!1})}return a(t,e,n)}:a:function(t,n,s){if(i(t),n=r(n),i(s),e)try{return a(t,n,s)}catch(t){}if("get"in s||"set"in s)throw new o("Accessors not supported");return"value"in s&&(t[n]=s.value),t},Sr}function Tr(){if(wr)return br;wr=1;var t=yn(),e=kr(),n=ci();return br=t?function(t,i,r){return e.f(t,i,n(1,r))}:function(t,e,n){return t[e]=n,t}}var Ar,Pr,Er,Ir,Dr,Mr,Lr,Or,Rr,Fr,Br,Wr,Ur,Gr,Nr,zr={exports:{}};function Hr(){if(Pr)return Ar;Pr=1;var t=yn(),e=sr(),n=Function.prototype,i=t&&Object.getOwnPropertyDescriptor,r=e(n,"name"),o=r&&"something"===function(){}.name,a=r&&(!t||t&&i(n,"name").configurable);return Ar={EXISTS:r,PROPER:o,CONFIGURABLE:a}}function Vr(){if(Ir)return Er;Ir=1;var t=di(),e=_i(),n=rr(),i=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(t){return i(t)}),Er=n.inspectSource}function jr(){if(Or)return Lr;Or=1;var t=or(),e=lr(),n=t("keys");return Lr=function(t){return n[t]||(n[t]=e(t))}}function Xr(){return Fr?Rr:(Fr=1,Rr={})}function Yr(){if(Wr)return Br;Wr=1;var t,e,n,i=function(){if(Mr)return Dr;Mr=1;var t=ln(),e=_i(),n=t.WeakMap;return Dr=e(n)&&/native code/.test(String(n))}(),r=ln(),o=yi(),a=Tr(),s=sr(),l=rr(),h=jr(),u=Xr(),c="Object already initialized",d=r.TypeError,f=r.WeakMap;if(i||l.state){var p=l.state||(l.state=new f);p.get=p.get,p.has=p.has,p.set=p.set,t=function(t,e){if(p.has(t))throw new d(c);return e.facade=t,p.set(t,e),e},e=function(t){return p.get(t)||{}},n=function(t){return p.has(t)}}else{var g=h("state");u[g]=!0,t=function(t,e){if(s(t,g))throw new d(c);return e.facade=t,a(t,g,e),e},e=function(t){return s(t,g)?t[g]:{}},n=function(t){return s(t,g)}}return Br={set:t,get:e,has:n,enforce:function(i){return n(i)?e(i):t(i,{})},getterFor:function(t){return function(n){var i;if(!o(n)||(i=e(n)).type!==t)throw new d("Incompatible receiver, "+t+" required");return i}}}}function Zr(){if(Ur)return zr.exports;Ur=1;var t=di(),e=_n(),n=_i(),i=sr(),r=yn(),o=Hr().CONFIGURABLE,a=Vr(),s=Yr(),l=s.enforce,h=s.get,u=String,c=Object.defineProperty,d=t("".slice),f=t("".replace),p=t([].join),g=r&&!e(function(){return 8!==c(function(){},"length",{value:8}).length}),m=String(String).split("String"),v=zr.exports=function(t,e,n){"Symbol("===d(u(e),0,7)&&(e="["+f(u(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!i(t,"name")||o&&t.name!==e)&&(r?c(t,"name",{value:e,configurable:!0}):t.name=e),g&&n&&i(n,"arity")&&t.length!==n.arity&&c(t,"length",{value:n.arity});try{n&&i(n,"constructor")&&n.constructor?r&&c(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var a=l(t);return i(a,"source")||(a.source=p(m,"string"==typeof e?e:"")),t};return Function.prototype.toString=v(function(){return n(this)&&h(this).source||a(this)},"toString"),zr.exports}function Kr(){if(Nr)return Gr;Nr=1;var t=_i(),e=kr(),n=Zr(),i=ir();return Gr=function(r,o,a,s){s||(s={});var l=s.enumerable,h=void 0!==s.name?s.name:o;if(t(a)&&n(a,h,s),s.global)l?r[o]=a:i(o,a);else{try{s.unsafe?r[o]&&(l=!0):delete r[o]}catch(t){}l?r[o]=a:e.f(r,o,{value:a,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return r}}var qr,Jr,Qr,$r,to,eo,no,io,ro,oo,ao,so,lo,ho,uo,co,fo,po={};function go(){if($r)return Qr;$r=1;var t=function(){if(Jr)return qr;Jr=1;var t=Math.ceil,e=Math.floor;return qr=Math.trunc||function(n){var i=+n;return(i>0?e:t)(i)}}();return Qr=function(e){var n=+e;return n!=n||0===n?0:t(n)}}function mo(){if(eo)return to;eo=1;var t=go(),e=Math.max,n=Math.min;return to=function(i,r){var o=t(i);return o<0?e(o+r,0):n(o,r)}}function vo(){if(io)return no;io=1;var t=go(),e=Math.min;return no=function(n){var i=t(n);return i>0?e(i,9007199254740991):0}}function _o(){if(oo)return ro;oo=1;var t=vo();return ro=function(e){return t(e.length)}}function yo(){if(so)return ao;so=1;var t=vi(),e=mo(),n=_o(),i=function(i){return function(r,o,a){var s=t(r),l=n(s);if(0===l)return!i&&-1;var h,u=e(a,l);if(i&&o!=o){for(;l>u;)if((h=s[u++])!=h)return!0}else for(;l>u;u++)if((i||u in s)&&s[u]===o)return i||u||0;return!i&&-1}};return ao={includes:i(!0),indexOf:i(!1)}}function bo(){if(ho)return lo;ho=1;var t=di(),e=sr(),n=vi(),i=yo().indexOf,r=Xr(),o=t([].push);return lo=function(t,a){var s,l=n(t),h=0,u=[];for(s in l)!e(r,s)&&e(l,s)&&o(u,s);for(;a.length>h;)e(l,s=a[h++])&&(~i(u,s)||o(u,s));return u}}function wo(){return co?uo:(co=1,uo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"])}function So(){if(fo)return po;fo=1;var t=bo(),e=wo().concat("length","prototype");return po.f=Object.getOwnPropertyNames||function(n){return t(n,e)},po}var Co,xo,ko,To,Ao,Po,Eo,Io,Do,Mo,Lo,Oo,Ro,Fo,Bo,Wo,Uo,Go,No,zo,Ho,Vo,jo,Xo,Yo,Zo,Ko,qo,Jo={};function Qo(){return Co||(Co=1,Jo.f=Object.getOwnPropertySymbols),Jo}function $o(){if(Ao)return To;Ao=1;var t=sr(),e=function(){if(ko)return xo;ko=1;var t=bi(),e=di(),n=So(),i=Qo(),r=xr(),o=e([].concat);return xo=t("Reflect","ownKeys")||function(t){var e=n.f(r(t)),a=i.f;return a?o(e,a(t)):e},xo}(),n=pr(),i=kr();return To=function(r,o,a){for(var s=e(o),l=i.f,h=n.f,u=0;u<s.length;u++){var c=s[u];t(r,c)||a&&t(a,c)||l(r,c,h(o,c))}},To}function ta(){if(Eo)return Po;Eo=1;var t=_n(),e=_i(),n=/#|\.prototype\./,i=function(n,i){var l=o[r(n)];return l===s||l!==a&&(e(i)?t(i):!!i)},r=i.normalize=function(t){return String(t).replace(n,".").toLowerCase()},o=i.data={},a=i.NATIVE="N",s=i.POLYFILL="P";return Po=i}function ea(){if(Do)return Io;Do=1;var t=ln(),e=pr().f,n=Tr(),i=Kr(),r=ir(),o=$o(),a=ta();return Io=function(s,l){var h,u,c,d,f,p=s.target,g=s.global,m=s.stat;if(h=g?t:m?t[p]||r(p,{}):t[p]&&t[p].prototype)for(u in l){if(d=l[u],c=s.dontCallGetSet?(f=e(h,u))&&f.value:h[u],!a(g?u:p+(m?".":"#")+u,s.forced)&&void 0!==c){if(typeof d==typeof c)continue;o(d,c)}(s.sham||c&&c.sham)&&n(d,"sham",!0),i(h,u,d,s)}}}function na(){if(Lo)return Mo;Lo=1;var t=fi();return Mo=Array.isArray||function(e){return"Array"===t(e)}}function ia(){if(Ro)return Oo;Ro=1;var t=TypeError;return Oo=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}}function ra(){if(Bo)return Fo;Bo=1;var t=yn(),e=kr(),n=ci();return Fo=function(i,r,o){t?e.f(i,r,n(0,o)):i[r]=o}}function oa(){if(Uo)return Wo;Uo=1;var t={};return t[hr()("toStringTag")]="z",Wo="[object z]"===String(t)}function aa(){if(No)return Go;No=1;var t=oa(),e=_i(),n=fi(),i=hr()("toStringTag"),r=Object,o="Arguments"===n(function(){return arguments}());return Go=t?n:function(t){var a,s,l;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(s=function(t,e){try{return t[e]}catch(t){}}(a=r(t),i))?s:o?n(a):"Object"===(l=n(a))&&e(a.callee)?"Arguments":l}}function sa(){if(Ho)return zo;Ho=1;var t=di(),e=_n(),n=_i(),i=aa(),r=bi(),o=Vr(),a=function(){},s=r("Reflect","construct"),l=/^\s*(?:class|function)\b/,h=t(l.exec),u=!l.test(a),c=function(t){if(!n(t))return!1;try{return s(a,[],t),!0}catch(t){return!1}},d=function(t){if(!n(t))return!1;switch(i(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!h(l,o(t))}catch(t){return!0}};return d.sham=!0,zo=!s||e(function(){var t;return c(c.call)||!c(Object)||!c(function(){t=!0})||t})?d:c}function la(){if(jo)return Vo;jo=1;var t=na(),e=sa(),n=yi(),i=hr()("species"),r=Array;return Vo=function(o){var a;return t(o)&&(a=o.constructor,(e(a)&&(a===r||t(a.prototype))||n(a)&&null===(a=a[i]))&&(a=void 0)),void 0===a?r:a}}function ha(){if(Yo)return Xo;Yo=1;var t=la();return Xo=function(e,n){return new(t(e))(0===n?0:n)}}function ua(){if(Ko)return Zo;Ko=1;var t=_n(),e=hr(),n=Ci(),i=e("species");return Zo=function(e){return n>=51||!t(function(){var t=[];return(t.constructor={})[i]=function(){return{foo:1}},1!==t[e](Boolean).foo})}}!function(){if(qo)return sn;qo=1;var t=ea(),e=_n(),n=na(),i=yi(),r=ar(),o=_o(),a=ia(),s=ra(),l=ha(),h=ua(),u=hr(),c=Ci(),d=u("isConcatSpreadable"),f=c>=51||!e(function(){var t=[];return t[d]=!1,t.concat()[0]!==t}),p=function(t){if(!i(t))return!1;var e=t[d];return void 0!==e?!!e:n(t)};t({target:"Array",proto:!0,arity:1,forced:!f||!h("concat")},{concat:function(t){var e,n,i,h,u,c=r(this),d=l(c,0),f=0;for(e=-1,i=arguments.length;e<i;e++)if(p(u=-1===e?c:arguments[e]))for(h=o(u),a(f+h),n=0;n<h;n++,f++)n in u&&s(d,f,u[n]);else a(f+1),s(d,f++,u);return d.length=f,d}})}();var ca,da,fa,pa,ga,ma={};function va(){if(da)return ca;da=1;var t=fi(),e=di();return ca=function(n){if("Function"===t(n))return e(n)}}function _a(){if(pa)return fa;pa=1;var t=_n();return fa=function(e,n){var i=[][e];return!!i&&t(function(){i.call(null,n||function(){return 1},1)})}}!function(){if(ga)return ma;ga=1;var t=ea(),e=va(),n=yo().indexOf,i=_a(),r=e([].indexOf),o=!!r&&1/r([1],1,-0)<0;t({target:"Array",proto:!0,forced:o||!i("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return o?r(this,t,e)||0:n(this,t,e)}})}();var ya,ba,wa,Sa,Ca,xa={};function ka(){if(Sa)return wa;Sa=1;var t=Ai(),e=TypeError;return wa=function(n,i){if(!delete n[i])throw new e("Cannot delete property "+t(i)+" of "+t(n))}}!function(){if(Ca)return xa;Ca=1;var t=ea(),e=ar(),n=mo(),i=go(),r=_o(),o=function(){if(ba)return ya;ba=1;var t=yn(),e=na(),n=TypeError,i=Object.getOwnPropertyDescriptor,r=t&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();return ya=r?function(t,r){if(e(t)&&!i(t,"length").writable)throw new n("Cannot set read only .length");return t.length=r}:function(t,e){return t.length=e}}(),a=ia(),s=ha(),l=ra(),h=ka(),u=ua()("splice"),c=Math.max,d=Math.min;t({target:"Array",proto:!0,forced:!u},{splice:function(t,u){var f,p,g,m,v,_,y=e(this),b=r(y),w=n(t,b),S=arguments.length;for(0===S?f=p=0:1===S?(f=0,p=b-w):(f=S-2,p=d(c(i(u),0),b-w)),a(b+f-p),g=s(y,p),m=0;m<p;m++)(v=w+m)in y&&l(g,m,y[v]);if(g.length=p,f<p){for(m=w;m<b-p;m++)_=m+f,(v=m+p)in y?y[_]=y[v]:h(y,_);for(m=b;m>b-p+f;m--)h(y,m-1)}else if(f>p)for(m=b-p;m>w;m--)_=m+f-1,(v=m+p-1)in y?y[_]=y[v]:h(y,_);for(m=0;m<f;m++)y[m+w]=arguments[m+2];return o(y,b-p+f),g}})}();var Ta,Aa,Pa,Ea={};!function(){if(Pa)return Ea;Pa=1;var t=oa(),e=Kr(),n=function(){if(Aa)return Ta;Aa=1;var t=oa(),e=aa();return Ta=t?{}.toString:function(){return"[object "+e(this)+"]"}}();t||e(Object.prototype,"toString",n,{unsafe:!0})}();var Ia,Da,Ma={};Da||(Da=1,function(){if(Ia)return Ma;Ia=1;var t=ea(),e=ln();t({global:!0,forced:e.globalThis!==e},{globalThis:e})}());var La,Oa,Ra,Fa,Ba,Wa,Ua,Ga,Na,za,Ha,Va={};function ja(){return Oa?La:(Oa=1,La={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})}function Xa(){if(Fa)return Ra;Fa=1;var t=dr()("span").classList,e=t&&t.constructor&&t.constructor.prototype;return Ra=e===Object.prototype?void 0:e}function Ya(){if(Wa)return Ba;Wa=1;var t=va(),e=Pi(),n=bn(),i=t(t.bind);return Ba=function(t,r){return e(t),void 0===r?t:n?i(t,r):function(){return t.apply(r,arguments)}},Ba}function Za(){if(Ga)return Ua;Ga=1;var t=Ya(),e=di(),n=pi(),i=ar(),r=_o(),o=ha(),a=e([].push),s=function(e){var s=1===e,l=2===e,h=3===e,u=4===e,c=6===e,d=7===e,f=5===e||c;return function(p,g,m,v){for(var _,y,b=i(p),w=n(b),S=r(w),C=t(g,m),x=0,k=v||o,T=s?k(p,S):l||d?k(p,0):void 0;S>x;x++)if((f||x in w)&&(y=C(_=w[x],x,b),e))if(s)T[x]=y;else if(y)switch(e){case 3:return!0;case 5:return _;case 6:return x;case 2:a(T,_)}else switch(e){case 4:return!1;case 7:a(T,_)}return c?-1:h||u?u:T}};return Ua={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}}!function(){if(Ha)return Va;Ha=1;var t=ln(),e=ja(),n=Xa(),i=function(){if(za)return Na;za=1;var t=Za().forEach,e=_a()("forEach");return Na=e?[].forEach:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)},Na}(),r=Tr(),o=function(t){if(t&&t.forEach!==i)try{r(t,"forEach",i)}catch(e){t.forEach=i}};for(var a in e)e[a]&&o(t[a]&&t[a].prototype);o(n)}();var Ka="undefined"!=typeof window?window:globalThis;Ka.StarmusRegistry||(Ka.StarmusRegistry={});var qa=Ka.StarmusRegistry;function Ja(){}var Qa={subscribe:function(t,e){return qa[t]||(qa[t]=[]),qa[t].push(e),console.log("[Bus] Listener added for: ".concat(t)),function(){var n=qa[t].indexOf(e);n>-1&&qa[t].splice(n,1)}},dispatch:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=qa[t];i&&i.length?(console.log("[Bus] Dispatching '".concat(t,"' to ").concat(i.length," listeners"),n),i.forEach(function(t){try{t(e,n)}catch(t){console.error(t)}})):console.warn("[Bus]  Dispatched '".concat(t,"' but nobody is listening."))},debugLog:Ja};Ka.CommandBus=Qa,Ka.StarmusHooks=Qa;var $a,ts,es,ns={};function is(){if(ts)return $a;ts=1;var t=di();return $a=t([].slice)}!function(){if(es)return ns;es=1;var t=ea(),e=na(),n=sa(),i=yi(),r=mo(),o=_o(),a=vi(),s=ra(),l=hr(),h=ua(),u=is(),c=h("slice"),d=l("species"),f=Array,p=Math.max;t({target:"Array",proto:!0,forced:!c},{slice:function(t,l){var h,c,g,m=a(this),v=o(m),_=r(t,v),y=r(void 0===l?v:l,v);if(e(m)&&(h=m.constructor,(n(h)&&(h===f||e(h.prototype))||i(h)&&null===(h=h[d]))&&(h=void 0),h===f||void 0===h))return u(m,_,y);for(c=new(void 0===h?f:h)(p(y-_,0)),g=0;_<y;_++,g++)_ in m&&s(c,g,m[_]);return c.length=g,c}})}();var rs,os,as,ss={};function ls(){if(os)return rs;os=1;var t=Zr(),e=kr();return rs=function(n,i,r){return r.get&&t(r.get,i,{getter:!0}),r.set&&t(r.set,i,{setter:!0}),e.f(n,i,r)}}!function(){if(as)return ss;as=1;var t=yn(),e=Hr().EXISTS,n=di(),i=ls(),r=Function.prototype,o=n(r.toString),a=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,s=n(a.exec);t&&!e&&i(r,"name",{configurable:!0,get:function(){try{return s(a,o(this))[1]}catch(t){return""}}})}(),function(t){var e={instanceId:null,tier:null,status:"uninitialized",step:1,error:null,env:{device:{},browser:{},network:{},identifiers:{},errors:[]},source:{kind:null,blob:null,file:null,fileName:"",transcript:"",interimTranscript:"",metadata:{duration:0,mimeType:"",fileSize:0}},calibration:{phase:null,message:"",volumePercent:0,complete:!1,gain:1,speechLevel:0},recorder:{duration:0,amplitude:0,isPlaying:!1,isPaused:!1},submission:{progress:0,isQueued:!1}};function n(t){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function i(t,e){var i=n(t);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i}function r(t){var r=i(e,t||{}),o=[];return{getState:function(){return r},dispatch:function(t){r=function(t,r){if(!r||!r.type)return t;switch(!t.instanceId&&r.payload&&r.payload.instanceId&&(t=i(t,{instanceId:r.payload.instanceId})),r.type){case"starmus/init":return i(t,i(r.payload||{},{status:"idle",error:null}));case"starmus/env-update":var o=i(t.env,r.payload||{});return o.errors||(o.errors=t.env.errors||[]),i(t,{env:o});case"starmus/error":var a=r.error||r.payload,s=t.env&&t.env.errors?t.env.errors.slice():[];return s.push({code:a.code||"RUNTIME_ERROR",message:a.message||"Unknown",timestamp:Date.now(),severity:!1===a.retryable?"hard":"soft"}),i(t,{error:a,env:i(t.env,{errors:s})});case"starmus/tier-ready":return i(t,{tier:r.payload.tier||t.tier});case"starmus/ui/step-continue":return i(t,{step:2,status:"idle",error:null});case"starmus/calibration-start":return i(t,{status:"calibrating"});case"starmus/calibration-update":return i(t,{calibration:i(t.calibration,{message:r.message,volumePercent:r.volumePercent})});case"starmus/calibration-complete":return i(t,{status:"ready",calibration:i(t.calibration,i(r.payload.calibration||{},{complete:!0}))});case"starmus/mic-start":return i(t,{status:"recording",error:null,recorder:i(t.recorder,{duration:0,isPaused:!1})});case"starmus/mic-pause":return i(t,{status:"paused",recorder:i(t.recorder,{isPaused:!0})});case"starmus/mic-resume":return i(t,{status:"recording",recorder:i(t.recorder,{isPaused:!1})});case"starmus/mic-stop":return i(t,{status:"ready_to_submit"});case"starmus/recorder-tick":return i(t,{recorder:i(t.recorder,{duration:r.duration,amplitude:r.amplitude})});case"starmus/recording-available":return i(t,{status:"ready_to_submit",source:i(t.source,{kind:"blob",blob:r.payload.blob,fileName:r.payload.fileName,metadata:{duration:t.recorder.duration||0,mimeType:r.payload.blob.type||"audio/webm",fileSize:r.payload.blob.size||0}})});case"starmus/transcript-update":return i(t,{source:i(t.source,{transcript:r.transcript})});case"starmus/transcript-interim":return i(t,{source:i(t.source,{interimTranscript:r.interim})});case"starmus/file-attached":return i(t,{status:"ready_to_submit",source:{kind:"file",file:r.file,fileName:r.file.name,metadata:{duration:0,mimeType:r.file.type,fileSize:r.file.size}}});case"starmus/submit-start":return i(t,{status:"submitting",error:null});case"starmus/submit-progress":return i(t,{submission:i(t.submission,{progress:r.progress})});case"starmus/submit-complete":return i(t,{status:"complete",submission:{progress:1,isQueued:!1}});case"starmus/submit-queued":return i(t,{status:"complete",submission:{progress:0,isQueued:!0}});case"starmus/reset":return i(n(e),{instanceId:t.instanceId,env:t.env,tier:t.tier,status:"idle"});default:return t}}(r,t);for(var a=0;a<o.length;a++)o[a](r)},subscribe:function(t){return o.push(t),function(){o.splice(o.indexOf(t),1)}}}}t.StarmusStore=t.StarmusStore||{},t.StarmusStore.createStore=r,"undefined"!=typeof module&&module.exports&&(module.exports={createStore:r})}("undefined"!=typeof window?window:globalThis);var hs="undefined"!=typeof window?window:globalThis;function us(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function cs(t,e,n,i,r,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,r)}function ds(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function a(t){cs(o,i,r,a,s,"next",t)}function s(t){cs(o,i,r,a,s,"throw",t)}a(void 0)})}}function fs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ps(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Ss(i.key),i)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function gs(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=xs(t))||e){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ms(t,e,n){return(e=Ss(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function _s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vs(Object(n),!0).forEach(function(e){ms(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ys(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var l=i&&i.prototype instanceof s?i:s,h=Object.create(l.prototype);return bs(h,"_invoke",function(n,i,r){var o,s,l,h=0,u=r||[],c=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,s=0,l=t,d.n=n,a}};function f(n,i){for(s=n,l=i,e=0;!c&&h&&!r&&e<u.length;e++){var r,o=u[e],f=d.p,p=o[2];n>3?(r=p===i)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=f&&((r=n<2&&f<o[1])?(s=0,d.v=i,d.n=o[1]):f<p&&(r=n<3||o[0]>i||i>p)&&(o[4]=n,o[5]=i,d.n=p,s=0))}if(r||n>1)return a;throw c=!0,i}return function(r,u,p){if(h>1)throw TypeError("Generator is already running");for(c&&1===u&&f(u,p),s=u,l=p;(e=s<2?t:l)||!c;){o||(s?s<3?(s>1&&(d.n=-1),f(s,l)):d.n=l:d.v=l);try{if(h=2,o){if(s||(r="next"),e=o[r]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=t}else if((e=(c=d.n<0)?l:n.call(i,d))!==a)break}catch(e){o=t,s=1,l=e}finally{h=1}}return{value:e,done:c}}}(n,r,o),!0),h}var a={};function s(){}function l(){}function h(){}e=Object.getPrototypeOf;var u=[][i]?e(e([][i]())):(bs(e={},i,function(){return this}),e),c=h.prototype=s.prototype=Object.create(u);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,bs(t,r,"GeneratorFunction")),t.prototype=Object.create(c),t}return l.prototype=h,bs(c,"constructor",h),bs(h,"constructor",l),l.displayName="GeneratorFunction",bs(h,r,"GeneratorFunction"),bs(c),bs(c,r,"Generator"),bs(c,i,function(){return this}),bs(c,"toString",function(){return"[object Generator]"}),(ys=function(){return{w:o,m:d}})()}function bs(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}bs=function(t,e,n,i){function o(e,n){bs(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},bs(t,e,n,i)}function ws(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,o,a,s=[],l=!0,h=!1;try{if(o=(n=n.call(t)).next,0===e);else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==e);l=!0);}catch(t){h=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(h)throw r}}return s}}(t,e)||xs(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ss(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Cs(t){return Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cs(t)}function xs(t,e){if(t){if("string"==typeof t)return us(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?us(t,e):void 0}}var ks,Ts,As,Ps,Es,Is,Ds,Ms,Ls,Os={};function Rs(){if(Ts)return ks;Ts=1;var t=aa(),e=String;return ks=function(n){if("Symbol"===t(n))throw new TypeError("Cannot convert a Symbol value to a string");return e(n)}}function Fs(){return Ps?As:(Ps=1,As="\t\n\v\f\r \u2028\u2029\ufeff")}function Bs(){if(Is)return Es;Is=1;var t=di(),e=mi(),n=Rs(),i=Fs(),r=t("".replace),o=RegExp("^["+i+"]+"),a=RegExp("(^|[^"+i+"])["+i+"]+$"),s=function(t){return function(i){var s=n(e(i));return 1&t&&(s=r(s,o,"")),2&t&&(s=r(s,a,"$1")),s}};return Es={start:s(1),end:s(2),trim:s(3)}}!function(){if(Ls)return Os;Ls=1;var t=ea(),e=Bs().trim,n=function(){if(Ms)return Ds;Ms=1;var t=Hr().PROPER,e=_n(),n=Fs();return Ds=function(i){return e(function(){return!!n[i]()||""!==""[i]()||t&&n[i].name!==i})}}();t({target:"String",proto:!0,forced:n("trim")},{trim:function(){return e(this)}})}();var Ws,Us,Gs,Ns,zs,Hs,Vs,js,Xs,Ys,Zs={},Ks={};function qs(){if(Us)return Ws;Us=1;var t=bo(),e=wo();return Ws=Object.keys||function(n){return t(n,e)}}function Js(){if(zs)return Ns;zs=1;var t=bi();return Ns=t("document","documentElement")}function Qs(){if(Vs)return Hs;Vs=1;var t,e=xr(),n=function(){if(Gs)return Ks;Gs=1;var t=yn(),e=Cr(),n=kr(),i=xr(),r=vi(),o=qs();return Ks.f=t&&!e?Object.defineProperties:function(t,e){i(t);for(var a,s=r(e),l=o(e),h=l.length,u=0;h>u;)n.f(t,a=l[u++],s[a]);return t},Ks}(),i=wo(),r=Xr(),o=Js(),a=dr(),s=jr(),l="prototype",h="script",u=s("IE_PROTO"),c=function(){},d=function(t){return"<"+h+">"+t+"</"+h+">"},f=function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e},p=function(){try{t=new ActiveXObject("htmlfile")}catch(t){}var e,n,r;p="undefined"!=typeof document?document.domain&&t?f(t):(n=a("iframe"),r="java"+h+":",n.style.display="none",o.appendChild(n),n.src=String(r),(e=n.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F):f(t);for(var s=i.length;s--;)delete p[l][i[s]];return p()};return r[u]=!0,Hs=Object.create||function(t,i){var r;return null!==t?(c[l]=e(t),r=new c,c[l]=null,r[u]=t):r=p(),void 0===i?r:n.f(r,i)}}function $s(){if(Xs)return js;Xs=1;var t=hr(),e=Qs(),n=kr().f,i=t("unscopables"),r=Array.prototype;return void 0===r[i]&&n(r,i,{configurable:!0,value:e(null)}),js=function(t){r[i][t]=!0}}!function(){if(Ys)return Zs;Ys=1;var t=ea(),e=yo().includes,n=_n(),i=$s();t({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")}();var tl,el,nl,il,rl,ol,al,sl={};function ll(){if(il)return nl;il=1;var t=sr(),e=_i(),n=ar(),i=jr(),r=function(){if(el)return tl;el=1;var t=_n();return tl=!t(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})}(),o=i("IE_PROTO"),a=Object,s=a.prototype;return nl=r?a.getPrototypeOf:function(i){var r=n(i);if(t(r,o))return r[o];var l=r.constructor;return e(l)&&r instanceof l?l.prototype:r instanceof a?s:null}}!function(){if(al)return sl;al=1;var t=ea(),e=function(){if(ol)return rl;ol=1;var t=yn(),e=_n(),n=di(),i=ll(),r=qs(),o=vi(),a=n(ui().f),s=n([].push),l=t&&e(function(){var t=Object.create(null);return t[2]=2,!a(t,2)}),h=function(e){return function(n){for(var h,u=o(n),c=r(u),d=l&&null===i(u),f=c.length,p=0,g=[];f>p;)h=c[p++],t&&!(d?h in u:a(u,h))||s(g,e?[h,u[h]]:u[h]);return g}};return rl={entries:h(!0),values:h(!1)}}().entries;t({target:"Object",stat:!0},{entries:function(t){return e(t)}})}();var hl,ul={};!function(){if(hl)return ul;hl=1;var t=ea(),e=ar(),n=qs();t({target:"Object",stat:!0,forced:_n()(function(){n(1)})},{keys:function(t){return n(e(t))}})}();var cl,dl,fl,pl,gl,ml,vl,_l,yl,bl,wl,Sl,Cl,xl,kl,Tl,Al,Pl,El,Il,Dl,Ml,Ll,Ol,Rl,Fl,Bl,Wl,Ul,Gl,Nl,zl,Hl,Vl,jl,Xl,Yl,Zl,Kl,ql,Jl,Ql,$l,th,eh,nh,ih,rh,oh,ah,sh={};function lh(){if(dl)return cl;dl=1;var t=ln(),e=Si(),n=fi(),i=function(t){return e.slice(0,t.length)===t};return cl=i("Bun/")?"BUN":i("Cloudflare-Workers")?"CLOUDFLARE":i("Deno/")?"DENO":i("Node.js/")?"NODE":t.Bun&&"string"==typeof Bun.version?"BUN":t.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(t.process)?"NODE":t.window&&t.document?"BROWSER":"REST"}function hh(){if(pl)return fl;pl=1;var t=lh();return fl="NODE"===t}function uh(){if(ml)return gl;ml=1;var t=ln();return gl=t}function ch(){if(bl)return yl;bl=1;var t=yi();return yl=function(e){return t(e)||null===e}}function dh(){if(Sl)return wl;Sl=1;var t=ch(),e=String,n=TypeError;return wl=function(i){if(t(i))return i;throw new n("Can't set "+e(i)+" as a prototype")}}function fh(){if(xl)return Cl;xl=1;var t=function(){if(_l)return vl;_l=1;var t=di(),e=Pi();return vl=function(n,i,r){try{return t(e(Object.getOwnPropertyDescriptor(n,i)[r]))}catch(t){}}}(),e=yi(),n=mi(),i=dh();return Cl=Object.setPrototypeOf||("__proto__"in{}?function(){var r,o=!1,a={};try{(r=t(Object.prototype,"__proto__","set"))(a,[]),o=a instanceof Array}catch(t){}return function(t,a){return n(t),i(a),e(t)?(o?r(t,a):t.__proto__=a,t):t}}():void 0)}function ph(){if(Tl)return kl;Tl=1;var t=kr().f,e=sr(),n=hr()("toStringTag");return kl=function(i,r,o){i&&!o&&(i=i.prototype),i&&!e(i,n)&&t(i,n,{configurable:!0,value:r})}}function gh(){if(Pl)return Al;Pl=1;var t=bi(),e=ls(),n=hr(),i=yn(),r=n("species");return Al=function(n){var o=t(n);i&&o&&!o[r]&&e(o,r,{configurable:!0,get:function(){return this}})}}function mh(){if(Il)return El;Il=1;var t=wi(),e=TypeError;return El=function(n,i){if(t(i,n))return n;throw new e("Incorrect invocation")}}function vh(){if(Ml)return Dl;Ml=1;var t=sa(),e=Ai(),n=TypeError;return Dl=function(i){if(t(i))return i;throw new n(e(i)+" is not a constructor")}}function _h(){if(Ol)return Ll;Ol=1;var t=xr(),e=vh(),n=gi(),i=hr()("species");return Ll=function(r,o){var a,s=t(r).constructor;return void 0===s||n(a=t(s)[i])?o:e(a)}}function yh(){if(Fl)return Rl;Fl=1;var t=bn(),e=Function.prototype,n=e.apply,i=e.call;return Rl="object"==typeof Reflect&&Reflect.apply||(t?i.bind(n):function(){return i.apply(n,arguments)}),Rl}function bh(){if(Wl)return Bl;Wl=1;var t=TypeError;return Bl=function(e,n){if(e<n)throw new t("Not enough arguments");return e}}function wh(){if(Gl)return Ul;Gl=1;var t=Si();return Ul=/(?:ipad|iphone|ipod).*applewebkit/i.test(t)}function Sh(){if(zl)return Nl;zl=1;var t,e,n,i,r=ln(),o=yh(),a=Ya(),s=_i(),l=sr(),h=_n(),u=Js(),c=is(),d=dr(),f=bh(),p=wh(),g=hh(),m=r.setImmediate,v=r.clearImmediate,_=r.process,y=r.Dispatch,b=r.Function,w=r.MessageChannel,S=r.String,C=0,x={},k="onreadystatechange";h(function(){t=r.location});var T=function(t){if(l(x,t)){var e=x[t];delete x[t],e()}},A=function(t){return function(){T(t)}},P=function(t){T(t.data)},E=function(e){r.postMessage(S(e),t.protocol+"//"+t.host)};return m&&v||(m=function(t){f(arguments.length,1);var n=s(t)?t:b(t),i=c(arguments,1);return x[++C]=function(){o(n,void 0,i)},e(C),C},v=function(t){delete x[t]},g?e=function(t){_.nextTick(A(t))}:y&&y.now?e=function(t){y.now(A(t))}:w&&!p?(i=(n=new w).port2,n.port1.onmessage=P,e=a(i.postMessage,i)):r.addEventListener&&s(r.postMessage)&&!r.importScripts&&t&&"file:"!==t.protocol&&!h(E)?(e=E,r.addEventListener("message",P,!1)):e=k in d("script")?function(t){u.appendChild(d("script"))[k]=function(){u.removeChild(this),T(t)}}:function(t){setTimeout(A(t),0)}),Nl={set:m,clear:v}}function Ch(){if(Vl)return Hl;Vl=1;var t=ln(),e=yn(),n=Object.getOwnPropertyDescriptor;return Hl=function(i){if(!e)return t[i];var r=n(t,i);return r&&r.value}}function xh(){if(Xl)return jl;Xl=1;var t=function(){this.head=null,this.tail=null};return t.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},jl=t}function kh(){if(Ql)return Jl;Ql=1;var t,e,n,i,r,o=ln(),a=Ch(),s=Ya(),l=Sh().set,h=xh(),u=wh(),c=function(){if(Zl)return Yl;Zl=1;var t=Si();return Yl=/ipad|iphone|ipod/i.test(t)&&"undefined"!=typeof Pebble}(),d=function(){if(ql)return Kl;ql=1;var t=Si();return Kl=/web0s(?!.*chrome)/i.test(t)}(),f=hh(),p=o.MutationObserver||o.WebKitMutationObserver,g=o.document,m=o.process,v=o.Promise,_=a("queueMicrotask");if(!_){var y=new h,b=function(){var e,n;for(f&&(e=m.domain)&&e.exit();n=y.get();)try{n()}catch(e){throw y.head&&t(),e}e&&e.enter()};u||f||d||!p||!g?!c&&v&&v.resolve?((i=v.resolve(void 0)).constructor=v,r=s(i.then,i),t=function(){r(b)}):f?t=function(){m.nextTick(b)}:(l=s(l,o),t=function(){l(b)}):(e=!0,n=g.createTextNode(""),new p(b).observe(n,{characterData:!0}),t=function(){n.data=e=!e}),_=function(e){y.head||t(),y.add(e)}}return Jl=_}function Th(){return th||(th=1,$l=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}}),$l}function Ah(){return nh?eh:(nh=1,eh=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}})}function Ph(){if(rh)return ih;rh=1;var t=ln();return ih=t.Promise}function Eh(){if(ah)return oh;ah=1;var t=ln(),e=Ph(),n=_i(),i=ta(),r=Vr(),o=hr(),a=lh(),s=nr(),l=Ci(),h=e&&e.prototype,u=o("species"),c=!1,d=n(t.PromiseRejectionEvent),f=i("Promise",function(){var t=r(e),n=t!==String(e);if(!n&&66===l)return!0;if(s&&(!h.catch||!h.finally))return!0;if(!l||l<51||!/native code/.test(t)){var i=new e(function(t){t(1)}),o=function(t){t(function(){},function(){})};if((i.constructor={})[u]=o,!(c=i.then(function(){})instanceof o))return!0}return!(n||"BROWSER"!==a&&"DENO"!==a||d)});return oh={CONSTRUCTOR:f,REJECTION_EVENT:d,SUBCLASSING:c}}var Ih,Dh,Mh={};function Lh(){if(Ih)return Mh;Ih=1;var t=Pi(),e=TypeError,n=function(n){var i,r;this.promise=new n(function(t,n){if(void 0!==i||void 0!==r)throw new e("Bad Promise constructor");i=t,r=n}),this.resolve=t(i),this.reject=t(r)};return Mh.f=function(t){return new n(t)},Mh}var Oh,Rh,Fh,Bh,Wh,Uh,Gh,Nh,zh,Hh,Vh,jh,Xh,Yh,Zh,Kh,qh,Jh={};function Qh(){return Rh?Oh:(Rh=1,Oh={})}function $h(){if(Bh)return Fh;Bh=1;var t=hr(),e=Qh(),n=t("iterator"),i=Array.prototype;return Fh=function(t){return void 0!==t&&(e.Array===t||i[n]===t)}}function tu(){if(Uh)return Wh;Uh=1;var t=aa(),e=Ei(),n=gi(),i=Qh(),r=hr()("iterator");return Wh=function(o){if(!n(o))return e(o,r)||e(o,"@@iterator")||i[t(o)]}}function eu(){if(Nh)return Gh;Nh=1;var t=wn(),e=Pi(),n=xr(),i=Ai(),r=tu(),o=TypeError;return Gh=function(a,s){var l=arguments.length<2?r(a):s;if(e(l))return n(t(l,a));throw new o(i(a)+" is not iterable")},Gh}function nu(){if(Hh)return zh;Hh=1;var t=wn(),e=xr(),n=Ei();return zh=function(i,r,o){var a,s;e(i);try{if(!(a=n(i,"return"))){if("throw"===r)throw o;return o}a=t(a,i)}catch(t){s=!0,a=t}if("throw"===r)throw o;if(s)throw a;return e(a),o}}function iu(){if(jh)return Vh;jh=1;var t=Ya(),e=wn(),n=xr(),i=Ai(),r=$h(),o=_o(),a=wi(),s=eu(),l=tu(),h=nu(),u=TypeError,c=function(t,e){this.stopped=t,this.result=e},d=c.prototype;return Vh=function(f,p,g){var m,v,_,y,b,w,S,C=g&&g.that,x=!(!g||!g.AS_ENTRIES),k=!(!g||!g.IS_RECORD),T=!(!g||!g.IS_ITERATOR),A=!(!g||!g.INTERRUPTED),P=t(p,C),E=function(t){return m&&h(m,"normal"),new c(!0,t)},I=function(t){return x?(n(t),A?P(t[0],t[1],E):P(t[0],t[1])):A?P(t,E):P(t)};if(k)m=f.iterator;else if(T)m=f;else{if(!(v=l(f)))throw new u(i(f)+" is not iterable");if(r(v)){for(_=0,y=o(f);y>_;_++)if((b=I(f[_]))&&a(d,b))return b;return new c(!1)}m=s(f,v)}for(w=k?f.next:m.next;!(S=e(w,m)).done;){try{b=I(S.value)}catch(t){h(m,"throw",t)}if("object"==typeof b&&b&&a(d,b))return b}return new c(!1)}}function ru(){if(Yh)return Xh;Yh=1;var t=hr()("iterator"),e=!1;try{var n=0,i={next:function(){return{done:!!n++}},return:function(){e=!0}};i[t]=function(){return this},Array.from(i,function(){throw 2})}catch(t){}return Xh=function(n,i){try{if(!i&&!e)return!1}catch(t){return!1}var r=!1;try{var o={};o[t]=function(){return{next:function(){return{done:r=!0}}}},n(o)}catch(t){}return r}}function ou(){if(Kh)return Zh;Kh=1;var t=Ph(),e=ru(),n=Eh().CONSTRUCTOR;return Zh=n||!e(function(e){t.all(e).then(void 0,function(){})})}var au,su={};var lu,hu={};var uu,cu={};var du,fu,pu,gu,mu={};function vu(){if(fu)return du;fu=1;var t=xr(),e=yi(),n=Lh();return du=function(i,r){if(t(i),e(r)&&r.constructor===i)return r;var o=n.f(i);return(0,o.resolve)(r),o.promise}}gu||(gu=1,function(){if(Dh)return sh;Dh=1;var t,e,n,i,r=ea(),o=nr(),a=hh(),s=ln(),l=uh(),h=wn(),u=Kr(),c=fh(),d=ph(),f=gh(),p=Pi(),g=_i(),m=yi(),v=mh(),_=_h(),y=Sh().set,b=kh(),w=Th(),S=Ah(),C=xh(),x=Yr(),k=Ph(),T=Eh(),A=Lh(),P="Promise",E=T.CONSTRUCTOR,I=T.REJECTION_EVENT,D=T.SUBCLASSING,M=x.getterFor(P),L=x.set,O=k&&k.prototype,R=k,F=O,B=s.TypeError,W=s.document,U=s.process,G=A.f,N=G,z=!!(W&&W.createEvent&&s.dispatchEvent),H="unhandledrejection",V=function(t){var e;return!(!m(t)||!g(e=t.then))&&e},j=function(t,e){var n,i,r,o=e.value,a=1===e.state,s=a?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{s?(a||(2===e.rejection&&q(e),e.rejection=1),!0===s?n=o:(c&&c.enter(),n=s(o),c&&(c.exit(),r=!0)),n===t.promise?u(new B("Promise-chain cycle")):(i=V(n))?h(i,n,l,u):l(n)):u(o)}catch(t){c&&!r&&c.exit(),u(t)}},X=function(t,e){t.notified||(t.notified=!0,b(function(){for(var n,i=t.reactions;n=i.get();)j(n,t);t.notified=!1,e&&!t.rejection&&Z(t)}))},Y=function(t,e,n){var i,r;z?((i=W.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),s.dispatchEvent(i)):i={promise:e,reason:n},!I&&(r=s["on"+t])?r(i):t===H&&w("Unhandled promise rejection",n)},Z=function(t){h(y,s,function(){var e,n=t.facade,i=t.value;if(K(t)&&(e=S(function(){a?U.emit("unhandledRejection",i,n):Y(H,n,i)}),t.rejection=a||K(t)?2:1,e.error))throw e.value})},K=function(t){return 1!==t.rejection&&!t.parent},q=function(t){h(y,s,function(){var e=t.facade;a?U.emit("rejectionHandled",e):Y("rejectionhandled",e,t.value)})},J=function(t,e,n){return function(i){t(e,i,n)}},Q=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,X(t,!0))},$=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new B("Promise can't be resolved itself");var i=V(e);i?b(function(){var n={done:!1};try{h(i,e,J($,n,t),J(Q,n,t))}catch(e){Q(n,e,t)}}):(t.value=e,t.state=1,X(t,!1))}catch(e){Q({done:!1},e,t)}}};if(E&&(F=(R=function(e){v(this,F),p(e),h(t,this);var n=M(this);try{e(J($,n),J(Q,n))}catch(t){Q(n,t)}}).prototype,(t=function(t){L(this,{type:P,done:!1,notified:!1,parent:!1,reactions:new C,rejection:!1,state:0,value:null})}).prototype=u(F,"then",function(t,e){var n=M(this),i=G(_(this,R));return n.parent=!0,i.ok=!g(t)||t,i.fail=g(e)&&e,i.domain=a?U.domain:void 0,0===n.state?n.reactions.add(i):b(function(){j(i,n)}),i.promise}),e=function(){var e=new t,n=M(e);this.promise=e,this.resolve=J($,n),this.reject=J(Q,n)},A.f=G=function(t){return t===R||t===n?new e(t):N(t)},!o&&g(k)&&O!==Object.prototype)){i=O.then,D||u(O,"then",function(t,e){var n=this;return new R(function(t,e){h(i,n,t,e)}).then(t,e)},{unsafe:!0});try{delete O.constructor}catch(t){}c&&c(O,F)}r({global:!0,constructor:!0,wrap:!0,forced:E},{Promise:R}),n=l.Promise,d(R,P,!1,!0),f(P)}(),function(){if(qh)return Jh;qh=1;var t=ea(),e=wn(),n=Pi(),i=Lh(),r=Ah(),o=iu();t({target:"Promise",stat:!0,forced:ou()},{all:function(t){var a=this,s=i.f(a),l=s.resolve,h=s.reject,u=r(function(){var i=n(a.resolve),r=[],s=0,u=1;o(t,function(t){var n=s++,o=!1;u++,e(i,a,t).then(function(t){o||(o=!0,r[n]=t,--u||l(r))},h)}),--u||l(r)});return u.error&&h(u.value),s.promise}})}(),function(){if(au)return su;au=1;var t=ea(),e=nr(),n=Eh().CONSTRUCTOR,i=Ph(),r=bi(),o=_i(),a=Kr(),s=i&&i.prototype;if(t({target:"Promise",proto:!0,forced:n,real:!0},{catch:function(t){return this.then(void 0,t)}}),!e&&o(i)){var l=r("Promise").prototype.catch;s.catch!==l&&a(s,"catch",l,{unsafe:!0})}}(),function(){if(lu)return hu;lu=1;var t=ea(),e=wn(),n=Pi(),i=Lh(),r=Ah(),o=iu();t({target:"Promise",stat:!0,forced:ou()},{race:function(t){var a=this,s=i.f(a),l=s.reject,h=r(function(){var i=n(a.resolve);o(t,function(t){e(i,a,t).then(s.resolve,l)})});return h.error&&l(h.value),s.promise}})}(),function(){if(uu)return cu;uu=1;var t=ea(),e=Lh();t({target:"Promise",stat:!0,forced:Eh().CONSTRUCTOR},{reject:function(t){var n=e.f(this);return(0,n.reject)(t),n.promise}})}(),function(){if(pu)return mu;pu=1;var t=ea(),e=bi(),n=nr(),i=Ph(),r=Eh().CONSTRUCTOR,o=vu(),a=e("Promise"),s=n&&!r;t({target:"Promise",stat:!0,forced:n||r},{resolve:function(t){return o(s&&this===a?i:this,t)}})}());var _u,yu,bu,wu,Su,Cu,xu,ku,Tu,Au,Pu,Eu={};function Iu(){if(yu)return _u;yu=1;var t=xr();return _u=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n}}function Du(){if(wu)return bu;wu=1;var t=_n(),e=ln().RegExp,n=t(function(){var t=e("a","y");return t.lastIndex=2,null!==t.exec("abcd")}),i=n||t(function(){return!e("a","y").sticky}),r=n||t(function(){var t=e("^r","gy");return t.lastIndex=2,null!==t.exec("str")});return bu={BROKEN_CARET:r,MISSED_STICKY:i,UNSUPPORTED_Y:n}}function Mu(){if(Au)return Tu;Au=1;var t,e,n=wn(),i=di(),r=Rs(),o=Iu(),a=Du(),s=or(),l=Qs(),h=Yr().get,u=function(){if(Cu)return Su;Cu=1;var t=_n(),e=ln().RegExp;return Su=t(function(){var t=e(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)})}(),c=function(){if(ku)return xu;ku=1;var t=_n(),e=ln().RegExp;return xu=t(function(){var t=e("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})}(),d=s("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,p=f,g=i("".charAt),m=i("".indexOf),v=i("".replace),_=i("".slice),y=(e=/b*/g,n(f,t=/a/,"a"),n(f,e,"a"),0!==t.lastIndex||0!==e.lastIndex),b=a.BROKEN_CARET,w=void 0!==/()??/.exec("")[1];return(y||w||b||u||c)&&(p=function(t){var e,i,a,s,u,c,S,C=this,x=h(C),k=r(t),T=x.raw;if(T)return T.lastIndex=C.lastIndex,e=n(p,T,k),C.lastIndex=T.lastIndex,e;var A=x.groups,P=b&&C.sticky,E=n(o,C),I=C.source,D=0,M=k;if(P&&(E=v(E,"y",""),-1===m(E,"g")&&(E+="g"),M=_(k,C.lastIndex),C.lastIndex>0&&(!C.multiline||C.multiline&&"\n"!==g(k,C.lastIndex-1))&&(I="(?: "+I+")",M=" "+M,D++),i=new RegExp("^(?:"+I+")",E)),w&&(i=new RegExp("^"+I+"$(?!\\s)",E)),y&&(a=C.lastIndex),s=n(f,P?i:C,M),P?s?(s.input=_(s.input,D),s[0]=_(s[0],D),s.index=C.lastIndex,C.lastIndex+=s[0].length):C.lastIndex=0:y&&s&&(C.lastIndex=C.global?s.index+s[0].length:a),w&&s&&s.length>1&&n(d,s[0],i,function(){for(u=1;u<arguments.length-2;u++)void 0===arguments[u]&&(s[u]=void 0)}),s&&A)for(s.groups=c=l(null),u=0;u<A.length;u++)c[(S=A[u])[0]]=s[S[1]];return s}),Tu=p}function Lu(){if(Pu)return Eu;Pu=1;var t=ea(),e=Mu();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),Eu}Lu();var Ou,Ru,Fu,Bu,Wu,Uu={};function Gu(){if(Bu)return Fu;Bu=1;var t=wn(),e=sr(),n=wi(),i=function(){if(Ru)return Ou;Ru=1;var t=ln(),e=_n(),n=t.RegExp,i=!e(function(){var t=!0;try{n(".","d")}catch(e){t=!1}var e={},i="",r=t?"dgimsy":"gimsy",o=function(t,n){Object.defineProperty(e,t,{get:function(){return i+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in t&&(a.hasIndices="d"),a)o(s,a[s]);return Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(e)!==r||i!==r});return Ou={correct:i}}(),r=Iu(),o=RegExp.prototype;return Fu=i.correct?function(t){return t.flags}:function(a){return i.correct||!n(o,a)||e(a,"flags")?a.flags:t(r,a)}}!function(){if(Wu)return Uu;Wu=1;var t=Hr().PROPER,e=Kr(),n=xr(),i=Rs(),r=_n(),o=Gu(),a="toString",s=RegExp.prototype,l=s[a],h=r(function(){return"/a/b"!==l.call({source:"a",flags:"b"})}),u=t&&l.name!==a;(h||u)&&e(s,a,function(){var t=n(this);return"/"+i(t.source)+"/"+i(o(t))},{unsafe:!0})}();var Nu,zu,Hu,Vu,ju,Xu,Yu,Zu,Ku,qu,Ju,Qu={};function $u(){if(zu)return Nu;zu=1,Lu();var t=wn(),e=Kr(),n=Mu(),i=_n(),r=hr(),o=Tr(),a=r("species"),s=RegExp.prototype;return Nu=function(l,h,u,c){var d=r(l),f=!i(function(){var t={};return t[d]=function(){return 7},7!==""[l](t)}),p=f&&!i(function(){var t=!1,e=/a/;if("split"===l){var n={};n[a]=function(){return e},(e={constructor:n,flags:""})[d]=/./[d]}return e.exec=function(){return t=!0,null},e[d](""),!t});if(!f||!p||u){var g=/./[d],m=h(d,""[l],function(e,i,r,o,a){var l=i.exec;return l===n||l===s.exec?f&&!a?{done:!0,value:t(g,i,r,o)}:{done:!0,value:t(e,r,i,o)}:{done:!1}});e(String.prototype,l,m[0]),e(s,d,m[1])}c&&o(s[d],"sham",!0)}}function tc(){if(Vu)return Hu;Vu=1;var t=di(),e=go(),n=Rs(),i=mi(),r=t("".charAt),o=t("".charCodeAt),a=t("".slice),s=function(t){return function(s,l){var h,u,c=n(i(s)),d=e(l),f=c.length;return d<0||d>=f?t?"":void 0:(h=o(c,d))<55296||h>56319||d+1===f||(u=o(c,d+1))<56320||u>57343?t?r(c,d):h:t?a(c,d,d+2):u-56320+(h-55296<<10)+65536}};return Hu={codeAt:s(!1),charAt:s(!0)}}function ec(){if(Xu)return ju;Xu=1;var t=tc().charAt;return ju=function(e,n,i){return n+(i?t(e,n).length:1)}}function nc(){if(Zu)return Yu;Zu=1;var t=di(),e=ar(),n=Math.floor,i=t("".charAt),r=t("".replace),o=t("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,s=/\$([$&'`]|\d{1,2})/g;return Yu=function(t,l,h,u,c,d){var f=h+t.length,p=u.length,g=s;return void 0!==c&&(c=e(c),g=a),r(d,g,function(e,r){var a;switch(i(r,0)){case"$":return"$";case"&":return t;case"`":return o(l,0,h);case"'":return o(l,f);case"<":a=c[o(r,1,-1)];break;default:var s=+r;if(0===s)return e;if(s>p){var d=n(s/10);return 0===d?e:d<=p?void 0===u[d-1]?i(r,1):u[d-1]+i(r,1):e}a=u[s-1]}return void 0===a?"":a})}}function ic(){if(qu)return Ku;qu=1;var t=wn(),e=xr(),n=_i(),i=fi(),r=Mu(),o=TypeError;return Ku=function(a,s){var l=a.exec;if(n(l)){var h=t(l,a,s);return null!==h&&e(h),h}if("RegExp"===i(a))return t(r,a,s);throw new o("RegExp#exec called on incompatible receiver")}}!function(){if(Ju)return Qu;Ju=1;var t=yh(),e=wn(),n=di(),i=$u(),r=_n(),o=xr(),a=_i(),s=yi(),l=go(),h=vo(),u=Rs(),c=mi(),d=ec(),f=Ei(),p=nc(),g=Gu(),m=ic(),v=hr()("replace"),_=Math.max,y=Math.min,b=n([].concat),w=n([].push),S=n("".indexOf),C=n("".slice),x=function(t){return void 0===t?t:String(t)},k="$0"==="a".replace(/./,"$0"),T=!!/./[v]&&""===/./[v]("a","$0");i("replace",function(n,i,r){var k=T?"$":"$0";return[function(t,n){var r=c(this),o=s(t)?f(t,v):void 0;return o?e(o,t,r,n):e(i,u(r),t,n)},function(e,n){var s=o(this),c=u(e);if("string"==typeof n&&-1===S(n,k)&&-1===S(n,"$<")){var f=r(i,s,c,n);if(f.done)return f.value}var v=a(n);v||(n=u(n));var T,A=u(g(s)),P=-1!==S(A,"g");P&&(T=-1!==S(A,"u"),s.lastIndex=0);for(var E,I=[];null!==(E=m(s,c))&&(w(I,E),P);){""===u(E[0])&&(s.lastIndex=d(c,h(s.lastIndex),T))}for(var D="",M=0,L=0;L<I.length;L++){for(var O,R=u((E=I[L])[0]),F=_(y(l(E.index),c.length),0),B=[],W=1;W<E.length;W++)w(B,x(E[W]));var U=E.groups;if(v){var G=b([R],B,F,c);void 0!==U&&w(G,U),O=u(t(n,void 0,G))}else O=p(R,c,F,B,U,n);F>=M&&(D+=C(c,M,F)+O,M=F+R.length)}return D+C(c,M)}]},!!r(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})||!k||T)}(),function(t){function e(){var e=void 0!==window.acf?window.acf:null,n=void 0!==window.tinyMCE?window.tinyMCE:null,i=void 0!==window.aiwa_recorder_data?window.aiwa_recorder_data:null;t&&t.fn?(e&&e.add_action("wp_ajax_success",function(e){if(e&&e.data&&e.data.post_id){var r=e.data.post_id,o=t("#acf-_post_title").val(),a="";a=n&&n.get("acf-editor-58")?n.get("acf-editor-58").getContent({format:"text"}):t("#acf-_post_content").val(),t("#aiwa-step-1").fadeOut(300,function(){t("#script-title").text(o),t("#script-content").text(a),t("#aiwa-step-2").fadeIn(300),t.ajax({url:i?i.ajax_url:"/wp-admin/admin-ajax.php",type:"POST",data:{action:"aiwa_load_prompter_recorder",target_post_id:r,audio_post_id:0},success:function(e){t("#aiwa-recorder-load-point").html(e)}})})}}),"function"==typeof t.fn.on&&t(window).on("message",function(e){var n=e.originalEvent.data;n&&"starmusRecordingComplete"===n.type&&t("#aiwa-step-2").html('\n            <div style="text-align:center; padding:50px;">\n                <h2 style="color:green;"> Saved and Recorded</h2>\n                <p>Your entry and audio have been successfully linked.</p>\n                <button onclick="window.location.reload();" class="button button-large">Add Another Entry</button>\n            </div>\n          ')})):console.warn("[SparxstarIntegration] jQuery missing; recorder bridge skipped.")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}("undefined"!=typeof jQuery?jQuery:null);var rc={isAvailable:!0,init:function(){return Promise.resolve(rc.getEnvironmentData())},getEnvironmentData:function(){return{tier:"C",recordingSettings:{uploadChunkSize:524288},network:{type:"unknown"}}},reportError:function(t,e){console.warn("[Integration] Error:",t,e)}},oc=function(){return ps(function t(){fs(this,t),this.failures=0,this.threshold=3,this.timeout=6e4,this.state="closed",this.openedAt=null},[{key:"execute",value:(t=ds(ys().m(function t(e){var n,i,r,o=arguments;return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"","open"!==this.state){t.n=2;break}if(!(Date.now()-this.openedAt<this.timeout)){t.n=1;break}throw new Error("Upload circuit breaker open - too many failures".concat(n?" [".concat(n,"]"):""));case 1:this.state="half-open",console.log("[Circuit Breaker] Attempting half-open state".concat(n?" [".concat(n,"]"):""));case 2:return t.p=2,t.n=3,e();case 3:return i=t.v,"half-open"===this.state&&(this.state="closed",this.failures=0,console.log("[Circuit Breaker] Reset to closed state")),t.a(2,i);case 4:throw t.p=4,r=t.v,this.failures++,this.failures>=this.threshold&&(this.state="open",this.openedAt=Date.now(),console.error("[Circuit Breaker] Opened after ".concat(this.failures," failures"))),r;case 5:return t.a(2)}},t,this,[[2,4]])})),function(e){return t.apply(this,arguments)})}]);var t}(),ac=new oc;function sc(){var t,e=function(){var t=rc.getEnvironmentData();return{chunkSize:((null==t?void 0:t.recordingSettings)||{}).uploadChunkSize||524288,retryDelays:[0,5e3,1e4,3e4,6e4,12e4,3e5],removeFingerprintOnSuccess:!0,maxChunkRetries:10,endpoint:"/files/",webhookSecret:""}}(),n=window.starmusTus||window.starmusConfig||{},i=_s(_s({},e),n),r=rc.getEnvironmentData();null!=r&&r.tier&&console.log("[TUS] Using tier-optimized config:",{tier:r.tier,chunkSize:i.chunkSize,network:null===(t=r.network)||void 0===t?void 0:t.type});return i}function lc(t){return t&&"object"===Cs(t)?t:{}}function hc(t){return"object"===Cs(t)?JSON.stringify(t):("string"==typeof t?t:String(t)).replace(/[\r\n\t]/g," ")}function uc(t,e){return cc.apply(this,arguments)}function cc(){return cc=ds(ys().m(function t(e,n){var i,r,o,a,s,l,h,u,c=arguments;return ys().w(function(t){for(;;)if(0===t.n)return r=c.length>2&&void 0!==c[2]?c[2]:{},o=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>5?c[5]:void 0,s=sc(),l=s.nonce||(null===(i=window.starmusConfig)||void 0===i?void 0:i.nonce)||"",h=lc(r),u=rc.getEnvironmentData(),t.a(2,new Promise(function(t,i){var r=new FormData;if(!(e instanceof Blob)){var s=new Error("INVALID_BLOB_TYPE");return rc.isAvailable&&rc.reportError("upload_invalid_blob",{error:s.message,fileSize:(null==e?void 0:e.size)||0,tier:null==u?void 0:u.tier}),i(s)}var c=["_starmus_env","_starmus_calibration"];Object.entries(h).forEach(function(t){var e=ws(t,2),n=e[0],i=e[1];c.includes(n)||r.append(n,i)}),r.append("audio_file",e,n),null!=o&&o.calibration&&r.append("_starmus_calibration",JSON.stringify(o.calibration)),null!=o&&o.env&&r.append("_starmus_env",JSON.stringify(o.env)),null!=o&&o.tier&&r.append("tier",o.tier);var d=new XMLHttpRequest;d.open("POST","/wp-json/star-starmus-audio-recorder/v1/upload-fallback",!0),l&&d.setRequestHeader("X-WP-Nonce",l),d.upload&&"function"==typeof a&&(d.upload.onprogress=function(t){t.lengthComputable&&a(t.loaded,t.total)}),d.onload=function(){if(d.status>=200&&d.status<300)try{var n,r=JSON.parse(d.responseText);if(rc.isAvailable)rc.reportError("upload_direct_success",{fileSize:e.size,duration:Date.now()-f,tier:null==u?void 0:u.tier,network:null==u||null===(n=u.network)||void 0===n?void 0:n.type});t(r)}catch(t){i(new Error("Invalid JSON response"))}else{var o=new Error("Upload failed: ".concat(d.status," ").concat(d.statusText));rc.isAvailable&&rc.reportError("upload_direct_failed",{error:o.message,status:d.status,fileSize:e.size,tier:null==u?void 0:u.tier}),i(o)}},d.onerror=function(){var t,n=new Error("Network error on direct upload");rc.isAvailable&&rc.reportError("upload_network_error",{error:n.message,fileSize:e.size,tier:null==u?void 0:u.tier,network:null==u||null===(t=u.network)||void 0===t?void 0:t.type});i(n)};var f=Date.now();d.send(r)}))},t)})),cc.apply(this,arguments)}function dc(t){return fc.apply(this,arguments)}function fc(){return fc=ds(ys().m(function t(e){var n,i,r,o,a,s,l,h=arguments;return ys().w(function(t){for(;;)switch(t.n){case 0:if(e&&e.blob?(n=e.blob,i=e.fileName,r=e.formFields,o=e.metadata,a=e.instanceId,s=e.onProgress):(l=Array.prototype.slice.call(h),n=l[0],i=l[1],r=l[2],o=l[3],a=l[4],s=l[5]),n){t.n=1;break}throw new Error("No blob provided");case 1:return t.a(2,ac.execute(ds(ys().m(function t(){var e;return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!pc(n.size)){t.n=2;break}return t.n=1,gc(n,i,r,o,a,s);case 1:case 4:return t.a(2,t.v);case 2:throw new Error("TUS_UNAVAILABLE");case 3:return t.p=3,e=t.v,console.warn("[Uploader] TUS failed, using Direct Fallback.",e.message),t.n=4,uc(n,i,r,o,a,s);case 5:return t.a(2)}},t,null,[[0,3]])})),"upload"))}},t)})),fc.apply(this,arguments)}function pc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=sc();return!!(window.tus&&window.tus.Upload&&e.endpoint&&t>0)}function gc(t,e,n,i,r,o){return mc.apply(this,arguments)}function mc(){return(mc=ds(ys().m(function t(e,n,i,r,o,a){var s,l,h;return ys().w(function(t){for(;;)if(0===t.n)return s=sc(),l=rc.getEnvironmentData(),h=Date.now(),t.a(2,new Promise(function(t,o){var u,c={filename:n,filetype:e.type||"application/octet-stream",name:n},d=lc(i);Object.entries(d).forEach(function(t){var e=ws(t,2),n=e[0],i=e[1];c[n]=String(i)}),null!=r&&r.calibration&&(c._starmus_calibration=hc(r.calibration)),null!=r&&r.env&&(c._starmus_env=hc(r.env)),null!=r&&r.tier&&(c.tier=hc(r.tier));var f=s.webhookSecret;if(!f||""===f.trim()){var p=new Error("TUS webhook secret not configured - upload blocked for security");throw console.error("[TUS Security] CRITICAL:",p.message),rc.isAvailable&&rc.reportError("tus_security_no_secret",{error:p.message,endpoint:s.endpoint,timestamp:Date.now()}),p}var g=Date.now().toString(),m="".concat(n,"-").concat(g,"-").concat(e.size),v=new tus.Upload(e,{endpoint:s.endpoint,retryDelays:s.retryDelays,chunkSize:s.chunkSize,parallelUploads:1,metadata:c,removeFingerprintOnSuccess:s.removeFingerprintOnSuccess,headers:{"x-starmus-secret":f,"x-starmus-timestamp":g,"x-starmus-payload-hash":btoa(m),"x-starmus-tier":(null==l?void 0:l.tier)||"C","x-starmus-network":(null==l||null===(u=l.network)||void 0===u?void 0:u.type)||"unknown"},onError:function(t){var n;(console.error("[StarmusTus] Upload Error:",t),rc.isAvailable)&&rc.reportError("upload_tus_failed",{error:t.message,fileSize:e.size,tier:null==l?void 0:l.tier,network:null==l||null===(n=l.network)||void 0===n?void 0:n.type,chunkSize:s.chunkSize});o(t)},onProgress:function(t,e){"function"==typeof a&&a(t,e)},onSuccess:function(){var n;rc.isAvailable&&rc.reportError("upload_tus_success",{fileSize:e.size,duration:Date.now()-h,tier:null==l?void 0:l.tier,network:null==l||null===(n=l.network)||void 0===n?void 0:n.type,chunkSize:s.chunkSize});t({success:!0,tus_url:v.url,message:"Upload transfer complete. Processing in background."})}});v.findPreviousUploads().then(function(t){t.length&&v.resumeFromPreviousUpload(t[0]),v.start()})}))},t)}))).apply(this,arguments)}var vc={uploadWithTus:gc,uploadDirect:uc,uploadWithPriority:dc,isTusAvailable:pc,estimateUploadTime:function(t,e){var n=1e6*((null==e?void 0:e.downlink)||.5)/8;return Math.ceil(t/n*1.5)},formatUploadEstimate:function(t){return isFinite(t)?t<60?"~".concat(t,"s"):"~".concat(Math.ceil(t/60),"m"):"..."}};"undefined"!=typeof window&&(window.StarmusTus=vc);var _c,yc={};!function(){if(_c)return yc;_c=1;var t=ea(),e=Za().map;t({target:"Array",proto:!0,forced:!ua()("map")},{map:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}();var bc,wc,Sc,Cc,xc,kc={};function Tc(){if(wc)return bc;wc=1;var t=di();return bc=t(1.1.valueOf)}function Ac(){if(Cc)return Sc;Cc=1;var t=go(),e=Rs(),n=mi(),i=RangeError;return Sc=function(r){var o=e(n(this)),a="",s=t(r);if(s<0||s===1/0)throw new i("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(o+=o))1&s&&(a+=o);return a}}!function(){if(xc)return kc;xc=1;var t=ea(),e=di(),n=go(),i=Tc(),r=Ac(),o=_n(),a=RangeError,s=String,l=Math.floor,h=e(r),u=e("".slice),c=e(1.1.toFixed),d=function(t,e,n){return 0===e?n:e%2==1?d(t,e-1,n*t):d(t*t,e/2,n)},f=function(t,e,n){for(var i=-1,r=n;++i<6;)r+=e*t[i],t[i]=r%1e7,r=l(r/1e7)},p=function(t,e){for(var n=6,i=0;--n>=0;)i+=t[n],t[n]=l(i/e),i=i%e*1e7},g=function(t){for(var e=6,n="";--e>=0;)if(""!==n||0===e||0!==t[e]){var i=s(t[e]);n=""===n?i:n+h("0",7-i.length)+i}return n};t({target:"Number",proto:!0,forced:o(function(){return"0.000"!==c(8e-5,3)||"1"!==c(.9,0)||"1.25"!==c(1.255,2)||"1000000000000000128"!==c(0xde0b6b3a7640080,0)})||!o(function(){c({})})},{toFixed:function(t){var e,r,o,l,c=i(this),m=n(t),v=[0,0,0,0,0,0],_="",y="0";if(m<0||m>20)throw new a("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return s(c);if(c<0&&(_="-",c=-c),c>1e-21)if(r=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(c*d(2,69,1))-69)<0?c*d(2,-e,1):c/d(2,e,1),r*=4503599627370496,(e=52-e)>0){for(f(v,0,r),o=m;o>=7;)f(v,1e7,0),o-=7;for(f(v,d(10,o,1),0),o=e-1;o>=23;)p(v,1<<23),o-=23;p(v,1<<o),f(v,1,1),p(v,2),y=g(v)}else f(v,0,r),f(v,1<<-e,0),y=g(v)+h("0",m);return y=m>0?_+((l=y.length)<=m?"0."+h("0",m-l)+y:u(y,0,l-m)+"."+u(y,l-m)):_+y}})}();var Pc={dbName:"StarmusSubmissions",storeName:"pendingSubmissions",dbVersion:1,maxRetries:10,retryDelays:[0,5e3,1e4,3e4,6e4,12e4,3e5,6e5,12e5,18e5],maxBlobSizes:{A:20971520,B:10485760,C:5242880},defaultMaxBlobSize:5242880};function Ec(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n&&"object"===Cs(n)?null!==(t=n.tier)&&void 0!==t?t:null===(e=n.env)||void 0===e?void 0:e.tier:void 0;return"string"==typeof i&&Object.prototype.hasOwnProperty.call(Pc.maxBlobSizes,i)?Pc.maxBlobSizes[i]:Pc.defaultMaxBlobSize}var Ic,Dc=function(){return ps(function t(){fs(this,t),this.db=null,this.isProcessing=!1},[{key:"init",value:(o=ds(ys().m(function t(){var e,n=this;return ys().w(function(t){for(;;)switch(t.n){case 0:if(window.indexedDB){t.n=1;break}throw e=new Error("IndexedDB not supported"),console.error("[Offline] CRITICAL:",e.message),this._reportStorageFailure("no_indexeddb",e),e;case 1:return t.a(2,new Promise(function(t,e){var i=indexedDB.open(Pc.dbName,Pc.dbVersion);i.onerror=function(t){var i=t.target.error;console.error("[Offline] CRITICAL: DB open failed:",i),n._reportStorageFailure("db_open_failed",i,{name:i.name,message:i.message,userAgent:navigator.userAgent,isPrivateBrowsing:n._detectPrivateBrowsing()}),e(i)},i.onblocked=function(){var t=new Error("DB open blocked - close other tabs");console.error("[Offline] CRITICAL:",t.message),n._reportStorageFailure("db_blocked",t),e(t)},i.onsuccess=function(e){n.db=e.target.result,n.db.onversionchange=function(){n.db.close(),console.warn("[Offline] DB version changed  closed connection")},n.db.onerror=function(t){console.error("[Offline] DB runtime error:",t.target.error),n._reportStorageFailure("db_runtime_error",t.target.error)},console.log("[Offline] DB ready"),t()},i.onupgradeneeded=function(t){var e=t.target.result;if(!e.objectStoreNames.contains(Pc.storeName)){var n=e.createObjectStore(Pc.storeName,{keyPath:"id"});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("retryCount","retryCount",{unique:!1})}}}))}},t,this)})),function(){return o.apply(this,arguments)})},{key:"add",value:(r=ds(ys().m(function t(e,n,i){var r,o,a,s,l,h=this,u=arguments;return ys().w(function(t){for(;;)switch(t.n){case 0:if(r=u.length>3&&void 0!==u[3]?u[3]:{},o=u.length>4&&void 0!==u[4]?u[4]:{},this.db){t.n=1;break}throw new Error("OfflineQueue: DB not initialized");case 1:if(a=Ec(o),!(n.size>a)){t.n=2;break}throw new Error("Audio too large (".concat((n.size/1024/1024).toFixed(2)," MB); limit ").concat((a/1024/1024).toFixed(2)," MB"));case 2:return s=new Blob([n],{type:n.type}),l={id:"starmus-offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),instanceId:e,fileName:i,timestamp:Date.now(),audioBlob:s,formFields:r,metadata:o,retryCount:0,lastAttempt:null,error:null},t.a(2,new Promise(function(t,e){var n=h.db.transaction([Pc.storeName],"readwrite");n.objectStore(Pc.storeName).add(l),n.oncomplete=function(){h._notifyQueueUpdate(),t(l.id)},n.onerror=function(t){return e(t.target.error)}}))}},t,this)})),function(t,e,n){return r.apply(this,arguments)})},{key:"getAll",value:(i=ds(ys().m(function t(){var e=this;return ys().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2,[]);case 1:return t.a(2,new Promise(function(t,n){var i=e.db.transaction([Pc.storeName],"readonly").objectStore(Pc.storeName).getAll();i.onsuccess=function(){return t(i.result||[])},i.onerror=function(){return n(i.error)}}))}},t,this)})),function(){return i.apply(this,arguments)})},{key:"remove",value:(n=ds(ys().m(function t(e){var n=this;return ys().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,i){var r=n.db.transaction([Pc.storeName],"readwrite");r.objectStore(Pc.storeName).delete(e),r.oncomplete=function(){n._notifyQueueUpdate(),t()},r.onerror=function(t){return i(t.target.error)}}))}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"_updateRetry",value:(e=ds(ys().m(function t(e,n,i){var r=this;return ys().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,o){var a=r.db.transaction([Pc.storeName],"readwrite"),s=a.objectStore(Pc.storeName),l=s.get(e);l.onsuccess=function(){var t=l.result;t&&(t.retryCount=n,t.lastAttempt=Date.now(),t.error=i||null,s.put(t))},l.onerror=function(t){return o(t.target.error)},a.oncomplete=function(){return t()}}))}},t,this)})),function(t,n,i){return e.apply(this,arguments)})},{key:"processQueue",value:(t=ds(ys().m(function t(){var e,n,i,r,o,a,s,l,h,u,c,d,f,p,g,m;return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isProcessing&&navigator.onLine){t.n=1;break}return t.a(2);case 1:return this.isProcessing=!0,t.p=2,t.n=3,this.getAll();case 3:if(0!==(e=t.v).length){t.n=4;break}return this.isProcessing=!1,t.a(2);case 4:Ja("[Offline] Processing ".concat(e.length," items")),n=gs(e),t.p=5,n.s();case 6:if((i=n.n()).done){t.n=13;break}if(r=i.value,o=r.id,a=r.audioBlob,s=r.fileName,l=r.formFields,h=r.metadata,u=r.retryCount,c=r.instanceId,!(u>=Pc.maxRetries)){t.n=7;break}return t.a(3,12);case 7:if(null===r.lastAttempt){t.n=8;break}if(d=Pc.retryDelays[Math.min(u,Pc.retryDelays.length-1)],!(Date.now()-r.lastAttempt<d)){t.n=8;break}return t.a(3,12);case 8:return t.p=8,t.n=9,dc({blob:a,fileName:s,formFields:l,metadata:h,instanceId:c});case 9:return t.v,t.n=10,this.remove(o);case 10:t.n=12;break;case 11:if(t.p=11,p=t.v,f=p&&p.message?p.message:String(p),/400|Invalid JSON|QuotaExceeded/i.test(f)){t.n=12;break}return t.n=12,this._updateRetry(o,u+1,f);case 12:t.n=6;break;case 13:t.n=15;break;case 14:t.p=14,g=t.v,n.e(g);case 15:return t.p=15,n.f(),t.f(15);case 16:t.n=18;break;case 17:t.p=17,m=t.v,console.error("[Offline] Queue fatal:",m);case 18:return t.p=18,this.isProcessing=!1,t.f(18);case 19:return t.a(2)}},t,this,[[8,11],[5,14,15,16],[2,17,18,19]])})),function(){return t.apply(this,arguments)})},{key:"setupNetworkListeners",value:function(){var t=this;window.addEventListener("online",function(){return t.processQueue()}),setInterval(function(){navigator.onLine&&t.processQueue().catch(function(){})},6e4)}},{key:"_notifyQueueUpdate",value:function(){var t=window.CommandBus||window.StarmusHooks;t&&"function"==typeof t.dispatch&&this.getAll().then(function(e){t.dispatch("starmus/offline/queue_updated",{count:e.length,queue:e.map(function(t){return{id:t.id,retryCount:t.retryCount,error:t.error}})})})}},{key:"_reportStorageFailure",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={type:"offline_storage_".concat(t),error:e.message,details:_s(_s({},i),{},{timestamp:Date.now(),storageEstimate:null})};"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate().then(function(t){var e;r.details.storageEstimate={usage:t.usage,quota:t.quota,usagePercent:(t.usage/t.quota*100).toFixed(2)},null!==(e=window.SparxstarIntegration)&&void 0!==e&&e.reportError&&window.SparxstarIntegration.reportError(r.type,r)}):null!==(n=window.SparxstarIntegration)&&void 0!==n&&n.reportError&&window.SparxstarIntegration.reportError(r.type,r);this._showUserError(t,e)}},{key:"_detectPrivateBrowsing",value:function(){try{return window.indexedDB.open("test").onerror=function(){return!0},!1}catch(t){return!0}}},{key:"_showUserError",value:function(t,e){var n={no_indexeddb:"Your browser doesn't support offline storage. Recordings will upload immediately.",db_open_failed:"Storage initialization failed. Please check your browser settings.",db_blocked:"Please close other tabs and try again.",quota_exceeded:"Storage full. Please free up space or upload pending recordings."}[t]||"Storage error occurred.";console.error("[Offline] User message: ".concat(n)),window.CommandBus&&window.CommandBus.dispatch("starmus/storage-error",{type:t,message:n,error:e.message})}}]);var t,e,n,i,r,o}(),Mc=new Dc;function Lc(){return Oc.apply(this,arguments)}function Oc(){return(Oc=ds(ys().m(function t(){return ys().w(function(t){for(;;)switch(t.n){case 0:if(Mc.db){t.n=2;break}return t.n=1,Mc.init();case 1:Mc.setupNetworkListeners();case 2:return t.a(2,Mc)}},t)}))).apply(this,arguments)}function Rc(t,e,n,i,r){return Fc.apply(this,arguments)}function Fc(){return(Fc=ds(ys().m(function t(e,n,i,r,o){var a;return ys().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Lc();case 1:return a=t.v,t.a(2,a.add(e,n,i,r,o))}},t)}))).apply(this,arguments)}function Bc(){return Wc.apply(this,arguments)}function Wc(){return(Wc=ds(ys().m(function t(){var e,n;return ys().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Lc();case 1:return e=t.v,t.n=2,e.getAll();case 2:return n=t.v,t.a(2,n.length)}},t)}))).apply(this,arguments)}function Uc(){return Lc()}"undefined"!=typeof window&&(window.initOffline=Uc,window.StarmusOfflineQueue=Lc);var Gc,Nc,zc,Hc,Vc,jc,Xc,Yc,Zc,Kc,qc=(null===(Ic=window.StarmusHooks)||void 0===Ic?void 0:Ic.subscribe)||function(){};function Jc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"undefined"==typeof MediaRecorder?"C":t&&t.tier?(console.log("[Core] Using SPARXSTAR tier:",t.tier),t.tier):window.AudioContext||window.webkitAudioContext?"A":"B":"C"}function Qc(t,e,n){function i(t){return r.apply(this,arguments)}function r(){return(r=ds(ys().m(function i(r){var o,a,s,l,h,u,c,d,f,p,g,m,v,_,y,b,w,S,C;return ys().w(function(i){for(;;)switch(i.p=i.n){case 0:if(a=t.getState(),s=a.source||{},l=a.calibration||{},h=rc.getEnvironmentData(),u=_s(_s(_s(_s({},a.env),n),h),{},{submission_timestamp:Date.now()}),c=s.blob||s.file,d=s.fileName||(s.file?s.file.name:"rec-".concat(Date.now(),".webm")),c){i.n=1;break}return alert("No audio recording found."),i.a(2);case 1:if(f={transcript:(null===(o=s.transcript)||void 0===o?void 0:o.trim())||null,calibration:l.complete?{gain:l.gain,speechLevel:l.speechLevel}:null,env:u,tier:u.tier||(null==h?void 0:h.tier)||"C"},t.dispatch({type:"starmus/submit-start"}),i.p=2,navigator.onLine){i.n=3;break}throw new Error("OFFLINE_FAST_PATH");case 3:return console.log("[StarmusCore]  Uploading..."),i.n=4,dc({blob:c,fileName:d,formFields:r,metadata:f,instanceId:e,onProgress:function(e,n){return t.dispatch({type:"starmus/submit-progress",progress:e/n})}});case 4:if(p=i.v,console.log("[StarmusCore]  Success:",p),g=!1,p.success&&(v=(null===(m=p.data)||void 0===m?void 0:m.post_id)||p.post_id)){console.log("[StarmusCore] Firing starmusRecordingComplete event with Post ID:",v);try{window.parent&&window.parent!==window&&window.parent.jQuery&&(window.parent.location.href,parent.jQuery(parent.document).trigger("starmusRecordingComplete",[{audioPostId:v}]),g=!0)}catch(t){rc.reportError("cross_origin_parent",{instanceId:e,tier:u.tier,network:u.network,_e:t})}}t.dispatch({type:"starmus/submit-complete",payload:p}),p.success&&((y=(null===(_=p.data)||void 0===_?void 0:_.redirect_url)||p.redirect_url)?(console.log("[StarmusCore] Redirecting to:",y),setTimeout(function(){return window.location.href=y},1500)):g||(alert("Submission successful!"),window.location.reload())),i.n=10;break;case 5:return i.p=5,S=i.v,console.error("[StarmusCore]  Upload Failed:",S.message),rc.isAvailable&&rc.reportError("upload_failed",{error:S.message,instanceId:e,tier:u.tier,network:u.network,fileSize:c.size}),i.p=6,i.n=7,Rc(e,c,d,r,f);case 7:return b=i.v,t.dispatch({type:"starmus/submit-queued",submissionId:b}),i.n=8,Bc();case 8:w=i.v,window.CommandBus&&window.CommandBus.dispatch("starmus/offline/queue_updated",{count:w}),i.n=10;break;case 9:i.p=9,C=i.v,console.error("Offline Queue Failed:",C),t.dispatch({type:"starmus/error",error:{message:"Upload failed completely."}});case 10:return i.a(2)}},i,null,[[6,9],[2,5]])}))).apply(this,arguments)}return rc.init().then(function(i){var r,o,a=Jc(i),s=_s(_s(_s({},n),i),{},{tier:a,sparxstar_available:rc.isAvailable});t.dispatch({type:"starmus/environment-ready",payload:{tier:a,environment:s,recordingSettings:i.recordingSettings}}),t.dispatch({type:"starmus/tier-ready",payload:{tier:a}}),window.dispatchEvent(new CustomEvent("starmus-ready",{detail:{instanceId:e,tier:a,environment:s}})),console.log("[Core] Environment initialized:",{tier:a,sparxstar:rc.isAvailable,network:null===(r=s.network)||void 0===r?void 0:r.type,device:null===(o=s.device)||void 0===o?void 0:o.type})}).catch(function(n){console.error("[Core] Environment initialization failed:",n);var i=Jc();t.dispatch({type:"starmus/tier-ready",payload:{tier:i}}),window.dispatchEvent(new CustomEvent("starmus-ready",{detail:{instanceId:e,tier:i}}))}),qc("submit",function(t,n){n&&n.instanceId===e&&i(t.formFields||{})},e),qc("reset",function(n,i){i&&i.instanceId===e&&t.dispatch({type:"starmus/reset"})},e),qc("continue",function(n,i){i&&i.instanceId===e&&t.dispatch({type:"starmus/ui/step-continue"})},e),{handleSubmit:i}}function $c(){if(Nc)return Gc;Nc=1;var t,e,n,i=_n(),r=_i(),o=yi(),a=Qs(),s=ll(),l=Kr(),h=hr(),u=nr(),c=h("iterator"),d=!1;return[].keys&&("next"in(n=[].keys())?(e=s(s(n)))!==Object.prototype&&(t=e):d=!0),!o(t)||i(function(){var e={};return t[c].call(e)!==e})?t={}:u&&(t=a(t)),r(t[c])||l(t,c,function(){return this}),Gc={IteratorPrototype:t,BUGGY_SAFARI_ITERATORS:d}}function td(){if(Hc)return zc;Hc=1;var t=$c().IteratorPrototype,e=Qs(),n=ci(),i=ph(),r=Qh(),o=function(){return this};return zc=function(a,s,l,h){var u=s+" Iterator";return a.prototype=e(t,{next:n(+!h,l)}),i(a,u,!1,!0),r[u]=o,a}}function ed(){if(jc)return Vc;jc=1;var t=ea(),e=wn(),n=nr(),i=Hr(),r=_i(),o=td(),a=ll(),s=fh(),l=ph(),h=Tr(),u=Kr(),c=hr(),d=Qh(),f=$c(),p=i.PROPER,g=i.CONFIGURABLE,m=f.IteratorPrototype,v=f.BUGGY_SAFARI_ITERATORS,_=c("iterator"),y="keys",b="values",w="entries",S=function(){return this};return Vc=function(i,c,f,C,x,k,T){o(f,c,C);var A,P,E,I=function(t){if(t===x&&R)return R;if(!v&&t&&t in L)return L[t];switch(t){case y:case b:case w:return function(){return new f(this,t)}}return function(){return new f(this)}},D=c+" Iterator",M=!1,L=i.prototype,O=L[_]||L["@@iterator"]||x&&L[x],R=!v&&O||I(x),F="Array"===c&&L.entries||O;if(F&&(A=a(F.call(new i)))!==Object.prototype&&A.next&&(n||a(A)===m||(s?s(A,m):r(A[_])||u(A,_,S)),l(A,D,!0,!0),n&&(d[D]=S)),p&&x===b&&O&&O.name!==b&&(!n&&g?h(L,"name",b):(M=!0,R=function(){return e(O,this)})),x)if(P={values:I(b),keys:k?R:I(y),entries:I(w)},T)for(E in P)(v||M||!(E in L))&&u(L,E,P[E]);else t({target:c,proto:!0,forced:v||M},P);return n&&!T||L[_]===R||u(L,_,R,{name:x}),d[c]=R,P}}function nd(){return Yc?Xc:(Yc=1,Xc=function(t,e){return{value:t,done:e}})}function id(){if(Kc)return Zc;Kc=1;var t=vi(),e=$s(),n=Qh(),i=Yr(),r=kr().f,o=ed(),a=nd(),s=nr(),l=yn(),h="Array Iterator",u=i.set,c=i.getterFor(h);Zc=o(Array,"Array",function(e,n){u(this,{type:h,target:t(e),index:0,kind:n})},function(){var t=c(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,a(void 0,!0);switch(t.kind){case"keys":return a(n,!1);case"values":return a(e[n],!1)}return a([n,e[n]],!1)},"values");var d=n.Arguments=n.Array;if(e("keys"),e("values"),e("entries"),!s&&l&&"values"!==d.name)try{r(d,"name",{value:"values"})}catch(t){}return Zc}"undefined"!=typeof window&&(window.initCore=Qc),id();var rd,od,ad;function sd(){if(od)return rd;od=1;var t=ln().isFinite;return rd=Number.isFinite||function(e){return"number"==typeof e&&t(e)}}ad||(ad=1,ea()({target:"Number",stat:!0},{isFinite:sd()}));var ld,hd={};function ud(){if(ld)return hd;ld=1;var t=tc().charAt,e=Rs(),n=Yr(),i=ed(),r=nd(),o="String Iterator",a=n.set,s=n.getterFor(o);return i(String,"String",function(t){a(this,{type:o,string:e(t),index:0})},function(){var e,n=s(this),i=n.string,o=n.index;return o>=i.length?r(void 0,!0):(e=t(i,o),n.index+=e.length,r(e,!1))}),hd}ud();var cd,dd={};!function(){if(cd)return dd;cd=1;var t=ln(),e=ja(),n=Xa(),i=id(),r=Tr(),o=ph(),a=hr()("iterator"),s=i.values,l=function(t,n){if(t){if(t[a]!==s)try{r(t,a,s)}catch(e){t[a]=s}if(o(t,n,!0),e[n])for(var l in i)if(t[l]!==i[l])try{r(t,l,i[l])}catch(e){t[l]=i[l]}}};for(var h in e)l(t[h]&&t[h].prototype,h);l(n,"DOMTokenList")}();var fd,pd,gd,md,vd,_d,yd,bd,wd,Sd,Cd={};function xd(){if(pd)return fd;pd=1;var t=_n(),e=hr(),n=yn(),i=nr(),r=e("iterator");return fd=!t(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,o=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",e.forEach(function(t,n){e.delete("b"),a+=n+t}),o.delete("a",2),o.delete("b",void 0),i&&(!t.toJSON||!o.has("a",1)||o.has("a",2)||!o.has("a",void 0)||o.has("b"))||!e.size&&(i||!n)||!e.sort||"https://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[r]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==a||"x"!==new URL("https://x",void 0).host})}function kd(){if(_d)return vd;_d=1;var t=xr(),e=nu();return vd=function(n,i,r,o){try{return o?i(t(r)[0],r[1]):i(r)}catch(t){e(n,"throw",t)}}}function Td(){if(bd)return yd;bd=1;var t=Ya(),e=wn(),n=ar(),i=kd(),r=$h(),o=sa(),a=_o(),s=ra(),l=eu(),h=tu(),u=Array;return yd=function(c){var d=n(c),f=o(this),p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g;m&&(g=t(g,p>2?arguments[2]:void 0));var v,_,y,b,w,S,C=h(d),x=0;if(!C||this===u&&r(C))for(v=a(d),_=f?new this(v):u(v);v>x;x++)S=m?g(d[x],x):d[x],s(_,x,S);else for(_=f?new this:[],w=(b=l(d,C)).next;!(y=e(w,b)).done;x++)S=m?i(b,g,[y.value,x],!0):y.value,s(_,x,S);return _.length=x,_},yd}function Ad(){if(Sd)return wd;Sd=1;var t=di(),e=2147483647,n=/[^\0-\u007E]/,i=/[.\u3002\uFF0E\uFF61]/g,r="Overflow: input needs wider integers to process",o=RangeError,a=t(i.exec),s=Math.floor,l=String.fromCharCode,h=t("".charCodeAt),u=t([].join),c=t([].push),d=t("".replace),f=t("".split),p=t("".toLowerCase),g=function(t){return t+22+75*(t<26)},m=function(t,e,n){var i=0;for(t=n?s(t/700):t>>1,t+=s(t/e);t>455;)t=s(t/35),i+=36;return s(i+36*t/(t+38))},v=function(t){var n=[];t=function(t){for(var e=[],n=0,i=t.length;n<i;){var r=h(t,n++);if(r>=55296&&r<=56319&&n<i){var o=h(t,n++);56320==(64512&o)?c(e,((1023&r)<<10)+(1023&o)+65536):(c(e,r),n--)}else c(e,r)}return e}(t);var i,a,d=t.length,f=128,p=0,v=72;for(i=0;i<t.length;i++)(a=t[i])<128&&c(n,l(a));var _=n.length,y=_;for(_&&c(n,"-");y<d;){var b=e;for(i=0;i<t.length;i++)(a=t[i])>=f&&a<b&&(b=a);var w=y+1;if(b-f>s((e-p)/w))throw new o(r);for(p+=(b-f)*w,f=b,i=0;i<t.length;i++){if((a=t[i])<f&&++p>e)throw new o(r);if(a===f){for(var S=p,C=36;;){var x=C<=v?1:C>=v+26?26:C-v;if(S<x)break;var k=S-x,T=36-x;c(n,l(g(x+k%T))),S=s(k/T),C+=36}c(n,l(g(S))),v=m(p,w,y===_),p=0,y++}}p++,f++}return u(n,"")};return wd=function(t){var e,r,o=[],s=f(d(p(t),i,"."),".");for(e=0;e<s.length;e++)r=s[e],c(o,a(n,r)?"xn--"+v(r):r);return u(o,".")}}var Pd,Ed,Id,Dd,Md,Ld,Od,Rd,Fd,Bd={};function Wd(){if(Id)return Ed;Id=1;var t=Kr();return Ed=function(e,n,i){for(var r in n)t(e,r,n[r],i);return e}}function Ud(){if(Md)return Dd;Md=1;var t=is(),e=Math.floor,n=function(i,r){var o=i.length;if(o<8)for(var a,s,l=1;l<o;){for(s=l,a=i[l];s&&r(i[s-1],a)>0;)i[s]=i[--s];s!==l++&&(i[s]=a)}else for(var h=e(o/2),u=n(t(i,0,h),r),c=n(t(i,h),r),d=u.length,f=c.length,p=0,g=0;p<d||g<f;)i[p+g]=p<d&&g<f?r(u[p],c[g])<=0?u[p++]:c[g++]:p<d?u[p++]:c[g++];return i};return Dd=n}function Gd(){if(Od)return Ld;Od=1,id(),function(){if(Pd)return Bd;Pd=1;var t=ea(),e=di(),n=mo(),i=RangeError,r=String.fromCharCode,o=String.fromCodePoint,a=e([].join);t({target:"String",stat:!0,arity:1,forced:!!o&&1!==o.length},{fromCodePoint:function(t){for(var e,o=[],s=arguments.length,l=0;s>l;){if(e=+arguments[l++],n(e,1114111)!==e)throw new i(e+" is not a valid code point");o[l]=e<65536?r(e):r(55296+((e-=65536)>>10),e%1024+56320)}return a(o,"")}})}();var t=ea(),e=ln(),n=Ch(),i=bi(),r=wn(),o=di(),a=yn(),s=xd(),l=Kr(),h=ls(),u=Wd(),c=ph(),d=td(),f=Yr(),p=mh(),g=_i(),m=sr(),v=Ya(),_=aa(),y=xr(),b=yi(),w=Rs(),S=Qs(),C=ci(),x=eu(),k=tu(),T=nd(),A=bh(),P=hr(),E=Ud(),I=P("iterator"),D="URLSearchParams",M=D+"Iterator",L=f.set,O=f.getterFor(D),R=f.getterFor(M),F=n("fetch"),B=n("Request"),W=n("Headers"),U=B&&B.prototype,G=W&&W.prototype,N=e.TypeError,z=e.encodeURIComponent,H=String.fromCharCode,V=i("String","fromCodePoint"),j=parseInt,X=o("".charAt),Y=o([].join),Z=o([].push),K=o("".replace),q=o([].shift),J=o([].splice),Q=o("".split),$=o("".slice),tt=o(/./.exec),et=/\+/g,nt=/^[0-9a-f]+$/i,it=function(t,e){var n=$(t,e,e+2);return tt(nt,n)?j(n,16):NaN},rt=function(t){for(var e=0,n=128;n>0&&0!==(t&n);n>>=1)e++;return e},ot=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},at=function(t){for(var e=(t=K(t,et," ")).length,n="",i=0;i<e;){var r=X(t,i);if("%"===r){if("%"===X(t,i+1)||i+3>e){n+="%",i++;continue}var o=it(t,i+1);if(o!=o){n+=r,i++;continue}i+=2;var a=rt(o);if(0===a)r=H(o);else{if(1===a||a>4){n+="",i++;continue}for(var s=[o],l=1;l<a&&!(++i+3>e||"%"!==X(t,i));){var h=it(t,i+1);if(h!=h){i+=3;break}if(h>191||h<128)break;Z(s,h),i+=2,l++}if(s.length!==a){n+="";continue}var u=ot(s);null===u?n+="":r=V(u)}}n+=r,i++}return n},st=/[!'()~]|%20/g,lt={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ht=function(t){return lt[t]},ut=function(t){return K(z(t),st,ht)},ct=d(function(t,e){L(this,{type:M,target:O(t).entries,index:0,kind:e})},D,function(){var t=R(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,T(void 0,!0);var i=e[n];switch(t.kind){case"keys":return T(i.key,!1);case"values":return T(i.value,!1)}return T([i.key,i.value],!1)},!0),dt=function(t){this.entries=[],this.url=null,void 0!==t&&(b(t)?this.parseObject(t):this.parseQuery("string"==typeof t?"?"===X(t,0)?$(t,1):t:w(t)))};dt.prototype={type:D,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,o,a,s,l,h=this.entries,u=k(t);if(u)for(n=(e=x(t,u)).next;!(i=r(n,e)).done;){if(a=(o=x(y(i.value))).next,(s=r(a,o)).done||(l=r(a,o)).done||!r(a,o).done)throw new N("Expected sequence with length 2");Z(h,{key:w(s.value),value:w(l.value)})}else for(var c in t)m(t,c)&&Z(h,{key:c,value:w(t[c])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,r=Q(t,"&"),o=0;o<r.length;)(e=r[o++]).length&&(n=Q(e,"="),Z(i,{key:at(q(n)),value:at(Y(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],Z(n,ut(t.key)+"="+ut(t.value));return Y(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ft=function(){p(this,pt);var t=L(this,new dt(arguments.length>0?arguments[0]:void 0));a||(this.size=t.entries.length)},pt=ft.prototype;if(u(pt,{append:function(t,e){var n=O(this);A(arguments.length,2),Z(n.entries,{key:w(t),value:w(e)}),a||this.size++,n.updateURL()},delete:function(t){for(var e=O(this),n=A(arguments.length,1),i=e.entries,r=w(t),o=n<2?void 0:arguments[1],s=void 0===o?o:w(o),l=0;l<i.length;){var h=i[l];if(h.key!==r||void 0!==s&&h.value!==s)l++;else if(J(i,l,1),void 0!==s)break}a||(this.size=i.length),e.updateURL()},get:function(t){var e=O(this).entries;A(arguments.length,1);for(var n=w(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=O(this).entries;A(arguments.length,1);for(var n=w(t),i=[],r=0;r<e.length;r++)e[r].key===n&&Z(i,e[r].value);return i},has:function(t){for(var e=O(this).entries,n=A(arguments.length,1),i=w(t),r=n<2?void 0:arguments[1],o=void 0===r?r:w(r),a=0;a<e.length;){var s=e[a++];if(s.key===i&&(void 0===o||s.value===o))return!0}return!1},set:function(t,e){var n=O(this);A(arguments.length,1);for(var i,r=n.entries,o=!1,s=w(t),l=w(e),h=0;h<r.length;h++)(i=r[h]).key===s&&(o?J(r,h--,1):(o=!0,i.value=l));o||Z(r,{key:s,value:l}),a||(this.size=r.length),n.updateURL()},sort:function(){var t=O(this);E(t.entries,function(t,e){return t.key>e.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=O(this).entries,i=v(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new ct(this,"keys")},values:function(){return new ct(this,"values")},entries:function(){return new ct(this,"entries")}},{enumerable:!0}),l(pt,I,pt.entries,{name:"entries"}),l(pt,"toString",function(){return O(this).serialize()},{enumerable:!0}),a&&h(pt,"size",{get:function(){return O(this).entries.length},configurable:!0,enumerable:!0}),c(ft,D),t({global:!0,constructor:!0,forced:!s},{URLSearchParams:ft}),!s&&g(W)){var gt=o(G.has),mt=o(G.set),vt=function(t){if(b(t)){var e,n=t.body;if(_(n)===D)return e=t.headers?new W(t.headers):new W,gt(e,"content-type")||mt(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),S(t,{body:C(0,w(n)),headers:C(0,e)})}return t};if(g(F)&&t({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return F(t,arguments.length>1?vt(arguments[1]):{})}}),g(B)){var _t=function(t){return p(this,U),new B(t,arguments.length>1?vt(arguments[1]):{})};U.constructor=_t,_t.prototype=U,t({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:_t})}}return Ld={URLSearchParams:ft,getState:O}}function Nd(){if(Rd)return Cd;Rd=1,ud();var t,e=ea(),n=yn(),i=xd(),r=ln(),o=Ya(),a=di(),s=Kr(),l=ls(),h=mh(),u=sr(),c=function(){if(md)return gd;md=1;var t=yn(),e=di(),n=wn(),i=_n(),r=qs(),o=Qo(),a=ui(),s=ar(),l=pi(),h=Object.assign,u=Object.defineProperty,c=e([].concat);return gd=!h||i(function(){if(t&&1!==h({b:1},h(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},n={},i=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(t){n[t]=t}),7!==h({},e)[i]||r(h({},n)).join("")!==o})?function(e,i){for(var h=s(e),u=arguments.length,d=1,f=o.f,p=a.f;u>d;)for(var g,m=l(arguments[d++]),v=f?c(r(m),f(m)):r(m),_=v.length,y=0;_>y;)g=v[y++],t&&!n(p,m,g)||(h[g]=m[g]);return h}:h,gd}(),d=Td(),f=is(),p=tc().codeAt,g=Ad(),m=Rs(),v=ph(),_=bh(),y=Gd(),b=Yr(),w=b.set,S=b.getterFor("URL"),C=y.URLSearchParams,x=y.getState,k=r.URL,T=r.TypeError,A=r.parseInt,P=Math.floor,E=Math.pow,I=a("".charAt),D=a(/./.exec),M=a([].join),L=a(1.1.toString),O=a([].pop),R=a([].push),F=a("".replace),B=a([].shift),W=a("".split),U=a("".slice),G=a("".toLowerCase),N=a([].unshift),z="Invalid scheme",H="Invalid host",V="Invalid port",j=/[a-z]/i,X=/[\d+-.a-z]/i,Y=/\d/,Z=/^0x/i,K=/^[0-7]+$/,q=/^\d+$/,J=/^[\da-f]+$/i,Q=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$=/[\0\t\n\r #/:<>?@[\\\]^|]/,tt=/^[\u0000-\u0020]+/,et=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,nt=/[\t\n\r]/g,it=function(t){var e,n,i,r;if("number"==typeof t){for(e=[],n=0;n<4;n++)N(e,t%256),t=P(t/256);return M(e,".")}if("object"==typeof t){for(e="",i=function(t){for(var e=null,n=1,i=null,r=0,o=0;o<8;o++)0!==t[o]?(r>n&&(e=i,n=r),i=null,r=0):(null===i&&(i=o),++r);return r>n?i:e}(t),n=0;n<8;n++)r&&0===t[n]||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=L(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},rt={},ot=c({},rt,{" ":1,'"':1,"<":1,">":1,"`":1}),at=c({},ot,{"#":1,"?":1,"{":1,"}":1}),st=c({},at,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),lt=function(t,e){var n=p(t,0);return n>32&&n<127&&!u(e,t)?t:encodeURIComponent(t)},ht={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ut=function(t,e){var n;return 2===t.length&&D(j,I(t,0))&&(":"===(n=I(t,1))||!e&&"|"===n)},ct=function(t){var e;return t.length>1&&ut(U(t,0,2))&&(2===t.length||"/"===(e=I(t,2))||"\\"===e||"?"===e||"#"===e)},dt=function(t){return"."===t||"%2e"===G(t)},ft=function(t){return".."===(t=G(t))||"%2e."===t||".%2e"===t||"%2e%2e"===t},pt={},gt={},mt={},vt={},_t={},yt={},bt={},wt={},St={},Ct={},xt={},kt={},Tt={},At={},Pt={},Et={},It={},Dt={},Mt={},Lt={},Ot={},Rt=function(t,e,n){var i,r,o,a=m(t);if(e){if(r=this.parse(a))throw new T(r);this.searchParams=null}else{if(void 0!==n&&(i=new Rt(n,!0)),r=this.parse(a,null,i))throw new T(r);(o=x(new C)).bindURL(this),this.searchParams=o}};Rt.prototype={type:"URL",parse:function(e,n,i){var r,o,a,s,l=this,h=n||pt,c=0,p="",g=!1,v=!1,_=!1;for(e=m(e),n||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=F(e,tt,""),e=F(e,et,"$1")),e=F(e,nt,""),r=d(e);c<=r.length;){switch(o=r[c],h){case pt:if(!o||!D(j,o)){if(n)return z;h=mt;continue}p+=G(o),h=gt;break;case gt:if(o&&(D(X,o)||"+"===o||"-"===o||"."===o))p+=G(o);else{if(":"!==o){if(n)return z;p="",h=mt,c=0;continue}if(n&&(l.isSpecial()!==u(ht,p)||"file"===p&&(l.includesCredentials()||null!==l.port)||"file"===l.scheme&&!l.host))return;if(l.scheme=p,n)return void(l.isSpecial()&&ht[l.scheme]===l.port&&(l.port=null));p="","file"===l.scheme?h=At:l.isSpecial()&&i&&i.scheme===l.scheme?h=vt:l.isSpecial()?h=wt:"/"===r[c+1]?(h=_t,c++):(l.cannotBeABaseURL=!0,R(l.path,""),h=Mt)}break;case mt:if(!i||i.cannotBeABaseURL&&"#"!==o)return z;if(i.cannotBeABaseURL&&"#"===o){l.scheme=i.scheme,l.path=f(i.path),l.query=i.query,l.fragment="",l.cannotBeABaseURL=!0,h=Ot;break}h="file"===i.scheme?At:yt;continue;case vt:if("/"!==o||"/"!==r[c+1]){h=yt;continue}h=St,c++;break;case _t:if("/"===o){h=Ct;break}h=Dt;continue;case yt:if(l.scheme=i.scheme,o===t)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=f(i.path),l.query=i.query;else if("/"===o||"\\"===o&&l.isSpecial())h=bt;else if("?"===o)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=f(i.path),l.query="",h=Lt;else{if("#"!==o){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=f(i.path),l.path.length--,h=Dt;continue}l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=f(i.path),l.query=i.query,l.fragment="",h=Ot}break;case bt:if(!l.isSpecial()||"/"!==o&&"\\"!==o){if("/"!==o){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,h=Dt;continue}h=Ct}else h=St;break;case wt:if(h=St,"/"!==o||"/"!==I(p,c+1))continue;c++;break;case St:if("/"!==o&&"\\"!==o){h=Ct;continue}break;case Ct:if("@"===o){g&&(p="%40"+p),g=!0,a=d(p);for(var y=0;y<a.length;y++){var b=a[y];if(":"!==b||_){var w=lt(b,st);_?l.password+=w:l.username+=w}else _=!0}p=""}else if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()){if(g&&""===p)return"Invalid authority";c-=d(p).length+1,p="",h=xt}else p+=o;break;case xt:case kt:if(n&&"file"===l.scheme){h=Et;continue}if(":"!==o||v){if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()){if(l.isSpecial()&&""===p)return H;if(n&&""===p&&(l.includesCredentials()||null!==l.port))return;if(s=l.parseHost(p))return s;if(p="",h=It,n)return;continue}"["===o?v=!0:"]"===o&&(v=!1),p+=o}else{if(""===p)return H;if(s=l.parseHost(p))return s;if(p="",h=Tt,n===kt)return}break;case Tt:if(!D(Y,o)){if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()||n){if(""!==p){var S=A(p,10);if(S>65535)return V;l.port=l.isSpecial()&&S===ht[l.scheme]?null:S,p=""}if(n)return;h=It;continue}return V}p+=o;break;case At:if(l.scheme="file","/"===o||"\\"===o)h=Pt;else{if(!i||"file"!==i.scheme){h=Dt;continue}switch(o){case t:l.host=i.host,l.path=f(i.path),l.query=i.query;break;case"?":l.host=i.host,l.path=f(i.path),l.query="",h=Lt;break;case"#":l.host=i.host,l.path=f(i.path),l.query=i.query,l.fragment="",h=Ot;break;default:ct(M(f(r,c),""))||(l.host=i.host,l.path=f(i.path),l.shortenPath()),h=Dt;continue}}break;case Pt:if("/"===o||"\\"===o){h=Et;break}i&&"file"===i.scheme&&!ct(M(f(r,c),""))&&(ut(i.path[0],!0)?R(l.path,i.path[0]):l.host=i.host),h=Dt;continue;case Et:if(o===t||"/"===o||"\\"===o||"?"===o||"#"===o){if(!n&&ut(p))h=Dt;else if(""===p){if(l.host="",n)return;h=It}else{if(s=l.parseHost(p))return s;if("localhost"===l.host&&(l.host=""),n)return;p="",h=It}continue}p+=o;break;case It:if(l.isSpecial()){if(h=Dt,"/"!==o&&"\\"!==o)continue}else if(n||"?"!==o)if(n||"#"!==o){if(o!==t&&(h=Dt,"/"!==o))continue}else l.fragment="",h=Ot;else l.query="",h=Lt;break;case Dt:if(o===t||"/"===o||"\\"===o&&l.isSpecial()||!n&&("?"===o||"#"===o)){if(ft(p)?(l.shortenPath(),"/"===o||"\\"===o&&l.isSpecial()||R(l.path,"")):dt(p)?"/"===o||"\\"===o&&l.isSpecial()||R(l.path,""):("file"===l.scheme&&!l.path.length&&ut(p)&&(l.host&&(l.host=""),p=I(p,0)+":"),R(l.path,p)),p="","file"===l.scheme&&(o===t||"?"===o||"#"===o))for(;l.path.length>1&&""===l.path[0];)B(l.path);"?"===o?(l.query="",h=Lt):"#"===o&&(l.fragment="",h=Ot)}else p+=lt(o,at);break;case Mt:"?"===o?(l.query="",h=Lt):"#"===o?(l.fragment="",h=Ot):o!==t&&(l.path[0]+=lt(o,rt));break;case Lt:n||"#"!==o?o!==t&&("'"===o&&l.isSpecial()?l.query+="%27":l.query+="#"===o?"%23":lt(o,rt)):(l.fragment="",h=Ot);break;case Ot:o!==t&&(l.fragment+=lt(o,ot))}c++}},parseHost:function(t){var e,n,i;if("["===I(t,0)){if("]"!==I(t,t.length-1))return H;if(e=function(t){var e,n,i,r,o,a,s,l=[0,0,0,0,0,0,0,0],h=0,u=null,c=0,d=function(){return I(t,c)};if(":"===d()){if(":"!==I(t,1))return;c+=2,u=++h}for(;d();){if(8===h)return;if(":"!==d()){for(e=n=0;n<4&&D(J,d());)e=16*e+A(d(),16),c++,n++;if("."===d()){if(0===n)return;if(c-=n,h>6)return;for(i=0;d();){if(r=null,i>0){if(!("."===d()&&i<4))return;c++}if(!D(Y,d()))return;for(;D(Y,d());){if(o=A(d(),10),null===r)r=o;else{if(0===r)return;r=10*r+o}if(r>255)return;c++}l[h]=256*l[h]+r,2!==++i&&4!==i||h++}if(4!==i)return;break}if(":"===d()){if(c++,!d())return}else if(d())return;l[h++]=e}else{if(null!==u)return;c++,u=++h}}if(null!==u)for(a=h-u,h=7;0!==h&&a>0;)s=l[h],l[h--]=l[u+a-1],l[u+--a]=s;else if(8!==h)return;return l}(U(t,1,-1)),!e)return H;this.host=e}else if(this.isSpecial()){if(t=g(t),D(Q,t))return H;if(e=function(t){var e,n,i,r,o,a,s,l=W(t,".");if(l.length&&""===l[l.length-1]&&l.length--,(e=l.length)>4)return t;for(n=[],i=0;i<e;i++){if(""===(r=l[i]))return t;if(o=10,r.length>1&&"0"===I(r,0)&&(o=D(Z,r)?16:8,r=U(r,8===o?1:2)),""===r)a=0;else{if(!D(10===o?q:8===o?K:J,r))return t;a=A(r,o)}R(n,a)}for(i=0;i<e;i++)if(a=n[i],i===e-1){if(a>=E(256,5-e))return null}else if(a>255)return null;for(s=O(n),i=0;i<n.length;i++)s+=n[i]*E(256,3-i);return s}(t),null===e)return H;this.host=e}else{if(D($,t))return H;for(e="",n=d(t),i=0;i<n.length;i++)e+=lt(n[i],rt);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return u(ht,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||"file"===this.scheme&&1===e&&ut(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,o=t.port,a=t.path,s=t.query,l=t.fragment,h=e+":";return null!==r?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=it(r),null!==o&&(h+=":"+o)):"file"===e&&(h+="//"),h+=t.cannotBeABaseURL?a[0]:a.length?"/"+M(a,"/"):"",null!==s&&(h+="?"+s),null!==l&&(h+="#"+l),h},setHref:function(t){var e=this.parse(t);if(e)throw new T(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if("blob"===t)try{return new Ft(t.path[0]).origin}catch(t){return"null"}return"file"!==t&&this.isSpecial()?t+"://"+it(this.host)+(null!==e?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(m(t)+":",pt)},getUsername:function(){return this.username},setUsername:function(t){var e=d(m(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=lt(e[n],st)}},getPassword:function(){return this.password},setPassword:function(t){var e=d(m(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=lt(e[n],st)}},getHost:function(){var t=this.host,e=this.port;return null===t?"":null===e?it(t):it(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,xt)},getHostname:function(){var t=this.host;return null===t?"":it(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,kt)},getPort:function(){var t=this.port;return null===t?"":m(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||(""===(t=m(t))?this.port=null:this.parse(t,Tt))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+M(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,It))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){""===(t=m(t))?this.query=null:("?"===I(t,0)&&(t=U(t,1)),this.query="",this.parse(t,Lt)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){""!==(t=m(t))?("#"===I(t,0)&&(t=U(t,1)),this.fragment="",this.parse(t,Ot)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ft=function(t){var e=h(this,Bt),i=_(arguments.length,1)>1?arguments[1]:void 0,r=w(e,new Rt(t,!1,i));n||(e.href=r.serialize(),e.origin=r.getOrigin(),e.protocol=r.getProtocol(),e.username=r.getUsername(),e.password=r.getPassword(),e.host=r.getHost(),e.hostname=r.getHostname(),e.port=r.getPort(),e.pathname=r.getPathname(),e.search=r.getSearch(),e.searchParams=r.getSearchParams(),e.hash=r.getHash())},Bt=Ft.prototype,Wt=function(t,e){return{get:function(){return S(this)[t]()},set:e&&function(t){return S(this)[e](t)},configurable:!0,enumerable:!0}};if(n&&(l(Bt,"href",Wt("serialize","setHref")),l(Bt,"origin",Wt("getOrigin")),l(Bt,"protocol",Wt("getProtocol","setProtocol")),l(Bt,"username",Wt("getUsername","setUsername")),l(Bt,"password",Wt("getPassword","setPassword")),l(Bt,"host",Wt("getHost","setHost")),l(Bt,"hostname",Wt("getHostname","setHostname")),l(Bt,"port",Wt("getPort","setPort")),l(Bt,"pathname",Wt("getPathname","setPathname")),l(Bt,"search",Wt("getSearch","setSearch")),l(Bt,"searchParams",Wt("getSearchParams")),l(Bt,"hash",Wt("getHash","setHash"))),s(Bt,"toJSON",function(){return S(this).serialize()},{enumerable:!0}),s(Bt,"toString",function(){return S(this).serialize()},{enumerable:!0}),k){var Ut=k.createObjectURL,Gt=k.revokeObjectURL;Ut&&s(Ft,"createObjectURL",o(Ut,k)),Gt&&s(Ft,"revokeObjectURL",o(Gt,k))}return v(Ft,"URL"),e({global:!0,constructor:!0,forced:!i,sham:!n},{URL:Ft}),Cd}Fd||(Fd=1,Nd());var zd,Hd={};!function(){if(zd)return Hd;zd=1;var t=ea(),e=wn();t({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return e(URL.prototype.toString,this)}})}();var Vd;Vd||(Vd=1,Gd());var jd=null;function Xd(t,e,n){t&&(t._starmusBound||(t.addEventListener(e,function(e){e.cancelable&&e.preventDefault(),e.stopPropagation(),t.disabled||n(e)}),t._starmusBound=!0))}function Yd(t,e){if(e){var n=t.status,i=t.step,r=t.recorder||{},o=t.calibration||{},a=t.submission||{};if("C"!==t.tier){if("calibrating"===n||"recording"===n){var s="calibrating"===n?o.volumePercent||0:r.amplitude||0;e.volumeMeter&&e.volumeMeter.style.setProperty("--starmus-audio-level",s+"%")}else e.volumeMeter&&e.volumeMeter.style.setProperty("--starmus-audio-level","0%");if(e.timerElapsed&&(e.timerElapsed.textContent=function(t){if(!Number.isFinite(t))return"00m 00s";var e=Math.floor(t/60),n=Math.floor(t%60);return(e<10?"0"+e:e)+"m "+(n<10?"0"+n:n)+"s"}(r.duration||0)),e.durationProgress){var l=Math.min(100,(r.duration||0)/120*100);e.durationProgress.style.setProperty("--starmus-recording-progress",l+"%")}if(e.step1&&e.step2){2===i||-1!==["recording","paused","processing","ready_to_submit","submitting","calibrating","ready","complete"].indexOf(n)?(e.step1.style.display="none",e.step2.style.display="block"):(e.step1.style.display="block",e.step2.style.display="none")}var h=!0===o.complete;if(e.setupContainer){var u=!h||"calibrating"===n;e.setupContainer.style.display=u?"block":"none",e.setupMicBtn&&("calibrating"===n?(e.setupMicBtn.innerHTML='<span class="dashicons dashicons-microphone" style="animation:pulse 1s infinite"></span> '+(o.message||"Adjusting..."),e.setupMicBtn.disabled=!0,e.setupMicBtn.classList.remove("is-busy")):(e.setupMicBtn.innerHTML='<span class="dashicons dashicons-microphone"></span> Setup Microphone',e.setupMicBtn.disabled=!1,e.setupMicBtn.classList.remove("is-busy")))}e.recorderContainer&&(e.recorderContainer.style.display=h?"block":"none");var c="recording"===n,d="paused"===n,f="ready_to_submit"===n,p=("ready"===n||"ready_to_record"===n||"idle"===n)&&h;e.recordBtn&&(e.recordBtn.style.display=!p||c||d||f?"none":"inline-flex"),e.pauseBtn&&(e.pauseBtn.style.display=c?"inline-flex":"none"),e.resumeBtn&&(e.resumeBtn.style.display=d?"inline-flex":"none"),e.stopBtn&&(e.stopBtn.style.display=c||d?"inline-flex":"none"),e.reviewControls?e.reviewControls.style.display=f?"flex":"none":(e.playBtn&&(e.playBtn.style.display=f?"inline-flex":"none"),e.resetBtn&&(e.resetBtn.style.display=f?"inline-flex":"none")),e.submitBtn&&("submitting"===n?(e.submitBtn.textContent="Uploading... "+Math.round(100*(a.progress||0))+"%",e.submitBtn.disabled=!0,e.submitBtn.classList.add("is-busy")):"complete"===n?(e.submitBtn.innerHTML='<span class="dashicons dashicons-yes"></span> Success! Redirecting...',e.submitBtn.disabled=!0,e.submitBtn.classList.remove("is-busy"),e.submitBtn.classList.add("starmus-btn--success")):(e.submitBtn.textContent="Submit Recording",e.submitBtn.disabled="ready_to_submit"!==n,e.submitBtn.classList.remove("is-busy")))}else{e.recorderContainer&&(e.recorderContainer.style.display="none"),e.setupContainer&&(e.setupContainer.style.display="none");var g=document.querySelector("[data-starmus-fallback-container]");g&&(g.style.display="block")}}}function Zd(t,e,n){var i=n||t.getState().instanceId,r=document;if(i){var o=document.querySelector('form[data-starmus-instance="'+i+'"]');o&&(r=o)}var a=window.CommandBus,s={step1:r.querySelector('[data-starmus-step="1"]'),step2:r.querySelector('[data-starmus-step="2"]'),setupContainer:r.querySelector("[data-starmus-setup-container]"),timer:r.querySelector("[data-starmus-timer]"),timerElapsed:r.querySelector(".starmus-timer-elapsed"),volumeMeter:r.querySelector("[data-starmus-volume-meter]"),durationProgress:r.querySelector("[data-starmus-duration-progress]"),recorderContainer:r.querySelector("[data-starmus-recorder-container]"),transcript:r.querySelector("[data-starmus-transcript]"),reviewControls:r.querySelector(".starmus-review-controls"),continueBtn:r.querySelector('[data-starmus-action="next"]'),setupMicBtn:r.querySelector('[data-starmus-action="setup-mic"]'),recordBtn:r.querySelector('[data-starmus-action="record"]'),pauseBtn:r.querySelector('[data-starmus-action="pause"]'),resumeBtn:r.querySelector('[data-starmus-action="resume"]'),stopBtn:r.querySelector('[data-starmus-action="stop"]'),playBtn:r.querySelector('[data-starmus-action="play"]'),resetBtn:r.querySelector('[data-starmus-action="reset"]'),submitBtn:r.querySelector('[data-starmus-action="submit"]')};Xd(s.continueBtn,"click",function(){for(var e=s.step1?s.step1.querySelectorAll("[required]"):[],n=!0,i=0;i<e.length;i++)e[i].value.trim()||e[i].checked?e[i].style.borderColor="":(n=!1,e[i].style.borderColor="red");n&&t.dispatch({type:"starmus/ui/step-continue"})}),Xd(s.setupMicBtn,"click",function(){a.dispatch("setup-mic",{},{instanceId:i})}),Xd(s.recordBtn,"click",function(){a.dispatch("start-recording",{},{instanceId:i})}),Xd(s.pauseBtn,"click",function(){a.dispatch("pause-mic",{},{instanceId:i})}),Xd(s.resumeBtn,"click",function(){a.dispatch("resume-mic",{},{instanceId:i})}),Xd(s.stopBtn,"click",function(){a.dispatch("stop-mic",{},{instanceId:i})}),Xd(s.playBtn,"click",function(){if(jd)return jd.pause(),jd=null,void(s.playBtn.innerHTML='<span class="dashicons dashicons-controls-play"></span> Play / Pause');var e=t.getState();if(e.source.blob)try{var n=URL.createObjectURL(e.source.blob);(jd=new Audio(n)).onended=function(){jd=null,s.playBtn.innerHTML='<span class="dashicons dashicons-controls-play"></span> Play / Pause'},jd.onerror=function(){alert("Playback error."),jd=null,s.playBtn.innerHTML='<span class="dashicons dashicons-controls-play"></span> Play / Pause'},jd.play(),s.playBtn.innerHTML='<span class="dashicons dashicons-controls-pause"></span> Stop'}catch(t){console.error(t)}}),Xd(s.resetBtn,"click",function(){confirm("Discard recording?")&&(jd&&(jd.pause(),jd=null),a.dispatch("reset",{},{instanceId:i}))}),Xd(s.submitBtn,"click",function(t){jd&&(jd.pause(),jd=null);var e=t.target.closest("form"),n={};if(e){var r,o=gs(new FormData(e).entries());try{for(o.s();!(r=o.n()).done;){var s=r.value;n[s[0]]=s[1]}}catch(t){o.e(t)}finally{o.f()}}a.dispatch("submit",{formFields:n},{instanceId:i})});var l=r.querySelector('input[type="file"][name="audio_file"]');return l&&Xd(l,"change",function(e){e.target.files&&e.target.files[0]&&t.dispatch({type:"starmus/file-attached",file:e.target.files[0]})}),a&&a.subscribe("starmus/offline/queue_updated",function(t){console.log("[UI] Offline Queue:",t)}),t.dispatch({type:"starmus/init",payload:{instanceId:i}}),t.subscribe(function(t){Yd(t,s)})}"undefined"!=typeof window&&(window.initUI=Zd);var Kd,qd,Jd,Qd={};function $d(){if(qd)return Kd;qd=1;var t=Pi(),e=ar(),n=pi(),i=_o(),r=TypeError,o="Reduce of empty array with no initial value",a=function(a){return function(s,l,h,u){var c=e(s),d=n(c),f=i(c);if(t(l),0===f&&h<2)throw new r(o);var p=a?f-1:0,g=a?-1:1;if(h<2)for(;;){if(p in d){u=d[p],p+=g;break}if(p+=g,a?p<0:f<=p)throw new r(o)}for(;a?p>=0:f>p;p+=g)p in d&&(u=l(u,d[p],p,c));return u}};return Kd={left:a(!1),right:a(!0)}}!function(){if(Jd)return Qd;Jd=1;var t=ea(),e=$d().left,n=_a(),i=Ci();t({target:"Array",proto:!0,forced:!hh()&&i>79&&i<83||!n("reduce")},{reduce:function(t){var n=arguments.length;return e(this,t,n,n>1?arguments[1]:void 0)}})}();var tf,ef,nf,rf,of,af,sf,lf,hf,uf,cf,df,ff,pf,gf,mf,vf,_f,yf,bf,wf,Sf={};function Cf(){return ef?tf:(ef=1,tf="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView)}function xf(){if(rf)return nf;rf=1;var t=go(),e=vo(),n=RangeError;return nf=function(i){if(void 0===i)return 0;var r=t(i),o=e(r);if(r!==o)throw new n("Wrong length or index");return o}}function kf(){if(uf)return hf;uf=1;var t=af?of:(af=1,of=Math.sign||function(t){var e=+t;return 0===e||e!=e?e:e<0?-1:1}),e=function(){if(lf)return sf;lf=1;var t=4503599627370496;return sf=function(e){return e+t-t}}(),n=Math.abs;return hf=function(i,r,o,a){var s=+i,l=n(s),h=t(s);if(l<a)return h*e(l/a/r)*a*r;var u=(1+r/2220446049250313e-31)*l,c=u-(u-l);return c>o||c!=c?h*(1/0):h*c}}function Tf(){if(pf)return ff;pf=1;var t=Array,e=Math.abs,n=Math.pow,i=Math.floor,r=Math.log,o=Math.LN2;return ff={pack:function(a,s,l){var h,u,c,d=t(l),f=8*l-s-1,p=(1<<f)-1,g=p>>1,m=23===s?n(2,-24)-n(2,-77):0,v=a<0||0===a&&1/a<0?1:0,_=0;for((a=e(a))!=a||a===1/0?(u=a!=a?1:0,h=p):(h=i(r(a)/o),a*(c=n(2,-h))<1&&(h--,c*=2),(a+=h+g>=1?m/c:m*n(2,1-g))*c>=2&&(h++,c/=2),h+g>=p?(u=0,h=p):h+g>=1?(u=(a*c-1)*n(2,s),h+=g):(u=a*n(2,g-1)*n(2,s),h=0));s>=8;)d[_++]=255&u,u/=256,s-=8;for(h=h<<s|u,f+=s;f>0;)d[_++]=255&h,h/=256,f-=8;return d[_-1]|=128*v,d},unpack:function(t,e){var i,r=t.length,o=8*r-e-1,a=(1<<o)-1,s=a>>1,l=o-7,h=r-1,u=t[h--],c=127&u;for(u>>=7;l>0;)c=256*c+t[h--],l-=8;for(i=c&(1<<-l)-1,c>>=-l,l+=e;l>0;)i=256*i+t[h--],l-=8;if(0===c)c=1-s;else{if(c===a)return i?NaN:u?-1/0:1/0;i+=n(2,e),c-=s}return(u?-1:1)*i*n(2,c-e)}}}function Af(){if(mf)return gf;mf=1;var t=ar(),e=mo(),n=_o();return gf=function(i){for(var r=t(this),o=n(r),a=arguments.length,s=e(a>1?arguments[1]:void 0,o),l=a>2?arguments[2]:void 0,h=void 0===l?o:e(l,o);h>s;)r[s++]=i;return r},gf}function Pf(){if(_f)return vf;_f=1;var t=_i(),e=yi(),n=fh();return vf=function(i,r,o){var a,s;return n&&t(a=r.constructor)&&a!==o&&e(s=a.prototype)&&s!==o.prototype&&n(i,s),i}}function Ef(){if(bf)return yf;bf=1;var t=ln(),e=di(),n=yn(),i=Cf(),r=Hr(),o=Tr(),a=ls(),s=Wd(),l=_n(),h=mh(),u=go(),c=vo(),d=xf(),f=function(){if(df)return cf;df=1;var t=kf();return cf=Math.fround||function(e){return t(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}}(),p=Tf(),g=ll(),m=fh(),v=Af(),_=is(),y=Pf(),b=$o(),w=ph(),S=Yr(),C=r.PROPER,x=r.CONFIGURABLE,k="ArrayBuffer",T="DataView",A="prototype",P="Wrong index",E=S.getterFor(k),I=S.getterFor(T),D=S.set,M=t[k],L=M,O=L&&L[A],R=t[T],F=R&&R[A],B=Object.prototype,W=t.Array,U=t.RangeError,G=e(v),N=e([].reverse),z=p.pack,H=p.unpack,V=function(t){return[255&t]},j=function(t){return[255&t,t>>8&255]},X=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Y=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Z=function(t){return z(f(t),23,4)},K=function(t){return z(t,52,8)},q=function(t,e,n){a(t[A],e,{configurable:!0,get:function(){return n(this)[e]}})},J=function(t,e,n,i){var r=I(t),o=d(n),a=!!i;if(o+e>r.byteLength)throw new U(P);var s=r.bytes,l=o+r.byteOffset,h=_(s,l,l+e);return a?h:N(h)},Q=function(t,e,n,i,r,o){var a=I(t),s=d(n),l=i(+r),h=!!o;if(s+e>a.byteLength)throw new U(P);for(var u=a.bytes,c=s+a.byteOffset,f=0;f<e;f++)u[c+f]=l[h?f:e-f-1]};if(i){var $=C&&M.name!==k;l(function(){M(1)})&&l(function(){new M(-1)})&&!l(function(){return new M,new M(1.5),new M(NaN),1!==M.length||$&&!x})?$&&x&&o(M,"name",k):((L=function(t){return h(this,O),y(new M(d(t)),this,L)})[A]=O,O.constructor=L,b(L,M)),m&&g(F)!==B&&m(F,B);var tt=new R(new L(2)),et=e(F.setInt8);tt.setInt8(0,2147483648),tt.setInt8(1,2147483649),!tt.getInt8(0)&&tt.getInt8(1)||s(F,{setInt8:function(t,e){et(this,t,e<<24>>24)},setUint8:function(t,e){et(this,t,e<<24>>24)}},{unsafe:!0})}else O=(L=function(t){h(this,O);var e=d(t);D(this,{type:k,bytes:G(W(e),0),byteLength:e}),n||(this.byteLength=e,this.detached=!1)})[A],F=(R=function(t,e,i){h(this,F),h(t,O);var r=E(t),o=r.byteLength,a=u(e);if(a<0||a>o)throw new U("Wrong offset");if(a+(i=void 0===i?o-a:c(i))>o)throw new U("Wrong length");D(this,{type:T,buffer:t,byteLength:i,byteOffset:a,bytes:r.bytes}),n||(this.buffer=t,this.byteLength=i,this.byteOffset=a)})[A],n&&(q(L,"byteLength",E),q(R,"buffer",I),q(R,"byteLength",I),q(R,"byteOffset",I)),s(F,{getInt8:function(t){return J(this,1,t)[0]<<24>>24},getUint8:function(t){return J(this,1,t)[0]},getInt16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))},getUint32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(t){return H(J(this,4,t,arguments.length>1&&arguments[1]),23)},getFloat64:function(t){return H(J(this,8,t,arguments.length>1&&arguments[1]),52)},setInt8:function(t,e){Q(this,1,t,V,e)},setUint8:function(t,e){Q(this,1,t,V,e)},setInt16:function(t,e){Q(this,2,t,j,e,arguments.length>2&&arguments[2])},setUint16:function(t,e){Q(this,2,t,j,e,arguments.length>2&&arguments[2])},setInt32:function(t,e){Q(this,4,t,X,e,arguments.length>2&&arguments[2])},setUint32:function(t,e){Q(this,4,t,X,e,arguments.length>2&&arguments[2])},setFloat32:function(t,e){Q(this,4,t,Z,e,arguments.length>2&&arguments[2])},setFloat64:function(t,e){Q(this,8,t,K,e,arguments.length>2&&arguments[2])}});return w(L,k),w(R,T),yf={ArrayBuffer:L,DataView:R}}!function(){if(wf)return Sf;wf=1;var t=ea(),e=ln(),n=Ef(),i=gh(),r="ArrayBuffer",o=n[r];t({global:!0,constructor:!0,forced:e[r]!==o},{ArrayBuffer:o}),i(r)}();var If,Df={};!function(){if(If)return Df;If=1;var t=ea(),e=va(),n=_n(),i=Ef(),r=xr(),o=mo(),a=vo(),s=i.ArrayBuffer,l=i.DataView,h=l.prototype,u=e(s.prototype.slice),c=e(h.getUint8),d=e(h.setUint8);t({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:n(function(){return!new s(2).slice(1,void 0).byteLength})},{slice:function(t,e){if(u&&void 0===e)return u(r(this),t);for(var n=r(this).byteLength,i=o(t,n),h=o(void 0===e?n:e,n),f=new s(a(h-i)),p=new l(this),g=new l(f),m=0;i<h;)d(g,m++,c(p,i++));return f}})}();var Mf,Lf,Of,Rf,Ff,Bf,Wf,Uf,Gf,Nf,zf,Hf,Vf,jf,Xf={exports:{}},Yf={};function Zf(){if(Mf)return Yf;Mf=1;var t=fi(),e=vi(),n=So().f,i=is(),r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];return Yf.f=function(o){return r&&"Window"===t(o)?function(t){try{return n(t)}catch(t){return i(r)}}(o):n(e(o))},Yf}function Kf(){if(Ff)return Rf;Ff=1;var t=_n(),e=yi(),n=fi(),i=function(){if(Of)return Lf;Of=1;var t=_n();return Lf=t(function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})}(),r=Object.isExtensible,o=t(function(){});return Rf=o||i?function(t){return!!e(t)&&((!i||"ArrayBuffer"!==n(t))&&(!r||r(t)))}:r}function qf(){if(Uf)return Xf.exports;Uf=1;var t=ea(),e=di(),n=Xr(),i=yi(),r=sr(),o=kr().f,a=So(),s=Zf(),l=Kf(),h=lr(),u=function(){if(Wf)return Bf;Wf=1;var t=_n();return Bf=!t(function(){return Object.isExtensible(Object.preventExtensions({}))})}(),c=!1,d=h("meta"),f=0,p=function(t){o(t,d,{value:{objectID:"O"+f++,weakData:{}}})},g=Xf.exports={enable:function(){g.enable=function(){},c=!0;var n=a.f,i=e([].splice),r={};r[d]=1,n(r).length&&(a.f=function(t){for(var e=n(t),r=0,o=e.length;r<o;r++)if(e[r]===d){i(e,r,1);break}return e},t({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:s.f}))},fastKey:function(t,e){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,d)){if(!l(t))return"F";if(!e)return"E";p(t)}return t[d].objectID},getWeakData:function(t,e){if(!r(t,d)){if(!l(t))return!0;if(!e)return!1;p(t)}return t[d].weakData},onFreeze:function(t){return u&&c&&l(t)&&!r(t,d)&&p(t),t}};return n[d]=!0,Xf.exports}jf||(jf=1,Vf||(Vf=1,function(){if(Nf)return Gf;Nf=1;var t=ea(),e=ln(),n=di(),i=ta(),r=Kr(),o=qf(),a=iu(),s=mh(),l=_i(),h=gi(),u=yi(),c=_n(),d=ru(),f=ph(),p=Pf();return Gf=function(g,m,v){var _=-1!==g.indexOf("Map"),y=-1!==g.indexOf("Weak"),b=_?"set":"add",w=e[g],S=w&&w.prototype,C=w,x={},k=function(t){var e=n(S[t]);r(S,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(y&&!u(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return y&&!u(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(y&&!u(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(i(g,!l(w)||!(y||S.forEach&&!c(function(){(new w).entries().next()}))))C=v.getConstructor(m,g,_,b),o.enable();else if(i(g,!0)){var T=new C,A=T[b](y?{}:-0,1)!==T,P=c(function(){T.has(1)}),E=d(function(t){new w(t)}),I=!y&&c(function(){for(var t=new w,e=5;e--;)t[b](e,e);return!t.has(-0)});E||((C=m(function(t,e){s(t,S);var n=p(new w,t,C);return h(e)||a(e,n[b],{that:n,AS_ENTRIES:_}),n})).prototype=S,S.constructor=C),(P||I)&&(k("delete"),k("has"),_&&k("get")),(I||A)&&k(b),y&&S.clear&&delete S.clear}return x[g]=C,t({global:!0,constructor:!0,forced:C!==w},x),f(C,g),y||v.setStrong(C,g,_),C}}()("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},function(){if(Hf)return zf;Hf=1;var t=Qs(),e=ls(),n=Wd(),i=Ya(),r=mh(),o=gi(),a=iu(),s=ed(),l=nd(),h=gh(),u=yn(),c=qf().fastKey,d=Yr(),f=d.set,p=d.getterFor;return zf={getConstructor:function(s,l,h,d){var g=s(function(e,n){r(e,m),f(e,{type:l,index:t(null),first:null,last:null,size:0}),u||(e.size=0),o(n)||a(n,e[d],{that:e,AS_ENTRIES:h})}),m=g.prototype,v=p(l),_=function(t,e,n){var i,r,o=v(t),a=y(t,e);return a?a.value=n:(o.last=a={index:r=c(e,!0),key:e,value:n,previous:i=o.last,next:null,removed:!1},o.first||(o.first=a),i&&(i.next=a),u?o.size++:t.size++,"F"!==r&&(o.index[r]=a)),t},y=function(t,e){var n,i=v(t),r=c(e);if("F"!==r)return i.index[r];for(n=i.first;n;n=n.next)if(n.key===e)return n};return n(m,{clear:function(){for(var e=v(this),n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=null),n=n.next;e.first=e.last=null,e.index=t(null),u?e.size=0:this.size=0},delete:function(t){var e=this,n=v(e),i=y(e,t);if(i){var r=i.next,o=i.previous;delete n.index[i.index],i.removed=!0,o&&(o.next=r),r&&(r.previous=o),n.first===i&&(n.first=r),n.last===i&&(n.last=o),u?n.size--:e.size--}return!!i},forEach:function(t){for(var e,n=v(this),r=i(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!y(this,t)}}),n(m,h?{get:function(t){var e=y(this,t);return e&&e.value},set:function(t,e){return _(this,0===t?0:t,e)}}:{add:function(t){return _(this,t=0===t?0:t,t)}}),u&&e(m,"size",{configurable:!0,get:function(){return v(this).size}}),g},setStrong:function(t,e,n){var i=e+" Iterator",r=p(e),o=p(i);s(t,e,function(t,e){f(this,{type:i,target:t,state:r(t),kind:e,last:null})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?l("keys"===e?n.key:"values"===e?n.value:[n.key,n.value],!1):(t.target=null,l(void 0,!0))},n?"entries":"values",!n,!0),h(e)}},zf}())));var Jf,Qf,$f;$f||($f=1,ea()({target:"Math",stat:!0},{log10:function(){if(Qf)return Jf;Qf=1;var t=Math.log,e=Math.LOG10E;return Jf=Math.log10||function(n){return t(n)*e}}()}));var tp,ep={};!function(){if(tp)return ep;tp=1;var t=wn(),e=di(),n=$u(),i=xr(),r=yi(),o=mi(),a=_h(),s=ec(),l=vo(),h=Rs(),u=Ei(),c=ic(),d=Du(),f=_n(),p=d.UNSUPPORTED_Y,g=Math.min,m=e([].push),v=e("".slice),_=!f(function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}),y="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length;n("split",function(e,n,d){var f="0".split(void 0,0).length?function(e,i){return void 0===e&&0===i?[]:t(n,this,e,i)}:n;return[function(n,i){var a=o(this),s=r(n)?u(n,e):void 0;return s?t(s,n,a,i):t(f,h(a),n,i)},function(t,e){var r=i(this),o=h(t);if(!y){var u=d(f,r,o,e,f!==n);if(u.done)return u.value}var _=a(r,RegExp),b=r.unicode,w=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(p?"g":"y"),S=new _(p?"^(?:"+r.source+")":r,w),C=void 0===e?4294967295:e>>>0;if(0===C)return[];if(0===o.length)return null===c(S,o)?[o]:[];for(var x=0,k=0,T=[];k<o.length;){S.lastIndex=p?0:k;var A,P=c(S,p?v(o,k):o);if(null===P||(A=g(l(S.lastIndex+(p?k:0)),o.length))===x)k=s(o,k,b);else{if(m(T,v(o,x,k)),T.length===C)return T;for(var E=1;E<=P.length-1;E++)if(m(T,P[E]),T.length===C)return T;k=x=A}}return m(T,v(o,x)),T}]},y||!_,p)}();var np,ip,rp,op,ap,sp,lp,hp,up,cp,dp,fp,pp,gp,mp,vp,_p,yp,bp,wp,Sp,Cp,xp={exports:{}};function kp(){if(ip)return np;ip=1;var t,e,n,i=Cf(),r=yn(),o=ln(),a=_i(),s=yi(),l=sr(),h=aa(),u=Ai(),c=Tr(),d=Kr(),f=ls(),p=wi(),g=ll(),m=fh(),v=hr(),_=lr(),y=Yr(),b=y.enforce,w=y.get,S=o.Int8Array,C=S&&S.prototype,x=o.Uint8ClampedArray,k=x&&x.prototype,T=S&&g(S),A=C&&g(C),P=Object.prototype,E=o.TypeError,I=v("toStringTag"),D=_("TYPED_ARRAY_TAG"),M="TypedArrayConstructor",L=i&&!!m&&"Opera"!==h(o.opera),O=!1,R={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},B=function(t){var e=g(t);if(s(e)){var n=w(e);return n&&l(n,M)?n[M]:B(e)}},W=function(t){if(!s(t))return!1;var e=h(t);return l(R,e)||l(F,e)};for(t in R)(n=(e=o[t])&&e.prototype)?b(n)[M]=e:L=!1;for(t in F)(n=(e=o[t])&&e.prototype)&&(b(n)[M]=e);if((!L||!a(T)||T===Function.prototype)&&(T=function(){throw new E("Incorrect invocation")},L))for(t in R)o[t]&&m(o[t],T);if((!L||!A||A===P)&&(A=T.prototype,L))for(t in R)o[t]&&m(o[t].prototype,A);if(L&&g(k)!==A&&m(k,A),r&&!l(A,I))for(t in O=!0,f(A,I,{configurable:!0,get:function(){return s(this)?this[D]:void 0}}),R)o[t]&&c(o[t],D,t);return np={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_TAG:O&&D,aTypedArray:function(t){if(W(t))return t;throw new E("Target is not a typed array")},aTypedArrayConstructor:function(t){if(a(t)&&(!m||p(T,t)))return t;throw new E(u(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n,i){if(r){if(n)for(var a in R){var s=o[a];if(s&&l(s.prototype,t))try{delete s.prototype[t]}catch(n){try{s.prototype[t]=e}catch(t){}}}A[t]&&!n||d(A,t,n?e:L&&C[t]||e,i)}},exportTypedArrayStaticMethod:function(t,e,n){var i,a;if(r){if(m){if(n)for(i in R)if((a=o[i])&&l(a,t))try{delete a[t]}catch(t){}if(T[t]&&!n)return;try{return d(T,t,n?e:L&&T[t]||e)}catch(t){}}for(i in R)!(a=o[i])||a[t]&&!n||d(a,t,e)}},getTypedArrayConstructor:B,isView:function(t){if(!s(t))return!1;var e=h(t);return"DataView"===e||l(R,e)||l(F,e)},isTypedArray:W,TypedArray:T,TypedArrayPrototype:A}}function Tp(){if(sp)return ap;sp=1;var t=yi(),e=Math.floor;return ap=Number.isInteger||function(n){return!t(n)&&isFinite(n)&&e(n)===n}}function Ap(){if(hp)return lp;hp=1;var t=go(),e=RangeError;return lp=function(n){var i=t(n);if(i<0)throw new e("The argument can't be less than 0");return i}}function Pp(){if(cp)return up;cp=1;var t=Ap(),e=RangeError;return up=function(n,i){var r=t(n);if(r%i)throw new e("Wrong offset");return r}}function Ep(){if(fp)return dp;fp=1;var t=Math.round;return dp=function(e){var n=t(e);return n<0?0:n>255?255:255&n}}function Ip(){if(gp)return pp;gp=1;var t=aa();return pp=function(e){var n=t(e);return"BigInt64Array"===n||"BigUint64Array"===n}}function Dp(){if(vp)return mp;vp=1;var t=ur(),e=TypeError;return mp=function(n){var i=t(n,"number");if("number"==typeof i)throw new e("Can't convert number to bigint");return BigInt(i)}}function Mp(){if(yp)return _p;yp=1;var t=Ya(),e=wn(),n=vh(),i=ar(),r=_o(),o=eu(),a=tu(),s=$h(),l=Ip(),h=kp().aTypedArrayConstructor,u=Dp();return _p=function(c){var d,f,p,g,m,v,_,y,b=n(this),w=i(c),S=arguments.length,C=S>1?arguments[1]:void 0,x=void 0!==C,k=a(w);if(k&&!s(k))for(y=(_=o(w,k)).next,w=[];!(v=e(y,_)).done;)w.push(v.value);for(x&&S>2&&(C=t(C,arguments[2])),f=r(w),p=new(h(b))(f),g=l(p),d=0;f>d;d++)m=x?C(w[d],d):w[d],p[d]=g?u(m):+m;return p},_p}function Lp(){if(wp)return bp;wp=1;var t=_o();return bp=function(e,n,i){for(var r=0,o=arguments.length>2?i:t(n),a=new e(o);o>r;)a[r]=n[r++];return a},bp}function Op(){if(Sp)return xp.exports;Sp=1;var t=ea(),e=ln(),n=wn(),i=yn(),r=function(){if(op)return rp;op=1;var t=ln(),e=_n(),n=ru(),i=kp().NATIVE_ARRAY_BUFFER_VIEWS,r=t.ArrayBuffer,o=t.Int8Array;return rp=!i||!e(function(){o(1)})||!e(function(){new o(-1)})||!n(function(t){new o,new o(null),new o(1.5),new o(t)},!0)||e(function(){return 1!==new o(new r(2),1,void 0).length})}(),o=kp(),a=Ef(),s=mh(),l=ci(),h=Tr(),u=Tp(),c=vo(),d=xf(),f=Pp(),p=Ep(),g=cr(),m=sr(),v=aa(),_=yi(),y=Ti(),b=Qs(),w=wi(),S=fh(),C=So().f,x=Mp(),k=Za().forEach,T=gh(),A=ls(),P=kr(),E=pr(),I=Lp(),D=Yr(),M=Pf(),L=D.get,O=D.set,R=D.enforce,F=P.f,B=E.f,W=e.RangeError,U=a.ArrayBuffer,G=U.prototype,N=a.DataView,z=o.NATIVE_ARRAY_BUFFER_VIEWS,H=o.TYPED_ARRAY_TAG,V=o.TypedArray,j=o.TypedArrayPrototype,X=o.isTypedArray,Y="BYTES_PER_ELEMENT",Z="Wrong length",K=function(t,e){A(t,e,{configurable:!0,get:function(){return L(this)[e]}})},q=function(t){var e;return w(G,t)||"ArrayBuffer"===(e=v(t))||"SharedArrayBuffer"===e},J=function(t,e){return X(t)&&!y(e)&&e in t&&u(+e)&&e>=0},Q=function(t,e){return e=g(e),J(t,e)?l(2,t[e]):B(t,e)},$=function(t,e,n){return e=g(e),!(J(t,e)&&_(n)&&m(n,"value"))||m(n,"get")||m(n,"set")||n.configurable||m(n,"writable")&&!n.writable||m(n,"enumerable")&&!n.enumerable?F(t,e,n):(t[e]=n.value,t)};return i?(z||(E.f=Q,P.f=$,K(j,"buffer"),K(j,"byteOffset"),K(j,"byteLength"),K(j,"length")),t({target:"Object",stat:!0,forced:!z},{getOwnPropertyDescriptor:Q,defineProperty:$}),xp.exports=function(i,o,a){var l=i.match(/\d+/)[0]/8,u=i+(a?"Clamped":"")+"Array",g="get"+i,m="set"+i,v=e[u],y=v,w=y&&y.prototype,A={},P=function(t,e){F(t,e,{get:function(){return function(t,e){var n=L(t);return n.view[g](e*l+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,n){var i=L(t);i.view[m](e*l+i.byteOffset,a?p(n):n,!0)}(this,e,t)},enumerable:!0})};z?r&&(y=o(function(t,e,i,r){return s(t,w),M(_(e)?q(e)?void 0!==r?new v(e,f(i,l),r):void 0!==i?new v(e,f(i,l)):new v(e):X(e)?I(y,e):n(x,y,e):new v(d(e)),t,y)}),S&&S(y,V),k(C(v),function(t){t in y||h(y,t,v[t])}),y.prototype=w):(y=o(function(t,e,i,r){s(t,w);var o,a,h,u=0,p=0;if(_(e)){if(!q(e))return X(e)?I(y,e):n(x,y,e);o=e,p=f(i,l);var g=e.byteLength;if(void 0===r){if(g%l)throw new W(Z);if((a=g-p)<0)throw new W(Z)}else if((a=c(r)*l)+p>g)throw new W(Z);h=a/l}else h=d(e),o=new U(a=h*l);for(O(t,{buffer:o,byteOffset:p,byteLength:a,length:h,view:new N(o)});u<h;)P(t,u++)}),S&&S(y,V),w=y.prototype=b(j)),w.constructor!==y&&h(w,"constructor",y),R(w).TypedArrayConstructor=y,H&&h(w,H,u);var E=y!==v;A[u]=y,t({global:!0,constructor:!0,forced:E,sham:!z},A),Y in y||h(y,Y,l),Y in w||h(w,Y,l),T(u)}):xp.exports=function(){},xp.exports}Cp||(Cp=1,Op()("Uint8",function(t){return function(e,n,i){return t(this,e,n,i)}}));var Rp,Fp,Bp,Wp={};!function(){if(Bp)return Wp;Bp=1;var t=di(),e=kp(),n=function(){if(Fp)return Rp;Fp=1;var t=ar(),e=mo(),n=_o(),i=ka(),r=Math.min;return Rp=[].copyWithin||function(o,a){var s=t(this),l=n(s),h=e(o,l),u=e(a,l),c=arguments.length>2?arguments[2]:void 0,d=r((void 0===c?l:e(c,l))-u,l-h),f=1;for(u<h&&h<u+d&&(f=-1,u+=d-1,h+=d-1);d-- >0;)u in s?s[h]=s[u]:i(s,h),h+=f,u+=f;return s},Rp}(),i=t(n),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("copyWithin",function(t,e){return i(r(this),t,e,arguments.length>2?arguments[2]:void 0)})}();var Up,Gp={};!function(){if(Up)return Gp;Up=1;var t=kp(),e=Za().every,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("every",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Np,zp={};!function(){if(Np)return zp;Np=1;var t=kp(),e=Af(),n=Dp(),i=aa(),r=wn(),o=di(),a=_n(),s=t.aTypedArray,l=t.exportTypedArrayMethod,h=o("".slice);l("fill",function(t){var o=arguments.length;s(this);var a="Big"===h(i(this),0,3)?n(t):+t;return r(e,this,a,o>1?arguments[1]:void 0,o>2?arguments[2]:void 0)},a(function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t}))}();var Hp,Vp,jp,Xp={};!function(){if(jp)return Xp;jp=1;var t=kp(),e=Za().filter,n=function(){if(Vp)return Hp;Vp=1;var t=Lp(),e=kp().getTypedArrayConstructor;return Hp=function(n,i){return t(e(n),i)}}(),i=t.aTypedArray;(0,t.exportTypedArrayMethod)("filter",function(t){var r=e(i(this),t,arguments.length>1?arguments[1]:void 0);return n(this,r)})}();var Yp,Zp={};!function(){if(Yp)return Zp;Yp=1;var t=kp(),e=Za().find,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("find",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Kp,qp={};!function(){if(Kp)return qp;Kp=1;var t=kp(),e=Za().findIndex,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("findIndex",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Jp,Qp={};!function(){if(Jp)return Qp;Jp=1;var t=kp(),e=Za().forEach,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("forEach",function(t){e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var $p,tg={};!function(){if($p)return tg;$p=1;var t=kp(),e=yo().includes,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("includes",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var eg,ng={};!function(){if(eg)return ng;eg=1;var t=kp(),e=yo().indexOf,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("indexOf",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var ig,rg={};!function(){if(ig)return rg;ig=1;var t=ln(),e=_n(),n=di(),i=kp(),r=id(),o=hr()("iterator"),a=t.Uint8Array,s=n(r.values),l=n(r.keys),h=n(r.entries),u=i.aTypedArray,c=i.exportTypedArrayMethod,d=a&&a.prototype,f=!e(function(){d[o].call([1])}),p=!!d&&d.values&&d[o]===d.values&&"values"===d.values.name,g=function(){return s(u(this))};c("entries",function(){return h(u(this))},f),c("keys",function(){return l(u(this))},f),c("values",g,f||!p,{name:"values"}),c(o,g,f||!p,{name:"values"})}();var og,ag={};!function(){if(og)return ag;og=1;var t=kp(),e=di(),n=t.aTypedArray,i=t.exportTypedArrayMethod,r=e([].join);i("join",function(t){return r(n(this),t)})}();var sg,lg,hg,ug={};!function(){if(hg)return ug;hg=1;var t=kp(),e=yh(),n=function(){if(lg)return sg;lg=1;var t=yh(),e=vi(),n=go(),i=_o(),r=_a(),o=Math.min,a=[].lastIndexOf,s=!!a&&1/[1].lastIndexOf(1,-0)<0,l=r("lastIndexOf");return sg=s||!l?function(r){if(s)return t(a,this,arguments)||0;var l=e(this),h=i(l);if(0===h)return-1;var u=h-1;for(arguments.length>1&&(u=o(u,n(arguments[1]))),u<0&&(u=h+u);u>=0;u--)if(u in l&&l[u]===r)return u||0;return-1}:a,sg}(),i=t.aTypedArray;(0,t.exportTypedArrayMethod)("lastIndexOf",function(t){var r=arguments.length;return e(n,i(this),r>1?[t,arguments[1]]:[t])})}();var cg,dg={};!function(){if(cg)return dg;cg=1;var t=kp(),e=Za().map,n=t.aTypedArray,i=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("map",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0,function(t,e){return new(i(t))(e)})})}();var fg,pg={};!function(){if(fg)return pg;fg=1;var t=kp(),e=$d().left,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduce",function(t){var i=arguments.length;return e(n(this),t,i,i>1?arguments[1]:void 0)})}();var gg,mg={};!function(){if(gg)return mg;gg=1;var t=kp(),e=$d().right,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduceRight",function(t){var i=arguments.length;return e(n(this),t,i,i>1?arguments[1]:void 0)})}();var vg,_g={};!function(){if(vg)return _g;vg=1;var t=kp(),e=t.aTypedArray,n=t.exportTypedArrayMethod,i=Math.floor;n("reverse",function(){for(var t,n=this,r=e(n).length,o=i(r/2),a=0;a<o;)t=n[a],n[a++]=n[--r],n[r]=t;return n})}();var yg,bg={};!function(){if(yg)return bg;yg=1;var t=ln(),e=wn(),n=kp(),i=_o(),r=Pp(),o=ar(),a=_n(),s=t.RangeError,l=t.Int8Array,h=l&&l.prototype,u=h&&h.set,c=n.aTypedArray,d=n.exportTypedArrayMethod,f=!a(function(){var t=new Uint8ClampedArray(2);return e(u,t,{length:1,0:3},1),3!==t[1]}),p=f&&n.NATIVE_ARRAY_BUFFER_VIEWS&&a(function(){var t=new l(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]});d("set",function(t){c(this);var n=r(arguments.length>1?arguments[1]:void 0,1),a=o(t);if(f)return e(u,this,a,n);var l=this.length,h=i(a),d=0;if(h+n>l)throw new s("Wrong length");for(;d<h;)this[n+d]=a[d++]},!f||p)}();var wg,Sg={};!function(){if(wg)return Sg;wg=1;var t=kp(),e=_n(),n=is(),i=t.aTypedArray,r=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("slice",function(t,e){for(var o=n(i(this),t,e),a=r(this),s=0,l=o.length,h=new a(l);l>s;)h[s]=o[s++];return h},e(function(){new Int8Array(1).slice()}))}();var Cg,xg={};!function(){if(Cg)return xg;Cg=1;var t=kp(),e=Za().some,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("some",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var kg,Tg,Ag,Pg,Eg,Ig,Dg,Mg={};function Lg(){if(Tg)return kg;Tg=1;var t=Si().match(/firefox\/(\d+)/i);return kg=!!t&&+t[1]}function Og(){if(Pg)return Ag;Pg=1;var t=Si();return Ag=/MSIE|Trident/.test(t)}function Rg(){if(Ig)return Eg;Ig=1;var t=Si().match(/AppleWebKit\/(\d+)\./);return Eg=!!t&&+t[1]}!function(){if(Dg)return Mg;Dg=1;var t=ln(),e=va(),n=_n(),i=Pi(),r=Ud(),o=kp(),a=Lg(),s=Og(),l=Ci(),h=Rg(),u=o.aTypedArray,c=o.exportTypedArrayMethod,d=t.Uint16Array,f=d&&e(d.prototype.sort),p=!(!f||n(function(){f(new d(2),null)})&&n(function(){f(new d(2),{})})),g=!!f&&!n(function(){if(l)return l<74;if(a)return a<67;if(s)return!0;if(h)return h<602;var t,e,n=new d(516),i=Array(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,i[t]=t-2*e+3;for(f(n,function(t,e){return(t/4|0)-(e/4|0)}),t=0;t<516;t++)if(n[t]!==i[t])return!0});c("sort",function(t){return void 0!==t&&i(t),g?f(this,t):r(u(this),function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t))},!g||p)}();var Fg,Bg={};!function(){if(Fg)return Bg;Fg=1;var t=kp(),e=vo(),n=mo(),i=t.aTypedArray,r=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("subarray",function(t,o){var a=i(this),s=a.length,l=n(t,s);return new(r(a))(a.buffer,a.byteOffset+l*a.BYTES_PER_ELEMENT,e((void 0===o?s:n(o,s))-l))})}();var Wg,Ug={};!function(){if(Wg)return Ug;Wg=1;var t=ln(),e=yh(),n=kp(),i=_n(),r=is(),o=t.Int8Array,a=n.aTypedArray,s=n.exportTypedArrayMethod,l=[].toLocaleString,h=!!o&&i(function(){l.call(new o(1))});s("toLocaleString",function(){return e(l,h?r(a(this)):a(this),r(arguments))},i(function(){return[1,2].toLocaleString()!==new o([1,2]).toLocaleString()})||!i(function(){o.prototype.toLocaleString.call([1,2])}))}();var Gg,Ng={};!function(){if(Gg)return Ng;Gg=1;var t=kp().exportTypedArrayMethod,e=_n(),n=ln(),i=di(),r=n.Uint8Array,o=r&&r.prototype||{},a=[].toString,s=i([].join);e(function(){a.call({})})&&(a=function(){return s(this)});var l=o.toString!==a;t("toString",a,l)}();var zg=function(){return ps(function t(){fs(this,t),this.audioContext=null,this.analyser=null,this.source=null,this.calibrationData=null,this.tier="C",this.environmentData=null},[{key:"init",value:(n=ds(ys().m(function t(){var e;return ys().w(function(t){for(;;)if(0===t.n)return this.environmentData=rc.getEnvironmentData(),this.tier=(null===(e=this.environmentData)||void 0===e?void 0:e.tier)||"C",console.log("[Enhanced Calibration] Initialized for tier:",this.tier),t.a(2,this)},t,this)})),function(){return n.apply(this,arguments)})},{key:"getTierSettings",value:function(){var t={A:{duration:15e3,phases:3,noiseThreshold:5,speechThreshold:20,sampleRate:44100,fftSize:2048,smoothing:.8,gainRange:[.5,2],autoGainControl:!0},B:{duration:1e4,phases:2,noiseThreshold:8,speechThreshold:15,sampleRate:22050,fftSize:1024,smoothing:.6,gainRange:[.7,1.5],autoGainControl:!0},C:{duration:5e3,phases:1,noiseThreshold:12,speechThreshold:10,sampleRate:16e3,fftSize:512,smoothing:.4,gainRange:[.8,1.2],autoGainControl:!1}};return t[this.tier]||t.C}},{key:"performCalibration",value:(e=ds(ys().m(function t(e,n){var i,r,o,a,s,l;return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:i=this.getTierSettings(),r=0,t.p=1;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:i.sampleRate,latencyHint:"interactive"})}catch(t){console.warn("[Calibration] Preferred sampleRate ".concat(i.sampleRate,"Hz failed. Falling back to hardware default.")),this.audioContext=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),rc.isAvailable&&rc.reportError("calibration_samplerate_fallback",{tier:this.tier,requestedSampleRate:i.sampleRate,error:t.message,network:null===(o=this.environmentData)||void 0===o||null===(o=o.network)||void 0===o?void 0:o.type,device:null===(a=this.environmentData)||void 0===a||null===(a=a.device)||void 0===a?void 0:a.type})}if("suspended"!==this.audioContext.state){t.n=2;break}return t.n=2,this.audioContext.resume();case 2:return r=this.audioContext.sampleRate,console.log("[Calibration] Context active at ".concat(r,"Hz")),this.source=this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=i.fftSize,this.analyser.smoothingTimeConstant=i.smoothing,this.source.connect(this.analyser),t.n=3,this.runTierBasedCalibration(i,n);case 3:return s=t.v,rc.isAvailable&&rc.reportError("calibration_completed",{tier:this.tier,actualSampleRate:r,duration:i.duration,result:s}),t.a(2,s);case 4:throw t.p=4,l=t.v,console.error("[Enhanced Calibration] Fatal Error:",l),rc.isAvailable&&rc.reportError("calibration_failed",{error:l.message,tier:this.tier}),l;case 5:return t.p=5,this.cleanup(),t.f(5);case 6:return t.a(2)}},t,this,[[1,4,5,6]])})),function(t,n){return e.apply(this,arguments)})},{key:"runTierBasedCalibration",value:(t=ds(ys().m(function t(e,n){var i,r,o,a,s,l,h,u,c=this;return ys().w(function(t){for(;;)if(0===t.n)return i=new Uint8Array(this.analyser.frequencyBinCount),r=Date.now(),o=0,a=0,s=0,l=[],h=e.duration/e.phases,u=0,t.a(2,new Promise(function(t){var d=function(){var f=Date.now()-r,p=f%h,g=Math.floor(f/h);g!==u&&(u=g,console.log("[Enhanced Calibration] Phase",u+1,"of",e.phases)),c.analyser.getByteFrequencyData(i);for(var m=0,v=0;v<i.length;v++)m+=i[v];var _=m/i.length/255,y=20*Math.log10(Math.max(_,1e-6))- -50+94,b=Math.min(100,Math.max(0,1.67*(y-30)));a++,b>o&&(o=b);var w="",S=f/e.duration*100;switch(u){case 0:b<e.noiseThreshold&&(s=Math.max(s,b)),w="C"===c.tier?"Quick setup...":"Phase 1: Measuring background noise (".concat(Math.ceil((h-p)/1e3),"s)");break;case 1:b>e.speechThreshold&&l.push(b),w="Phase 2: Speak your name clearly...";break;case 2:w="Phase 3: Optimizing settings...";break;default:w="Calibration complete"}if(n&&n(w,Math.min(b,100),!1,{phase:u+1,totalPhases:e.phases,progress:Math.min(S,100),tier:c.tier}),f>=e.duration){var C=l.length>0?l.reduce(function(t,e){return t+e},0)/l.length:o,x=o-s,k=C/Math.max(s,1),T=c.calculateOptimalGain(C,s,x,e),A={complete:!0,tier:c.tier,gain:T,speechLevel:C,noiseFloor:s,dynamicRange:x,signalToNoise:k,sampleCount:a,duration:f,phases:e.phases,quality:c.assessCalibrationQuality(x,k,e),recommendations:c.generateRecommendations(x,k,e)};return n&&n("Calibration Complete!",0,!0,A),void t(A)}requestAnimationFrame(d)};d()}))},t,this)})),function(e,n){return t.apply(this,arguments)})},{key:"calculateOptimalGain",value:function(t,e,n,i){var r,o=60/Math.max(t,1),a=ws(i.gainRange,2),s=a[0],l=a[1],h=Math.max(s,Math.min(l,o));return e>15?h*=.9:e<5&&(h*=1.1),"very_low"===(null===(r=this.environmentData)||void 0===r||null===(r=r.network)||void 0===r?void 0:r.type)&&(h*=.8),Math.round(100*h)/100}},{key:"assessCalibrationQuality",value:function(t,e,n){var i=0;t>40?i+=3:t>20?i+=2:t>10&&(i+=1),e>5?i+=3:e>3?i+=2:e>2&&(i+=1);var r=i/("A"===this.tier?6:"B"===this.tier?5:4)*100;return r>=80?"excellent":r>=60?"good":r>=40?"fair":"poor"}},{key:"generateRecommendations",value:function(t,e,n){var i,r=[];return t<15&&r.push("Consider moving to a quieter location"),e<2&&r.push("Speak closer to the microphone"),"C"===this.tier&&"very_low"===(null===(i=this.environmentData)||void 0===i||null===(i=i.network)||void 0===i?void 0:i.type)&&r.push("Recording optimized for your network conditions"),n.autoGainControl&&t>50&&r.push("Automatic gain control will help maintain consistent levels"),r}},{key:"cleanup",value:function(){try{this.source&&(this.source.disconnect(),this.source=null),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null)}catch(t){console.warn("[Enhanced Calibration] Cleanup error:",t)}}}]);var t,e,n}(),Hg=new Map,Vg=null,jg=window.SpeechRecognition||window.webkitSpeechRecognition,Xg=function(){return ps(function t(e){var n=e.tier,i=e.country,r=e.maxDuration,o=void 0===r?2e4:r;fs(this,t),this.tier=n,this.country=i,this.maxDuration=o,this.probeLanguages=this.getProbeLanguages(),this.results={signal_analysis:{country:i,probe_language:this.probeLanguages[0]||null},violation_flags:{},timing_hints:[]},this._abort=!1},[{key:"getProbeLanguages",value:function(){if("C"===this.tier)return[];switch(this.country){case"GM":default:return["en-US"];case"SN":case"GN":case"ML":return["fr-FR"]}}},{key:"analyze",value:(t=ds(ys().m(function t(e){var n;return ys().w(function(t){for(;;)switch(t.n){case 0:if("C"!==this.tier){t.n=1;break}return t.a(2,this.audioOnlySignals(e));case 1:if(n=e.clone(),!(this.probeLanguages.length>0)){t.n=2;break}return t.n=2,this.runViolationProbe(n,this.probeLanguages[0]);case 2:return this.calculateViolationFlags(),t.a(2,this.results)}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"runViolationProbe",value:function(t,e){var n=this;return new Promise(function(t){if(!jg)return t();var i=new jg;i.lang=e,i.continuous=!1,i.interimResults=!1,i.maxAlternatives=1;var r=0,o=0,a=null;i.onresult=function(t){var i,s=gs(t.results);try{for(s.s();!(i=s.n()).done;){var l,h=i.value;if(h.isFinal){var u=h[0].transcript.trim(),c=null!==(l=h[0].confidence)&&void 0!==l?l:0,d=u?u.split(/\s+/).length:0,f=t.timeStamp/1e3;r+=d,o+=c*d,null!==a&&n.results.timing_hints.push({start:a,end:f,type:"speech",lang:e,violation_confidence:c}),a=f}}}catch(t){s.e(t)}finally{s.f()}},i.onend=function(){var i=e.split("-")[0];n.results.signal_analysis["".concat(i,"_word_count")]=r,n.results.signal_analysis["".concat(i,"_violation_confidence")]=r?o/r:0,t()},i.start(),setTimeout(function(){try{i.stop()}catch(t){}},n.maxDuration)})}},{key:"calculateViolationFlags",value:function(){var t=this.results.signal_analysis;if("GM"===this.country){var e=t.en_word_count||0,n=t.en_violation_confidence||0;if(e<3)return void(this.results.violation_flags={mostly_english:!1,detection_quality:"insufficient"});var i=e+5;this.results.violation_flags={mostly_english:e>8&&n>.6&&e>=.6*i,violation_reason:e>8?"Recording appears mostly English for this location":null,estimated_local_content:Math.max(0,1-e/i),detection_quality:e>=8?"sufficient":"insufficient"}}else if("SN"===this.country){var r=t.fr_word_count||0,o=t.fr_violation_confidence||0;if(r<3)return void(this.results.violation_flags={mostly_french:!1,detection_quality:"insufficient"});var a=r+5;this.results.violation_flags={mostly_french:r>8&&o>.6&&r>=.6*a,violation_reason:r>8?"Recording appears mostly French for this location":null,estimated_local_content:Math.max(0,1-r/a),detection_quality:r>=8?"sufficient":"insufficient"}}}},{key:"audioOnlySignals",value:function(t){var e=this;return new Promise(function(n){var i=new AudioContext,r=i.createMediaStreamSource(t),o=i.createAnalyser();o.fftSize=1024,r.connect(o);var a=new Uint8Array(o.frequencyBinCount),s=[],l="silence",h=performance.now(),u=setInterval(function(){if(!e._abort){o.getByteTimeDomainData(a);var t=Math.sqrt(a.reduce(function(t,e){return t+Math.pow(e-128,2)},0)/a.length)>10?"speech":"silence";t!==l&&(s.push({time:(performance.now()-h)/1e3,transition:"".concat(l,"_to_").concat(t)}),l=t)}},100);setTimeout(function(){clearInterval(u),r.disconnect(),n({signal_analysis:{audio_only:!0,country:e.country},timing_hints:s,violation_flags:{estimated_local_content:1,detection_quality:"audio_only"}})},e.maxDuration)})}},{key:"stop",value:function(){this._abort=!0}}]);var t}();function Yg(){var t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("Audio API not supported");return Vg&&"closed"!==Vg.state||(Vg=new t({latencyHint:"interactive"}),window.StarmusAudioContext=Vg),Vg}function Zg(){return Kg.apply(this,arguments)}function Kg(){return(Kg=ds(ys().m(function t(){var e,n;return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=Yg(),console.debug("[AUDIOCTX]",e.state),"suspended"!==e.state){t.n=4;break}return t.p=1,t.n=2,e.resume();case 2:console.debug("[AUDIOCTX]",e.state),t.n=4;break;case 3:t.p=3,n=t.v,console.warn("[Audio] Resume failed:",n.message);case 4:return t.a(2,e)}},t,null,[[1,3]])}))).apply(this,arguments)}function qg(t,e){console.log("[Recorder]  Listening for commands for ID:",e),Qa.subscribe("setup-mic",function(){var n=ds(ys().m(function n(i,r){var o,a,s,l;return ys().w(function(n){for(;;)switch(n.p=n.n){case 0:if((null==r?void 0:r.instanceId)===e){n.n=1;break}return n.a(2);case 1:return n.p=1,n.n=2,navigator.mediaDevices.getUserMedia({audio:!0});case 2:return o=n.v,n.n=3,Zg();case 3:return t.dispatch({type:"starmus/calibration-start"}),a=new zg,n.n=4,a.init();case 4:return n.n=5,a.performCalibration(o,function(e,n,i,r){i||t.dispatch({type:"starmus/calibration-update",message:e,volumePercent:n,extra:r||{}})});case 5:s=n.v,o.getTracks().forEach(function(t){return t.stop()}),t.dispatch({type:"starmus/calibration-complete",payload:{calibration:s}}),n.n=7;break;case 6:n.p=6,l=n.v,console.error("[Recorder] Calibration failed:",l),rc.isAvailable&&rc.reportError("calibration_setup_failed",{error:l.message,instanceId:e,userAgent:navigator.userAgent}),t.dispatch({type:"starmus/error",payload:{message:"Microphone access denied."}});case 7:return n.a(2)}},n,null,[[1,6]])}));return function(t,e){return n.apply(this,arguments)}}()),Qa.subscribe("start-recording",function(){var n=ds(ys().m(function n(i,r){var o,a,s,l,h,u,c,d,f,p,g,m,v,_,y,b,w,S,C,x,k,T,A,P,E,I;return ys().w(function(n){for(;;)switch(n.p=n.n){case 0:if((null==r?void 0:r.instanceId)===e){n.n=1;break}return n.a(2);case 1:return n.p=1,l=function(){var n=Hg.get(e);if(n&&"recording"===b.state){A.getByteFrequencyData(P);for(var i=0,r=0;r<P.length;r++)i+=P[r];var o=i/P.length/255,a=20*Math.log10(Math.max(o,1e-6))- -50+94,s=Math.min(100,Math.max(0,1.67*(a-30)));t.dispatch({type:"starmus/recorder-tick",duration:(Date.now()-E)/1e3,amplitude:s}),n.rafId=requestAnimationFrame(l)}},h=rc.getEnvironmentData(),u=h.recordingSettings||{},c={audio:{sampleRate:u.sampleRate||16e3,channelCount:u.channels||1,echoCancellation:!1!==u.enableEchoCancellation,noiseSuppression:!1!==u.enableNoiseSupression,autoGainControl:!1!==u.enableAutoGainControl}},console.log("[Recorder] Using optimized constraints for tier",h.tier,c),n.n=2,navigator.mediaDevices.getUserMedia(c);case 2:return d=n.v,n.n=3,Zg();case 3:f=n.v,p=f.createMediaStreamSource(d),g=f.createGain(),m=f.createMediaStreamDestination(),v=t.getState(),_=(null===(o=v.calibration)||void 0===o?void 0:o.gain)||1,g.gain.setValueAtTime(_,f.currentTime),p.connect(g),g.connect(m),y={mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:u.bitrate||32e3},b=new MediaRecorder(m.stream,y),console.debug("[RECORDER]",b.state,"with options:",y),w=[],S=null,C=(null===(a=t.getState())||void 0===a||null===(a=a.env)||void 0===a?void 0:a.tier)||"B",x=(null===(s=t.getState())||void 0===s||null===(s=s.env)||void 0===s?void 0:s.country)||"GM","C"!==C&&(S=new Xg({tier:C,country:x,maxDuration:2e4})).analyze(d).then(function(e){t.dispatch({type:"starmus/signal-analysis-complete",payload:e})}).catch(function(t){console.warn("[Recorder] Signal analysis failed:",t.message)}),k=u.chunkSize||1e3,b.ondataavailable=function(t){t.data.size>0&&w.push(t.data)},b.onstop=function(){var n=Hg.get(e);null!=n&&n.rafId&&cancelAnimationFrame(n.rafId),S&&S.stop();var i=new Blob(w,{type:"audio/webm"});rc.isAvailable&&rc.reportError("recording_completed",{duration:(Date.now()-T)/1e3,fileSize:i.size,tier:h.tier,settings:u}),t.dispatch({type:"starmus/recording-available",payload:{blob:i,fileName:"rec-".concat(Date.now(),".webm")}}),d.getTracks().forEach(function(t){return t.stop()});try{p.disconnect()}catch(t){console.debug("[ANALYZER]","disconnect failed")}Hg.delete(e)},Hg.set(e,{mediaRecorder:b,rafId:null,signalAnalyzer:S}),T=Date.now(),b.start(k),console.debug("[RECORDER]",b.state),t.dispatch({type:"starmus/mic-start"}),A=f.createAnalyser(),console.debug("[ANALYZER]",A?"attached":"missing"),p.connect(A),P=new Uint8Array(A.frequencyBinCount),E=Date.now(),l(),n.n=5;break;case 4:n.p=4,I=n.v,console.error("[Recorder] Recording failed:",I),rc.isAvailable&&rc.reportError("recording_failed",{error:I.message,instanceId:e,userAgent:navigator.userAgent}),t.dispatch({type:"starmus/error",payload:{message:"Recording failed."}});case 5:return n.a(2)}},n,null,[[1,4]])}));return function(t,e){return n.apply(this,arguments)}}()),Qa.subscribe("stop-mic",function(n,i){var r,o;if((null==i?void 0:i.instanceId)===e){var a=Hg.get(e);"recording"!==(null==a||null===(r=a.mediaRecorder)||void 0===r?void 0:r.state)&&"paused"!==(null==a||null===(o=a.mediaRecorder)||void 0===o?void 0:o.state)||(a.mediaRecorder.stop(),a.signalAnalyzer&&a.signalAnalyzer.stop(),t.dispatch({type:"starmus/mic-stop"}))}}),Qa.subscribe("pause-mic",function(n,i){var r;if((null==i?void 0:i.instanceId)===e){var o=Hg.get(e);"recording"===(null==o||null===(r=o.mediaRecorder)||void 0===r?void 0:r.state)&&(o.mediaRecorder.pause(),o.signalAnalyzer&&o.signalAnalyzer.stop(),t.dispatch({type:"starmus/mic-pause"}))}}),Qa.subscribe("resume-mic",function(n,i){var r;if((null==i?void 0:i.instanceId)===e){var o=Hg.get(e);"paused"===(null==o||null===(r=o.mediaRecorder)||void 0===r?void 0:r.state)&&(o.mediaRecorder.resume(),t.dispatch({type:"starmus/mic-resume"}))}})}function Jg(t,e,n){var i=t.querySelector('input[name="'.concat(e,'"]'));i||((i=document.createElement("input")).type="hidden",i.name=e,t.appendChild(i));var r="object"===Cs(n)?JSON.stringify(n):n||"";(!i.value||""===i.value.trim()||""!==r&&"{}"!==r&&"[]"!==r)&&i.value!==r&&(i.value=r)}function Qg(t,e,n){if(t&&e)return i(),t.subscribe(i);function i(){var n=t.getState(),i=n.env||{},r=n.calibration||{},o=n.source||{},a=r.complete?{gain:r.gain,speechLevel:r.speechLevel,message:r.message}:{};Jg(e,"_starmus_calibration",a),Jg(e,"_starmus_env",i),o.metadata&&Jg(e,"recording_metadata",o.metadata),o.waveform&&Jg(e,"waveform_json",o.waveform)}console.warn("[StarmusMetadata] Store or Form missing.")}var $g,tm,em,nm={};!function(){if(em)return nm;em=1;var t=ea(),e=function(){if(tm)return $g;tm=1;var t=ln(),e=_n(),n=di(),i=Rs(),r=Bs().trim,o=Fs(),a=n("".charAt),s=t.parseFloat,l=t.Symbol,h=l&&l.iterator,u=1/s(o+"-0")!=-1/0||h&&!e(function(){s(Object(h))});return $g=u?function(t){var e=r(i(t)),n=s(e);return 0===n&&"-"===a(e,0)?-0:n}:s}();t({global:!0,forced:parseFloat!==e},{parseFloat:e})}();var im=window.CommandBus||window.StarmusHooks,rm=im&&im.debugLog?im.debugLog:function(){},om=function(){return ps(function t(e,n,i){fs(this,t),this.peaks=e,this.container=document.getElementById(n),this.data=Array.isArray(i)?i:[],this.activeTokenIndex=-1,this.isUserScrolling=!1,this.scrollTimeout=null,this.boundOnTimeUpdate=null,this.boundOnSeeked=null,this.boundOnClick=null,this.boundOnScroll=null,this.init()},[{key:"init",value:function(){this.container?(this.render(),this.bindEvents()):console.warn("[StarmusTranscript] Container not found. Transcript sync disabled.")}},{key:"render",value:function(){var t=this,e=document.createDocumentFragment();this.data.forEach(function(n,i){var r=document.createElement("span");r.textContent=n.text,r.className="starmus-word",r.dataset.index=i,r.dataset.start=n.start,r.dataset.end=n.end,"confidence"in n&&n.confidence<.8&&(r.dataset.confidence="low",r.title="Low confidence: ".concat(Math.round(100*n.confidence),"%")),e.appendChild(r),i<t.data.length-1&&e.appendChild(document.createTextNode(" "))}),this.container.innerHTML="",this.container.appendChild(e),this.activeTokenIndex=-1}},{key:"bindEvents",value:function(){var t=this;this.boundOnClick=function(e){var n=e.target;if(n.classList.contains("starmus-word")){var i=parseFloat(n.dataset.start);t.peaks&&t.peaks.player&&"function"==typeof t.peaks.player.seek&&(t.peaks.player.seek(i),im&&"function"==typeof im.dispatch&&im.dispatch("starmus/transcript/seek",{time:i},{instanceId:t.peaks.instanceId}))}},this.container.addEventListener("click",this.boundOnClick),this.boundOnScroll=function(){t.isUserScrolling=!0,t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(function(){t.isUserScrolling=!1},1e3)},this.container.addEventListener("scroll",this.boundOnScroll);var e=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;e&&"function"==typeof e.addEventListener?(this.boundOnTimeUpdate=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("seeked",this.boundOnSeeked)):rm("[StarmusTranscript] Player media element not found  sync disabled")}},{key:"findTokenIndex",value:function(t){if("number"!=typeof t||0===this.data.length)return-1;for(var e=0,n=this.data.length-1;e<=n;){var i=e+n>>1,r=this.data[i];if(t>=r.start&&t<=r.end)return i;t<r.start?n=i-1:e=i+1}return-1}},{key:"syncHighlight",value:function(t){var e=this.findTokenIndex(t);-1===e?this.clearHighlight():e!==this.activeTokenIndex&&this.updateDOM(e)}},{key:"updateDOM",value:function(t){var e=this.container.querySelectorAll(".starmus-word");this.activeTokenIndex>=0&&e[this.activeTokenIndex]&&e[this.activeTokenIndex].classList.remove("is-active"),this.activeTokenIndex=t;var n=e[t];n&&(n.classList.add("is-active"),this.isUserScrolling||this.scrollToWord(n))}},{key:"clearHighlight",value:function(){var t=this.container.querySelector(".starmus-word.is-active");t&&t.classList.remove("is-active"),this.activeTokenIndex=-1}},{key:"scrollToWord",value:function(t){t.scrollIntoView&&t.scrollIntoView({block:"center",behavior:"smooth"})}},{key:"updateData",value:function(t){this.data=Array.isArray(t)?t:[],this.render(),this.unbindEvents(),this.bindEvents()}},{key:"unbindEvents",value:function(){if(this.container){this.boundOnClick&&this.container.removeEventListener("click",this.boundOnClick),this.boundOnScroll&&this.container.removeEventListener("scroll",this.boundOnScroll);var t=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;t&&"function"==typeof t.removeEventListener&&(this.boundOnTimeUpdate&&t.removeEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked&&t.removeEventListener("seeked",this.boundOnSeeked))}}},{key:"destroy",value:function(){this.unbindEvents(),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.container&&(this.container.innerHTML=""),this.data=[],this.activeTokenIndex=-1,this.isUserScrolling=!1}}])}();function am(t,e,n){return new om(t,e,n)}"undefined"!=typeof window&&(window.StarmusTranscript=om,window.StarmusTranscriptController={StarmusTranscript:om,init:am}),"undefined"!=typeof module&&module.exports&&(module.exports={StarmusTranscript:om,init:am});var sm,lm={StarmusTranscript:om,init:am},hm={};!function(){if(sm)return hm;sm=1;var t=ea(),e=Za().filter;t({target:"Array",proto:!0,forced:!ua()("filter")},{filter:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}();var um,cm={};!function(){if(um)return cm;um=1;var t=ea(),e=Za().find,n=$s(),i="find",r=!0;i in[]&&Array(1)[i](function(){r=!1}),t({target:"Array",proto:!0,forced:r},{find:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),n(i)}();var dm,fm={};!function(){if(dm)return fm;dm=1;var t=ea(),e=di(),n=Pi(),i=ar(),r=_o(),o=ka(),a=Rs(),s=_n(),l=Ud(),h=_a(),u=Lg(),c=Og(),d=Ci(),f=Rg(),p=[],g=e(p.sort),m=e(p.push),v=s(function(){p.sort(void 0)}),_=s(function(){p.sort(null)}),y=h("sort"),b=!s(function(){if(d)return d<70;if(!(u&&u>3)){if(c)return!0;if(f)return f<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)p.push({k:e+i,v:n})}for(p.sort(function(t,e){return e.v-t.v}),i=0;i<p.length;i++)e=p[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return"DGBEFHACIJK"!==r}});t({target:"Array",proto:!0,forced:v||!_||!y||!b},{sort:function(t){void 0!==t&&n(t);var e=i(this);if(b)return void 0===t?g(e):g(e,t);var s,h,u=[],c=r(e);for(h=0;h<c;h++)h in e&&m(u,e[h]);for(l(u,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:a(e)>a(n)?1:-1}}(t)),s=r(u),h=0;h<s;)e[h]=u[h++];for(;h<c;)o(e,h++);return e}})}();var pm,gm,mm,vm,_m,ym={};!function(){if(_m)return ym;_m=1;var t=ea(),e=function(){if(gm)return pm;gm=1;var t=di(),e=vo(),n=Rs(),i=Ac(),r=mi(),o=t(i),a=t("".slice),s=Math.ceil,l=function(t){return function(i,l,h){var u,c,d=n(r(i)),f=e(l),p=d.length,g=void 0===h?" ":n(h);return f<=p||""===g?d:((c=o(g,s((u=f-p)/g.length))).length>u&&(c=a(c,0,u)),t?d+c:c+d)}};return pm={start:l(!1),end:l(!0)}}().start;t({target:"String",proto:!0,forced:function(){if(vm)return mm;vm=1;var t=Si();return mm=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)}()},{padStart:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}(),function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e():t.StarmusAudioEditor=e()}("undefined"!=typeof window?window:globalThis,function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",n=document.getElementById("starmus-editor-notice");n&&(t?(n.textContent=t,n.className="starmus-alert starmus-alert--".concat(e),n.hidden=!1,setTimeout(function(){return n.hidden=!0},5e3)):n.hidden=!0)}function e(t){if(isNaN(t))return"0:00";var e=Math.floor(t/60),n=Math.floor(t%60);return e+":"+String(n).padStart(2,"0")}return{init:function(){return new Promise(function(n,i){var r=window.STARMUS_EDITOR_DATA;if(!r)return t("Error loading editor."),void i(new Error("STARMUS_EDITOR_DATA not defined"));var o=r.restUrl,a=r.nonce,s=r.postId,l=r.audioUrl,h=r.annotations,u=void 0===h?[]:h,c=document.getElementById("overview"),d=document.getElementById("zoomview"),f=document.getElementById("play"),p=document.getElementById("back5"),g=document.getElementById("fwd5"),m=document.getElementById("zoom-in"),v=document.getElementById("zoom-out"),_=document.getElementById("zoom-fit"),y=document.getElementById("loop"),b=document.getElementById("add-region"),w=document.getElementById("save"),S=document.getElementById("regions-list"),C=document.getElementById("starmus-time-cur"),x=document.getElementById("starmus-time-dur");if(!(l&&c&&d&&f&&b&&w&&S))return t("Error initializing editor."),void i(new Error("Missing required DOM elements"));var k=!1,T=function(t){k=!!t,w.disabled=!k};T(!1),window.addEventListener("beforeunload",function(t){k&&(t.preventDefault(),t.returnValue="")});var A=new Audio(l);A.crossOrigin="anonymous",A.addEventListener("error",function(){t("Audio failed to load. Check the file or network.","error"),i(new Error("Audio load error"))}),A.addEventListener("loadedmetadata",function(){var r=A.duration;if(!isFinite(r)||r<=0)return t("Audio error, file corrupt"),void i(new Error("Invalid audio duration"));if("undefined"==typeof Peaks)return t("Peaks.js library is missing","error"),void i(new Error("Peaks.js not loaded"));var l=function(){var t,e;return(null===(t=window.crypto)||void 0===t||null===(e=t.randomUUID)||void 0===e?void 0:e.call(t))||"id-"+Math.random().toString(36).slice(2)+Date.now()},h=function(t){var e=(t||[]).filter(function(t){return isFinite(t.startTime)&&isFinite(t.endTime)&&t.startTime>=0&&t.endTime>t.startTime&&t.endTime<=r});e.sort(function(t,e){return t.startTime-e.startTime});var n,i=[],o=-1,a=gs(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;s.startTime>=o&&(i.push({id:s.id||l(),startTime:s.startTime,endTime:s.endTime,label:(s.label||"").trim().slice(0,200)}),o=s.endTime)}}catch(t){a.e(t)}finally{a.f()}return i},P=h(u);Peaks.init({containers:{overview:c,zoomview:d},mediaElement:A,webAudio:{audioContext:new(window.AudioContext||window.webkitAudioContext),multiChannel:!1},height:180,zoomLevels:[64,128,256,512,1024,2048],segments:P,keyboard:!0,showPlayheadTime:!0,emitCueEvents:!0},function(t,u){if(t)i(t);else{x.textContent=e(r),A.addEventListener("timeupdate",function(){C.textContent=e(A.currentTime)}),f.onclick=function(){return A.paused?A.play():A.pause()},A.addEventListener("play",function(){return f.textContent="Pause"}),A.addEventListener("pause",function(){return f.textContent="Play"}),p.onclick=function(){return A.currentTime=Math.max(0,A.currentTime-5)},g.onclick=function(){return A.currentTime=Math.min(r,A.currentTime+5)},m.onclick=function(){return u.zoom.zoomIn()},v.onclick=function(){return u.zoom.zoomOut()},_.onclick=function(){return u.zoom.zoom(0)};var c=!1;y.onchange=function(){return c=y.checked},A.addEventListener("timeupdate",function(){if(c){var t=A.currentTime,e=u.segments.getSegments().find(function(e){return t>=e.startTime&&t<e.endTime});e&&t>=e.endTime&&(A.currentTime=e.startTime)}});var d=function(){var t=h(u.segments.getSegments());if(S.innerHTML="",!t.length)return S.innerHTML='<tr><td colspan="5">No annotations</td></tr>',void T(!1);t.forEach(function(t){var e,n=document.createElement("tr");n.innerHTML='<td><input data-id="'.concat(t.id,'" data-key="label" value="').concat((e=t.label,(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")),'"></td>\n               <td>').concat(t.startTime.toFixed(2),"</td>\n               <td>").concat(t.endTime.toFixed(2),'</td>\n               <td><button data-act="jump" data-id="').concat(t.id,'">Jump</button>\n                   <button data-act="del" data-id="').concat(t.id,'">Delete</button></td>'),S.appendChild(n)}),T(!0)};S.onclick=function(t){var e=t.target.dataset.act,n=t.target.dataset.id;if(e&&n){var i=u.segments.getSegment(n);i&&("jump"===e?(A.currentTime=i.startTime,A.play()):"del"===e&&(u.segments.removeById(n),d()))}},b.onclick=function(){var t=A.currentTime||0;u.segments.add({id:l(),startTime:Math.max(0,t-2),endTime:Math.min(r,t+2),label:""}),d()},w.onclick=ds(ys().m(function t(){return ys().w(function(t){for(;;)switch(t.p=t.n){case 0:if(k){t.n=1;break}return t.a(2);case 1:return T(!1),t.p=2,t.n=3,fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":a},body:JSON.stringify({postId:s,annotations:h(u.segments.getSegments())})});case 3:t.n=5;break;case 4:t.p=4,t.v,T(!0);case 5:return t.a(2)}},t,null,[[2,4]])})),d(),n(u)}})})})}}});var bm,wm={init:function(){return window.StarmusAudioEditor.init()}},Sm=function(){return ps(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};fs(this,t),this.peaks=e,this.options=_s({showNotifications:!0,logEvents:!0,autoHighlight:!0,pointsTableId:"points-list",segmentsTableId:"segments-list"},n),this.init()},[{key:"init",value:function(){var t=this;this.peaks?(this.peaks.on("points.enter",function(e){return t.handlePointEnter(e)}),this.peaks.on("segments.enter",function(e){return t.handleSegmentEnter(e)}),this.peaks.on("segments.exit",function(e){return t.handleSegmentExit(e)}),this.options.logEvents&&console.log("[StarmusCueEvents] Initialized")):console.warn("[StarmusCueEvents] No Peaks instance provided")}},{key:"handlePointEnter",value:function(t){var e=t.point;this.options.showNotifications&&this.showNotification("Point reached: ".concat(e.labelText),"info"),this.options.autoHighlight&&this.highlightTableRow(this.options.pointsTableId,e.id),this.dispatchCustomEvent("starmus:point:enter",{point:e})}},{key:"handleSegmentEnter",value:function(t){var e=t.segment;this.options.showNotifications&&this.showNotification("Entering: ".concat(e.labelText),"success"),this.options.autoHighlight&&this.highlightTableRow(this.options.segmentsTableId,e.id),this.dispatchCustomEvent("starmus:segment:enter",{segment:e})}},{key:"handleSegmentExit",value:function(t){var e=t.segment;this.options.autoHighlight&&this.removeHighlight(this.options.segmentsTableId,e.id),this.dispatchCustomEvent("starmus:segment:exit",{segment:e})}},{key:"showNotification",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"function"==typeof window.showNotice?window.showNotice(t,e):console.info("[Starmus Notification] ".concat(t))}},{key:"highlightTableRow",value:function(t,e){var n=document.getElementById(t);if(n){n.querySelectorAll("tr.starmus-active-row").forEach(function(t){t.classList.remove("starmus-active-row")});var i=n.querySelector('tr[data-id="'.concat(e,'"]'));i&&(i.classList.add("starmus-active-row"),i.scrollIntoView({behavior:"smooth",block:"nearest"}))}}},{key:"removeHighlight",value:function(t,e){var n=document.getElementById(t);if(n){var i=n.querySelector('tr[data-id="'.concat(e,'"]'));i&&i.classList.remove("starmus-active-row")}}},{key:"dispatchCustomEvent",value:function(t,e){var n=new CustomEvent(t,{detail:e,bubbles:!0});document.dispatchEvent(n)}},{key:"destroy",value:function(){this.peaks&&(this.peaks.off("points.enter"),this.peaks.off("segments.enter"),this.peaks.off("segments.exit")),this.peaks=null}}])}();window.Starmus=window.Starmus||{},window.Starmus.version="6.5.0",window.Peaks&&!window.Starmus.Peaks?window.Starmus.Peaks=window.Peaks:window.Peaks||(window.Peaks={init:function(){return null}},window.Starmus.Peaks=window.Peaks),"SpeechRecognition"in window||"webkitSpeechRecognition"in window?window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition:console.log("[StarmusIntegrator] Speech API missing (Tier B/C)"),window.addEventListener("sparxstar:environment-ready",function(t){var e,n;if(console.log("[StarmusIntegrator]  Parsing UEC Payload..."),window.StarmusStore){var i=t.detail||{},r=i.technical||{},o=r.raw||{},a=r.profile||{},s=i.identifiers||{},l={device:_s(_s({},o.device||{}),{},{class:a.deviceClass||"unknown",os:(null===(e=i.identifiers)||void 0===e||null===(e=e.deviceDetails)||void 0===e?void 0:e.os)||{},userAgent:navigator.userAgent}),browser:_s(_s({},o.browser||{}),(null===(n=i.identifiers)||void 0===n||null===(n=n.deviceDetails)||void 0===n?void 0:n.client)||{}),network:_s(_s({},o.network||{}),{},{profile:a.networkProfile||"unknown"}),identifiers:{sessionId:s.sessionId||i.sessionId||"unknown",visitorId:s.visitorId||i.visitorId||"unknown",ip:s.ipAddress||"0.0.0.0"},features:{battery:o.battery||{},performance:o.performance||{}},errors:[]};console.log("[StarmusIntegrator]  Normalized Env:",l),window.StarmusStore.dispatch({type:"starmus/env-update",payload:l})}}),document.addEventListener("click",function(){try{var t=window.StarmusAudioContext;t&&"suspended"===t.state&&t.resume()}catch(t){}},{once:!0}),window.Peaks||(window.Peaks=qe),bm=function(t,e){console.warn("[STARMUS RUNTIME]",t,e)},window.addEventListener("error",function(t){bm("window.error",{message:t.message,file:t.filename,line:t.lineno,col:t.colno})}),window.addEventListener("unhandledrejection",function(t){bm("unhandledrejection",t.reason)});var Cm,xm=hs.StarmusStore.createStore(Cm);window.StarmusStore=xm,document.addEventListener("DOMContentLoaded",function(){try{var t=document.querySelector("form[data-starmus-instance]"),e=document.getElementById("starmus-editor-root");if(t){var n=t.getAttribute("data-starmus-instance");!function(t,e){console.log("[StarmusMain] Booting RECORDER for ID:",e),t.addEventListener("submit",function(t){return t.preventDefault()}),rc.init().then(function(n){console.log("[StarmusMain] SPARXSTAR integration ready:",n),Qc(xm,e,n),Zd(xm,0,e),qg(xm,e),Uc(),Qg(xm,t)}).catch(function(n){console.warn("[StarmusMain] SPARXSTAR integration failed, using fallback:",n),Qc(xm,e,{}),Zd(xm,0,e),qg(xm,e),Uc(),Qg(xm,t)})}(t,n)}else e?(console.log("[StarmusMain] Booting EDITOR..."),window.STARMUS_EDITOR_DATA&&window.STARMUS_EDITOR_DATA.audioUrl?wm.init().then(function(t){window.StarmusCueEvents=new Sm(t,{pointsTableId:"points-list",segmentsTableId:"segments-list",showNotifications:!0,autoHighlight:!0}),console.log("[StarmusMain] Cue Events Manager connected to Peaks.")}).catch(function(t){console.error("[StarmusMain] Editor or Cue Manager failed to init:",t)}):console.warn("[StarmusMain] Editor data missing.")):console.warn("[StarmusMain]  No Starmus form or editor found.")}catch(t){console.error("[StarmusMain] Boot failed:",t)}}),window.StarmusRecorder=qg,window.StarmusTus={queueSubmission:Rc},window.StarmusOfflineQueue=Lc,window.StarmusTranscriptController=lm,window.StarmusAudioEditor=wm,window.SparxstarIntegration=rc}();
