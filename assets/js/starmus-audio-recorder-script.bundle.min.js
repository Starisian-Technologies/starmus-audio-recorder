var StarmusBundle=function(t){"use strict";const e=Math.PI/180;const n="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},r={_global:n,version:"10.0.12",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>r.angleDeg?t*e:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>r.DD.isDragging,isTransforming(){var t,e;return null!==(e=null===(t=r.Transformer)||void 0===t?void 0:t.isTransforming())&&void 0!==e&&e},isDragReady:()=>!!r.DD.node,releaseCanvasOnDestroy:!0,document:n.document,_injectGlobal(t){void 0!==n.Konva&&console.error("Several Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),n.Konva=t}},i=t=>{r[t.prototype.getClassName()]=t};r._injectGlobal(r);const o=()=>{if("undefined"==typeof document)throw new Error('Konva.js unsupported environment.\n\nLooks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.\n\nTo use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.\n\nbash: npm install canvas\njs: import "konva/canvas-backend";\n\nor\n\nbash: npm install skia-canvas\njs: import "konva/skia-backend";\n')};class a{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new a(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){const e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.m[0]*e+this.m[2]*n,i=this.m[1]*e+this.m[3]*n,o=this.m[0]*-n+this.m[2]*e,a=this.m[1]*-n+this.m[3]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=o,this.m[3]=a,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){const n=this.m[0]+this.m[2]*e,r=this.m[1]+this.m[3]*e,i=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=o,this}multiply(t){const e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],i=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],a=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,r=-this.m[2]*t,i=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),a=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=o,this.m[5]=a,this}getMatrix(){return this.m}decompose(){const t=this.m[0],e=this.m[1],n=this.m[2],r=this.m[3],i=t*r-e*n,o={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){const a=Math.sqrt(t*t+e*e);o.rotation=e>0?Math.acos(t/a):-Math.acos(t/a),o.scaleX=a,o.scaleY=i/a,o.skewX=(t*n+e*r)/i,o.skewY=0}else if(0!=n||0!=r){const a=Math.sqrt(n*n+r*r);o.rotation=Math.PI/2-(r>0?Math.acos(-n/a):-Math.acos(n/a)),o.scaleX=i/a,o.scaleY=a,o.skewX=0,o.skewY=(t*n+e*r)/i}return o.rotation=m._getRotation(o.rotation),o}}const s=Math.PI/180,l=180/Math.PI,u="#",h="Konva error: ",c={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let f=[],p=null;const g="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},m={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;const e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){f.push(t),1===f.length&&g(function(){const t=f;f=[],t.forEach(function(t){t()})})},createCanvasElement(){o();const t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>(o(),document.createElement("img")),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){const n=m.createImageElement();n.onload=function(){e(n)},n.src=t},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace(u,"");const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){let t=(16777215*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return u+t},isCanvasFarblingActive(){if(null!==p)return p;if("undefined"==typeof document)return p=!1,!1;const t=this.createCanvasElement();t.width=10,t.height=10;const e=t.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,10,10),e.fillStyle="#282828",e.fillRect(0,0,10,10);const n=e.getImageData(0,0,10,10).data;let r=!1;for(let t=0;t<100;t++)if(40!==n[4*t]||40!==n[4*t+1]||40!==n[4*t+2]||255!==n[4*t+3]){r=!0;break}return p=r,this.releaseCanvas(t),p},getHitColor(){const t=this.getRandomColor();return this.isCanvasFarblingActive()?this.getSnappedHexColor(t):t},getHitColorKey(t,e,n){return this.isCanvasFarblingActive()&&(t=5*Math.round(t/5),e=5*Math.round(e/5),n=5*Math.round(n/5)),u+this._rgbToHex(t,e,n)},getSnappedHexColor(t){const e=this._hexToRgb(t);return u+this._rgbToHex(5*Math.round(e.r/5),5*Math.round(e.g/5),5*Math.round(e.b/5))},getRGB(t){let e;return t in c?(e=c[t],{r:e[0],g:e[1],b:e[2]}):t[0]===u?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=d.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",m._namedColorToRBA(t)||m._hex3ColorToRGBA(t)||m._hex4ColorToRGBA(t)||m._hex6ColorToRGBA(t)||m._hex8ColorToRGBA(t)||m._rgbColorToRGBA(t)||m._rgbaColorToRGBA(t)||m._hslColorToRGBA(t)),_namedColorToRBA(t){const e=c[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){const e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){const e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),r=Number(n[0])/360,i=Number(n[1])/100,o=Number(n[2])/100;let a,s,l;if(0===i)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};a=o<.5?o*(1+i):o+i-o*i;const u=2*o-a,h=[0,0,0];for(let t=0;t<3;t++)s=r+1/3*-(t-1),s<0&&s++,s>1&&s--,l=6*s<1?u+6*(a-u)*s:2*s<1?a:3*s<2?u+(a-u)*(2/3-s)*6:u,h[t]=255*l;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){const e={};for(const n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*s,radToDeg:t=>t*l,_degToRad:t=>(m.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),m.degToRad(t)),_radToDeg:t=>(m.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),m.radToDeg(t)),_getRotation:t=>r.angleDeg?m.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(h+t)},error(t){console.error(h+t)},warn(t){r.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(const n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,r,i,o){let a,s,l;const u=(t-n)*(t-n)+(e-r)*(e-r);if(0==u)a=t,s=e,l=(i-n)*(i-n)+(o-r)*(o-r);else{const h=((i-t)*(n-t)+(o-e)*(r-e))/u;h<0?(a=t,s=e,l=(t-i)*(t-i)+(e-o)*(e-o)):h>1?(a=n,s=r,l=(n-i)*(n-i)+(r-o)*(r-o)):(a=t+h*(n-t),s=e+h*(r-e),l=(a-i)*(a-i)+(s-o)*(s-o))}return[a,s,l]},_getProjectionToLine(t,e,n){const r=m.cloneObject(t);let i=Number.MAX_VALUE;return e.forEach(function(o,a){if(!n&&a===e.length-1)return;const s=e[(a+1)%e.length],l=m._getProjectionToSegment(o.x,o.y,s.x,s.y,t.x,t.y),u=l[0],h=l[1],c=l[2];c<i&&(r.x=u,r.y=h,i=c)}),r},_prepareArrayForTween(t,e,n){const r=[],i=[];if(t.length>e.length){const n=e;e=t,t=n}for(let e=0;e<t.length;e+=2)r.push({x:t[e],y:t[e+1]});for(let t=0;t<e.length;t+=2)i.push({x:e[t],y:e[t+1]});const o=[];return i.forEach(function(t){const e=m._getProjectionToLine(t,r,n);o.push(e.x),o.push(e.y)}),o},_prepareToStringify(t){let e;t.visitedByCircularReferenceRemoval=!0;for(const n in t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(e=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||m._isElement(t[n])){if(!e.configurable)return null;delete t[n]}else if(null===m._prepareToStringify(t[n])){if(!e.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(const n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){r.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,n,r){let i=e<0?e:0,o=n<0?n:0;e=Math.abs(e),n=Math.abs(n);let a=0,s=0,l=0,u=0;"number"==typeof r?a=s=l=u=Math.min(r,e/2,n/2):(a=Math.min(r[0]||0,e/2,n/2),s=Math.min(r[1]||0,e/2,n/2),u=Math.min(r[2]||0,e/2,n/2),l=Math.min(r[3]||0,e/2,n/2)),t.moveTo(i+a,o),t.lineTo(i+e-s,o),t.arc(i+e-s,o+s,s,3*Math.PI/2,0,!1),t.lineTo(i+e,o+n-u),t.arc(i+e-u,o+n-u,u,0,Math.PI/2,!1),t.lineTo(i+l,o+n),t.arc(i+l,o+n-l,l,Math.PI/2,Math.PI,!1),t.lineTo(i,o+a),t.arc(i+a,o+a,a,Math.PI,3*Math.PI/2,!1)},drawRoundedPolygonPath(t,e,n,r,i){r=Math.abs(r);for(let o=0;o<n;o++){const a=e[(o-1+n)%n],s=e[o],l=e[(o+1)%n],u={x:s.x-a.x,y:s.y-a.y},h={x:l.x-s.x,y:l.y-s.y},c=Math.hypot(u.x,u.y),d=Math.hypot(h.x,h.y);let f;f="number"==typeof i?i:o<i.length?i[o]:0;f=r*Math.cos(Math.PI/n)*Math.min(1,f/r*2);const p={x:u.x/c,y:u.y/c},g={x:h.x/d,y:h.y/d},m={x:s.x-p.x*f,y:s.y-p.y*f},v={x:s.x+g.x*f,y:s.y+g.y*f};0===o?t.moveTo(m.x,m.y):t.lineTo(m.x,m.y),t.arcTo(s.x,s.y,v.x,v.y,f)}}};const v=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let y,_=null;function b(){if(null!==_)return _;try{const t=m.createCanvasElement().getContext("2d");return t?!!t&&"filter"in t:(_=!1,!1)}catch(t){return _=!1,!1}}class w{constructor(t){this.canvas=t,r.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){let n,r,i,o,a=this.traceArr,s=a.length,l="";for(n=0;n<s;n++)r=a[n],i=r.method,i?(o=r.args,l+=i,t?l+="()":m._isArray(o[0])?l+="(["+o.join(",")+"])":(e&&(o=o.map(t=>"number"==typeof t?Math.floor(t):t)),l+="("+o.join(",")+")")):(l+=r.property,t||(l+="="+r.val)),l+=";";return l}clearTrace(){this.traceArr=[]}_trace(t){let e,n=this.traceArr;n.push(t),e=n.length,e>=100&&n.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){const e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}_applyMiterLimit(t){const e=t.attrs.miterLimit;null!=e&&this.setAttr("miterLimit",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,r,i,o){this._context.arc(t,e,n,r,i,o)}arcTo(t,e,n,r,i){this._context.arcTo(t,e,n,r,i)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,r,i,o){this._context.bezierCurveTo(t,e,n,r,i,o)}clearRect(t,e,n,r){this._context.clearRect(t,e,n,r)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){const n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,r){return this._context.createLinearGradient(t,e,n,r)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,r,i,o){return this._context.createRadialGradient(t,e,n,r,i,o)}drawImage(t,e,n,r,i,o,a,s,l){const u=arguments,h=this._context;3===u.length?h.drawImage(t,e,n):5===u.length?h.drawImage(t,e,n,r,i):9===u.length&&h.drawImage(t,e,n,r,i,o,a,s,l)}ellipse(t,e,n,r,i,o,a,s){this._context.ellipse(t,e,n,r,i,o,a,s)}isPointInPath(t,e,n,r){return n?this._context.isPointInPath(n,t,e,r):this._context.isPointInPath(t,e,r)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,n,r){this._context.fillRect(t,e,n,r)}strokeRect(t,e,n,r){this._context.strokeRect(t,e,n,r)}fillText(t,e,n,r){r?this._context.fillText(t,e,n,r):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,r){return this._context.getImageData(t,e,n,r)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,r){this._context.rect(t,e,n,r)}roundRect(t,e,n,r,i){this._context.roundRect(t,e,n,r,i)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,r){this._context.quadraticCurveTo(t,e,n,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,r,i,o){this._context.setTransform(t,e,n,r,i,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,r){this._context.strokeText(t,e,n,r)}transform(t,e,n,r,i,o){this._context.transform(t,e,n,r,i,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let t,e,n=this,r=v.length,i=this.setAttr;const o=function(t){let r,i=n[t];n[t]=function(){return e=function(t){const e=[],n=t.length,r=m;for(let i=0;i<n;i++){let n=t[i];r._isNumber(n)?n=Math.round(1e3*n)/1e3:r._isString(n)||(n+=""),e.push(n)}return e}(Array.prototype.slice.call(arguments,0)),r=i.apply(n,arguments),n._trace({method:t,args:e}),r}};for(t=0;t<r;t++)o(v[t]);n.setAttr=function(){i.apply(n,arguments);const t=arguments[0];let e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"].forEach(function(t){Object.defineProperty(w.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class S extends w{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){const e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)return void this._fillColor(t);const r=t.getFillPatternImage();if(r&&"pattern"===n)return void this._fillPattern(t);const i=t.getFillLinearGradientColorStops();if(i&&"linear-gradient"===n)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):r?this._fillPattern(t):i?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(e.x,e.y,n.x,n.y);if(r){for(let t=0;t<r.length;t+=2)i.addColorStop(r[t],r[t+1]);this.setAttr("strokeStyle",i)}}_stroke(t){const e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,r;const i=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,a=null!==(r=t.getShadowOffset())&&void 0!==r?r:{x:0,y:0},s=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),u=s.x*l,h=s.y*l;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",o*Math.min(Math.abs(u),Math.abs(h))),this.setAttr("shadowOffsetX",a.x*u),this.setAttr("shadowOffsetY",a.y*h)}}class k extends w{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const e=t.getStrokeScaleEnabled();if(!e){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t);const n=t.hitStrokeWidth(),r="auto"===n?t.strokeWidth():n;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}class x{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const e=(t||{}).pixelRatio||r.pixelRatio||function(){if(y)return y;const t=m.createCanvasElement(),e=t.getContext("2d");return y=(r._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),m.releaseCanvas(t),y}();this.pixelRatio=e,this._canvas=m.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return m.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class C extends x{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new S(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}class T extends x{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new k(this),this.setSize(t.width,t.height)}}const A={get isDragging(){let t=!1;return A._dragElements.forEach(e=>{"dragging"===e.dragStatus&&(t=!0)}),t},justDragged:!1,get node(){let t;return A._dragElements.forEach(e=>{t=e.node}),t},_dragElements:new Map,_drag(t){const e=[];A._dragElements.forEach((n,r)=>{const{node:i}=n,o=i.getStage();o.setPointersPositions(t),void 0===n.pointerId&&(n.pointerId=m._getFirstPointerId(t));const a=o._changedPointerPositions.find(t=>t.id===n.pointerId);if(a){if("dragging"!==n.dragStatus){const e=i.dragDistance();if(Math.max(Math.abs(a.x-n.startPointerPos.x),Math.abs(a.y-n.startPointerPos.y))<e)return;if(i.startDrag({evt:t}),!i.isDragging())return}i._setDragPosition(t,n),e.push(i)}}),e.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)})},_endDragBefore(t){const e=[];A._dragElements.forEach(n=>{const{node:i}=n,o=i.getStage();t&&o.setPointersPositions(t);if(!o._changedPointerPositions.find(t=>t.id===n.pointerId))return;"dragging"!==n.dragStatus&&"stopped"!==n.dragStatus||(A.justDragged=!0,r._mouseListenClick=!1,r._touchListenClick=!1,r._pointerListenClick=!1,n.dragStatus="stopped");const a=n.node.getLayer()||n.node instanceof r.Stage&&n.node;a&&-1===e.indexOf(a)&&e.push(a)}),e.forEach(t=>{t.draw()})},_endDragAfter(t){A._dragElements.forEach((e,n)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&A._dragElements.delete(n)})}};function E(t){return m._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||m._isBoolean(t)?t:Object.prototype.toString.call(t)}function P(){if(r.isUnminified)return function(t,e){return m._isNumber(t)||m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function I(){if(r.isUnminified)return function(t,e){return m._isNumber(t)||"auto"===t||m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function M(){if(r.isUnminified)return function(t,e){return m._isString(t)||m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function D(){if(r.isUnminified)return function(t,e){const n=m._isString(t),r="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return n||r||m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function O(){if(r.isUnminified)return function(t,e){return!0===t||!1===t||m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}r.isBrowser&&(window.addEventListener("mouseup",A._endDragBefore,!0),window.addEventListener("touchend",A._endDragBefore,!0),window.addEventListener("touchcancel",A._endDragBefore,!0),window.addEventListener("mousemove",A._drag),window.addEventListener("touchmove",A._drag),window.addEventListener("mouseup",A._endDragAfter,!1),window.addEventListener("touchend",A._endDragAfter,!1),window.addEventListener("touchcancel",A._endDragAfter,!1));const L="get",R="set",B={addGetterSetter(t,e,n,r,i){B.addGetter(t,e,n),B.addSetter(t,e,r,i),B.addOverloadedGetterSetter(t,e)},addGetter(t,e,n){const r=L+m._capitalize(e);t.prototype[r]=t.prototype[r]||function(){const t=this.attrs[e];return void 0===t?n:t}},addSetter(t,e,n,r){const i=R+m._capitalize(e);t.prototype[i]||B.overWriteSetter(t,e,n,r)},overWriteSetter(t,e,n,r){const i=R+m._capitalize(e);t.prototype[i]=function(t){return n&&null!=t&&(t=n.call(this,t,e)),this._setAttr(e,t),r&&r.call(this),this}},addComponentsGetterSetter(t,e,n,i,o){const a=n.length,s=m._capitalize,l=L+s(e),u=R+s(e);t.prototype[l]=function(){const t={};for(let r=0;r<a;r++){const i=n[r];t[i]=this.getAttr(e+s(i))}return t};const h=function(t){if(r.isUnminified)return function(e,n){return null==e||m.isObject(e)||m.warn(E(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(n);t.prototype[u]=function(t){const r=this.attrs[e];i&&(t=i.call(this,t,e)),h&&h.call(this,t,e);for(const n in t)t.hasOwnProperty(n)&&this._setAttr(e+s(n),t[n]);return t||n.forEach(t=>{this._setAttr(e+s(t),void 0)}),this._fireChangeEvent(e,r,t),o&&o.call(this),this},B.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){const n=m._capitalize(e),r=R+n,i=L+n;t.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(t,e,n,r){m.error("Adding deprecated "+e);const i=L+m._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[i]=function(){m.error(o);const t=this.attrs[e];return void 0===t?n:t},B.addSetter(t,e,r,function(){m.error(o)}),B.addOverloadedGetterSetter(t,e)},backCompat(t,e){m.each(e,function(e,n){const r=t.prototype[n],i=L+m._capitalize(e),o=R+m._capitalize(e);function a(){r.apply(this,arguments),m.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=a,t.prototype[i]=a,t.prototype[o]=a})},afterSetFilter(){this._filterUpToDate=!1}};function F(t){const e=/(\w+)\(([^)]+)\)/g;let n;for(;null!==(n=e.exec(t));){const[,t,e]=n;switch(t){case"blur":{const t=parseFloat(e.replace("px",""));return function(e){this.blurRadius(.5*t);const n=r.Filters;n&&n.Blur&&n.Blur.call(this,e)}}case"brightness":{const t=e.includes("%")?parseFloat(e)/100:parseFloat(e);return function(e){this.brightness(t);const n=r.Filters;n&&n.Brightness&&n.Brightness.call(this,e)}}case"contrast":{const t=parseFloat(e);return function(e){const n=100*(Math.sqrt(t)-1);this.contrast(n);const i=r.Filters;i&&i.Contrast&&i.Contrast.call(this,e)}}case"grayscale":return function(t){const e=r.Filters;e&&e.Grayscale&&e.Grayscale.call(this,t)};case"sepia":return function(t){const e=r.Filters;e&&e.Sepia&&e.Sepia.call(this,t)};case"invert":return function(t){const e=r.Filters;e&&e.Invert&&e.Invert.call(this,t)};default:m.warn(`CSS filter "${t}" is not supported in fallback mode. Consider using function filters for better compatibility.`)}}return()=>{}}const U="absoluteOpacity",W="allEventListeners",G="absoluteTransform",j="absoluteScale",H="canvas",N="listening",z="Shape",X=" ",V="stage",Y="transform",Z="visible",q=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(X);let K=1;class J{constructor(t){this._id=K++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==Y&&t!==G||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){let n=this._cache.get(t);return(void 0===n||(t===Y||t===G)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map(t=>t+"Change.konva").join(X);this.on(n,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(H)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===G&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(H)){const{scene:t,filter:e,hit:n,buffer:r}=this._cache.get(H);m.releaseCanvas(t,e,n,r),this._cache.delete(H)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){const e=t||{};let n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let r=Math.ceil(e.width||n.width),i=Math.ceil(e.height||n.height),o=e.pixelRatio,a=void 0===e.x?Math.floor(n.x):e.x,s=void 0===e.y?Math.floor(n.y):e.y,l=e.offset||0,u=e.drawBorder||!1,h=e.hitCanvasPixelRatio||1;if(!r||!i)return void m.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");r+=2*l+(Math.abs(Math.round(n.x)-a)>.5?1:0),i+=2*l+(Math.abs(Math.round(n.y)-s)>.5?1:0),a-=l,s-=l;const c=new C({pixelRatio:o,width:r,height:i}),d=new C({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),f=new T({pixelRatio:h,width:r,height:i}),p=c.getContext(),g=f.getContext(),v=new C({width:c.width/c.pixelRatio+Math.abs(a),height:c.height/c.pixelRatio+Math.abs(s),pixelRatio:c.pixelRatio}),y=v.getContext();return f.isCache=!0,c.isCache=!0,this._cache.delete(H),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(c.getContext()._context.imageSmoothingEnabled=!1,d.getContext()._context.imageSmoothingEnabled=!1),p.save(),g.save(),y.save(),p.translate(-a,-s),g.translate(-a,-s),y.translate(-a,-s),v.x=a,v.y=s,this._isUnderCache=!0,this._clearSelfAndDescendantCache(U),this._clearSelfAndDescendantCache(j),this.drawScene(c,this,v),this.drawHit(f,this),this._isUnderCache=!1,p.restore(),g.restore(),u&&(p.save(),p.beginPath(),p.rect(0,0,r,i),p.closePath(),p.setAttr("strokeStyle","red"),p.setAttr("lineWidth",5),p.stroke(),p.restore()),this._cache.set(H,{scene:c,filter:d,hit:f,buffer:v,x:a,y:s}),this._requestDraw(),this}isCached(){return this._cache.has(H)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){const n=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let r=1/0,i=1/0,o=-1/0,a=-1/0;const s=this.getAbsoluteTransform(e);return n.forEach(function(t){const e=s.point(t);void 0===r&&(r=o=e.x,i=a=e.y),r=Math.min(r,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y)}),{x:r,y:i,width:o-r,height:a-i}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);const n=this._getCachedSceneCanvas(),r=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/r,n.height/r),t.restore()}_drawCachedHitCanvas(t){const e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t,e,n,r,i=this.filters(),o=this._getCanvasCache(),a=o.scene,s=o.filter,l=s.getContext();if(!i||0===i.length)return a;if(this._filterUpToDate)return s;let u=!0;for(let t=0;t<i.length;t++)if("string"==typeof i[t]&&b(),"string"!=typeof i[t]||!b()){u=!1;break}const h=a.pixelRatio;if(s.setSize(a.width/a.pixelRatio,a.height/a.pixelRatio),u){const t=i.join(" ");return l.save(),l.setAttr("filter",t),l.drawImage(a._canvas,0,0,a.getWidth()/h,a.getHeight()/h),l.restore(),this._filterUpToDate=!0,s}try{for(t=i.length,l.clear(),l.drawImage(a._canvas,0,0,a.getWidth()/h,a.getHeight()/h),e=l.getImageData(0,0,s.getWidth(),s.getHeight()),n=0;n<t;n++)r=i[n],"string"==typeof r&&(r=F(r)),r.call(this,e),l.putImageData(e,0,0)}catch(t){m.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,s}on(t,e){if(this._cache&&this._cache.delete(W),3===arguments.length)return this._delegate.apply(this,arguments);const n=t.split(X);for(let t=0;t<n.length;t++){const r=n[t].split("."),i=r[0],o=r[1]||"";this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:o,handler:e})}return this}off(t,e){let n,r,i,o,a,s,l=(t||"").split(X),u=l.length;if(this._cache&&this._cache.delete(W),!t)for(r in this.eventListeners)this._off(r);for(n=0;n<u;n++)if(i=l[n],o=i.split("."),a=o[0],s=o[1],a)this.eventListeners[a]&&this._off(a,s,e);else for(r in this.eventListeners)this._off(r,s,e);return this}dispatchEvent(t){const e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){const r=this;this.on(t,function(t){const i=t.target.findAncestors(e,!0,r);for(let e=0;e<i.length;e++)(t=m.cloneObject(t)).currentTarget=i[e],n.call(i[e],t)})}remove(){return this.isDragging()&&this.stopDrag(),A._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(G),this._clearSelfAndDescendantCache(U),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(V),this._clearSelfAndDescendantCache(Z),this._clearSelfAndDescendantCache(N)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const e="get"+m._capitalize(t);return m._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];for(;t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+m._capitalize(e),m._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(N,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(Z,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);const n=this.getLayer();let i=!1;A._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===n)&&(i=!0)});const o=!e&&!r.hitOnDragEnabled&&(i||r.isTransforming());return this.isListening()&&this.isVisible()&&!o}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t,e,n,r,i=this.getDepth(),o=this,a=0;const s=this.getStage();return"Stage"!==o.nodeType&&s&&function s(l){for(t=[],e=l.length,n=0;n<e;n++)r=l[n],a++,r.nodeType!==z&&(t=t.concat(r.getChildren().slice())),r._id===o._id&&(n=e);t.length>0&&t[0].getDepth()<=i&&s(t)}(s.getChildren()),a}getDepth(){let t=0,e=this.parent;for(;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Y),this._clearSelfAndDescendantCache(G)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const e=t.getPointerPosition();if(!e)return null;const n=this.getAbsoluteTransform().copy();return n.invert(),n.point(e)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);const r=this.getAbsoluteTransform(t).getMatrix(),i=new a,o=this.offset();return i.m=r.slice(),i.translate(o.x,o.y),i.getTranslation()}setAbsolutePosition(t){const{x:e,y:n,...r}=this._clearTransform();this.attrs.x=e,this.attrs.y=n,this._clearCache(Y);const i=this._getAbsoluteTransform().copy();return i.invert(),i.translate(t.x,t.y),t={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this._setTransform(r),this.setPosition({x:t.x,y:t.y}),this._clearCache(Y),this._clearSelfAndDescendantCache(G),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let e=t.x,n=t.y,r=this.x(),i=this.y();return void 0!==e&&(r+=e),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this}_eachAncestorReverse(t,e){let n,r,i=[],o=this.getParent();if(!e||e._id!==this._id){for(i.unshift(this);o&&(!e||o._id!==e._id);)i.unshift(o),o=o.parent;for(n=i.length,r=0;r<n;r++)t(i[r])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return m.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return m.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return m.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return m.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return m.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&m.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(U,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t,e,n,r,i,o=this.getAttrs();const a={attrs:{},className:this.getClassName()};for(t in o)e=o[t],i=m.isObject(e)&&!m._isPlainObject(e)&&!m._isArray(e),i||(n="function"==typeof this[t]&&this[t],delete o[t],r=n?n.call(this):null,o[t]=e,r!==e&&(a.attrs[t]=e));return m._prepareToStringify(a)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){const r=[];e&&this._isMatch(t)&&r.push(this);let i=this.parent;for(;i;){if(i===n)return r;i._isMatch(t)&&r.push(i),i=i.parent}return r}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);let e,n,r=t.replace(/ /g,"").split(","),i=r.length;for(e=0;e<i;e++)if(n=r[e],m.isValidSelector(n)||(m.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),m.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),m.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(V,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(G,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new a,this._eachAncestorReverse(function(t){const n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())},t),e;{e=this._cache.get(G)||new a,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();const t=this.transformsEnabled();if("all"===t)e.multiply(this.getTransform());else if("position"===t){const t=this.attrs.x||0,n=this.attrs.y||0,r=this.attrs.offsetX||0,i=this.attrs.offsetY||0;e.translate(t-r,n-i)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;for(;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Y,this._getTransform)}_getTransform(){var t,e;const n=this._cache.get(Y)||new a;n.reset();const i=this.x(),o=this.y(),s=r.getAngle(this.rotation()),l=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,u=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,h=this.attrs.skewX||0,c=this.attrs.skewY||0,d=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===i&&0===o||n.translate(i,o),0!==s&&n.rotate(s),0===h&&0===c||n.skew(h,c),1===l&&1===u||n.scale(l,u),0===d&&0===f||n.translate(-1*d,-1*f),n.dirty=!1,n}clone(t){let e,n,r,i,o,a=m.cloneObject(this.attrs);for(e in t)a[e]=t[e];const s=new this.constructor(a);for(e in this.eventListeners)for(n=this.eventListeners[e],r=n.length,i=0;i<r;i++)o=n[i],o.name.indexOf("konva")<0&&(s.eventListeners[e]||(s.eventListeners[e]=[]),s.eventListeners[e].push(o));return s}_toKonvaCanvas(t){t=t||{};const e=this.getClientRect(),n=this.getStage(),r=void 0!==t.x?t.x:Math.floor(e.x),i=void 0!==t.y?t.y:Math.floor(e.y),o=t.pixelRatio||1,a=new C({width:t.width||Math.ceil(e.width)||(n?n.width():0),height:t.height||Math.ceil(e.height)||(n?n.height():0),pixelRatio:o}),s=a.getContext(),l=new C({width:a.width/a.pixelRatio+Math.abs(r),height:a.height/a.pixelRatio+Math.abs(i),pixelRatio:a.pixelRatio});return!1===t.imageSmoothingEnabled&&(s._context.imageSmoothingEnabled=!1),s.save(),(r||i)&&s.translate(-1*r,-1*i),this.drawScene(a,void 0,l),s.restore(),a}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){const e=(t=t||{}).mimeType||null,n=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(r),r}toImage(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,m._urlToImage(this.toDataURL(t),function(t){e(t),null==n||n(t)})}catch(t){n(t)}})}toBlob(t){return new Promise((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==n||n(t)},null==t?void 0:t.mimeType,null==t?void 0:t.quality)}catch(t){n(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():r.dragDistance}_off(t,e,n){let r,i,o,a=this.eventListeners[t];for(r=0;r<a.length;r++)if(i=a[r].name,o=a[r].handler,!("konva"===i&&"konva"!==e||e&&i!==e||n&&n!==o)){if(a.splice(r,1),0===a.length){delete this.eventListeners[t];break}r--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){const e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;return-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){const e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){const n=this["set"+m._capitalize(t)];return m._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(r.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){const n=this.attrs[t];(n!==e||m.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){let r;void 0!==n&&(r=this.attrs[t],r||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,r,n))}_fireAndBubble(t,e,n){e&&this.nodeType===z&&(e.target=this);const r=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(!(-1!==r.indexOf(t)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(t,e);const i=-1!==r.indexOf(t)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,n,r;const i=null!==(e=this._cache.get(W))&&void 0!==e?e:{};let o=null==i?void 0:i[t];if(void 0===o){o=[];let e=Object.getPrototypeOf(this);for(;e;){const i=null!==(r=null===(n=e.eventListeners)||void 0===n?void 0:n[t])&&void 0!==r?r:[];o.push(...i),e=Object.getPrototypeOf(e)}i[t]=o,this._cache.set(W,i)}return o}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(let t=0;t<n.length;t++)n[t].handler.call(this,e);const r=this.eventListeners[t];if(r)for(let t=0;t<r.length;t++)r[t].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const e=t?t.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition();if(!n)return;const i=n._getPointerById(e)||n._changedPointerPositions[0]||r;A._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-r.x,y:i.y-r.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){A._dragElements.has(this._id)||this._createDragElement(t);A._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(!n)return;let r={x:n.x-e.offset.x,y:n.y-e.offset.y};const i=this.dragBoundFunc();if(void 0!==i){const e=i.call(this,r,t);e?r=e:m.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===r.x&&this._lastPos.y===r.y||(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}stopDrag(t){const e=A._dragElements.get(this._id);e&&(e.dragStatus="stopped"),A._endDragBefore(t),A._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=A._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(!(void 0!==t.evt.button)||r.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let e=!1;A._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(e=!0)}),e||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();if(!this.getStage())return;const t=A._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,n=t&&"ready"===t.dragStatus;e?this.stopDrag():n&&A._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return m.haveIntersection(n,this.getClientRect())}static create(t,e){return m._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){let n,i,o,a=J.prototype.getClassName.call(t),s=t.children;e&&(t.attrs.container=e),r[a]||(m.warn('Can not find a node with class name "'+a+'". Fallback to "Shape".'),a="Shape");if(n=new(0,r[a])(t.attrs),s)for(i=s.length,o=0;o<i;o++)n.add(J._createNode(s[o]));return n}}J.prototype.nodeType="Node",J.prototype._attrsAffectingSize=[],J.prototype.eventListeners={},J.prototype.on.call(J.prototype,q,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(Y),this._clearSelfAndDescendantCache(G))}),J.prototype.on.call(J.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Z)}),J.prototype.on.call(J.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(N)}),J.prototype.on.call(J.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(U)});const Q=B.addGetterSetter;Q(J,"zIndex"),Q(J,"absolutePosition"),Q(J,"position"),Q(J,"x",0,P()),Q(J,"y",0,P()),Q(J,"globalCompositeOperation","source-over",M()),Q(J,"opacity",1,P()),Q(J,"name","",M()),Q(J,"id","",M()),Q(J,"rotation",0,P()),B.addComponentsGetterSetter(J,"scale",["x","y"]),Q(J,"scaleX",1,P()),Q(J,"scaleY",1,P()),B.addComponentsGetterSetter(J,"skew",["x","y"]),Q(J,"skewX",0,P()),Q(J,"skewY",0,P()),B.addComponentsGetterSetter(J,"offset",["x","y"]),Q(J,"offsetX",0,P()),Q(J,"offsetY",0,P()),Q(J,"dragDistance",void 0,P()),Q(J,"width",0,P()),Q(J,"height",0,P()),Q(J,"listening",!0,O()),Q(J,"preventDefault",!0,O()),Q(J,"filters",void 0,function(t){return this._filterUpToDate=!1,t}),Q(J,"visible",!0,O()),Q(J,"transformsEnabled","all",M()),Q(J,"size"),Q(J,"dragBoundFunc"),Q(J,"draggable",!1,O()),B.backCompat(J,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class $ extends J{constructor(){super(...arguments),this.children=[]}getChildren(t){const e=this.children||[];return t?e.filter(t):e}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(let e=0;e<t.length;e++)this.add(t[e]);return this}const e=t[0];return e.getParent()?(e.moveTo(this),this):(this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){const n=[];return this._descendants(r=>{const i=r._isMatch(t);return i&&n.push(r),!(!i||!e)}),n}_descendants(t){let e=!1;const n=this.getChildren();for(const r of n){if(e=t(r),e)return!0;if(r.hasChildren()&&(e=r._descendants(t),e))return!0}return!1}toObject(){const t=J.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();for(;e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){const e=J.prototype.clone.call(this,t);return this.getChildren().forEach(function(t){e.add(t.clone())}),e}getAllIntersections(t){const e=[];return this.find("Shape").forEach(n=>{n.isVisible()&&n.intersects(t)&&e.push(n)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach(function(e){e._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach(function(t,e){t.index=e}),this._requestDraw()}drawScene(t,e,n){const r=this.getLayer(),i=t||r&&r.getCanvas(),o=i&&i.getContext(),a=this._getCanvasCache(),s=a&&a.scene,l=i&&i.isCache;if(!this.isVisible()&&!l)return this;if(s){o.save();const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",i,e,n);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;const n=this.getLayer(),r=t||n&&n.hitCanvas,i=r&&r.getContext(),o=this._getCanvasCache();if(o&&o.hit){i.save();const t=this.getAbsoluteTransform(e).getMatrix();i.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",r,e);return this}_drawChildren(t,e,n,r){var i;const o=e&&e.getContext(),a=this.clipWidth(),s=this.clipHeight(),l=this.clipFunc(),u="number"==typeof a&&"number"==typeof s||l,h=n===this;if(u){o.save();const t=this.getAbsoluteTransform(n);let e,r=t.getMatrix();if(o.transform(r[0],r[1],r[2],r[3],r[4],r[5]),o.beginPath(),l)e=l.call(this,o,this);else{const t=this.clipX(),e=this.clipY();o.rect(t||0,e||0,a,s)}o.clip.apply(o,e),r=t.copy().invert().getMatrix(),o.transform(r[0],r[1],r[2],r[3],r[4],r[5])}const c=!h&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;c&&(o.save(),o._applyGlobalCompositeOperation(this)),null===(i=this.children)||void 0===i||i.forEach(function(i){i[t](e,n,r)}),c&&o.restore(),u&&o.restore()}getClientRect(t={}){var e;const n=t.skipTransform,r=t.relativeTo;let i,o,a,s,l={x:1/0,y:1/0,width:0,height:0};const u=this;null===(e=this.children)||void 0===e||e.forEach(function(e){if(!e.visible())return;const n=e.getClientRect({relativeTo:u,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===n.width&&0===n.height||(void 0===i?(i=n.x,o=n.y,a=n.x+n.width,s=n.y+n.height):(i=Math.min(i,n.x),o=Math.min(o,n.y),a=Math.max(a,n.x+n.width),s=Math.max(s,n.y+n.height)))});const h=this.find("Shape");let c=!1;for(let t=0;t<h.length;t++){if(h[t]._isVisible(this)){c=!0;break}}return l=c&&void 0!==i?{x:i,y:o,width:a-i,height:s-o}:{x:0,y:0,width:0,height:0},n?l:this._transformedRect(l,r)}}B.addComponentsGetterSetter($,"clip",["x","y","width","height"]),B.addGetterSetter($,"clipX",void 0,P()),B.addGetterSetter($,"clipY",void 0,P()),B.addGetterSetter($,"clipWidth",void 0,P()),B.addGetterSetter($,"clipHeight",void 0,P()),B.addGetterSetter($,"clipFunc");const tt=new Map,et=void 0!==r._global.PointerEvent;function nt(t){return tt.get(t)}function rt(t){return{evt:t,pointerId:t.pointerId}}function it(t,e){return tt.get(t)===e}function ot(t,e){at(t);e.getStage()&&(tt.set(t,e),et&&e._fire("gotpointercapture",rt(new PointerEvent("gotpointercapture"))))}function at(t,e){const n=tt.get(t);if(!n)return;const r=n.getStage();r&&r.content,tt.delete(t),et&&n._fire("lostpointercapture",rt(new PointerEvent("lostpointercapture")))}const st="mouseleave",lt="mouseover",ut="mouseenter",ht="mousemove",ct="mousedown",dt="mouseup",ft="pointermove",pt="pointerdown",gt="pointerup",mt="pointercancel",vt="pointerout",yt="pointerleave",_t="pointerover",bt="pointerenter",wt="contextmenu",St="touchstart",kt="touchend",xt="touchmove",Ct="touchcancel",Tt="wheel",At=[[ut,"_pointerenter"],[ct,"_pointerdown"],[ht,"_pointermove"],[dt,"_pointerup"],[st,"_pointerleave"],[St,"_pointerdown"],[xt,"_pointermove"],[kt,"_pointerup"],[Ct,"_pointercancel"],[lt,"_pointerover"],[Tt,"_wheel"],[wt,"_contextmenu"],[pt,"_pointerdown"],[ft,"_pointermove"],[gt,"_pointerup"],[mt,"_pointercancel"],[yt,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],Et={mouse:{[vt]:"mouseout",[yt]:st,[_t]:lt,[bt]:ut,[ft]:ht,[pt]:ct,[gt]:dt,[mt]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[vt]:"touchout",[yt]:"touchleave",[_t]:"touchover",[bt]:"touchenter",[ft]:xt,[pt]:St,[gt]:kt,[mt]:Ct,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[vt]:vt,[yt]:yt,[_t]:_t,[bt]:bt,[ft]:ft,[pt]:pt,[gt]:gt,[mt]:mt,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Pt=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",It=t=>{const e=Pt(t);return"pointer"===e?r.pointerEventsEnabled&&Et.pointer:"touch"===e?Et.touch:"mouse"===e?Et.mouse:void 0};function Mt(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&m.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const Dt=[];class Ot extends ${constructor(t){super(Mt(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Dt.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Mt(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),n="FastLayer"===t.getType();e||n||m.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){let e;if("."===t.charAt(0)){const e=t.slice(1);t=document.getElementsByClassName(e)[0]}else e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e);if(!t)throw"Can not find container in document with id "+e}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const t=this.children,e=t.length;for(let n=0;n<e;n++)t[n].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),$.prototype.clone.call(this,t)}destroy(){super.destroy();const t=this.content;t&&m._isInDocument(t)&&this.container().removeChild(t);const e=Dt.indexOf(this);return e>-1&&Dt.splice(e,1),m.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(m.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t={...t}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();const e=new C({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,r=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),r.forEach(function(e){if(!e.isVisible())return;const r=e._toKonvaCanvas(t);n.drawImage(r._canvas,t.x,t.y,r.getWidth()/r.getPixelRatio(),r.getHeight()/r.getPixelRatio())}),e}getIntersection(t){if(!t)return null;const e=this.children;for(let n=e.length-1;n>=0;n--){const r=e[n].getIntersection(t);if(r)return r}return null}_resizeDOM(){const t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(n=>{n.setSize({width:t,height:e}),n.draw()})}add(t,...e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}super.add(t);const n=this.children.length;return n>5&&m.warn("The stage has "+n+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),r.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){ot(t,this)}releaseCapture(t){at(t)}getLayers(){return this.children}_bindContentEvents(){r.isBrowser&&At.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=It(t.type);e&&this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=It(t.type);e&&this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=It(t.type),n=Pt(t.type);if(!e)return;this.setPointersPositions(t);const i=this._getTargetShape(n),o=!(r.isDragging()||r.isTransforming())||r.hitOnDragEnabled;i&&o?(i._fireAndBubble(e.pointerout,{evt:t}),i._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[n+"targetShape"]=null):o&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){const e=It(t.type),n=Pt(t.type);if(!e)return;this.setPointersPositions(t);let i=!1;this._changedPointerPositions.forEach(o=>{const a=this.getIntersection(o);if(A.justDragged=!1,r["_"+n+"ListenClick"]=!0,!a||!a.isListening())return void(this[n+"ClickStartShape"]=void 0);r.capturePointerEventsEnabled&&a.setPointerCapture(o.id),this[n+"ClickStartShape"]=a,a._fireAndBubble(e.pointerdown,{evt:t,pointerId:o.id}),i=!0;const s=t.type.indexOf("touch")>=0;a.preventDefault()&&t.cancelable&&s&&t.preventDefault()}),i||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){const e=It(t.type),n=Pt(t.type);if(!e)return;const i=t.type.indexOf("touch")>=0||"touch"===t.pointerType;r.isDragging()&&A.node.preventDefault()&&t.cancelable&&i&&t.preventDefault(),this.setPointersPositions(t);if(!(!(r.isDragging()||r.isTransforming())||r.hitOnDragEnabled))return;const o={};let a=!1;const s=this._getTargetShape(n);this._changedPointerPositions.forEach(r=>{const i=nt(r.id)||this.getIntersection(r),l=r.id,u={evt:t,pointerId:l},h=s!==i;if(h&&s&&(s._fireAndBubble(e.pointerout,{...u},i),s._fireAndBubble(e.pointerleave,{...u},i)),i){if(o[i._id])return;o[i._id]=!0}i&&i.isListening()?(a=!0,h&&(i._fireAndBubble(e.pointerover,{...u},s),i._fireAndBubble(e.pointerenter,{...u},s),this[n+"targetShape"]=i),i._fireAndBubble(e.pointermove,{...u})):s&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[n+"targetShape"]=null)}),a||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=It(t.type),n=Pt(t.type);if(!e)return;this.setPointersPositions(t);const i=this[n+"ClickStartShape"],o=this[n+"ClickEndShape"],a={};let s=!1;this._changedPointerPositions.forEach(l=>{const u=nt(l.id)||this.getIntersection(l);if(u){if(u.releaseCapture(l.id),a[u._id])return;a[u._id]=!0}const h=l.id,c={evt:t,pointerId:h};let d=!1;r["_"+n+"InDblClickWindow"]?(d=!0,clearTimeout(this[n+"DblTimeout"])):A.justDragged||(r["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout(function(){r["_"+n+"InDblClickWindow"]=!1},r.dblClickWindow),u&&u.isListening()?(s=!0,this[n+"ClickEndShape"]=u,u._fireAndBubble(e.pointerup,{...c}),r["_"+n+"ListenClick"]&&i&&i===u&&(u._fireAndBubble(e.pointerclick,{...c}),d&&o&&o===u&&u._fireAndBubble(e.pointerdblclick,{...c}))):(this[n+"ClickEndShape"]=null,s||(this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s=!0),r["_"+n+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:h}),d&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:h}))}),s||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r["_"+n+"ListenClick"]=!1,t.cancelable&&"touch"!==n&&"pointer"!==n&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(wt,{evt:t}):this._fire(wt,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(Tt,{evt:t}):this._fire(Tt,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=nt(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(gt,rt(t)),at(t.pointerId)}_lostpointercapture(t){at(t.pointerId)}setPointersPositions(t){const e=this._getContentPosition();let n=null,r=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})):(n=(t.clientX-e.left)/e.scaleX,r=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:n,y:r},this._pointerPositions=[{x:n,y:r,id:m._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:r,id:m._getFirstPointerId(t)}])}_setPointerPosition(t){m.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new C({width:this.width(),height:this.height()}),this.bufferHitCanvas=new T({pixelRatio:1,width:this.width(),height:this.height()}),!r.isBrowser)return;const t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return m.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}Ot.prototype.nodeType="Stage",i(Ot),B.addGetterSetter(Ot,"container"),r.isBrowser&&document.addEventListener("visibilitychange",()=>{Dt.forEach(t=>{t.batchDraw()})});const Lt="hasShadow",Rt="shadowRGBA",Bt="patternImage",Ft="linearGradient",Ut="radialGradient";let Wt;function Gt(){return Wt||(Wt=m.createCanvasElement().getContext("2d"),Wt)}const jt={};class Ht extends J{constructor(t){let e;super(t);let n=0;for(;e=m.getHitColor(),!e||e in jt;)if(n++,n>=1e4){m.warn("Failed to find a unique color key for a shape. Konva may work incorrectly. Most likely your browser is using canvas farbling. Consider disabling it."),e=m.getRandomColor();break}this.colorKey=e,jt[e]=this}getContext(){return m.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return m.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Lt,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Bt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=Gt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new a;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(r.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=e.getMatrix(),i="undefined"==typeof DOMMatrix?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);t.setTransform(i)}return t}}_getLinearGradient(){return this._getCache(Ft,this.__getLinearGradient)}__getLinearGradient(){const t=this.fillLinearGradientColorStops();if(t){const e=Gt(),n=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),i=e.createLinearGradient(n.x,n.y,r.x,r.y);for(let e=0;e<t.length;e+=2)i.addColorStop(t[e],t[e+1]);return i}}_getRadialGradient(){return this._getCache(Ut,this.__getRadialGradient)}__getRadialGradient(){const t=this.fillRadialGradientColorStops();if(t){const e=Gt(),n=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),i=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius());for(let e=0;e<t.length;e+=2)i.addColorStop(t[e],t[e+1]);return i}}getShadowRGBA(){return this._getCache(Rt,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const t=m.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){const e=this.getStage();if(!e)return!1;const n=e.bufferHitCanvas;n.getContext().clear(),this.drawHit(n,void 0,!0);return n.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return J.prototype.destroy.call(this),delete jt[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const n=t||this.hasFill(),r=this.hasStroke(),i=1!==this.getAbsoluteOpacity();if(n&&r&&i)return!0;const o=this.hasShadow(),a=this.shadowForStrokeEnabled();return!!(n&&r&&o&&a)}setStrokeHitEnabled(t){m.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,n=this.getParent();for(;n;){if(n.isCached()){e=!0;break}n=n.getParent()}const r=t.skipTransform,i=t.relativeTo||e&&this.getStage()||void 0,o=this.getSelfRect(),a=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,s=o.width+a,l=o.height+a,u=!t.skipShadow&&this.hasShadow(),h=u?this.shadowOffsetX():0,c=u?this.shadowOffsetY():0,d=s+Math.abs(h),f=l+Math.abs(c),p=u&&this.shadowBlur()||0,g={width:d+2*p,height:f+2*p,x:-(a/2+p)+Math.min(h,0)+o.x,y:-(a/2+p)+Math.min(c,0)+o.y};return r?g:this._transformedRect(g,i)}drawScene(t,e,n){const r=this.getLayer(),i=(t||r.getCanvas()).getContext(),o=this._getCanvasCache(),a=this.getSceneFunc(),s=this.hasShadow();let l;const u=e===this;if(!this.isVisible()&&!u)return this;if(o){i.save();const t=this.getAbsoluteTransform(e).getMatrix();return i.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(i),i.restore(),this}if(!a)return this;if(i.save(),this._useBufferCanvas()){l=this.getStage();const t=n||l.bufferCanvas,r=t.getContext();r.clear(),r.save(),r._applyLineJoin(this),r._applyMiterLimit(this);const o=this.getAbsoluteTransform(e).getMatrix();r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),a.call(this,r,this),r.restore();const h=t.pixelRatio;s&&i._applyShadow(this),u||(i._applyOpacity(this),i._applyGlobalCompositeOperation(this)),i.drawImage(t._canvas,t.x||0,t.y||0,t.width/h,t.height/h)}else{if(i._applyLineJoin(this),i._applyMiterLimit(this),!u){const t=this.getAbsoluteTransform(e).getMatrix();i.transform(t[0],t[1],t[2],t[3],t[4],t[5]),i._applyOpacity(this),i._applyGlobalCompositeOperation(this)}s&&i._applyShadow(this),a.call(this,i,this)}return i.restore(),this}drawHit(t,e,n=!1){if(!this.shouldDrawHit(e,n))return this;const r=this.getLayer(),i=t||r.hitCanvas,o=i&&i.getContext(),a=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),l=s&&s.hit;if(this.colorKey||m.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){o.save();const t=this.getAbsoluteTransform(e).getMatrix();return o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!a)return this;o.save(),o._applyLineJoin(this),o._applyMiterLimit(this);if(!(this===e)){const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return a.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){const e=this._getCanvasCache(),n=this._getCachedSceneCanvas(),r=e.hit,i=r.getContext(),o=r.getWidth(),a=r.getHeight();i.clear(),i.drawImage(n._canvas,0,0,o,a);try{const e=i.getImageData(0,0,o,a),n=e.data,r=n.length,s=m._hexToRgb(this.colorKey);for(let e=0;e<r;e+=4){n[e+3]>t?(n[e]=s.r,n[e+1]=s.g,n[e+2]=s.b,n[e+3]=255):n[e+3]=0}i.putImageData(e,0,0)}catch(t){m.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){ot(t,this)}releaseCapture(t){at(t)}}Ht.prototype._fillFunc=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Ht.prototype._strokeFunc=function(t){t.stroke()},Ht.prototype._fillFuncHit=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Ht.prototype._strokeFuncHit=function(t){t.stroke()},Ht.prototype._centroid=!1,Ht.prototype.nodeType="Shape",i(Ht),Ht.prototype.eventListeners={},Ht.prototype.on.call(Ht.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Lt)}),Ht.prototype.on.call(Ht.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Rt)}),Ht.prototype.on.call(Ht.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(Bt)}),Ht.prototype.on.call(Ht.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(Ft)}),Ht.prototype.on.call(Ht.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(Ut)}),B.addGetterSetter(Ht,"stroke",void 0,D()),B.addGetterSetter(Ht,"strokeWidth",2,P()),B.addGetterSetter(Ht,"fillAfterStrokeEnabled",!1),B.addGetterSetter(Ht,"hitStrokeWidth","auto",I()),B.addGetterSetter(Ht,"strokeHitEnabled",!0,O()),B.addGetterSetter(Ht,"perfectDrawEnabled",!0,O()),B.addGetterSetter(Ht,"shadowForStrokeEnabled",!0,O()),B.addGetterSetter(Ht,"lineJoin"),B.addGetterSetter(Ht,"lineCap"),B.addGetterSetter(Ht,"miterLimit"),B.addGetterSetter(Ht,"sceneFunc"),B.addGetterSetter(Ht,"hitFunc"),B.addGetterSetter(Ht,"dash"),B.addGetterSetter(Ht,"dashOffset",0,P()),B.addGetterSetter(Ht,"shadowColor",void 0,M()),B.addGetterSetter(Ht,"shadowBlur",0,P()),B.addGetterSetter(Ht,"shadowOpacity",1,P()),B.addComponentsGetterSetter(Ht,"shadowOffset",["x","y"]),B.addGetterSetter(Ht,"shadowOffsetX",0,P()),B.addGetterSetter(Ht,"shadowOffsetY",0,P()),B.addGetterSetter(Ht,"fillPatternImage"),B.addGetterSetter(Ht,"fill",void 0,D()),B.addGetterSetter(Ht,"fillPatternX",0,P()),B.addGetterSetter(Ht,"fillPatternY",0,P()),B.addGetterSetter(Ht,"fillLinearGradientColorStops"),B.addGetterSetter(Ht,"strokeLinearGradientColorStops"),B.addGetterSetter(Ht,"fillRadialGradientStartRadius",0),B.addGetterSetter(Ht,"fillRadialGradientEndRadius",0),B.addGetterSetter(Ht,"fillRadialGradientColorStops"),B.addGetterSetter(Ht,"fillPatternRepeat","repeat"),B.addGetterSetter(Ht,"fillEnabled",!0),B.addGetterSetter(Ht,"strokeEnabled",!0),B.addGetterSetter(Ht,"shadowEnabled",!0),B.addGetterSetter(Ht,"dashEnabled",!0),B.addGetterSetter(Ht,"strokeScaleEnabled",!0),B.addGetterSetter(Ht,"fillPriority","color"),B.addComponentsGetterSetter(Ht,"fillPatternOffset",["x","y"]),B.addGetterSetter(Ht,"fillPatternOffsetX",0,P()),B.addGetterSetter(Ht,"fillPatternOffsetY",0,P()),B.addComponentsGetterSetter(Ht,"fillPatternScale",["x","y"]),B.addGetterSetter(Ht,"fillPatternScaleX",1,P()),B.addGetterSetter(Ht,"fillPatternScaleY",1,P()),B.addComponentsGetterSetter(Ht,"fillLinearGradientStartPoint",["x","y"]),B.addComponentsGetterSetter(Ht,"strokeLinearGradientStartPoint",["x","y"]),B.addGetterSetter(Ht,"fillLinearGradientStartPointX",0),B.addGetterSetter(Ht,"strokeLinearGradientStartPointX",0),B.addGetterSetter(Ht,"fillLinearGradientStartPointY",0),B.addGetterSetter(Ht,"strokeLinearGradientStartPointY",0),B.addComponentsGetterSetter(Ht,"fillLinearGradientEndPoint",["x","y"]),B.addComponentsGetterSetter(Ht,"strokeLinearGradientEndPoint",["x","y"]),B.addGetterSetter(Ht,"fillLinearGradientEndPointX",0),B.addGetterSetter(Ht,"strokeLinearGradientEndPointX",0),B.addGetterSetter(Ht,"fillLinearGradientEndPointY",0),B.addGetterSetter(Ht,"strokeLinearGradientEndPointY",0),B.addComponentsGetterSetter(Ht,"fillRadialGradientStartPoint",["x","y"]),B.addGetterSetter(Ht,"fillRadialGradientStartPointX",0),B.addGetterSetter(Ht,"fillRadialGradientStartPointY",0),B.addComponentsGetterSetter(Ht,"fillRadialGradientEndPoint",["x","y"]),B.addGetterSetter(Ht,"fillRadialGradientEndPointX",0),B.addGetterSetter(Ht,"fillRadialGradientEndPointY",0),B.addGetterSetter(Ht,"fillPatternRotation",0),B.addGetterSetter(Ht,"fillRule",void 0,M()),B.backCompat(Ht,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const Nt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],zt=Nt.length;class Xt extends ${constructor(t){super(t),this.canvas=new C,this.hitCanvas=new T({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){J.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!J.prototype.moveUp.call(this))return!1;const t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(J.prototype.moveDown.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(J.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const t=this.getNativeCanvasElement();return J.prototype.remove.call(this),t&&t.parentNode&&m._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&m.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t={...t}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),J.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){m.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){m.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,m.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,n=!1;for(;;){for(let r=0;r<zt;r++){const i=Nt[r],o=this._getIntersection({x:t.x+i.x*e,y:t.y+i.y*e}),a=o.shape;if(a)return a;if(n=!!o.antialiased,!o.antialiased)break}if(!n)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,r=n[3];if(255===r){const t=m.getHitColorKey(n[0],n[1],n[2]),e=jt[t];return e?{shape:e}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}drawScene(t,e,n){const r=this.getLayer(),i=t||r&&r.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),$.prototype.drawScene.call(this,i,e,n),this._fire("draw",{node:this}),this}drawHit(t,e){const n=this.getLayer(),r=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),$.prototype.drawHit.call(this,r,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){m.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return m.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return m.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Xt.prototype.nodeType="Layer",i(Xt),B.addGetterSetter(Xt,"imageSmoothingEnabled",!0),B.addGetterSetter(Xt,"clearBeforeDraw",!0),B.addGetterSetter(Xt,"hitGraphEnabled",!0,O());class Vt extends Xt{constructor(t){super(t),this.listening(!1),m.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Vt.prototype.nodeType="FastLayer",i(Vt);class Yt extends ${_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&m.throw("You may only add groups and shapes to groups.")}}Yt.prototype.nodeType="Group",i(Yt);const Zt=n.performance&&n.performance.now?function(){return n.performance.now()}:function(){return(new Date).getTime()};class qt{constructor(t,e){this.id=qt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Zt(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,n=e.length;for(let r=0;r<n;r++)if(e[r]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const t=qt.animations,e=t.length;for(let n=0;n<e;n++)if(t[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Zt(),qt._addAnimation(this),this}stop(){return qt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,n=this.animations,r=n.length;for(let t=0;t<r;t++)if(n[t].id===e){this.animations.splice(t,1);break}}static _runFrames(){const t={},e=this.animations;for(let n=0;n<e.length;n++){const r=e[n],i=r.layers,o=r.func;r._updateFrameObject(Zt());const a=i.length;let s;if(s=!o||!1!==o.call(r,r.frame),s)for(let e=0;e<a;e++){const n=i[e];void 0!==n._id&&(t[n._id]=n)}}for(const e in t)t.hasOwnProperty(e)&&t[e].batchDraw()}static _animationLoop(){const t=qt;t.animations.length?(t._runFrames(),m.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,m.requestAnimFrame(this._animationLoop))}}qt.animations=[],qt.animIdCounter=0,qt.animRunning=!1;const Kt={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Jt=["fill","stroke","shadowColor"];let Qt=0;class $t{constructor(t,e,n,r,i,o,a){this.prop=t,this.propFunc=e,this.begin=r,this._pos=r,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=a,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()}fire(t){const e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class te{constructor(t){const e=this,n=t.node,i=n._id,o=t.easing||ee.Linear,a=!!t.yoyo;let s,l;s=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=n,this._id=Qt++;const u=n.getLayer()||(n instanceof r.Stage?n.getLayers():null);for(l in u||m.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new qt(function(){e.tween.onEnterFrame()},u),this.tween=new $t(l,function(t){e._tweenFunc(t)},o,0,1,1e3*s,a),this._addListeners(),te.attrs[i]||(te.attrs[i]={}),te.attrs[i][this._id]||(te.attrs[i][this._id]={}),te.tweens[i]||(te.tweens[i]={}),t)void 0===Kt[l]&&this._addAttr(l,t[l]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){const n=this.node,r=n._id;let i,o,a,s,l;const u=te.tweens[r][t];u&&delete te.attrs[r][u][t];let h=n.getAttr(t);if(m._isArray(e))if(i=[],o=Math.max(e.length,h.length),"points"===t&&e.length!==h.length&&(e.length>h.length?(s=h,h=m._prepareArrayForTween(h,e,n.closed())):(a=e,e=m._prepareArrayForTween(e,h,n.closed()))),0===t.indexOf("fill"))for(let t=0;t<o;t++)if(t%2==0)i.push(e[t]-h[t]);else{const n=m.colorToRGBA(h[t]);l=m.colorToRGBA(e[t]),h[t]=n,i.push({r:l.r-n.r,g:l.g-n.g,b:l.b-n.b,a:l.a-n.a})}else for(let t=0;t<o;t++)i.push(e[t]-h[t]);else-1!==Jt.indexOf(t)?(h=m.colorToRGBA(h),l=m.colorToRGBA(e),i={r:l.r-h.r,g:l.g-h.g,b:l.b-h.b,a:l.a-h.a}):i=e-h;te.attrs[r][this._id][t]={start:h,diff:i,end:e,trueEnd:a,trueStart:s},te.tweens[r][t]=this._id}_tweenFunc(t){const e=this.node,n=te.attrs[e._id][this._id];let r,i,o,a,s,l,u,h;for(r in n){if(i=n[r],o=i.start,a=i.diff,h=i.end,m._isArray(o))if(s=[],u=Math.max(o.length,h.length),0===r.indexOf("fill"))for(l=0;l<u;l++)l%2==0?s.push((o[l]||0)+a[l]*t):s.push("rgba("+Math.round(o[l].r+a[l].r*t)+","+Math.round(o[l].g+a[l].g*t)+","+Math.round(o[l].b+a[l].b*t)+","+(o[l].a+a[l].a*t)+")");else for(l=0;l<u;l++)s.push((o[l]||0)+a[l]*t);else s=-1!==Jt.indexOf(r)?"rgba("+Math.round(o.r+a.r*t)+","+Math.round(o.g+a.g*t)+","+Math.round(o.b+a.b*t)+","+(o.a+a.a*t)+")":o+a*t;e.setAttr(r,s)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const t=this.node,e=te.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const t=this.node,e=te.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const t=this.node._id,e=this._id,n=te.tweens[t];this.pause(),this.anim&&this.anim.stop();for(const e in n)delete te.tweens[t][e];delete te.attrs[t][e],te.tweens[t]&&(0===Object.keys(te.tweens[t]).length&&delete te.tweens[t],0===Object.keys(te.attrs[t]).length&&delete te.attrs[t])}}te.attrs={},te.tweens={},J.prototype.to=function(t){const e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()};new te(t).play()};const ee={BackEaseIn(t,e,n,r){const i=1.70158;return n*(t/=r)*t*((i+1)*t-i)+e},BackEaseOut(t,e,n,r){const i=1.70158;return n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},BackEaseInOut(t,e,n,r){let i=1.70158;return(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},ElasticEaseIn(t,e,n,r,i,o){let a=0;return 0===t?e:1===(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,n,r,i,o){let a=0;return 0===t?e:1===(t/=r)?e+n:(o||(o=.3*r),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-a)*(2*Math.PI)/o)+n+e)},ElasticEaseInOut(t,e,n,r,i,o){let a=0;return 0===t?e:2==(t/=r/2)?e+n:(o||(o=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,a=o/4):a=o/(2*Math.PI)*Math.asin(n/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/o)*.5+n+e)},BounceEaseOut:(t,e,n,r)=>(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,n,r)=>n-ee.BounceEaseOut(r-t,0,n,r)+e,BounceEaseInOut:(t,e,n,r)=>t<r/2?.5*ee.BounceEaseIn(2*t,0,n,r)+e:.5*ee.BounceEaseOut(2*t-r,0,n,r)+.5*n+e,EaseIn:(t,e,n,r)=>n*(t/=r)*t+e,EaseOut:(t,e,n,r)=>-n*(t/=r)*(t-2)+e,EaseInOut:(t,e,n,r)=>(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,r)=>n*(t/=r)*t*t*t*t+e,StrongEaseOut:(t,e,n,r)=>n*((t=t/r-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,r)=>(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,r)=>n*t/r+e},ne=m._assign(r,{Util:m,Transform:a,Node:J,Container:$,Stage:Ot,stages:Dt,Layer:Xt,FastLayer:Vt,Group:Yt,DD:A,Shape:Ht,shapes:jt,Animation:qt,Tween:te,Easings:ee,Context:w,Canvas:x});function re(t,e,n,r,i,o,a){const s=Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(i-n,2)+Math.pow(o-r,2)),u=a*s/(s+l),h=a*l/(s+l);return[n-u*(i-t),r-u*(o-e),n+h*(i-t),r+h*(o-e)]}function ie(t,e){const n=t.length,r=[];for(let i=2;i<n-2;i+=2){const n=re(t[i-2],t[i-1],t[i],t[i+1],t[i+2],t[i+3],e);isNaN(n[0])||(r.push(n[0]),r.push(n[1]),r.push(t[i]),r.push(t[i+1]),r.push(n[2]),r.push(n[3]))}return r}class oe extends Ht{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){const e=this.points(),n=e.length,r=this.tension(),i=this.closed(),o=this.bezier();if(!n)return;let a=0;if(t.beginPath(),t.moveTo(e[0],e[1]),0!==r&&n>4){const r=this.getTensionPoints(),o=r.length;for(a=i?0:4,i||t.quadraticCurveTo(r[0],r[1],r[2],r[3]);a<o-2;)t.bezierCurveTo(r[a++],r[a++],r[a++],r[a++],r[a++],r[a++]);i||t.quadraticCurveTo(r[o-2],r[o-1],e[n-2],e[n-1])}else if(o)for(a=2;a<n;)t.bezierCurveTo(e[a++],e[a++],e[a++],e[a++],e[a++],e[a++]);else for(a=2;a<n;a+=2)t.lineTo(e[a],e[a+1]);i?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():ie(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),e=t.length,n=this.tension(),r=re(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),i=re(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),o=ie(t,n);return[r[2],r[3]].concat(o).concat([i[0],i[1],t[e-2],t[e-1],i[2],i[3],r[0],r[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points();let e,n,r=t[0],i=t[0],o=t[1],a=t[1];for(let s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],r=Math.min(r,e),i=Math.max(i,e),o=Math.min(o,n),a=Math.max(a,n);return{x:r,y:o,width:i-r,height:a-o}}}oe.prototype.className="Line",oe.prototype._attrsAffectingSize=["points","bezier","tension"],i(oe),B.addGetterSetter(oe,"closed",!1),B.addGetterSetter(oe,"bezier",!1),B.addGetterSetter(oe,"tension",0,P()),B.addGetterSetter(oe,"points",[],function(){if(r.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(m._isArray(t)?t.forEach(function(t){m._isNumber(t)||m.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):m.warn(E(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());class ae extends Ht{_sceneFunc(t){const e=this.cornerRadius(),n=this.width(),r=this.height();t.beginPath(),e?m.drawRoundedRectPath(t,n,r,e):t.rect(0,0,n,r),t.closePath(),t.fillStrokeShape(this)}}function se(t){return[...t].reduce((t,e,n,r)=>{if(/\p{Emoji}/u.test(e)){const i=r[n+1];i&&/\p{Emoji_Modifier}|\u200D/u.test(i)?(t.push(e+i),r[n+1]=""):t.push(e)}else/\p{Regional_Indicator}{2}/u.test(e+(r[n+1]||""))?t.push(e+r[n+1]):n>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(e)?t[t.length-1]+=e:e&&t.push(e);return t},[])}ae.prototype.className="Rect",i(ae),B.addGetterSetter(ae,"cornerRadius",0,function(t){if(r.isUnminified)return function(e,n){let r=m._isNumber(e),i=m._isArray(e)&&e.length==t;return r||i||m.warn(E(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}(4));const le="auto",ue="inherit",he="justify",ce="left",de="middle",fe="normal",pe=" ",ge="none",me=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],ve=me.length;let ye;function _e(){return ye||(ye=m.createCanvasElement().getContext("2d"),ye)}class be extends Ht{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<ve;t++)this.on(me[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e,n;const i=this.textArr,o=i.length;if(!this.text())return;let a,s=this.padding(),l=this.fontSize(),u=this.lineHeight()*l,h=this.verticalAlign(),c=this.direction(),d=0,f=this.align(),p=this.getWidth(),g=this.letterSpacing(),m=this.charRenderFunc(),v=this.fill(),y=this.textDecoration(),_=-1!==y.indexOf("underline"),b=-1!==y.indexOf("line-through");c=c===ue?t.direction:c;let w=u/2,S=de;if(!r.legacyTextRendering){const t=this.measureSize("M");S="alphabetic";w=((null!==(e=t.fontBoundingBoxAscent)&&void 0!==e?e:t.actualBoundingBoxAscent)-(null!==(n=t.fontBoundingBoxDescent)&&void 0!==n?n:t.actualBoundingBoxDescent))/2+u/2}for("rtl"===c&&t.setAttr("direction",c),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",S),t.setAttr("textAlign",ce),h===de?d=(this.getHeight()-o*u-2*s)/2:"bottom"===h&&(d=this.getHeight()-o*u-2*s),t.translate(s,d+s),a=0;a<o;a++){let e=0,n=0;const h=i[a],d=h.text,y=h.width,S=h.lastInParagraph;if(t.save(),"right"===f?e+=p-y-2*s:"center"===f&&(e+=(p-y-2*s)/2),_){t.save(),t.beginPath();const i=e,o=w+n+(r.legacyTextRendering?Math.round(l/2):Math.round(l/4));t.moveTo(i,o);const a=f!==he||S?y:p-2*s;t.lineTo(i+Math.round(a),o),t.lineWidth=l/15;const u=this._getLinearGradient();t.strokeStyle=u||v,t.stroke(),t.restore()}const k=e;if("rtl"===c||0===g&&f!==he&&!m)0!==g&&t.setAttr("letterSpacing",`${g}px`),this._partialTextX=e,this._partialTextY=w+n,this._partialText=d,t.fillStrokeShape(this);else{const r=d.split(" ").length-1,o=se(d);for(let l=0;l<o.length;l++){const u=o[l];if(" "!==u||S||f!==he||(e+=(p-2*s-y)/r),this._partialTextX=e,this._partialTextY=w+n,this._partialText=u,m){t.save();m({char:u,index:l+i.slice(0,a).reduce((t,e)=>t+se(e.text).length,0),x:e,y:w+n,lineIndex:a,column:l,isLastInLine:S,width:this.measureSize(u).width,context:t})}t.fillStrokeShape(this),m&&t.restore(),e+=this.measureSize(u).width+g}}if(b){t.save(),t.beginPath();const e=r.legacyTextRendering?0:-Math.round(l/4),i=k;t.moveTo(i,w+n+e);const o=f!==he||S?y:p-2*s;t.lineTo(i+Math.round(o),w+n+e),t.lineWidth=l/15;const a=this._getLinearGradient();t.strokeStyle=a||v,t.stroke(),t.restore()}t.restore(),o>1&&(w+=u)}}_hitFunc(t){const e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(t){const e=m._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===le||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===le||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return m.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n,r,i,o,a,s,l,u,h,c;let d,f=_e(),p=this.fontSize();f.save(),f.font=this._getContextFont(),d=f.measureText(t),f.restore();const g=p/100;return{actualBoundingBoxAscent:null!==(e=d.actualBoundingBoxAscent)&&void 0!==e?e:71.58203125*g,actualBoundingBoxDescent:null!==(n=d.actualBoundingBoxDescent)&&void 0!==n?n:0,actualBoundingBoxLeft:null!==(r=d.actualBoundingBoxLeft)&&void 0!==r?r:-7.421875*g,actualBoundingBoxRight:null!==(i=d.actualBoundingBoxRight)&&void 0!==i?i:75.732421875*g,alphabeticBaseline:null!==(o=d.alphabeticBaseline)&&void 0!==o?o:0,emHeightAscent:null!==(a=d.emHeightAscent)&&void 0!==a?a:100*g,emHeightDescent:null!==(s=d.emHeightDescent)&&void 0!==s?s:-20*g,fontBoundingBoxAscent:null!==(l=d.fontBoundingBoxAscent)&&void 0!==l?l:91*g,fontBoundingBoxDescent:null!==(u=d.fontBoundingBoxDescent)&&void 0!==u?u:21*g,hangingBaseline:null!==(h=d.hangingBaseline)&&void 0!==h?h:72.80000305175781*g,ideographicBaseline:null!==(c=d.ideographicBaseline)&&void 0!==c?c:-21*g,width:d.width,height:p}}_getContextFont(){return this.fontStyle()+pe+this.fontVariant()+pe+(this.fontSize()+"px ")+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){this.align()===he&&(t=t.trim());const e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){const e=this.letterSpacing(),n=t.length;return _e().measureText(t).width+e*n}_setTextData(){let t=this.text().split("\n"),e=+this.fontSize(),n=0,r=this.lineHeight()*e,i=this.attrs.width,o=this.attrs.height,a=i!==le&&void 0!==i,s=o!==le&&void 0!==o,l=this.padding(),u=i-2*l,h=o-2*l,c=0,d=this.wrap(),f="char"!==d&&d!==ge,p=this.ellipsis();this.textArr=[],_e().font=this._getContextFont();const g=p?this._getTextWidth(""):0;for(let e=0,i=t.length;e<i;++e){let o=t[e],l=this._getTextWidth(o);if(a&&l>u)for(;o.length>0;){let t=0,e=se(o).length,i="",a=0;for(;t<e;){const n=t+e>>>1,l=se(o).slice(0,n+1).join(""),d=this._getTextWidth(l);(p&&s&&c+r>h?d+g:d)<=u?(t=n+1,i=l,a=d):e=n}if(!i)break;if(f){const e=se(o),n=se(i),r=e[n.length];let s;if((r===pe||"-"===r)&&a<=u)s=n.length;else{const t=n.lastIndexOf(pe),e=n.lastIndexOf("-");s=Math.max(t,e)+1}s>0&&(t=s,i=e.slice(0,t).join(""),a=this._getTextWidth(i))}i=i.trimRight(),this._addTextLine(i),n=Math.max(n,a),c+=r;if(this._shouldHandleEllipsis(c)){this._tryToAddEllipsisToLastLine();break}if(o=se(o).slice(t).join("").trimLeft(),o.length>0&&(l=this._getTextWidth(o),l<=u)){this._addTextLine(o),c+=r,n=Math.max(n,l);break}}else this._addTextLine(o),c+=r,n=Math.max(n,l),this._shouldHandleEllipsis(c)&&e<i-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),s&&c+r>h)break}this.textHeight=e,this.textWidth=n}_shouldHandleEllipsis(t){const e=+this.fontSize(),n=this.lineHeight()*e,r=this.attrs.height,i=r!==le&&void 0!==r,o=r-2*this.padding();return!(this.wrap()!==ge)||i&&t+n>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,e=t!==le&&void 0!==t,n=t-2*this.padding(),r=this.ellipsis(),i=this.textArr[this.textArr.length-1];if(i&&r){if(e){this._getTextWidth(i.text+"")<n||(i.text=i.text.slice(0,i.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(i.text+"")}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas()}}function we(t,e){this._waveformData=t,this._channelIndex=e}be.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},be.prototype._strokeFunc=function(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},be.prototype.className="Text",be.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],i(be),B.overWriteSetter(be,"width",I()),B.overWriteSetter(be,"height",I()),B.addGetterSetter(be,"direction",ue),B.addGetterSetter(be,"fontFamily","Arial"),B.addGetterSetter(be,"fontSize",12,P()),B.addGetterSetter(be,"fontStyle",fe),B.addGetterSetter(be,"fontVariant",fe),B.addGetterSetter(be,"padding",0,P()),B.addGetterSetter(be,"align",ce),B.addGetterSetter(be,"verticalAlign","top"),B.addGetterSetter(be,"lineHeight",1,P()),B.addGetterSetter(be,"wrap","word"),B.addGetterSetter(be,"ellipsis",!1,O()),B.addGetterSetter(be,"letterSpacing",0,P()),B.addGetterSetter(be,"text","",M()),B.addGetterSetter(be,"textDecoration",""),B.addGetterSetter(be,"charRenderFunc",void 0),we.prototype.min_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._at(e)},we.prototype.max_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._at(e)},we.prototype.set_min_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._set_at(n,e)},we.prototype.set_max_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._set_at(n,e)},we.prototype.min_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.min_sample(n));return e},we.prototype.max_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.max_sample(n));return e};function Se(t){for(var e=t.scale,n=t.amplitude_scale,r=t.split_channels,i=t.length,o=t.sample_rate,a=t.channels.map(function(t){return new Float32Array(t)}),s=r?a.length:1,l=function(t,e){var n=Math.floor(t/e);return t-n*e>0&&n++,n}(i,e),u=8===t.bits?1:2,h=new ArrayBuffer(24+2*l*u*s),c=new DataView(h),d=0,f=24,p=new Array(s),g=new Array(s),m=0;m<s;m++)p[m]=1/0,g[m]=-1/0;var v=8===t.bits?-128:-32768,y=8===t.bits?127:32767;c.setInt32(0,2,!0),c.setUint32(4,8===t.bits,!0),c.setInt32(8,o,!0),c.setInt32(12,e,!0),c.setInt32(16,l,!0),c.setInt32(20,s,!0);for(var _=0;_<i;_++){var b=0;if(1===s){for(var w=0;w<a.length;++w)b+=a[w][_];(b=Math.floor(y*b*n/a.length))<p[0]&&(p[0]=b,p[0]<v&&(p[0]=v)),b>g[0]&&(g[0]=b,g[0]>y&&(g[0]=y))}else for(var S=0;S<s;++S)(b=Math.floor(y*a[S][_]*n))<p[S]&&(p[S]=b,p[S]<v&&(p[S]=v)),b>g[S]&&(g[S]=b,g[S]>y&&(g[S]=y));if(++d===e){for(var k=0;k<s;k++)8===t.bits?(c.setInt8(f++,p[k]),c.setInt8(f++,g[k])):(c.setInt16(f,p[k],!0),c.setInt16(f+2,g[k],!0),f+=4),p[k]=1/0,g[k]=-1/0;d=0}}if(d>0)for(var x=0;x<s;x++)8===t.bits?(c.setInt8(f++,p[x]),c.setInt8(f++,g[x])):(c.setInt16(f,p[x],!0),c.setInt16(f+2,g[x],!0));return h}function ke(t){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(t)}function xe(t){return null==t}function Ce(t,e,n){var r=function(t){return atob(t)}(t),i=r.indexOf("\n",10)+1,o=r.substring(i)+"",a=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(a)}function Te(t,e,n){var r;return function(e){return r=r||Ce(t),new Worker(r,e)}}var Ae=Te("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgdmFyIElOVDE2X01BWCA9IDMyNzY3OwogIHZhciBJTlQxNl9NSU4gPSAtMzI3Njg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgaGVhZGVyX3NpemUgPSAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciBieXRlc19wZXJfc2FtcGxlID0gb3B0aW9ucy5iaXRzID09PSA4ID8gMSA6IDI7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogYnl0ZXNfcGVyX3NhbXBsZSAqIG91dHB1dF9jaGFubmVsczsKICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxfc2l6ZSk7CiAgICB2YXIgZGF0YV92aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB2YXIgc2NhbGVfY291bnRlciA9IDA7CiAgICB2YXIgb2Zmc2V0ID0gaGVhZGVyX3NpemU7CiAgICB2YXIgbWluX3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICB2YXIgbWF4X3ZhbHVlID0gbmV3IEFycmF5KG91dHB1dF9jaGFubmVscyk7CiAgICBmb3IgKHZhciBjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CiAgICB2YXIgcmFuZ2VfbWluID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NSU4gOiBJTlQxNl9NSU47CiAgICB2YXIgcmFuZ2VfbWF4ID0gb3B0aW9ucy5iaXRzID09PSA4ID8gSU5UOF9NQVggOiBJTlQxNl9NQVg7CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMCwgMiwgdHJ1ZSk7IC8vIFZlcnNpb24KICAgIGRhdGFfdmlldy5zZXRVaW50MzIoNCwgb3B0aW9ucy5iaXRzID09PSA4LCB0cnVlKTsgLy8gSXMgOCBiaXQ/CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoOCwgc2FtcGxlX3JhdGUsIHRydWUpOyAvLyBTYW1wbGUgcmF0ZQogICAgZGF0YV92aWV3LnNldEludDMyKDEyLCBzY2FsZSwgdHJ1ZSk7IC8vIFNjYWxlCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMTYsIGRhdGFfbGVuZ3RoLCB0cnVlKTsgLy8gTGVuZ3RoCiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMjAsIG91dHB1dF9jaGFubmVscywgdHJ1ZSk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzYW1wbGUgPSAwOwogICAgICBpZiAob3V0cHV0X2NoYW5uZWxzID09PSAxKSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwgPSAwOyBfY2hhbm5lbCA8IGNoYW5uZWxzLmxlbmd0aDsgKytfY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlICs9IGNoYW5uZWxzW19jaGFubmVsXVtpXTsKICAgICAgICB9CiAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBzYW1wbGUgKiBhbXBsaXR1ZGVfc2NhbGUgLyBjaGFubmVscy5sZW5ndGgpOwogICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbMF0pIHsKICAgICAgICAgIG1pbl92YWx1ZVswXSA9IHNhbXBsZTsKICAgICAgICAgIGlmIChtaW5fdmFsdWVbMF0gPCByYW5nZV9taW4pIHsKICAgICAgICAgICAgbWluX3ZhbHVlWzBdID0gcmFuZ2VfbWluOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlWzBdKSB7CiAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWF4X3ZhbHVlWzBdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgIG1heF92YWx1ZVswXSA9IHJhbmdlX21heDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgX2NoYW5uZWwyID0gMDsgX2NoYW5uZWwyIDwgb3V0cHV0X2NoYW5uZWxzOyArK19jaGFubmVsMikgewogICAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBjaGFubmVsc1tfY2hhbm5lbDJdW2ldICogYW1wbGl0dWRlX3NjYWxlKTsKICAgICAgICAgIGlmIChzYW1wbGUgPCBtaW5fdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtaW5fdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtfY2hhbm5lbDJdIDwgcmFuZ2VfbWluKSB7CiAgICAgICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9taW47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzYW1wbGUgPiBtYXhfdmFsdWVbX2NoYW5uZWwyXSkgewogICAgICAgICAgICBtYXhfdmFsdWVbX2NoYW5uZWwyXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1heF92YWx1ZVtfY2hhbm5lbDJdID4gcmFuZ2VfbWF4KSB7CiAgICAgICAgICAgICAgbWF4X3ZhbHVlW19jaGFubmVsMl0gPSByYW5nZV9tYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKHZhciBfY2hhbm5lbDMgPSAwOyBfY2hhbm5lbDMgPCBvdXRwdXRfY2hhbm5lbHM7IF9jaGFubmVsMysrKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtaW5fdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50MTYob2Zmc2V0LCBtaW5fdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQxNihvZmZzZXQgKyAyLCBtYXhfdmFsdWVbX2NoYW5uZWwzXSwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgfQogICAgICAgICAgbWluX3ZhbHVlW19jaGFubmVsM10gPSBJbmZpbml0eTsKICAgICAgICAgIG1heF92YWx1ZVtfY2hhbm5lbDNdID0gLUluZmluaXR5OwogICAgICAgIH0KICAgICAgICBzY2FsZV9jb3VudGVyID0gMDsKICAgICAgfQogICAgfQogICAgaWYgKHNjYWxlX2NvdW50ZXIgPiAwKSB7CiAgICAgIGZvciAodmFyIF9jaGFubmVsNCA9IDA7IF9jaGFubmVsNCA8IG91dHB1dF9jaGFubmVsczsgX2NoYW5uZWw0KyspIHsKICAgICAgICBpZiAob3B0aW9ucy5iaXRzID09PSA4KSB7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWluX3ZhbHVlW19jaGFubmVsNF0pOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtfY2hhbm5lbDRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW19jaGFubmVsNF0sIHRydWUpOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCArIDIsIG1heF92YWx1ZVtfY2hhbm5lbDRdLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBidWZmZXI7CiAgfQoKICBvbm1lc3NhZ2UgPSBmdW5jdGlvbiBvbm1lc3NhZ2UoZXZ0KSB7CiAgICB2YXIgYnVmZmVyID0gZ2VuZXJhdGVXYXZlZm9ybURhdGEoZXZ0LmRhdGEpOwoKICAgIC8vIFRyYW5zZmVyIGJ1ZmZlciB0byB0aGUgY2FsbGluZyB0aHJlYWQKICAgIHRoaXMucG9zdE1lc3NhZ2UoYnVmZmVyLCBbYnVmZmVyXSk7CiAgICB0aGlzLmNsb3NlKCk7CiAgfTsKCn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdhdmVmb3JtLWRhdGEtd29ya2VyLmpzLm1hcAoK");function Ee(t){if(function(t){return t&&"object"===ke(t)&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t}(t)&&(t=function(t){var e=t.data,n=t.channels||1,r=8===t.bits?1:2,i=2*t.length*n;if(e.length!==i)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var o=24+e.length*r,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===t.bits,!0),s.setInt32(8,t.sample_rate,!0),s.setInt32(12,t.samples_per_pixel,!0),s.setInt32(16,t.length,!0),s.setInt32(20,n,!0);var l=24;if(8===t.bits)for(var u=0;u<e.length;u++)s.setInt8(l++,e[u],!0);else for(var h=0;h<e.length;h++)s.setInt16(l,e[h],!0),l+=2;return a}(t)),!function(t){var e=t&&"object"===ke(t)&&"byteLength"in t;if(e){var n=new DataView(t).getInt32(0,!0);if(1!==n&&2!==n)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}(t))throw new TypeError("WaveformData.create(): Unknown data format");this._data=new DataView(t),this._offset=2===this._version()?24:20,this._channels=[];for(var e=0;e<this.channels;e++)this._channels[e]=new we(this,e)}var Pe=512,Ie=8,Me=1,De=!1,Oe=!1;function Le(t,e,n){var r=function(t){for(var e=[],n=0;n<t.numberOfChannels;++n)e.push(t.getChannelData(n).buffer);return e}(t);if(e.disable_worker){var i=Se({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:r});n(void 0,new Ee(i),t)}else{var o=new Ae;o.onmessage=function(e){n(void 0,new Ee(e.data),t)},o.postMessage({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:r},r)}}function Re(t){this._inputData=t.waveformData,this._output_samples_per_pixel=t.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var e=this._input_buffer_size*this._inputData.scale,n=Math.ceil(e/this._output_samples_per_pixel),r=8===this._inputData.bits?1:2,i=24+2*n*this._inputData.channels*r;this._output_data=new ArrayBuffer(i),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,8===this._inputData.bits,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,n,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new Ee(this._output_data),this._input_index=0,this._output_index=0;var o=this._inputData.channels;this._min=new Array(o),this._max=new Array(o);for(var a=0;a<o;++a)this._input_buffer_size>0?(this._min[a]=this._inputData.channel(a).min_sample(this._input_index),this._max[a]=this._inputData.channel(a).max_sample(this._input_index)):(this._min[a]=0,this._max[a]=0);this._min_value=8===this._inputData.bits?-128:-32768,this._max_value=8===this._inputData.bits?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}function Be(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}Ee.create=function(t){return new Ee(t)},Ee.createFromAudio=function(t,e){var n=function(t){return{scale:t.scale||Pe,bits:t.bits||Ie,amplitude_scale:t.amplitude_scale||Me,split_channels:t.split_channels||De,disable_worker:t.disable_worker||Oe}}(t);if(t.audio_context&&t.array_buffer)return function(t,e,n,r){function i(t){t||(t=new DOMException("EncodingError")),r(t),r=function(){}}var o=t.decodeAudioData(e,function(t){Le(t,n,r)},i);o&&o.catch(i)}(t.audio_context,t.array_buffer,n,e);if(t.audio_buffer)return Le(t.audio_buffer,n,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")},Re.prototype.sample_at_pixel=function(t){return Math.floor(t*this._output_samples_per_pixel)},Re.prototype.next=function(){for(var t,e=0,n=this._inputData.channels;this._input_index<this._input_buffer_size&&e<1e3;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(var r=0;r<n;++r)(t=this._outputWaveformData.channel(r)).set_min_sample(this._output_index-1,this._min[r]),t.set_max_sample(this._output_index-1,this._max[r]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(var i=0;i<n;++i)this._min[i]=this._max_value,this._max[i]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(var o=0;o<n;++o){var a=(t=this._inputData.channel(o)).min_sample(this._input_index);a<this._min[o]&&(this._min[o]=a),(a=t.max_sample(this._input_index))>this._max[o]&&(this._max[o]=a)}this._input_index++}e++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(var s=0;s<n;++s)(t=this._outputWaveformData.channel(s)).set_min_sample(this._output_index-1,this._min[s]),t.set_max_sample(this._output_index-1,this._max[s]);return!0},Re.prototype.getOutputData=function(){return this._output_data},Ee.prototype={_getResampleOptions:function(t){var e={};if(e.scale=t.scale,e.width=t.width,!xe(e.width)&&("number"!=typeof e.width||e.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(!xe(e.scale)&&("number"!=typeof e.scale||e.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!e.scale&&!e.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(e.width&&(e.scale=Math.floor(this.duration*this.sample_rate/e.width)),e.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+e.scale+" too low, minimum: "+this.scale);return e.abortSignal=t.abortSignal,e},resample:function(t){(t=this._getResampleOptions(t)).waveformData=this;for(var e=new Re(t);!e.next(););return new Ee(e.getOutputData())},concat:function(){var t=this,e=Array.prototype.slice.call(arguments);e.forEach(function(e){if(t.channels!==e.channels||t.sample_rate!==e.sample_rate||t.bits!==e.bits||t.scale!==e.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")});var n=this._concatBuffers.apply(this,e);return Ee.create(n)},_concatBuffers:function(){for(var t=Array.prototype.slice.call(arguments),e=this._offset,n=e,r=0,i=[this].concat(t).map(function(t){return t._data.buffer}),o=0;o<i.length;o++){var a=i[o],s=new DataView(a).getInt32(16,!0);n+=a.byteLength-e,r+=s}for(var l=new ArrayBuffer(n),u=new DataView(i[0]),h=new DataView(l),c=0;c<e;c++)h.setUint8(c,u.getUint8(c));h.setInt32(16,r,!0);for(var d=0,f=new Uint8Array(l,e),p=0;p<i.length;p++){var g=i[p];f.set(new Uint8Array(g,e),d),d+=g.byteLength-e}return l},slice:function(t){var e=0,n=0;if(xe(t.startIndex)||xe(t.endIndex)?xe(t.startTime)||xe(t.endTime)||(e=this.at_time(t.startTime),n=this.at_time(t.endTime)):(e=t.startIndex,n=t.endIndex),e<0)throw new RangeError("startIndex or startTime must not be negative");if(n<0)throw new RangeError("endIndex or endTime must not be negative");e>this.length&&(e=this.length),n>this.length&&(n=this.length),e>n&&(e=n);var r=n-e,i=8===this.bits?1:2,o=24+2*r*this.channels*i,a=new ArrayBuffer(o),s=new DataView(a);s.setInt32(0,2,!0),s.setUint32(4,8===this.bits,!0),s.setInt32(8,this.sample_rate,!0),s.setInt32(12,this.scale,!0),s.setInt32(16,r,!0),s.setInt32(20,this.channels,!0);for(var l=0;l<r*this.channels*2;l++){var u=this._at(e*this.channels*2+l);8===this.bits?s.setInt8(24+l,u):s.setInt16(24+2*l,u,!0)}return new Ee(a)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return 2===this._version()?this._data.getInt32(20,!0):1},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return 8===this.bits?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+2*t,!0)},_set_at:function(t,e){return 8===this.bits?this._data.setInt8(this._offset+t,e):this._data.setInt16(this._offset+2*t,e,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},e=0;e<this.length;e++)for(var n=0;n<this.channels;n++)t.data.push(this.channel(n).min_sample(e)),t.data.push(this.channel(n).max_sample(e));return t},toArrayBuffer:function(){return this._data.buffer}};var Fe,Ue={exports:{}};var We=(Fe||(Fe=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],s]:t._events[l].push(s):(t._events[l]=s,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var l,u,h=this._events[s],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,i),!0;case 5:return h.fn.call(h.context,e,r,i,o),!0;case 6:return h.fn.call(h.context,e,r,i,o,a),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var d,f=h.length;for(u=0;u<f;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),c){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,r);break;case 4:h[u].fn.call(h[u].context,e,r,i);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];h[u].fn.apply(h[u].context,l)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var l=0,u=[],h=s.length;l<h;l++)(s[l].fn!==e||i&&!s[l].once||r&&s[l].context!==r)&&u.push(s[l]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}(Ue)),Ue.exports),Ge=Be(We);function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function He(t,e,n){this.time=t,this.type=e,this.id=n}function Ne(t,e){for(t=t.toString();t.length<e;)t="0"+t;return t}function ze(t,e){var n=[],r=Math.floor(t%1*Math.pow(10,e)),i=Math.floor(t),o=Math.floor(i/60),a=Math.floor(o/60);a>0&&n.push(a),n.push(o%60),n.push(i%60);for(var s=0;s<n.length;s++)n[s]=Ne(n[s],2);return n=n.join(":"),e>0&&(n+="."+Ne(r,e)),n}function Xe(t,e,n){return t<e?e:t>n?n:t}function Ve(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ye(t,e){for(var n in e)Ve(e,n)&&(t[n]=e[n]);return t}function Ze(t){return"number"==typeof t}function qe(t){return"number"==typeof t&&Number.isFinite(t)}function Ke(t){return null!==t&&"object"===je(t)&&!Array.isArray(t)}function Je(t){return"string"==typeof t}function Qe(t){return null==t}function $e(t){return!0===t||!1===t}function tn(t){return t instanceof HTMLElement}function en(t){return Ke(t)&&Ve(t,"linearGradientStart")&&Ve(t,"linearGradientEnd")&&Ve(t,"linearGradientColorStops")&&Ze(t.linearGradientStart)&&Ze(t.linearGradientEnd)&&function(t){return Array.isArray(t)}(t.linearGradientColorStops)&&2===t.linearGradientColorStops.length}function nn(t){for(;null!==t.parent;){if(t.parent instanceof ne.Layer)return t;t=t.parent}return null}He.POINT=0,He.SEGMENT_START=1,He.SEGMENT_END=2,He.sorter=function(t,e){return t.time-e.time};var rn=/HeadlessChrome/.test(navigator.userAgent);var on=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,an=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,sn={forward:{},reverse:{}};sn.forward[He.POINT]=0,sn.forward[He.SEGMENT_START]=1,sn.forward[He.SEGMENT_END]=2,sn.reverse[He.POINT]=0,sn.reverse[He.SEGMENT_START]=2,sn.reverse[He.SEGMENT_END]=1;var ln={0:"points.enter",1:"segments.enter",2:"segments.exit"},un={};function hn(t,e){switch(e.type){case He.POINT:return t.points.getPoint(e.id);case He.SEGMENT_START:case He.SEGMENT_END:return t.segments.getSegment(e.id);default:throw new Error("getPointOrSegment: id not found?")}}function cn(t){this._cues=[],this._peaks=t,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}function dn(t){return function(e){return e.id===t}}un[0]="point",un[1]="segment",un[2]="segment",cn.prototype._updateCues=function(){var t=this,e=t._peaks.points.getPoints(),n=t._peaks.segments.getSegments();t._cues.length=0,e.forEach(function(e){t._cues.push(new He(e.time,He.POINT,e.id))}),n.forEach(function(e){t._cues.push(new He(e.startTime,He.SEGMENT_START,e.id)),t._cues.push(new He(e.endTime,He.SEGMENT_END,e.id))}),t._cues.sort(He.sorter);var r=t._peaks.player.getCurrentTime();t._updateActiveSegments(r)},cn.prototype._onUpdate=function(t,e){var n,r,i,o=t>e;o?(n=0,r=this._cues.length,i=1):(n=this._cues.length-1,r=-1,i=-1);for(var a=n;o?a<r:a>r;a+=i){var s=this._cues[a];if(o?s.time>e:s.time<e){if(o?s.time>t:s.time<t)break;var l=hn(this._peaks,s),u=o?sn.forward[s.type]:sn.reverse[s.type];1===u?this._activeSegments[l.id]=l:2===u&&delete this._activeSegments[l.id];var h={time:t};h[un[u]]=l,this._peaks.emit(ln[u],h)}}},cn.prototype._onTimeUpdate=function(t){(rn||navigator.webdriver||"object"!==("undefined"==typeof document?"undefined":je(document))||!("visibilityState"in document)||"visible"!==document.visibilityState)&&(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(t,this._previousTime),this._previousTime=t)},cn.prototype._onAnimationFrame=function(){var t=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(t,this._previousTime),this._previousTime=t,this._peaks.player.isPlaying()&&(this._rAFHandle=on(this._onAnimationFrame))},cn.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=on(this._onAnimationFrame)},cn.prototype._onSeeked=function(t){this._previousTime=t,this._updateActiveSegments(t)},cn.prototype._updateActiveSegments=function(t){var e=this,n=e._peaks.segments.getSegmentsAtTime(t);for(var r in e._activeSegments){if(Ve(e._activeSegments,r))n.find(dn(r))||(e._peaks.emit("segments.exit",{segment:e._activeSegments[r],time:t}),delete e._activeSegments[r])}n.forEach(function(n){n.id in e._activeSegments||(e._activeSegments[n.id]=n,e._peaks.emit("segments.enter",{segment:n,time:t}))})};var fn=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];cn.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var t=0;t<fn.length;t++)this._peaks.on(fn[t],this._updateCues);this._updateCues()},cn.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var t=0;t<fn.length;t++)this._peaks.off(fn[t],this._updateCues)},cn.prototype.destroy=function(){this._rAFHandle&&(an(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var pn=["id","pid","time","labelText","color","editable"],gn=["update","isVisible","peaks","pid"];function mn(t,e){var n=e?"update()":"add()";if((!e||e&&Ve(t,"time"))&&!qe(t.time))throw new TypeError("peaks.points."+n+": time should be a numeric value");if(t.time<0)throw new RangeError("peaks.points."+n+": time should not be negative");if(Ve(t,"labelText")&&!Je(t.labelText))throw new TypeError("peaks.points."+n+": labelText must be a string");if(Ve(t,"editable")&&!$e(t.editable))throw new TypeError("peaks.points."+n+": editable must be true or false");if(Ve(t,"color")&&!Je(t.color)&&!en(t.color))throw new TypeError("peaks.points."+n+": color must be a string or a valid linear gradient object");gn.forEach(function(e){if(Ve(t,e))throw new Error("peaks.points."+n+": invalid option name: "+e)}),pn.forEach(function(e){if(Ve(t,"_"+e))throw new Error("peaks.points."+n+": invalid option name: _"+e)})}function vn(t,e,n){this._peaks=t,this._pid=e,this._setUserData(n)}function yn(t){this._peaks=t,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}vn.prototype._setUserData=function(t){for(var e in t)Ve(t,e)&&(-1===pn.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(vn.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}}),vn.prototype.update=function(t){if(mn(t,!0),Ve(t,"id")){if(Qe(t.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,t.id)}this._setUserData(t),this._peaks.emit("points.update",this,t)},vn.prototype.isVisible=function(t,e){return this.time>=t&&this.time<e},vn.prototype._setTime=function(t){this._time=t},yn.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++},yn.prototype._getNextPid=function(){return this._pointPid++},yn.prototype._addPoint=function(t){this._points.push(t),this._pointsById[t.id]=t,this._pointsByPid[t.pid]=t},yn.prototype._createPoint=function(t){var e={};Ye(e,t),Qe(e.id)&&(e.id=this._getNextPointId());var n=this._getNextPid();return function(t,e){Qe(t.labelText)&&(t.labelText=""),Qe(t.editable)&&(t.editable=!1),Qe(t.color)&&(t.color=e.pointMarkerColor)}(e,this._peaks.options),mn(e,!1),new vn(this._peaks,n,e)},yn.prototype.getPoints=function(){return this._points},yn.prototype.getPoint=function(t){return this._pointsById[t]},yn.prototype.find=function(t,e){return this._points.filter(function(n){return n.isVisible(t,e)})},yn.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createPoint(e);if(Ve(t._pointsById,n.id))throw new Error("peaks.points.add(): duplicate id");return n}),n.forEach(function(e){t._addPoint(e)}),this._peaks.emit("points.add",{points:n}),e?n:n[0]},yn.prototype.updatePointId=function(t,e){if(this._pointsById[t.id]){if(this._pointsById[e])throw new Error("point.update(): duplicate id");delete this._pointsById[t.id],this._pointsById[e]=t}},yn.prototype._findPoint=function(t){for(var e=[],n=0,r=this._points.length;n<r;n++)t(this._points[n])&&e.push(n);return e},yn.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n]-e.length,i=this._points.splice(r,1)[0];delete this._pointsById[i.id],delete this._pointsByPid[i.pid],e.push(i)}return e},yn.prototype._removePoints=function(t){var e=this._findPoint(t),n=this._removeIndexes(e);return this._peaks.emit("points.remove",{points:n}),n},yn.prototype.remove=function(t){return this._removePoints(function(e){return e===t})},yn.prototype.removeById=function(t){return this._removePoints(function(e){return e.id===t})},yn.prototype.removeByTime=function(t){return this._removePoints(function(e){return e.time===t})},yn.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var _n=["id","pid","startTime","endTime","labelText","color","borderColor","markers","overlay","editable"],bn=["update","isVisible","peaks","pid"];function wn(t,e){var n=e?"update()":"add()";if(Ve(t,"startTime")&&!qe(t.startTime))throw new TypeError("peaks.segments."+n+": startTime should be a valid number");if(Ve(t,"endTime")&&!qe(t.endTime))throw new TypeError("peaks.segments."+n+": endTime should be a valid number");if(!(e||Ve(t,"startTime")&&Ve(t,"endTime")))throw new TypeError("peaks.segments."+n+": missing startTime or endTime");if(t.startTime<0)throw new RangeError("peaks.segments."+n+": startTime should not be negative");if(t.endTime<0)throw new RangeError("peaks.segments."+n+": endTime should not be negative");if(t.endTime<t.startTime)throw new RangeError("peaks.segments."+n+": endTime should not be less than startTime");if(Ve(t,"labelText")&&!Je(t.labelText))throw new TypeError("peaks.segments."+n+": labelText must be a string");if(e&&Ve(t,"markers"))throw new TypeError("peaks.segments."+n+": cannot update markers attribute");if(Ve(t,"markers")&&!$e(t.markers))throw new TypeError("peaks.segments."+n+": markers must be true or false");if(e&&Ve(t,"overlay"))throw new TypeError("peaks.segments."+n+": cannot update overlay attribute");if(Ve(t,"overlay")&&!$e(t.overlay))throw new TypeError("peaks.segments."+n+": overlay must be true or false");if(Ve(t,"editable")&&!$e(t.editable))throw new TypeError("peaks.segments."+n+": editable must be true or false");if(Ve(t,"color")&&!Je(t.color)&&!en(t.color))throw new TypeError("peaks.segments."+n+": color must be a string or a valid linear gradient object");if(Ve(t,"borderColor")&&!Je(t.borderColor))throw new TypeError("peaks.segments."+n+": borderColor must be a string");bn.forEach(function(e){if(Ve(t,e))throw new Error("peaks.segments."+n+": invalid option name: "+e)}),_n.forEach(function(e){if(Ve(t,"_"+e))throw new Error("peaks.segments."+n+": invalid option name: _"+e)})}function Sn(t,e,n){this._peaks=t,this._pid=e,this._id=n.id,this._startTime=n.startTime,this._endTime=n.endTime,this._labelText=n.labelText,this._color=n.color,this._borderColor=n.borderColor,this._editable=n.editable,this._markers=n.markers,this._overlay=n.overlay,this._setUserData(n)}function kn(t){this._peaks=t,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}Sn.prototype._setUserData=function(t){for(var e in t)Ve(t,e)&&(-1===_n.indexOf(e)?this[e]=t[e]:this["_"+e]=t[e])},Object.defineProperties(Sn.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},markers:{enumerable:!0,get:function(){return this._markers}},overlay:{enumerable:!0,get:function(){return this._overlay}},editable:{enumerable:!0,get:function(){return this._editable}}}),Sn.prototype.update=function(t){if(wn(t,!0),Ve(t,"id")){if(Qe(t.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,t.id)}this._setUserData(t),this._peaks.emit("segments.update",this,t)},Sn.prototype.isVisible=function(t,e){return this.startTime===this.endTime&&this.startTime===t||!(this.endTime<=t)&&!(this.startTime>=e)},Sn.prototype._setStartTime=function(t){this._startTime=t},Sn.prototype._setEndTime=function(t){this._endTime=t},kn.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++},kn.prototype._getNextPid=function(){return this._segmentPid++},kn.prototype._addSegment=function(t){this._segments.push(t),this._segmentsById[t.id]=t,this._segmentsByPid[t.pid]=t},kn.prototype._createSegment=function(t){var e={};Ye(e,t),Qe(e.id)&&(e.id=this._getNextSegmentId());var n=this._getNextPid();return function(t,e){Qe(t.color)&&(e.overlay?t.color=e.overlayColor:t.color=e.waveformColor),Qe(t.borderColor)&&(t.borderColor=e.overlayBorderColor),Qe(t.labelText)&&(t.labelText=""),Qe(t.markers)&&(t.markers=e.markers),Qe(t.overlay)&&(t.overlay=e.overlay),Qe(t.editable)&&(t.editable=!1)}(e,this._peaks.options.segmentOptions),wn(e,!1),new Sn(this._peaks,n,e)},kn.prototype.getSegments=function(){return this._segments},kn.prototype.getSegment=function(t){return this._segmentsById[t]},kn.prototype.getSegmentsAtTime=function(t){return this._segments.filter(function(e){return t>=e.startTime&&t<e.endTime})},kn.prototype.find=function(t,e){return this._segments.filter(function(n){return n.isVisible(t,e)})},kn.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(t,e){return t.startTime-e.startTime})},kn.prototype.findPreviousSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n-1]},kn.prototype.findNextSegment=function(t){var e=this._getSortedSegments(),n=e.findIndex(function(e){return e.id===t.id});if(-1!==n)return e[n+1]},kn.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),n=e?arguments[0]:Array.prototype.slice.call(arguments);return n=n.map(function(e){var n=t._createSegment(e);if(Ve(t._segmentsById,n.id))throw new Error("peaks.segments.add(): duplicate id");return n}),n.forEach(function(e){t._addSegment(e)}),this._peaks.emit("segments.add",{segments:n,insert:this._isInserting}),e?n:n[0]},kn.prototype.updateSegmentId=function(t,e){if(this._segmentsById[t.id]){if(this._segmentsById[e])throw new Error("segment.update(): duplicate id");delete this._segmentsById[t.id],this._segmentsById[e]=t}},kn.prototype._findSegment=function(t){for(var e=[],n=0,r=this._segments.length;n<r;n++)t(this._segments[n])&&e.push(n);return e},kn.prototype._removeIndexes=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n]-e.length,i=this._segments.splice(r,1)[0];delete this._segmentsById[i.id],delete this._segmentsByPid[i.pid],e.push(i)}return e},kn.prototype._removeSegments=function(t){var e=this._findSegment(t),n=this._removeIndexes(e);return this._peaks.emit("segments.remove",{segments:n}),n},kn.prototype.remove=function(t){return this._removeSegments(function(e){return e===t})},kn.prototype.removeById=function(t){return this._removeSegments(function(e){return e.id===t})},kn.prototype.removeByTime=function(t,e){var n;return n=(e="number"==typeof e?e:0)>0?function(n){return n.startTime===t&&n.endTime===e}:function(e){return e.startTime===t},this._removeSegments(n)},kn.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")},kn.prototype.setInserting=function(t){this._isInserting=t},kn.prototype.isInserting=function(){return this._isInserting};var xn=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],Cn=[32,9,37,39];function Tn(t){this.eventEmitter=t,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}function An(t){this._mediaElement=t}function En(t,e){this._eventEmitter=t,this._mediaElement=e,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}function Pn(t){var e=function(t){for(var e=[],n=t;n;)Object.getOwnPropertyNames(n).forEach(function(t){e.push(t)}),n=Object.getPrototypeOf(n);return e}(t);["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"].forEach(function(n){if(!e.includes(n))throw new TypeError("Peaks.init(): Player method "+n+" is undefined");if("function"!=typeof t[n])throw new TypeError("Peaks.init(): Player method "+n+" is not a function")})}function In(t,e){this._peaks=t,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),Pn(e),this._adapter=e}function Mn(t){this._options=t,this._draggable=t.editable}function Dn(t){this._options=t,this._editable=t.editable}function On(t){return"zoomview"===t.view?new Dn(t):null}function Ln(t){return new be({x:12,y:12,text:t.segment.labelText,textAlign:"center",fontFamily:t.fontFamily||"sans-serif",fontSize:t.fontSize||12,fontStyle:t.fontStyle||"normal",fill:"#000"})}function Rn(t){return new Mn(t)}function Bn(t,e){this._view=t,this._offset=e.highlightOffset,this._color=e.highlightColor,this._layer=new ne.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=e.highlightStrokeColor,this._opacity=e.highlightOpacity,this._cornerRadius=e.highlightCornerRadius}function Fn(t){this._point=t.point,this._marker=t.marker,this._draggable=t.draggable,this._onDragStart=t.onDragStart,this._onDragMove=t.onDragMove,this._onDragEnd=t.onDragEnd,this._dragBoundFunc=t.dragBoundFunc,this._onMouseEnter=t.onMouseEnter,this._onMouseLeave=t.onMouseLeave,this._group=new ne.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:t.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}function Un(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._pointMarkers={},this._layer=new ne.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}function Wn(t,e,n){this._player=t,this._view=e,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=n.playheadColor,this._playheadTextColor=n.playheadTextColor,this._playheadBackgroundColor=n.playheadBackgroundColor,this._playheadPadding=n.playheadPadding,this._playheadWidth=n.playheadWidth,this._playheadFontFamily=n.playheadFontFamily,this._playheadFontSize=n.playheadFontSize,this._playheadFontStyle=n.playheadFontStyle,this._playheadLayer=new ne.Layer({listening:!1}),this._createPlayhead(),n.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}function Gn(t){this._options=t}function jn(t){var e=this;e._segment=t.segment,e._marker=t.marker,e._segmentShape=t.segmentShape,e._editable=t.editable,e._startMarker=t.startMarker,e._onClick=t.onClick,e._onDragStart=t.onDragStart,e._onDragMove=t.onDragMove,e._onDragEnd=t.onDragEnd,e._group=new ne.Group({name:"segment-marker",segment:e._segment,draggable:e._editable,visible:e._editable,dragBoundFunc:function(n){return t.dragBoundFunc(e,n)}}),e._bindDefaultEventHandlers(),e._marker.init(e._group)}function Hn(t){this._color=t.color;var e={};if(Je(t.color))e.fill=t.color;else{if(!en(t.color))throw new TypeError("Unknown type for color property");var n=t.view._height*(t.color.linearGradientStart/100),r=t.view._height*(t.color.linearGradientEnd/100);e.fillLinearGradientStartPointY=n,e.fillLinearGradientEndPointY=r,e.fillLinearGradientColorStops=[0,t.color.linearGradientColorStops[0],1,t.color.linearGradientColorStops[1]]}this._shape=new ne.Shape(e),this._view=t.view,this._segment=t.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}function Nn(t,e,n,r){this._segment=t,this._peaks=e,this._layer=n,this._view=r,this._label=null,this._startMarker=null,this._endMarker=null,this._color=t.color,this._borderColor=t.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var i=r.getViewOptions(),o=i.segmentOptions;this._overlayOffset=o.overlayOffset,t.overlay||(this._waveformShape=new Hn({color:t.color,view:r,segment:t})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerClick=this._onSegmentMarkerClick.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:t,view:this._view.getName(),layer:this._layer,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStyle:i.fontStyle}),this._label&&this._label.hide();var a,s,l,u,h,c=this._view.timeToPixelOffset(this._segment.startTime),d=this._view.timeToPixelOffset(this._segment.endTime),f=Xe(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new ne.Group({name:"segment-overlay",segment:this._segment,x:c,y:0,width:d-c,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:d-c,clipHeight:f,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc}),t.overlay&&(a=this._borderColor||o.overlayBorderColor,s=o.overlayBorderWidth,l=this._color||o.overlayColor,u=o.overlayOpacity,h=o.overlayCornerRadius),this._overlayRect=new ne.Rect({x:0,y:this._overlayOffset,width:d-c,stroke:a,strokeWidth:s,height:f,fill:l,opacity:u,cornerRadius:h}),this._overlay.add(this._overlayRect),t.overlay&&(this._overlayText=new ne.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:o.overlayFontFamily,fontSize:o.overlayFontSize,fontStyle:o.overlayFontStyle,fill:o.overlayLabelColor,listening:!1,align:o.overlayLabelAlign,width:d-c,verticalAlign:o.overlayLabelVerticalAlign,height:f,padding:o.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function zn(t){return new Gn(t)}function Xn(t){return t.endTime-t.startTime}function Vn(t,e,n){this._peaks=t,this._view=e,this._enableEditing=n,this._segmentShapes={},this._layer=new ne.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}function Yn(t,e){var n=this;n._axisGridlineColor=e.axisGridlineColor,n._axisLabelColor=e.axisLabelColor,n._showAxisLabels=e.showAxisLabels,n._axisTopMarkerHeight=e.axisTopMarkerHeight,n._axisBottomMarkerHeight=e.axisBottomMarkerHeight,e.formatAxisTime?n._formatAxisTime=e.formatAxisTime:n._formatAxisTime=function(t){return ze(t,0)},n._axisLabelFont=Yn._buildFontString(e.fontFamily,e.fontSize,e.fontStyle),n._axisShape=new ne.Shape({sceneFunc:function(e){n._drawAxis(e,t)}})}function Zn(t,e,n,r){var i=this;i._container=e,i._peaks=n,i._options=n.options,i._viewOptions=r,i._originalWaveformData=t,i._data=t,i._frameOffset=0,i._width=e.clientWidth,i._height=e.clientHeight,i._amplitudeScale=1,i._waveformColor=i._viewOptions.waveformColor,i._playedWaveformColor=i._viewOptions.playedWaveformColor,i._timeLabelPrecision=i._viewOptions.timeLabelPrecision,i._viewOptions.formatPlayheadTime?i._formatPlayheadTime=i._viewOptions.formatPlayheadTime:i._formatPlayheadTime=function(t){return ze(t,i._timeLabelPrecision)},i._enableSeek=!0,i.initWaveformData(),ne.showWarnings=!1,i._stage=new ne.Stage({container:e,width:i._width,height:i._height}),i._createWaveform(),i._viewOptions.enableSegments&&(i._segmentsLayer=new Vn(n,i,i._viewOptions.enableEditing),i._segmentsLayer.addToStage(i._stage)),i._viewOptions.enablePoints&&(i._pointsLayer=new Un(n,i,i._viewOptions.enableEditing),i._pointsLayer.addToStage(i._stage)),i.initHighlightLayer(),i._createAxisLabels(),i._playheadLayer=new Wn(i._peaks.player,i,i._viewOptions),i._playheadLayer.addToStage(i._stage),i._onClick=i._onClick.bind(i),i._onDblClick=i._onDblClick.bind(i),i._onContextMenu=i._onContextMenu.bind(i),i._stage.on("click",i._onClick),i._stage.on("dblclick",i._onDblClick),i._stage.on("contextmenu",i._onContextMenu)}function qn(t,e){this._stage=t,this._handlers=e,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}function Kn(t,e){this._peaks=t,this._view=e,this._firstMove=!1,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new qn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function Jn(t,e,n){var r=this;Zn.call(r,t,e,n,n.options.overview),r._onTimeUpdate=r._onTimeUpdate.bind(r),r._onPlaying=r._onPlaying.bind(r),r._onPause=r._onPause.bind(r),r._onZoomviewUpdate=r._onZoomviewUpdate.bind(r),n.on("player.timeupdate",r._onTimeUpdate),n.on("player.playing",r._onPlaying),n.on("player.pause",r._onPause),n.on("zoomview.update",r._onZoomviewUpdate);var i=r._peaks.player.getCurrentTime();r._playheadLayer.updatePlayheadTime(i),r._mouseDragHandler=new Kn(n,r);var o=n.views.getView("zoomview");o&&r._highlightLayer.showHighlight(o.getStartTime(),o.getEndTime())}function Qn(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new qn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function $n(t,e){this._peaks=t,this._view=e,this._seeking=!1,this._firstMove=!1,this._segment=null,this._segmentIsDraggable=!1,this._initialFrameOffset=0,this._mouseDownX=0,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new qn(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}function tr(t,e,n){var r=this;Zn.call(r,t,e,n,n.options.zoomview),r._onTimeUpdate=r._onTimeUpdate.bind(r),r._onPlaying=r._onPlaying.bind(r),r._onPause=r._onPause.bind(r),r._onKeyboardLeft=r._onKeyboardLeft.bind(r),r._onKeyboardRight=r._onKeyboardRight.bind(r),r._onKeyboardShiftLeft=r._onKeyboardShiftLeft.bind(r),r._onKeyboardShiftRight=r._onKeyboardShiftRight.bind(r),r._peaks.on("player.timeupdate",r._onTimeUpdate),r._peaks.on("player.playing",r._onPlaying),r._peaks.on("player.pause",r._onPause),r._peaks.on("keyboard.left",r._onKeyboardLeft),r._peaks.on("keyboard.right",r._onKeyboardRight),r._peaks.on("keyboard.shift_left",r._onKeyboardShiftLeft),r._peaks.on("keyboard.shift_right",r._onKeyboardShiftRight),r._autoScroll=r._viewOptions.autoScroll,r._autoScrollOffset=r._viewOptions.autoScrollOffset,r._enableSegmentDragging=!1,r._segmentDragMode="overlap",r._minSegmentDragWidth=0,r._insertSegmentShape=null,r._playheadClickTolerance=r._viewOptions.playheadClickTolerance,r._zoomLevelAuto=!1,r._zoomLevelSeconds=null;var i=r._peaks.player.getCurrentTime();r._syncPlayhead(i),r._mouseDragHandler=new $n(n,r),r._onWheel=r._onWheel.bind(r),r._onWheelCaptureVerticalScroll=r._onWheelCaptureVerticalScroll.bind(r),r.setWheelMode(r._viewOptions.wheelMode),r._peaks.emit("zoomview.update",{startTime:0,endTime:r.getEndTime()})}function er(t,e){this._container=t,this._peaks=e,this._options=e.options.scrollbar,this._zoomview=e.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewUpdate=this._onZoomviewUpdate.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),this._peaks.on("zoomview.update",this._onZoomviewUpdate),this._width=t.clientWidth,this._height=t.clientHeight,this._stage=new ne.Stage({container:t,width:this._width,height:this._height}),this._layer=new ne.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new ne.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new ae({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._updateScrollbarWidthAndPosition()}function nr(t){this._peaks=t,this._overview=null,this._zoomview=null,this._scrollbar=null}function rr(t,e){this._peaks=t,this._zoomLevels=e,this._zoomLevelIndex=0}Tn.prototype._handleKeyEvent=function(t){if(-1===xn.indexOf(t.target.nodeName))if(Cn.indexOf(t.type)>-1&&t.preventDefault(),"keydown"===t.type||"keypress"===t.type)switch(t.keyCode){case 32:this.eventEmitter.emit("keyboard.space");break;case 9:this.eventEmitter.emit("keyboard.tab")}else if("keyup"===t.type)switch(t.keyCode){case 37:t.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case 39:t.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right")}},Tn.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)},An.prototype._addMediaListener=function(t,e){this._listeners.push({type:t,callback:e}),this._mediaElement.addEventListener(t,e)},An.prototype.init=function(t){var e,n=this;return n._eventEmitter=t,n._listeners=[],n._duration=n.getDuration(),n._addMediaListener("timeupdate",function(){n._eventEmitter.emit("player.timeupdate",n.getCurrentTime())}),n._addMediaListener("playing",function(){n._eventEmitter.emit("player.playing",n.getCurrentTime())}),n._addMediaListener("pause",function(){n._eventEmitter.emit("player.pause",n.getCurrentTime())}),n._addMediaListener("ended",function(){n._eventEmitter.emit("player.ended")}),n._addMediaListener("seeked",function(){n._eventEmitter.emit("player.seeked",n.getCurrentTime())}),n._addMediaListener("canplay",function(){n._eventEmitter.emit("player.canplay")}),n._addMediaListener("error",function(t){n._eventEmitter.emit("player.error",t.target.error)}),n._interval=null,(e=n._mediaElement).src||e.querySelector("source")?n._mediaElement.error&&n._mediaElement.error.code===MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED?Promise.reject(n._mediaElement.error):new Promise(function(t,e){function r(i){n._mediaElement.removeEventListener("loadedmetadata",r),n._mediaElement.removeEventListener("error",r),"loadedmetadata"===i.type?t():e(i.target.error)}n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(n._mediaElement.addEventListener("loadedmetadata",r),n._mediaElement.addEventListener("error",r),n._mediaElement.load()):t()}):Promise.resolve()},An.prototype.destroy=function(){for(var t=0;t<this._listeners.length;t++){var e=this._listeners[t];this._mediaElement.removeEventListener(e.type,e.callback)}this._listeners.length=0,this._mediaElement=null},An.prototype.play=function(){return this._mediaElement.play()},An.prototype.pause=function(){this._mediaElement.pause()},An.prototype.isPlaying=function(){return!this._mediaElement.paused},An.prototype.isSeeking=function(){return this._mediaElement.seeking},An.prototype.getCurrentTime=function(){return this._mediaElement.currentTime},An.prototype.getDuration=function(){return this._mediaElement.duration},An.prototype.seek=function(t){this._mediaElement.currentTime=t},En.prototype.setSource=function(t,e){var n=this;return n._options=t,n._callback=e,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),new Promise(function(e,r){n._resolve=e,n._reject=r,n._eventEmitter.on("player.canplay",n._playerCanPlayHandler),n._eventEmitter.on("player.error",n._playerErrorHandler),n._mediaElement.setAttribute("src",t.mediaUrl),n._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&n._mediaElement.load()})},En.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)},En.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()},En.prototype._playerErrorHandler=function(t){this._reset(),this._reject(t)},An.prototype.setSource=function(t){return t.mediaUrl?new En(this._eventEmitter,this._mediaElement).setSource(t):Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"))},In.prototype.init=function(){return this._adapter.init(this._peaks)},In.prototype.destroy=function(){this._adapter.destroy()},In.prototype.play=function(){return this._adapter.play()},In.prototype.pause=function(){this._adapter.pause()},In.prototype.isPlaying=function(){return this._adapter.isPlaying()},In.prototype.isSeeking=function(){return this._adapter.isSeeking()},In.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()},In.prototype.getDuration=function(){return this._adapter.getDuration()},In.prototype.seek=function(t){qe(t)?this._adapter.seek(t):this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds")},In.prototype.playSegment=function(t,e){var n=this;return t&&qe(t.startTime)&&qe(t.endTime)?(n._segment=t,n._loop=e,n.seek(t.startTime),n._peaks.once("player.playing",function(){n._playingSegment||(n._playingSegment=!0,window.requestAnimationFrame(n._playSegmentTimerCallback))}),n.play()):Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object"))},In.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime){if(!this._loop)return this.pause(),this._peaks.emit("player.ended"),void(this._playingSegment=!1);this.seek(this._segment.startTime)}window.requestAnimationFrame(this._playSegmentTimerCallback)}else this._playingSegment=!1},In.prototype._setSource=function(t){return this._adapter.setSource(t)},Mn.prototype.init=function(t){"zoomview"===this._options.view&&(this._label=new be({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new ae({x:-4.5,y:0,width:10,height:20,fill:this._options.color,visible:this._draggable}),this._line=new oe({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new be({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),t.add(this._handle),t.add(this._line),this._label&&t.add(this._label),t.add(this._time),this.fitToView(),this.bindEventHandlers(t)},Mn.prototype.bindEventHandlers=function(t){var e=this;e._handle.on("mouseover touchstart",function(){e._draggable&&(e._time.setX(-24-e._time.getWidth()),e._time.show())}),e._handle.on("mouseout touchend",function(){e._draggable&&e._time.hide()}),t.on("dragstart",function(){e._time.setX(-24-e._time.getWidth()),e._time.show()}),t.on("dragend",function(){e._time.hide()})},Mn.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._line.points([.5,0,.5,t]),this._label&&this._label.y(12),this._handle&&this._handle.y(t/2-10.5),this._time&&this._time.y(t/2-5)},Mn.prototype.update=function(t){void 0!==t.time&&this._time&&this._time.setText(this._options.layer.formatTime(t.time)),void 0!==t.labelText&&this._label&&this._label.text(t.labelText),void 0!==t.color&&(this._handle&&this._handle.fill(t.color),this._line.stroke(t.color)),void 0!==t.editable&&(this._draggable=t.editable,this._handle.visible(this._draggable))},Dn.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new be({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new ae({x:-4.5,y:0,width:10,height:20,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new oe({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),t.add(this._label),t.add(this._line),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},Dn.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),e._handle.on("mouseout touchend",function(){e._label.hide()})},Dn.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._label.y(t/2-5),this._handle.y(t/2-10.5),this._line.points([.5,0,.5,t])},Dn.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime)),void 0!==t.editable&&(this._editable=t.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))},Bn.prototype.addToStage=function(t){t.add(this._layer)},Bn.prototype.showHighlight=function(t,e){this._highlightRect||this._createHighlightRect(t,e),this._update(t,e)},Bn.prototype._update=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),r=this._view.timeToPixels(e);this._highlightRect.setAttrs({x:n,width:r-n})},Bn.prototype._createHighlightRect=function(t,e){this._startTime=t,this._endTime=e;var n=this._view.timeToPixels(t),r=this._view.timeToPixels(e);this._highlightRect=new ae({x:n,y:0,width:r-n,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)},Bn.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)},Bn.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)},Bn.prototype.fitToView=function(){if(this._highlightRect){var t=this._view.getHeight(),e=Xe(this._offset,0,Math.floor(t/2));this._highlightRect.setAttrs({y:e,height:t-2*e})}},Fn.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("dragstart",function(e){t._onDragStart(e,t._point)}),t._group.on("dragmove",function(e){t._onDragMove(e,t._point)}),t._group.on("dragend",function(e){t._onDragEnd(e,t._point)}),t._group.on("mouseenter",function(e){t._onMouseEnter(e,t._point)}),t._group.on("mouseleave",function(e){t._onMouseLeave(e,t._point)})},Fn.prototype.addToLayer=function(t){t.add(this._group)},Fn.prototype.fitToView=function(){this._marker.fitToView()},Fn.prototype.getPoint=function(){return this._point},Fn.prototype.getX=function(){return this._group.getX()},Fn.prototype.setX=function(t){this._group.setX(t)},Fn.prototype.getWidth=function(){return this._group.getWidth()},Fn.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},Fn.prototype.update=function(t){void 0!==t.editable&&this._group.draggable(t.editable),this._marker.update&&this._marker.update(t)},Fn.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},Un.prototype.addToStage=function(t){t.add(this._layer)},Un.prototype.setListening=function(t){this._layer.listening(t)},Un.prototype.enableEditing=function(t){this._enableEditing=t},Un.prototype.getPointMarker=function(t){return this._pointMarkers[t.pid]},Un.prototype.formatTime=function(t){return this._view.formatTime(t)},Un.prototype._onPointsUpdate=function(t,e){var n=this._view.getStartTime(),r=this._view.getEndTime(),i=this.getPointMarker(t),o=t.isVisible(n,r);if(i&&!o)this._removePoint(t);else if(!i&&o)this._updatePoint(t);else if(i&&o){if(Ve(e,"time")){var a=this._view.timeToPixels(t.time)-this._view.getFrameOffset();i.setX(a)}i.update(e)}},Un.prototype._onPointsAdd=function(t){var e=this,n=e._view.getStartTime(),r=e._view.getEndTime();t.points.forEach(function(t){t.isVisible(n,r)&&e._updatePoint(t)})},Un.prototype._onPointsRemove=function(t){var e=this;t.points.forEach(function(t){e._removePoint(t)})},Un.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}},Un.prototype._createPointMarker=function(t){var e=this._enableEditing&&t.editable,n=this._view.getViewOptions();return new Fn({point:t,draggable:e,marker:this._peaks.options.createPointMarker({point:t,editable:e,color:t.color,fontFamily:n.fontFamily,fontSize:n.fontSize,fontStyle:n.fontStyle,layer:this,view:this._view.getName()}),onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})},Un.prototype.getHeight=function(){return this._view.getHeight()},Un.prototype._addPointMarker=function(t){var e=this._createPointMarker(t);return this._pointMarkers[t.pid]=e,e.addToLayer(this._layer),e},Un.prototype._onPointsDrag=function(t){this._updatePoint(t.point).update({time:t.point.time})},Un.prototype._onPointMarkerMouseEnter=function(t,e){this._peaks.emit("points.mouseenter",{point:e,evt:t.evt})},Un.prototype._onPointMarkerMouseLeave=function(t,e){this._peaks.emit("points.mouseleave",{point:e,evt:t.evt})},Un.prototype._onPointMarkerDragStart=function(t,e){this._dragPointMarker=this.getPointMarker(e),this._peaks.emit("points.dragstart",{point:e,evt:t.evt})},Un.prototype._onPointMarkerDragMove=function(t,e){var n=this._pointMarkers[e.pid],r=n.getX()+n.getWidth();e._setTime(this._view.pixelOffsetToTime(r)),this._peaks.emit("points.dragmove",{point:e,evt:t.evt})},Un.prototype._onPointMarkerDragEnd=function(t,e){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:e,evt:t.evt})},Un.prototype._pointMarkerDragBoundFunc=function(t){return{x:Xe(t.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}},Un.prototype.updatePoints=function(t,e){this._peaks.points.find(t,e).forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(t,e)},Un.prototype._updatePoint=function(t){var e=this.getPointMarker(t);e||(e=this._addPointMarker(t));var n=this._view.timeToPixels(t.time)-this._view.getFrameOffset();return e.setX(n),e},Un.prototype._removeInvisiblePoints=function(t,e){for(var n in this._pointMarkers)if(Ve(this._pointMarkers,n)){var r=this._pointMarkers[n].getPoint();r.isVisible(t,e)||this._removePoint(r)}},Un.prototype._removePoint=function(t){var e=this.getPointMarker(t);e&&(e.destroy(),delete this._pointMarkers[t.pid])},Un.prototype.setVisible=function(t){this._layer.setVisible(t)},Un.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)},Un.prototype.fitToView=function(){for(var t in this._pointMarkers){if(Ve(this._pointMarkers,t))this._pointMarkers[t].fitToView()}},Un.prototype.draw=function(){this._layer.draw()},Wn.prototype.addToStage=function(t){t.add(this._playheadLayer)},Wn.prototype.zoomLevelChanged=function(){var t=this._view.timeToPixels(1);if(this._useAnimation=t>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var e=this._player.getCurrentTime();this.stop(e)}},Wn.prototype.fitToView=function(){var t=this._view.getHeight();this._playheadLine.points([.5,0,.5,t]),this._playheadText&&this._playheadText.y(12)},Wn.prototype._createPlayhead=function(){this._playheadLine=new oe({stroke:this._playheadColor,strokeWidth:this._playheadWidth}),this._playheadGroup=new ne.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)},Wn.prototype._createPlayheadText=function(){var t=this,e=t._player.getCurrentTime(),n=t._view.formatTime(e);t._playheadText=new be({x:0,y:0,padding:t._playheadPadding,text:n,fontSize:t._playheadFontSize,fontFamily:t._playheadFontFamily,fontStyle:t._playheadFontStyle,fill:t._playheadTextColor,align:"right",sceneFunc:function(e,n){var r=n.width(),i=n.height()+2*t._playheadPadding;e.fillStyle=t._playheadBackgroundColor,e.fillRect(0,-t._playheadPadding,r,i),n._sceneFunc(e)}}),t._playheadGroup.add(t._playheadText)},Wn.prototype.updatePlayheadTime=function(t){this._syncPlayhead(t),this._player.isPlaying()&&this._start()},Wn.prototype._syncPlayhead=function(t){var e=this._view.timeToPixels(t),n=this._view.getFrameOffset(),r=this._view.getWidth(),i=e>=n&&e<=n+r;if(this._playheadPixel=e,i){var o=this._playheadPixel-n;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(o),this._playheadText){var a=this._view.formatTime(t),s=this._playheadText.width();this._playheadText.setText(a),s+o>r-2?this._playheadText.setX(-s):s+o<r&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(t)},Wn.prototype._start=function(){var t=this;if(t._playheadLineAnimation&&(t._playheadLineAnimation.stop(),t._playheadLineAnimation=null),t._useAnimation){var e=null;t._playheadLineAnimation=new qt(function(){var n=t._player.getCurrentTime(),r=t._view.timeToPixels(n);r!==e&&(t._syncPlayhead(n),e=r)},t._playheadLayer),t._playheadLineAnimation.start()}},Wn.prototype.stop=function(t){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(t)},Wn.prototype.getPlayheadPixel=function(){return this._playheadPixel},Wn.prototype.showPlayheadTime=function(t){t?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)},Wn.prototype.updatePlayheadText=function(){if(this._playheadText){var t=this._player.getCurrentTime(),e=this._view.formatTime(t);this._playheadText.setText(e)}},Wn.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)},Gn.prototype.init=function(t){var e=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new be({x:e,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new ae({x:-4.5,y:0,width:10,height:20}),t.add(this._label),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)},Gn.prototype.bindEventHandlers=function(t){var e=this,n=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(n-e._label.getWidth()),e._label.show(),document.body.style.cursor="ew-resize"}),e._handle.on("mouseout touchend",function(){e._label.hide(),document.body.style.cursor="default"})},Gn.prototype.fitToView=function(){var t=this._options.layer.getHeight(),e=this._options.segmentOptions.overlayOffset,n=Xe(0,t-2*e);this._label.y(t/2-5),this._handle.y(e),this._handle.height(n)},Gn.prototype.update=function(t){void 0!==t.startTime&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),void 0===t.endTime||this._options.startMarker||this._label.text(this._options.layer.formatTime(t.endTime))},jn.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("click",function(e){t._onClick(t,e)}),t._group.on("dragstart",function(e){t._onDragStart(t,e)}),t._group.on("dragmove",function(e){t._onDragMove(t,e)}),t._group.on("dragend",function(e){t._onDragEnd(t,e)})},jn.prototype.addToLayer=function(t){t.add(this._group)},jn.prototype.moveToTop=function(){this._group.moveToTop()},jn.prototype.fitToView=function(){this._marker.fitToView()},jn.prototype.getSegment=function(){return this._segment},jn.prototype.getX=function(){return this._group.getX()},jn.prototype.setX=function(t){this._group.setX(t)},jn.prototype.getWidth=function(){return this._group.getWidth()},jn.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()},jn.prototype.isStartMarker=function(){return this._startMarker},jn.prototype.update=function(t){void 0!==t.editable&&(this._group.visible(t.editable),this._group.draggable(t.editable)),this._marker.update&&this._marker.update(t)},jn.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()},jn.prototype.startDrag=function(){this._group.startDrag()},jn.prototype.stopDrag=function(){this._group.stopDrag()},Hn.prototype.getX=function(){return this._shape.getX()},Hn.prototype.setX=function(t){return this._shape.setX(t)},Hn.prototype.setSegment=function(t){this._segment=t},Hn.prototype.setWaveformColor=function(t){if(Je(t))this._shape.fill(t),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else{if(!en(t))throw new TypeError("Unknown type for color property");this._shape.fill(null);var e=this._view._height*(t.linearGradientStart/100),n=this._view._height*(t.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(e),this._shape.fillLinearGradientEndPointY(n),this._shape.fillLinearGradientColorStops([0,t.linearGradientColorStops[0],1,t.linearGradientColorStops[1]])}},Hn.prototype.fitToView=function(){this.setWaveformColor(this._color)},Hn.prototype._sceneFunc=function(t){var e=this._view.getFrameOffset(),n=this._view.getWidth(),r=this._view.getHeight();this._drawWaveform(t,this._view.getWaveformData(),e,this._segment?this._view.timeToPixels(this._segment.startTime):e,this._segment?this._view.timeToPixels(this._segment.endTime):e+n,n,r)},Hn.prototype._drawWaveform=function(t,e,n,r,i,o,a){r<n&&(r=n);var s=n+o;i>s&&(i=s),i>e.length-1&&(i=e.length-1);for(var l=e.channels,u=0,h=Math.floor(a/l),c=0;c<l;c++)c===l-1&&(h=a-(l-1)*h),this._drawChannel(t,e.channel(c),n,r,i,u,h),u+=h},Hn.prototype._drawChannel=function(t,e,n,r,i,o,a){var s,l,u,h,c=this._view.getAmplitudeScale();for(t.beginPath(),s=r;s<=i;s++)l=e.min_sample(s),u=s-n+.5,h=o+Hn.scaleY(l,a,c)+.5,t.lineTo(u,h);for(s=i;s>=r;s--)l=e.max_sample(s),u=s-n+.5,h=o+Hn.scaleY(l,a,c)+1,t.lineTo(u,h);t.closePath(),t.fillShape(this._shape)},Hn.prototype.addToLayer=function(t){t.add(this._shape)},Hn.prototype.destroy=function(){this._shape.destroy(),this._shape=null},Hn.prototype.on=function(t,e){this._shape.on(t,e)},Hn.prototype.off=function(t,e){this._shape.off(t,e)},Hn.scaleY=function(t,e,n){var r=-(e-1)*(t*n+128)/255+(e-1);return Xe(Math.floor(r),0,e-1)},Nn.prototype._createMarkers=function(){var t,e,n,r=this._layer.isEditingEnabled()&&this._segment.editable,i=this._view.getViewOptions(),o=i.segmentOptions;this._segment.markers?t=this._peaks.options.createSegmentMarker:this._segment.overlay&&(t=zn),t&&(e=t({segment:this._segment,editable:r,startMarker:!0,color:o.startMarkerColor,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStyle:i.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),e&&(this._startMarker=new jn({segment:this._segment,segmentShape:this,editable:r,startMarker:!0,marker:e,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc})),t&&(n=t({segment:this._segment,editable:r,startMarker:!1,color:o.endMarkerColor,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStyle:i.fontStyle,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions})),n&&(this._endMarker=new jn({segment:this._segment,segmentShape:this,editable:r,startMarker:!1,marker:n,onClick:this._onSegmentMarkerClick,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))},Nn.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},Nn.prototype.update=function(t){var e,n=this._view.timeToPixelOffset(this._segment.startTime),r=this._view.timeToPixelOffset(this._segment.endTime),i=r-n;(e=this.getStartMarker())&&(e.setX(n-e.getWidth()),t&&e.update(t)),(e=this.getEndMarker())&&(e.setX(r),t&&e.update(t)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._label&&this._label.text(this._segment.labelText),this._overlayText&&this._overlayText.text(this._segment.labelText),this._segment.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:n,width:i,clipWidth:i<1?1:i}),this._overlayRect.setAttrs({x:0,width:i}),this._overlayText&&this._overlayText.setAttrs({width:i}))},Nn.prototype.getSegment=function(){return this._segment},Nn.prototype.getStartMarker=function(){return this._startMarker},Nn.prototype.getEndMarker=function(){return this._endMarker},Nn.prototype.addToLayer=function(t){this._waveformShape&&this._waveformShape.addToLayer(t),this._label&&t.add(this._label),this._overlay&&t.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(t),this._endMarker&&this._endMarker.addToLayer(t)},Nn.prototype.isDragging=function(){return this._dragging},Nn.prototype._onMouseEnter=function(t){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:t.evt})},Nn.prototype._onMouseLeave=function(t){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:t.evt})},Nn.prototype._onMouseDown=function(t){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:t.evt})},Nn.prototype._onMouseUp=function(t){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:t.evt})},Nn.prototype.segmentClicked=function(t,e){this._moveToTop(),this._peaks.emit("segments."+t,e)},Nn.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()},Nn.prototype.enableSegmentDragging=function(t){this._segment.editable&&(!this._draggable&&t?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!t&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(t),this._draggable=t)},Nn.prototype._setPreviousAndNextSegments=function(){"overlap"!==this._view.getSegmentDragMode()?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)},Nn.prototype._onSegmentDragStart=function(t){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},Nn.prototype._onSegmentDragMove=function(t){var e,n=this._overlay.getX()-this._dragStartX,r=this._view.pixelsToTime(n),i=this._dragStartTime+r,o=this._dragEndTime+r,a=this._segment.endTime-this._segment.startTime,s=this._view.getMinSegmentDragWidth(),l=this._view.pixelsToTime(s),u=!1,h=!1;if(i<0&&(i=0,o=a,this._overlay.setX(this._view.timeToPixelOffset(i))),this._previousSegment){var c=this._view.timeToPixelOffset(this._previousSegment.endTime);if(i<this._previousSegment.endTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._previousSegment.editable)o=(i=this._previousSegment.endTime)+a,this._overlay.setX(c);else if("compress"===e){var d=i,f=this._previousSegment.startTime+l;d<f&&(d=f,c=this._view.timeToPixelOffset(d),this._overlay.setX(c),o=(i=d)+a),this._previousSegment.update({endTime:d}),u=!0}}if(this._nextSegment){var p=this._view.timeToPixelOffset(this._nextSegment.startTime);if(o>this._nextSegment.startTime)if("no-overlap"===(e=this._view.getSegmentDragMode())||"compress"===e&&!this._nextSegment.editable)i=(o=this._nextSegment.startTime)-a,this._overlay.setX(p-this._overlay.getWidth());else if("compress"===e){var g=o,m=this._nextSegment.endTime-l;g>m&&(g=m,p=this._view.timeToPixelOffset(g),this._overlay.setX(p-this._overlay.getWidth()),i=(o=g)-a),this._nextSegment.update({startTime:g}),h=!0}}this._segment._setStartTime(i),this._segment._setEndTime(o),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt}),u?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:t.evt}):h&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:t.evt})},Nn.prototype._onSegmentDragEnd=function(t){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})},Nn.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()},Nn.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()},Nn.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()},Nn.prototype._onSegmentMarkerDragStart=function(t,e){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:t.isStartMarker(),evt:e.evt})},Nn.prototype._onSegmentMarkerDragMove=function(t,e){t.isStartMarker()?(this._segmentStartMarkerDragMove(t,e),t.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(t,e),t.update({endTime:this._segment.endTime}))},Nn.prototype._segmentStartMarkerDragMove=function(t,e){var n=this._view.getWidth(),r=this._startMarker.getX(),i=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._endMarker.getX()-a;s>n&&(s=n);var l,u=!1,h=!1;if(this._previousSegment&&(u=(l=this._view.timeToPixelOffset(this._previousSegment.endTime))>=0),r>s)t.setX(s),this._overlay.clipWidth(s-i),0===a&&s<n?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(s));else if(this._previousSegment&&u){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._previousSegment.editable,f="compress"===c&&this._previousSegment.editable;if(r<=l){if(d)t.setX(l),this._overlay.clipWidth(l-i),this._segment._setStartTime(this._previousSegment.endTime);else if(f){var p=Xn(this._previousSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._previousSegment.startTime+o);r<g&&(r=g),t.setX(r),this._overlay.clipWidth(i-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(r)}),h=!0}}else r<0&&(r=0),t.setX(r),this._overlay.clipWidth(i-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r))}else r<0&&(r=0),t.setX(r),this._overlay.clipWidth(i-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:e.evt}),h&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:e.evt})},Nn.prototype._segmentEndMarkerDragMove=function(t,e){var n=this._view.getWidth(),r=this._startMarker.getX(),i=this._endMarker.getX(),o=this._view.pixelsToTime(50),a=this._view.getMinSegmentDragWidth(),s=this._startMarker.getX()+a;s<0&&(s=0);var l,u=!1,h=!1;if(this._nextSegment&&(u=(l=this._view.timeToPixelOffset(this._nextSegment.startTime))<n),i<s)t.setX(s),this._overlay.clipWidth(s-r),0===a&&s>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(s));else if(this._nextSegment&&u){var c=this._view.getSegmentDragMode(),d="no-overlap"===c||"compress"===c&&!this._nextSegment.editable,f="compress"===c&&this._nextSegment.editable;if(i>=l){if(d)t.setX(l),this._overlay.clipWidth(l-r),this._segment._setEndTime(this._nextSegment.startTime);else if(f){var p=Xn(this._nextSegment);p<o&&(o=p);var g=this._view.timeToPixelOffset(this._nextSegment.endTime-o);i>g&&(i=g),t.setX(i),this._overlay.clipWidth(i-r),this._segment._setEndTime(this._view.pixelOffsetToTime(i)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(i)}),h=!0}}else i>n&&(i=n),t.setX(i),this._overlay.clipWidth(i-r),this._segment._setEndTime(this._view.pixelOffsetToTime(i))}else i>n&&(i=n),t.setX(i),this._overlay.clipWidth(i-r),this._segment._setEndTime(this._view.pixelOffsetToTime(i));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:e.evt}),h&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:e.evt})},Nn.prototype._onSegmentMarkerDragEnd=function(t,e){this._nextSegment=null,this._previousSegment=null;var n=t.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:n,evt:e.evt})},Nn.prototype._segmentMarkerDragBoundFunc=function(t,e){return{x:e.x,y:t.getAbsolutePosition().y}},Nn.prototype._onSegmentMarkerClick=function(){this._moveToTop()},Nn.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var t=this._view.getHeight(),e=Xe(0,t-2*this._overlayOffset);this._overlay.setAttrs({y:0,height:t,clipY:this._overlayOffset,clipHeight:e}),this._overlayRect.setAttrs({y:this._overlayOffset,height:e}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:e})}},Nn.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()},Vn.prototype.addToStage=function(t){t.add(this._layer)},Vn.prototype.setListening=function(t){this._layer.listening(t)},Vn.prototype.enableEditing=function(t){this._enableEditing=t},Vn.prototype.isEditingEnabled=function(){return this._enableEditing},Vn.prototype.enableSegmentDragging=function(t){for(var e in this._segmentShapes)Ve(this._segmentShapes,e)&&this._segmentShapes[e].enableSegmentDragging(t)},Vn.prototype.getSegmentShape=function(t){return this._segmentShapes[t.pid]},Vn.prototype.formatTime=function(t){return this._view.formatTime(t)},Vn.prototype._onSegmentsUpdate=function(t,e){var n=this._view.getStartTime(),r=this._view.getEndTime(),i=this.getSegmentShape(t),o=t.isVisible(n,r);i&&!o?i.isDragging()||this._removeSegment(t):!i&&o?i=this._updateSegment(t):i&&o&&i.update(e)},Vn.prototype._onSegmentsAdd=function(t){var e=this,n=e._view.getStartTime(),r=e._view.getEndTime();t.segments.forEach(function(t){t.isVisible(n,r)&&e._addSegmentShape(t).update()}),this.moveSegmentMarkersToTop()},Vn.prototype._onSegmentsRemove=function(t){var e=this;t.segments.forEach(function(t){e._removeSegment(t)})},Vn.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}},Vn.prototype._onSegmentsDragged=function(t){this._updateSegment(t.segment)},Vn.prototype._createSegmentShape=function(t){return new Nn(t,this._peaks,this,this._view)},Vn.prototype._addSegmentShape=function(t){var e=this._createSegmentShape(t);return e.addToLayer(this._layer),this._segmentShapes[t.pid]=e,e},Vn.prototype.updateSegments=function(t,e){this._peaks.segments.find(t,e).forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(t,e)},Vn.prototype._updateSegment=function(t){var e=this.getSegmentShape(t);e||(e=this._addSegmentShape(t)),e.update()},Vn.prototype._removeInvisibleSegments=function(t,e){for(var n in this._segmentShapes)if(Ve(this._segmentShapes,n)){var r=this._segmentShapes[n].getSegment();r.isVisible(t,e)||this._removeSegment(r)}},Vn.prototype._removeSegment=function(t){var e=this._segmentShapes[t.pid];e&&(e.destroy(),delete this._segmentShapes[t.pid])},Vn.prototype.moveSegmentMarkersToTop=function(){for(var t in this._segmentShapes)Ve(this._segmentShapes,t)&&this._segmentShapes[t].moveMarkersToTop()},Vn.prototype.setVisible=function(t){this._layer.setVisible(t)},Vn.prototype.segmentClicked=function(t,e){var n=this._segmentShapes[e.segment.pid];n&&n.segmentClicked(t,e)},Vn.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)},Vn.prototype.fitToView=function(){for(var t in this._segmentShapes){if(Ve(this._segmentShapes,t))this._segmentShapes[t].fitToView()}},Vn.prototype.draw=function(){this._layer.draw()},Vn.prototype.getHeight=function(){return this._layer.getHeight()},Yn._buildFontString=function(t,e,n){return e||(e=11),t||(t="sans-serif"),n||(n="normal"),n+" "+e+"px "+t},Yn.prototype.addToLayer=function(t){t.add(this._axisShape)},Yn.prototype.showAxisLabels=function(t,e){this._showAxisLabels=t,e&&(Ve(e,"topMarkerHeight")&&(this._axisTopMarkerHeight=e.topMarkerHeight),Ve(e,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=e.bottomMarkerHeight))},Yn.prototype.setAxisLabelColor=function(t){this._axisLabelColor=t},Yn.prototype.setAxisGridlineColor=function(t){this._axisGridlineColor=t},Yn.prototype._getAxisLabelScale=function(t){for(var e,n=1,r=[1,2,5,10,20,30],i=0;;){if(e=n*r[i],!(t.timeToPixels(e)<60))break;++i===r.length&&(n*=60,i=0)}return e},Yn.prototype._drawAxis=function(t,e){var n=e.getStartTime(),r=this._getAxisLabelScale(e),i=function(t,e){if(0===e)return 0;var n=1;return t<0&&(n=-1,t=-t),n*((Math.ceil(t)+e-1)/e|0)*e}(n,r),o=i-n,a=e.timeToPixels(o);t.setAttr("strokeStyle",this._axisGridlineColor),t.setAttr("lineWidth",1),t.setAttr("font",this._axisLabelFont),t.setAttr("fillStyle",this._axisLabelColor),t.setAttr("textAlign","left"),t.setAttr("textBaseline","bottom");for(var s=e.getWidth(),l=e.getHeight(),u=i;;){var h=a+e.timeToPixels(u-i);if(h>=s)break;if(this._axisTopMarkerHeight>0&&(t.beginPath(),t.moveTo(h+.5,0),t.lineTo(h+.5,0+this._axisTopMarkerHeight),t.stroke()),this._axisBottomMarkerHeight>0&&(t.beginPath(),t.moveTo(h+.5,l),t.lineTo(h+.5,l-this._axisBottomMarkerHeight),t.stroke()),this._showAxisLabels){var c=this._formatAxisTime(u),d=h-t.measureText(c).width/2,f=l-1-this._axisBottomMarkerHeight;d>=0&&t.fillText(c,d,f)}u+=r}},Zn.prototype.getViewOptions=function(){return this._viewOptions},Zn.prototype.getWaveformData=function(){return this._data},Zn.prototype.setWaveformData=function(t){this._data=t},Zn.prototype.timeToPixels=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)},Zn.prototype.pixelsToTime=function(t){return t*this._data.scale/this._data.sample_rate},Zn.prototype.pixelOffsetToTime=function(t){return(this._frameOffset+t)*this._data.scale/this._data.sample_rate},Zn.prototype.timeToPixelOffset=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)-this._frameOffset},Zn.prototype.getFrameOffset=function(){return this._frameOffset},Zn.prototype.getWidth=function(){return this._width},Zn.prototype.getHeight=function(){return this._height},Zn.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)},Zn.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)},Zn.prototype._getDuration=function(){return this._peaks.player.getDuration()},Zn.prototype._createWaveform=function(){this._waveformLayer=new ne.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)},Zn.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new Hn({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var t=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:t},this._unplayedSegment={startTime:t,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new Hn({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}},Zn.prototype.setWaveformColor=function(t){this._waveformColor=t,this._waveformShape.setWaveformColor(t)},Zn.prototype.setPlayedWaveformColor=function(t){this._playedWaveformColor=t,t?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(t)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()},Zn.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null},Zn.prototype._createAxisLabels=function(){this._axisLayer=new ne.Layer({listening:!1}),this._axis=new Yn(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)},Zn.prototype.showAxisLabels=function(t,e){this._axis.showAxisLabels(t,e),this._axisLayer.draw()},Zn.prototype.setAxisLabelColor=function(t){this._axis.setAxisLabelColor(t),this._axisLayer.draw()},Zn.prototype.setAxisGridlineColor=function(t){this._axis.setAxisGridlineColor(t),this._axisLayer.draw()},Zn.prototype.showPlayheadTime=function(t){this._playheadLayer.showPlayheadTime(t)},Zn.prototype.setTimeLabelPrecision=function(t){this._timeLabelPrecision=t,this._playheadLayer.updatePlayheadText()},Zn.prototype.formatTime=function(t){return this._formatPlayheadTime(t)},Zn.prototype.setAmplitudeScale=function(t){if(!Ze(t)||("number"!=typeof(e=t)||e!=e||e===1/0||e===-1/0))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");var e;this._amplitudeScale=t,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()},Zn.prototype.getAmplitudeScale=function(){return this._amplitudeScale},Zn.prototype.enableSeek=function(t){this._enableSeek=t},Zn.prototype.isSeekEnabled=function(){return this._enableSeek},Zn.prototype._onClick=function(t){this._clickHandler(t,"click")},Zn.prototype._onDblClick=function(t){this._clickHandler(t,"dblclick")},Zn.prototype._onContextMenu=function(t){this._clickHandler(t,"contextmenu")},Zn.prototype._clickHandler=function(t,e){var n=t.evt.offsetX;n<0&&(n=0);var r=!0;if(t.target!==this._stage){var i=nn(t.target);if(i)if("point-marker"===i.attrs.name){var o=i.getAttr("point");o&&this._peaks.emit("points."+e,{point:o,evt:t.evt,preventViewEvent:function(){r=!1}})}else if("segment-overlay"===i.attrs.name){var a=i.getAttr("segment");if(a){var s={segment:a,evt:t.evt,preventViewEvent:function(){r=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(e,s)}}}if(r){var l=this.pixelOffsetToTime(n),u=this.getName();this._peaks.emit(u+"."+e,{time:l,evt:t.evt})}},Zn.prototype.updatePlayheadTime=function(t){this._playheadLayer.updatePlayheadTime(t)},Zn.prototype.playheadPosChanged=function(t){this._playedWaveformShape&&(this._playedSegment.endTime=t,this._unplayedSegment.startTime=t,this.drawWaveformLayer())},Zn.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()},Zn.prototype.enableMarkerEditing=function(t){this._segmentsLayer&&this._segmentsLayer.enableEditing(t),this._pointsLayer&&this._pointsLayer.enableEditing(t)},Zn.prototype.dragSeek=function(t){this._segmentsLayer&&this._segmentsLayer.setListening(!t),this._pointsLayer&&this._pointsLayer.setListening(!t)},Zn.prototype.fitToContainer=function(){if(0!==this._container.clientWidth||0!==this._container.clientHeight){var t=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),t=this.containerWidthChange());var e=!1;this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.setHeight(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this.containerHeightChange(),e=!0),t?this.updateWaveform(this._frameOffset,!0):e&&(this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView())}},Zn.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)},qn.prototype._mouseDown=function(t){var e=null;if("mousedown"!==t.type||0===t.evt.button){var n=nn(t.target);if(n){if("point-marker"===n.attrs.name||"segment-marker"===n.attrs.name)return;"segment-overlay"===n.attrs.name&&(e=n)}if(this._lastMouseClientX=Math.floor("touchstart"===t.type?t.evt.touches[0].clientX:t.evt.clientX),this._handlers.onMouseDown){var r=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(r,e)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}},qn.prototype._mouseMove=function(t){var e=Math.floor("touchmove"===t.type?t.changedTouches[0].clientX:t.clientX);if(e!==this._lastMouseClientX&&(this._lastMouseClientX=e,this._dragging=!0,this._handlers.onMouseMove)){var n=this._getMousePosX(e);this._handlers.onMouseMove(n)}},qn.prototype._mouseUp=function(t){var e;if("touchend"===t.type?(e=Math.floor(t.changedTouches[0].clientX),t.cancelable&&t.preventDefault()):e=Math.floor(t.clientX),this._handlers.onMouseUp){var n=this._getMousePosX(e);this._handlers.onMouseUp(n)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1},qn.prototype._getMousePosX=function(t){var e=this._stage.getContainer().getBoundingClientRect();return Math.floor(t-e.left)},qn.prototype.isDragging=function(){return this._dragging},qn.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)},Kn.prototype._onMouseDown=function(t){this._firstMove=!0,this._seek(t)},Kn.prototype._onMouseMove=function(t){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),this._seek(t)},Kn.prototype._onMouseUp=function(){this._view.dragSeek(!1)},Kn.prototype._seek=function(t){if(this._view.isSeekEnabled()){t=Xe(t,0,this._width);var e=this._view.pixelsToTime(t),n=this._peaks.player.getDuration();e>n&&(e=n),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)}},Kn.prototype.destroy=function(){this._mouseDragHandler.destroy()},Jn.prototype=Object.create(Zn.prototype),Jn.prototype.initWaveformData=function(){0!==this._width&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},Jn.prototype.initHighlightLayer=function(){this._highlightLayer=new Bn(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)},Jn.prototype.isSegmentDraggingEnabled=function(){return!1},Jn.prototype.getName=function(){return"overview"},Jn.prototype._onTimeUpdate=function(t){this._playheadLayer.updatePlayheadTime(t)},Jn.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},Jn.prototype._onPause=function(t){this._playheadLayer.stop(t)},Jn.prototype._onZoomviewUpdate=function(t){this.showHighlight(t.startTime,t.endTime)},Jn.prototype.showHighlight=function(t,e){this._highlightLayer.showHighlight(t,e)},Jn.prototype.setWaveformData=function(t){this._originalWaveformData=t,0!==this._width?this._resampleAndSetWaveformData(t,this._width):this._data=t,this.updateWaveform()},Jn.prototype._resampleAndSetWaveformData=function(t,e){try{return this._data=t.resample({width:e}),!0}catch(e){return this._data=t,!1}},Jn.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()},Jn.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var t=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(t),this._highlightLayer.updateHighlight();var e=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(0,e),this._segmentsLayer&&this._segmentsLayer.updateSegments(0,e)},Jn.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)},Jn.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()},Jn.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._mouseDragHandler.destroy(),Zn.prototype.destroy.call(this)},Qn.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},Qn.prototype._reset=function(){this._insertSegment=null,this._insertSegmentShape=null,this._segmentIsDraggable=!1,this._peaks.segments.setInserting(!1)},Qn.prototype._onMouseDown=function(t,e){if(this._reset(),this._segment=e,this._segment){if("overlap"!==this._view.getSegmentDragMode())return;this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1)}var n=this._view.pixelsToTime(t+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:n,endTime:n,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())},Qn.prototype._onMouseMove=function(){},Qn.prototype._onMouseUp=function(){this._insertSegment&&(this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1))},Qn.prototype.destroy=function(){this._mouseDragHandler.destroy()},$n.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()},$n.prototype._onMouseDown=function(t,e){this._seeking=!1,this._firstMove=!0,e&&!e.attrs.draggable?this._segment=null:this._segment=e;var n=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(t-n)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){t=Xe(t,0,this._view.getWidth());var r=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(r)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=t},$n.prototype._onMouseMove=function(t){if(!this._segment||this._seeking)if(this._seeking){this._firstMove&&(this._view.dragSeek(!0),this._firstMove=!1),t=Xe(t,0,this._view.getWidth());var e=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(e)}else if(!this._view.isAutoZoom()){var n=this._mouseDownX-t,r=this._initialFrameOffset+n;r!==this._initialFrameOffset&&this._view.updateWaveform(r)}},$n.prototype._onMouseUp=function(){if(this._seeking)this._view.dragSeek(!1);else if(this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var t=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(t)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)},$n.prototype._seek=function(t){var e=this._peaks.player.getDuration();t>e&&(t=e),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)},$n.prototype.destroy=function(){this._mouseDragHandler.destroy()},tr.prototype=Object.create(Zn.prototype),tr.prototype.initWaveformData=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var t=this._peaks.zoom.getZoomLevel();this._resampleData({scale:t})},tr.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])},tr.prototype.initHighlightLayer=function(){},tr.prototype.setWheelMode=function(t,e){if(e||(e={}),(t!==this._wheelMode||e.captureVerticalScroll!==this._captureVerticalScroll)&&(this._stage.off("wheel"),this._wheelMode=t,this._captureVerticalScroll=e.captureVerticalScroll,"scroll"===t))e.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel)},tr.prototype._onWheel=function(t){var e,n=t.evt;if(n.shiftKey)if(0!==n.deltaY)e=n.deltaY;else{if(0===n.deltaX)return;e=n.deltaX}else{if(Math.abs(n.deltaX)<Math.abs(n.deltaY))return;e=n.deltaX}n.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._width),n.preventDefault();var r=Xe(this._frameOffset+Math.floor(e),0,this._pixelLength-this._width);this.updateWaveform(r,!1)},tr.prototype._onWheelCaptureVerticalScroll=function(t){var e=t.evt,n=Math.abs(e.deltaX)<Math.abs(e.deltaY)?e.deltaY:e.deltaX;e.preventDefault();var r=Xe(this._frameOffset+Math.floor(n),0,this._pixelLength-this._width);this.updateWaveform(r,!1)},tr.prototype.setWaveformDragMode=function(t){this._segmentsLayer&&(this._mouseDragHandler.destroy(),this.dragSeek(!1),this._mouseDragHandler="insert-segment"===t?new Qn(this._peaks,this):new $n(this._peaks,this))},tr.prototype.enableSegmentDragging=function(t){this._enableSegmentDragging=t,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(t)},tr.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging},tr.prototype.setSegmentDragMode=function(t){this._segmentDragMode=t},tr.prototype.getSegmentDragMode=function(){return this._segmentDragMode},tr.prototype.getName=function(){return"zoomview"},tr.prototype._onTimeUpdate=function(t){this._mouseDragHandler.isDragging()||this._syncPlayhead(t)},tr.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)},tr.prototype._onPause=function(t){this._playheadLayer.stop(t)},tr.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)},tr.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)},tr.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)},tr.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)},tr.prototype._keyboardScroll=function(t,e){var n;n=e?t*this._width:t*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:n})},tr.prototype.setWaveformData=function(t){this._originalWaveformData=t,this._initWaveformCache()},tr.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset},tr.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance},tr.prototype._syncPlayhead=function(t){if(this._playheadLayer.updatePlayheadTime(t),this._autoScroll&&!this._zoomLevelAuto){var e=this.timeToPixels(t),n=this._frameOffset+this._width-this._autoScrollOffset,r=this._frameOffset;(e>=n||e<r)&&((r=e-this._autoScrollOffset)<0&&(r=0),this.updateWaveform(r,!1))}},tr.prototype._getScale=function(t){return Math.floor(t*this._data.sample_rate/this._width)},tr.prototype.setZoom=function(t){var e;if(function(t){return Ve(t,"scale")&&"auto"===t.scale||Ve(t,"seconds")&&"auto"===t.seconds}(t)){var n=this._originalWaveformData.duration;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,e=this._getScale(n)}else{if(Ve(t,"scale"))this._zoomLevelSeconds=null,e=Math.floor(t.scale);else if(Ve(t,"seconds")){if(!qe(t.seconds))return!1;this._zoomLevelSeconds=t.seconds,e=this._getScale(t.seconds)}this._zoomLevelAuto=!1}e<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),e=this._originalWaveformData.scale);var r,i=this._peaks.player.getCurrentTime(),o=this.getPlayheadOffset();o>=0&&o<this._width?r=i:(o=Math.floor(this._width/2),r=this.pixelOffsetToTime(o));var a=this._scale;this._resampleData({scale:e});var s=this.timeToPixels(r)-o;return this.updateWaveform(s,!0),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(i),this._peaks.emit("zoom.update",{currentZoom:e,previousZoom:a}),!0},tr.prototype._resampleData=function(t){var e=t.scale;if(this._enableWaveformCache){if(!this._waveformData.has(e)){for(var n=this._originalWaveformData,r=0;r<this._waveformScales.length&&this._waveformScales[r]<e;r++)n=this._waveformData.get(this._waveformScales[r]);this._waveformData.set(e,n.resample(t)),this._waveformScales.push(e),this._waveformScales.sort(function(t,e){return t-e})}this._data=this._waveformData.get(e)}else this._data=this._originalWaveformData.resample(t);this._scale=this._data.scale,this._pixelLength=this._data.length},tr.prototype.isAutoZoom=function(){return this._zoomLevelAuto},tr.prototype.setStartTime=function(t){t<0&&(t=0),this._zoomLevelAuto&&(t=0),this.updateWaveform(this.timeToPixels(t),!1)},tr.prototype.getPixelLength=function(){return this._pixelLength},tr.prototype.scrollWaveform=function(t){var e;if(Ve(t,"pixels"))e=Math.floor(t.pixels);else{if(!Ve(t,"seconds"))throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");e=this.timeToPixels(t.seconds)}this.updateWaveform(this._frameOffset+e,!1)},tr.prototype.updateWaveform=function(t,e){var n;if(this._pixelLength<this._width?(t=0,n=this._width):n=this._pixelLength-this._width,t=Xe(t,0,n),e||t!==this._frameOffset){this._frameOffset=t;var r=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(r)),this.drawWaveformLayer(),this._axisLayer.draw();var i=this.getStartTime(),o=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(i,o),this._segmentsLayer&&this._segmentsLayer.updateSegments(i,o),this._peaks.emit("zoomview.update",{startTime:i,endTime:o})}},tr.prototype.enableAutoScroll=function(t,e){e||(e={}),this._autoScroll=t,Ve(e,"offset")&&(this._autoScrollOffset=e.offset)},tr.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth},tr.prototype.setMinSegmentDragWidth=function(t){this._minSegmentDragWidth=t},tr.prototype.containerWidthChange=function(){var t,e=!1;if(this._zoomLevelAuto?(e=!0,t={width:this._width}):null!==this._zoomLevelSeconds&&(e=!0,t={scale:this._getScale(this._zoomLevelSeconds)}),e)try{this._resampleData(t)}catch(t){}return!0},tr.prototype.containerHeightChange=function(){},tr.prototype.getStage=function(){return this._stage},tr.prototype.getSegmentsLayer=function(){return this._segmentsLayer},tr.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._enableWaveformCache?(this._waveformData.clear(),delete this._waveformData,delete this._waveformScales):delete this._data,this._mouseDragHandler.destroy(),Zn.prototype.destroy.call(this)},er.prototype.setZoomview=function(t){this._zoomview=t,this._updateScrollbarWidthAndPosition()},er.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)},er.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth},er.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}},er.prototype._onScrollboxDragStart=function(){this._dragging=!0},er.prototype._onScrollboxDragEnd=function(){this._dragging=!1},er.prototype._onScrollboxDragMove=function(){var t=this._getScrollbarRange(),e=Xe(this._scrollbox.x(),0,t);this._scrollbox.x(e),e!==this._scrollboxX&&(this._scrollboxX=e,this._zoomview&&this._updateWaveform(e))},er.prototype._onZoomviewUpdate=function(){this._dragging||this._updateScrollbarWidthAndPosition()},er.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var t=this._zoomview.getStartTime(),e=this._zoomview.getPixelLength()-this._zoomview.getWidth(),n=Math.floor(this._zoomview.timeToPixels(t)*this._getScrollbarRange()/e);this._scrollbox.x(n),this._layer.draw()}},er.prototype._onScrollbarClick=function(t){if(t.target===this._stage&&this._zoomview){var e=Math.floor(t.evt.offsetX-this._scrollboxWidth/2);e<0&&(e=0),this._updateWaveform(e)}},er.prototype._updateWaveform=function(t){var e=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*t/this._getScrollbarRange());this._zoomview.updateWaveform(e)},er.prototype.fitToContainer=function(){0===this._container.clientWidth&&0===this._container.clientHeight||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))},er.prototype.destroy=function(){this._peaks.off("zoomview.update",this._onZoomviewUpdate),this._layer.destroy(),this._stage.destroy(),this._stage=null},nr.prototype.createOverview=function(t){if(this._overview)return this._overview;var e=this._peaks.getWaveformData();return this._overview=new Jn(e,t,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview},nr.prototype.createZoomview=function(t){if(this._zoomview)return this._zoomview;var e=this._peaks.getWaveformData();return this._zoomview=new tr(e,t,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview},nr.prototype.createScrollbar=function(t){return this._scrollbar=new er(t,this._peaks),this._scrollbar},nr.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)},nr.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())},nr.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)},nr.prototype.getView=function(t){if(Qe(t))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(t){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}},nr.prototype.getScrollbar=function(){return this._scrollbar},rr.prototype.setZoomLevels=function(t){this._zoomLevels=t,this.setZoom(0,!0)},rr.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1,!1)},rr.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1,!1)},rr.prototype.setZoom=function(t,e){if(t>=this._zoomLevels.length&&(t=this._zoomLevels.length-1),t<0&&(t=0),e||t!==this._zoomLevelIndex){this._zoomLevelIndex=t;var n=this._peaks.views.getView("zoomview");n&&n.setZoom({scale:this._zoomLevels[t]})}},rr.prototype.getZoom=function(){return this._zoomLevelIndex},rr.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var ir="withCredentials"in new XMLHttpRequest;function or(t){this._peaks=t}function ar(t){var e=t.getResponseHeader("content-range");if(!e)return!1;var n=e.match(/^bytes (\d+)-(\d+)\/(\d+)$/);if(n&&4===n.length){var r=parseInt(n[1],10),i=parseInt(n[2],10),o=parseInt(n[3],10);return 0===r&&i+1===o}return!1}function sr(){return Ge.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:On,createSegmentLabel:Ln,createPointMarker:Rn,logger:console.error.bind(console)},this}or.prototype.init=function(t,e){if(!(t.dataUri&&(t.webAudio||t.audioContext)||t.waveformData&&(t.webAudio||t.audioContext)||t.dataUri&&t.waveformData))return t.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),t.webAudio={audioContext:t.audioContext}),t.dataUri?this._getRemoteWaveformData(t,e):t.waveformData?this._buildWaveformFromLocalData(t,e):t.webAudio?t.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(t,e):this._buildWaveformDataUsingWebAudio(t,e):void e(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"));e(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."))},or.prototype._getRemoteWaveformData=function(t,e){var n,r=this,i=null,o=null;Ke(t.dataUri)?(i=t.dataUri,["ArrayBuffer","JSON"].some(function(t){if(window[t])return o=t.toLowerCase(),n=i[o],Boolean(n)}),n?(r._xhr=r._createXHR(n,o,t.withCredentials,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&ar(this)){r._xhr=null;var n=Ee.create(t.target.response);1===n.channels||2===n.channels?8===n.bits?e(void 0,n):e(new Error("Peaks.init(): 16-bit waveform data is not supported")):e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"))}else e(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){e(new Error("XHR failed"))},function(){e(new Error("XHR aborted"))}),r._xhr.send()):e(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"))):e(new TypeError("Peaks.init(): The dataUri option must be an object"))},or.prototype._buildWaveformFromLocalData=function(t,e){var n,r=null,i=null;if(Ke(t.waveformData))if(Ke((r=t.waveformData).json)?i=r.json:(n=r.arraybuffer,Object.prototype.toString.call(n).includes("ArrayBuffer")&&(i=r.arraybuffer)),i)try{var o=Ee.create(i);if(1!==o.channels&&2!==o.channels)return void e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));if(8!==o.bits)return void e(new Error("Peaks.init(): 16-bit waveform data is not supported"));e(void 0,o)}catch(t){e(t)}else e(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));else e(new Error("Peaks.init(): The waveformData option must be an object"))},or.prototype._buildWaveformDataUsingWebAudio=function(t,e){var n=this,r=window.AudioContext||window.webkitAudioContext;if(t.webAudio.audioContext instanceof r){var i=t.webAudio;i.scale!==t.zoomLevels[0]&&(i.scale=t.zoomLevels[0]);var o=n._peaks.options.mediaElement.currentSrc;o?n._requestAudioAndBuildWaveformData(o,i,t.withCredentials,e):n._peaks.once("player.canplay",function(){n._requestAudioAndBuildWaveformData(n._peaks.options.mediaElement.currentSrc,i,t.withCredentials,e)})}else e(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"))},or.prototype._buildWaveformDataFromAudioBuffer=function(t,e){var n=t.webAudio;n.scale!==t.zoomLevels[0]&&(n.scale=t.zoomLevels[0]);var r={audio_buffer:n.audioBuffer,split_channels:n.multiChannel,scale:n.scale,disable_worker:!0};Ee.createFromAudio(r,e)},or.prototype._requestAudioAndBuildWaveformData=function(t,e,n,r){var i=this;t?(i._xhr=i._createXHR(t,"arraybuffer",n,function(t){if(4===this.readyState)if(200===this.status||206===this.status&&ar(this)){i._xhr=null;var n={audio_context:e.audioContext,array_buffer:t.target.response,split_channels:e.multiChannel,scale:e.scale};Ee.createFromAudio(n,r)}else r(new Error("Unable to fetch remote data. HTTP status "+this.status))},function(){r(new Error("XHR failed"))},function(){r(new Error("XHR aborted"))}),i._xhr.send()):i._peaks._logger("Peaks.init(): The mediaElement src is invalid")},or.prototype.abort=function(){this._xhr&&this._xhr.abort()},or.prototype._createXHR=function(t,e,n,r,i,o){var a=new XMLHttpRequest;if(a.open("GET",t,!0),ir)try{a.responseType=e}catch(t){}return a.onload=r,a.onerror=i,ir&&n&&(a.withCredentials=!0),a.addEventListener("abort",o),a},sr.prototype=Object.create(Ge.prototype);var lr={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,playheadWidth:1,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},ur={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},hr={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},cr={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},dr={color:"#888888",minWidth:50};function fr(t,e){for(var n in e)Ve(e,n)&&Ve(t,n)&&(t[n]=e[n]);return t}function pr(t){var e=t.zoomview.container,n=t.overview.container;return tn(e)||tn(n)?e&&(e.clientWidth<=0||e.clientHeight<=0)?new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height"):n&&(n.clientWidth<=0||n.clientHeight<=0)?new Error("Peaks.init(): The overview container must be visible and have non-zero width and height"):void 0:new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements")}sr.init=function(t,e){if(!e)throw new Error("Peaks.init(): Missing callback function");var n=new sr,r=n._setOptions(t);if(r||(r=pr(n.options)),r)e(r);else{var i=null;if(n.options.scrollbar){if(!tn(i=n.options.scrollbar.container))return void e(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));if(i.clientWidth<=0)return void e(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"))}t.keyboard&&(n._keyboardHandler=new Tn(n));var o=t.player?t.player:new An(n.options.mediaElement);n.player=new In(n,o),n.segments=new kn(n),n.points=new yn(n),n.zoom=new rr(n,n.options.zoomLevels),n.views=new nr(n),n._waveformBuilder=new or(n),n.player.init(n).then(function(){n._waveformBuilder.init(n.options,function(r,o){if(r)e(r);else if(r=pr(n.options))e(r);else{n._waveformBuilder=null,n._waveformData=o;var a=n.options.zoomview.container,s=n.options.overview.container;a&&n.views.createZoomview(a),s&&n.views.createOverview(s),i&&n.views.createScrollbar(i),t.segments&&n.segments.add(t.segments),t.points&&n.points.add(t.points),t.emitCueEvents&&(n._cueEmitter=new cn(n)),e(null,n)}})}).catch(function(t){e(t)})}},sr.prototype._setOptions=function(t){if(!Ke(t))return new TypeError("Peaks.init(): The options parameter should be an object");if(!t.player){if(!t.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(t.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}return t.logger&&"function"!=typeof t.logger?new TypeError("Peaks.init(): The logger option should be a function"):t.segments&&!Array.isArray(t.segments)?new TypeError("Peaks.init(): options.segments must be an array of segment objects"):t.points&&!Array.isArray(t.points)?new TypeError("Peaks.init(): options.points must be an array of point objects"):(fr(this.options,t),this.options.overview=function(t){var e={};return t.overview&&t.overview.showPlayheadTime&&(e.showPlayheadTime=t.overview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.overview&&Ve(t.overview,n)?e[n]=t.overview[n]:Ve(t,n)?e[n]=t[n]:Ve(e,n)||(Ve(hr,n)?e[n]=hr[n]:Ve(lr,n)&&(e[n]=lr[n]))}),e}(t),this.options.zoomview=function(t){var e={};return t.showPlayheadTime?e.showPlayheadTime=t.showPlayheadTime:t.zoomview&&t.zoomview.showPlayheadTime&&(e.showPlayheadTime=t.zoomview.showPlayheadTime),["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","playheadWidth","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"].forEach(function(n){t.zoomview&&Ve(t.zoomview,n)?e[n]=t.zoomview[n]:Ve(t,n)?e[n]=t[n]:Ve(e,n)||(Ve(ur,n)?e[n]=ur[n]:Ve(lr,n)&&(e[n]=lr[n]))}),e}(t),this.options.scrollbar=function(t){if(!Ve(t,"scrollbar"))return null;var e={};return["container","color","minWidth"].forEach(function(n){Ve(t.scrollbar,n)?e[n]=t.scrollbar[n]:e[n]=dr[n]}),e}(t),function(t,e){t.segmentOptions={},Ye(t.segmentOptions,cr),e.segmentOptions&&fr(t.segmentOptions,e.segmentOptions),t.zoomview.segmentOptions={},Ye(t.zoomview.segmentOptions,t.segmentOptions),e.zoomview&&e.zoomview.segmentOptions&&fr(t.zoomview.segmentOptions,e.zoomview.segmentOptions),t.overview.segmentOptions={},Ye(t.overview.segmentOptions,t.segmentOptions),e.overview&&e.overview.segmentOptions&&fr(t.overview.segmentOptions,e.overview.segmentOptions)}(this.options,t),Array.isArray(this.options.zoomLevels)?0===this.options.zoomLevels.length?new Error("Peaks.init(): The zoomLevels array must not be empty"):function(t){if(0===t.length)return!0;for(var e=t[0],n=1;n<t.length;n++){if(e>=t[n])return!1;e=t[n]}return!0}(this.options.zoomLevels)?void(this._logger=this.options.logger):new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order"):new TypeError("Peaks.init(): The zoomLevels option should be an array"))},sr.prototype.setSource=function(t,e){var n=this;n.player._setSource(t).then(function(){t.zoomLevels||(t.zoomLevels=n.options.zoomLevels),n._waveformBuilder=new or(n),n._waveformBuilder.init(t,function(r,i){r?e(r):(n._waveformBuilder=null,n._waveformData=i,["overview","zoomview"].forEach(function(t){var e=n.views.getView(t);e&&e.setWaveformData(i)}),n.zoom.setZoomLevels(t.zoomLevels),e())})}).catch(function(t){e(t)})},sr.prototype.getWaveformData=function(){return this._waveformData},sr.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};var gr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function mr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vr,yr,_r={};function br(){if(yr)return vr;yr=1;var t=function(t){return t&&t.Math===Math&&t};return vr=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof gr&&gr)||t("object"==typeof vr&&vr)||function(){return this}()||Function("return this")()}var wr,Sr,kr,xr,Cr,Tr,Ar,Er,Pr={};function Ir(){return Sr?wr:(Sr=1,wr=function(t){try{return!!t()}catch(t){return!0}})}function Mr(){if(xr)return kr;xr=1;var t=Ir();return kr=!t(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})}function Dr(){if(Tr)return Cr;Tr=1;var t=Ir();return Cr=!t(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})}function Or(){if(Er)return Ar;Er=1;var t=Dr(),e=Function.prototype.call;return Ar=t?e.bind(e):function(){return e.apply(e,arguments)},Ar}var Lr,Rr,Br,Fr,Ur,Wr,Gr,jr,Hr,Nr,zr,Xr,Vr,Yr,Zr,qr,Kr,Jr,Qr,$r,ti,ei,ni,ri,ii,oi,ai,si,li,ui,hi,ci,di,fi,pi,gi,mi,vi,yi,_i,bi,wi={};function Si(){if(Lr)return wi;Lr=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return wi.f=n?function(t){var n=e(this,t);return!!n&&n.enumerable}:t,wi}function ki(){return Br?Rr:(Br=1,Rr=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}})}function xi(){if(Ur)return Fr;Ur=1;var t=Dr(),e=Function.prototype,n=e.call,r=t&&e.bind.bind(n,n);return Fr=t?r:function(t){return function(){return n.apply(t,arguments)}},Fr}function Ci(){if(Gr)return Wr;Gr=1;var t=xi(),e=t({}.toString),n=t("".slice);return Wr=function(t){return n(e(t),8,-1)}}function Ti(){if(Hr)return jr;Hr=1;var t=xi(),e=Ir(),n=Ci(),r=Object,i=t("".split);return jr=e(function(){return!r("z").propertyIsEnumerable(0)})?function(t){return"String"===n(t)?i(t,""):r(t)}:r}function Ai(){return zr?Nr:(zr=1,Nr=function(t){return null==t})}function Ei(){if(Vr)return Xr;Vr=1;var t=Ai(),e=TypeError;return Xr=function(n){if(t(n))throw new e("Can't call method on "+n);return n}}function Pi(){if(Zr)return Yr;Zr=1;var t=Ti(),e=Ei();return Yr=function(n){return t(e(n))}}function Ii(){if(Kr)return qr;Kr=1;var t="object"==typeof document&&document.all;return qr=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(t){return"function"==typeof t}}function Mi(){if(Qr)return Jr;Qr=1;var t=Ii();return Jr=function(e){return"object"==typeof e?null!==e:t(e)}}function Di(){if(ti)return $r;ti=1;var t=br(),e=Ii();return $r=function(n,r){return arguments.length<2?(i=t[n],e(i)?i:void 0):t[n]&&t[n][r];var i},$r}function Oi(){if(ni)return ei;ni=1;var t=xi();return ei=t({}.isPrototypeOf)}function Li(){if(ii)return ri;ii=1;var t=br().navigator,e=t&&t.userAgent;return ri=e?String(e):""}function Ri(){if(ai)return oi;ai=1;var t,e,n=br(),r=Li(),i=n.process,o=n.Deno,a=i&&i.versions||o&&o.version,s=a&&a.v8;return s&&(e=(t=s.split("."))[0]>0&&t[0]<4?1:+(t[0]+t[1])),!e&&r&&(!(t=r.match(/Edge\/(\d+)/))||t[1]>=74)&&(t=r.match(/Chrome\/(\d+)/))&&(e=+t[1]),oi=e}function Bi(){if(li)return si;li=1;var t=Ri(),e=Ir(),n=br().String;return si=!!Object.getOwnPropertySymbols&&!e(function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&t&&t<41})}function Fi(){if(hi)return ui;hi=1;var t=Bi();return ui=t&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}function Ui(){if(di)return ci;di=1;var t=Di(),e=Ii(),n=Oi(),r=Fi(),i=Object;return ci=r?function(t){return"symbol"==typeof t}:function(r){var o=t("Symbol");return e(o)&&n(o.prototype,i(r))}}function Wi(){if(pi)return fi;pi=1;var t=String;return fi=function(e){try{return t(e)}catch(t){return"Object"}}}function Gi(){if(mi)return gi;mi=1;var t=Ii(),e=Wi(),n=TypeError;return gi=function(r){if(t(r))return r;throw new n(e(r)+" is not a function")}}function ji(){if(yi)return vi;yi=1;var t=Gi(),e=Ai();return vi=function(n,r){var i=n[r];return e(i)?void 0:t(i)}}function Hi(){if(bi)return _i;bi=1;var t=Or(),e=Ii(),n=Mi(),r=TypeError;return _i=function(i,o){var a,s;if("string"===o&&e(a=i.toString)&&!n(s=t(a,i)))return s;if(e(a=i.valueOf)&&!n(s=t(a,i)))return s;if("string"!==o&&e(a=i.toString)&&!n(s=t(a,i)))return s;throw new r("Can't convert object to primitive value")}}var Ni,zi,Xi,Vi,Yi,Zi,qi,Ki,Ji,Qi,$i,to,eo,no,ro,io,oo,ao,so,lo,uo,ho,co,fo,po={exports:{}};function go(){return zi?Ni:(zi=1,Ni=!1)}function mo(){if(Vi)return Xi;Vi=1;var t=br(),e=Object.defineProperty;return Xi=function(n,r){try{e(t,n,{value:r,configurable:!0,writable:!0})}catch(e){t[n]=r}return r},Xi}function vo(){if(Yi)return po.exports;Yi=1;var t=go(),e=br(),n=mo(),r="__core-js_shared__",i=po.exports=e[r]||n(r,{});return(i.versions||(i.versions=[])).push({version:"3.47.0",mode:t?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.47.0/LICENSE",source:"https://github.com/zloirock/core-js"}),po.exports}function yo(){if(qi)return Zi;qi=1;var t=vo();return Zi=function(e,n){return t[e]||(t[e]=n||{})},Zi}function _o(){if(Ji)return Ki;Ji=1;var t=Ei(),e=Object;return Ki=function(n){return e(t(n))}}function bo(){if($i)return Qi;$i=1;var t=xi(),e=_o(),n=t({}.hasOwnProperty);return Qi=Object.hasOwn||function(t,r){return n(e(t),r)},Qi}function wo(){if(eo)return to;eo=1;var t=xi(),e=0,n=Math.random(),r=t(1.1.toString);return to=function(t){return"Symbol("+(void 0===t?"":t)+")_"+r(++e+n,36)},to}function So(){if(ro)return no;ro=1;var t=br(),e=yo(),n=bo(),r=wo(),i=Bi(),o=Fi(),a=t.Symbol,s=e("wks"),l=o?a.for||a:a&&a.withoutSetter||r;return no=function(t){return n(s,t)||(s[t]=i&&n(a,t)?a[t]:l("Symbol."+t)),s[t]}}function ko(){if(oo)return io;oo=1;var t=Or(),e=Mi(),n=Ui(),r=ji(),i=Hi(),o=So(),a=TypeError,s=o("toPrimitive");return io=function(o,l){if(!e(o)||n(o))return o;var u,h=r(o,s);if(h){if(void 0===l&&(l="default"),u=t(h,o,l),!e(u)||n(u))return u;throw new a("Can't convert object to primitive value")}return void 0===l&&(l="number"),i(o,l)}}function xo(){if(so)return ao;so=1;var t=ko(),e=Ui();return ao=function(n){var r=t(n,"string");return e(r)?r:r+""},ao}function Co(){if(uo)return lo;uo=1;var t=br(),e=Mi(),n=t.document,r=e(n)&&e(n.createElement);return lo=function(t){return r?n.createElement(t):{}}}function To(){if(co)return ho;co=1;var t=Mr(),e=Ir(),n=Co();return ho=!t&&!e(function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a})}function Ao(){if(fo)return Pr;fo=1;var t=Mr(),e=Or(),n=Si(),r=ki(),i=Pi(),o=xo(),a=bo(),s=To(),l=Object.getOwnPropertyDescriptor;return Pr.f=t?l:function(t,u){if(t=i(t),u=o(u),s)try{return l(t,u)}catch(t){}if(a(t,u))return r(!e(n.f,t,u),t[u])},Pr}var Eo,Po,Io,Mo,Do,Oo,Lo,Ro={};function Bo(){if(Po)return Eo;Po=1;var t=Mr(),e=Ir();return Eo=t&&e(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})}function Fo(){if(Mo)return Io;Mo=1;var t=Mi(),e=String,n=TypeError;return Io=function(r){if(t(r))return r;throw new n(e(r)+" is not an object")}}function Uo(){if(Do)return Ro;Do=1;var t=Mr(),e=To(),n=Bo(),r=Fo(),i=xo(),o=TypeError,a=Object.defineProperty,s=Object.getOwnPropertyDescriptor,l="enumerable",u="configurable",h="writable";return Ro.f=t?n?function(t,e,n){if(r(t),e=i(e),r(n),"function"==typeof t&&"prototype"===e&&"value"in n&&h in n&&!n[h]){var o=s(t,e);o&&o[h]&&(t[e]=n.value,n={configurable:u in n?n[u]:o[u],enumerable:l in n?n[l]:o[l],writable:!1})}return a(t,e,n)}:a:function(t,n,s){if(r(t),n=i(n),r(s),e)try{return a(t,n,s)}catch(t){}if("get"in s||"set"in s)throw new o("Accessors not supported");return"value"in s&&(t[n]=s.value),t},Ro}function Wo(){if(Lo)return Oo;Lo=1;var t=Mr(),e=Uo(),n=ki();return Oo=t?function(t,r,i){return e.f(t,r,n(1,i))}:function(t,e,n){return t[e]=n,t},Oo}var Go,jo,Ho,No,zo,Xo,Vo,Yo,Zo,qo,Ko,Jo,Qo,$o,ta,ea={exports:{}};function na(){if(jo)return Go;jo=1;var t=Mr(),e=bo(),n=Function.prototype,r=t&&Object.getOwnPropertyDescriptor,i=e(n,"name"),o=i&&"something"===function(){}.name,a=i&&(!t||t&&r(n,"name").configurable);return Go={EXISTS:i,PROPER:o,CONFIGURABLE:a}}function ra(){if(No)return Ho;No=1;var t=xi(),e=Ii(),n=vo(),r=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(t){return r(t)}),Ho=n.inspectSource}function ia(){if(Yo)return Vo;Yo=1;var t=yo(),e=wo(),n=t("keys");return Vo=function(t){return n[t]||(n[t]=e(t))},Vo}function oa(){return qo?Zo:(qo=1,Zo={})}function aa(){if(Jo)return Ko;Jo=1;var t,e,n,r=function(){if(Xo)return zo;Xo=1;var t=br(),e=Ii(),n=t.WeakMap;return zo=e(n)&&/native code/.test(String(n))}(),i=br(),o=Mi(),a=Wo(),s=bo(),l=vo(),u=ia(),h=oa(),c="Object already initialized",d=i.TypeError,f=i.WeakMap;if(r||l.state){var p=l.state||(l.state=new f);p.get=p.get,p.has=p.has,p.set=p.set,t=function(t,e){if(p.has(t))throw new d(c);return e.facade=t,p.set(t,e),e},e=function(t){return p.get(t)||{}},n=function(t){return p.has(t)}}else{var g=u("state");h[g]=!0,t=function(t,e){if(s(t,g))throw new d(c);return e.facade=t,a(t,g,e),e},e=function(t){return s(t,g)?t[g]:{}},n=function(t){return s(t,g)}}return Ko={set:t,get:e,has:n,enforce:function(r){return n(r)?e(r):t(r,{})},getterFor:function(t){return function(n){var r;if(!o(n)||(r=e(n)).type!==t)throw new d("Incompatible receiver, "+t+" required");return r}}}}function sa(){if(Qo)return ea.exports;Qo=1;var t=xi(),e=Ir(),n=Ii(),r=bo(),i=Mr(),o=na().CONFIGURABLE,a=ra(),s=aa(),l=s.enforce,u=s.get,h=String,c=Object.defineProperty,d=t("".slice),f=t("".replace),p=t([].join),g=i&&!e(function(){return 8!==c(function(){},"length",{value:8}).length}),m=String(String).split("String"),v=ea.exports=function(t,e,n){"Symbol("===d(h(e),0,7)&&(e="["+f(h(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!r(t,"name")||o&&t.name!==e)&&(i?c(t,"name",{value:e,configurable:!0}):t.name=e),g&&n&&r(n,"arity")&&t.length!==n.arity&&c(t,"length",{value:n.arity});try{n&&r(n,"constructor")&&n.constructor?i&&c(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var a=l(t);return r(a,"source")||(a.source=p(m,"string"==typeof e?e:"")),t};return Function.prototype.toString=v(function(){return n(this)&&u(this).source||a(this)},"toString"),ea.exports}function la(){if(ta)return $o;ta=1;var t=Ii(),e=Uo(),n=sa(),r=mo();return $o=function(i,o,a,s){s||(s={});var l=s.enumerable,u=void 0!==s.name?s.name:o;if(t(a)&&n(a,u,s),s.global)l?i[o]=a:r(o,a);else{try{s.unsafe?i[o]&&(l=!0):delete i[o]}catch(t){}l?i[o]=a:e.f(i,o,{value:a,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return i},$o}var ua,ha,ca,da,fa,pa,ga,ma,va,ya,_a,ba,wa,Sa,ka,xa,Ca,Ta={};function Aa(){if(da)return ca;da=1;var t=function(){if(ha)return ua;ha=1;var t=Math.ceil,e=Math.floor;return ua=Math.trunc||function(n){var r=+n;return(r>0?e:t)(r)}}();return ca=function(e){var n=+e;return n!=n||0===n?0:t(n)}}function Ea(){if(pa)return fa;pa=1;var t=Aa(),e=Math.max,n=Math.min;return fa=function(r,i){var o=t(r);return o<0?e(o+i,0):n(o,i)}}function Pa(){if(ma)return ga;ma=1;var t=Aa(),e=Math.min;return ga=function(n){var r=t(n);return r>0?e(r,9007199254740991):0},ga}function Ia(){if(ya)return va;ya=1;var t=Pa();return va=function(e){return t(e.length)}}function Ma(){if(ba)return _a;ba=1;var t=Pi(),e=Ea(),n=Ia(),r=function(r){return function(i,o,a){var s=t(i),l=n(s);if(0===l)return!r&&-1;var u,h=e(a,l);if(r&&o!=o){for(;l>h;)if((u=s[h++])!=u)return!0}else for(;l>h;h++)if((r||h in s)&&s[h]===o)return r||h||0;return!r&&-1}};return _a={includes:r(!0),indexOf:r(!1)}}function Da(){if(Sa)return wa;Sa=1;var t=xi(),e=bo(),n=Pi(),r=Ma().indexOf,i=oa(),o=t([].push);return wa=function(t,a){var s,l=n(t),u=0,h=[];for(s in l)!e(i,s)&&e(l,s)&&o(h,s);for(;a.length>u;)e(l,s=a[u++])&&(~r(h,s)||o(h,s));return h},wa}function Oa(){return xa?ka:(xa=1,ka=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"])}function La(){if(Ca)return Ta;Ca=1;var t=Da(),e=Oa().concat("length","prototype");return Ta.f=Object.getOwnPropertyNames||function(n){return t(n,e)},Ta}var Ra,Ba,Fa,Ua,Wa,Ga,ja,Ha,Na,za,Xa,Va,Ya,Za,qa={};function Ka(){return Ra||(Ra=1,qa.f=Object.getOwnPropertySymbols),qa}function Ja(){if(Wa)return Ua;Wa=1;var t=bo(),e=function(){if(Fa)return Ba;Fa=1;var t=Di(),e=xi(),n=La(),r=Ka(),i=Fo(),o=e([].concat);return Ba=t("Reflect","ownKeys")||function(t){var e=n.f(i(t)),a=r.f;return a?o(e,a(t)):e},Ba}(),n=Ao(),r=Uo();return Ua=function(i,o,a){for(var s=e(o),l=r.f,u=n.f,h=0;h<s.length;h++){var c=s[h];t(i,c)||a&&t(a,c)||l(i,c,u(o,c))}},Ua}function Qa(){if(ja)return Ga;ja=1;var t=Ir(),e=Ii(),n=/#|\.prototype\./,r=function(n,r){var l=o[i(n)];return l===s||l!==a&&(e(r)?t(r):!!r)},i=r.normalize=function(t){return String(t).replace(n,".").toLowerCase()},o=r.data={},a=r.NATIVE="N",s=r.POLYFILL="P";return Ga=r}function $a(){if(Na)return Ha;Na=1;var t=br(),e=Ao().f,n=Wo(),r=la(),i=mo(),o=Ja(),a=Qa();return Ha=function(s,l){var u,h,c,d,f,p=s.target,g=s.global,m=s.stat;if(u=g?t:m?t[p]||i(p,{}):t[p]&&t[p].prototype)for(h in l){if(d=l[h],c=s.dontCallGetSet?(f=e(u,h))&&f.value:u[h],!a(g?h:p+(m?".":"#")+h,s.forced)&&void 0!==c){if(typeof d==typeof c)continue;o(d,c)}(s.sham||c&&c.sham)&&n(d,"sham",!0),r(u,h,d,s)}},Ha}function ts(){if(Xa)return za;Xa=1;var t=Ci(),e=xi();return za=function(n){if("Function"===t(n))return e(n)}}function es(){if(Ya)return Va;Ya=1;var t=Ir();return Va=function(e,n){var r=[][e];return!!r&&t(function(){r.call(null,n||function(){return 1},1)})}}!function(){if(Za)return _r;Za=1;var t=$a(),e=ts(),n=Ma().indexOf,r=es(),i=e([].indexOf),o=!!i&&1/i([1],1,-0)<0;t({target:"Array",proto:!0,forced:o||!r("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return o?i(this,t,e)||0:n(this,t,e)}})}();var ns,rs,is,os,as,ss,ls,us,hs,cs,ds,fs,ps,gs,ms,vs,ys,_s,bs,ws,Ss,ks,xs,Cs,Ts,As,Es,Ps,Is,Ms,Ds,Os,Ls,Rs,Bs,Fs={};function Us(){if(rs)return ns;rs=1;var t=Da(),e=Oa();return ns=Object.keys||function(n){return t(n,e)}}function Ws(){if(as)return os;as=1;var t=Di();return os=t("document","documentElement")}function Gs(){if(ls)return ss;ls=1;var t,e=Fo(),n=function(){if(is)return Fs;is=1;var t=Mr(),e=Bo(),n=Uo(),r=Fo(),i=Pi(),o=Us();return Fs.f=t&&!e?Object.defineProperties:function(t,e){r(t);for(var a,s=i(e),l=o(e),u=l.length,h=0;u>h;)n.f(t,a=l[h++],s[a]);return t},Fs}(),r=Oa(),i=oa(),o=Ws(),a=Co(),s=ia(),l="prototype",u="script",h=s("IE_PROTO"),c=function(){},d=function(t){return"<"+u+">"+t+"</"+u+">"},f=function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e},p=function(){try{t=new ActiveXObject("htmlfile")}catch(t){}var e,n,i;p="undefined"!=typeof document?document.domain&&t?f(t):(n=a("iframe"),i="java"+u+":",n.style.display="none",o.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F):f(t);for(var s=r.length;s--;)delete p[l][r[s]];return p()};return i[h]=!0,ss=Object.create||function(t,r){var i;return null!==t?(c[l]=e(t),i=new c,c[l]=null,i[h]=t):i=p(),void 0===r?i:n.f(i,r)}}function js(){if(hs)return us;hs=1;var t=So(),e=Gs(),n=Uo().f,r=t("unscopables"),i=Array.prototype;return void 0===i[r]&&n(i,r,{configurable:!0,value:e(null)}),us=function(t){i[r][t]=!0},us}function Hs(){return ds?cs:(ds=1,cs={})}function Ns(){if(ms)return gs;ms=1;var t=bo(),e=Ii(),n=_o(),r=ia(),i=function(){if(ps)return fs;ps=1;var t=Ir();return fs=!t(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})}(),o=r("IE_PROTO"),a=Object,s=a.prototype;return gs=i?a.getPrototypeOf:function(r){var i=n(r);if(t(i,o))return i[o];var l=i.constructor;return e(l)&&i instanceof l?l.prototype:i instanceof a?s:null}}function zs(){if(ys)return vs;ys=1;var t,e,n,r=Ir(),i=Ii(),o=Mi(),a=Gs(),s=Ns(),l=la(),u=So(),h=go(),c=u("iterator"),d=!1;return[].keys&&("next"in(n=[].keys())?(e=s(s(n)))!==Object.prototype&&(t=e):d=!0),!o(t)||r(function(){var e={};return t[c].call(e)!==e})?t={}:h&&(t=a(t)),i(t[c])||l(t,c,function(){return this}),vs={IteratorPrototype:t,BUGGY_SAFARI_ITERATORS:d}}function Xs(){if(bs)return _s;bs=1;var t=Uo().f,e=bo(),n=So()("toStringTag");return _s=function(r,i,o){r&&!o&&(r=r.prototype),r&&!e(r,n)&&t(r,n,{configurable:!0,value:i})}}function Vs(){if(Ss)return ws;Ss=1;var t=zs().IteratorPrototype,e=Gs(),n=ki(),r=Xs(),i=Hs(),o=function(){return this};return ws=function(a,s,l,u){var h=s+" Iterator";return a.prototype=e(t,{next:n(+!u,l)}),r(a,h,!1,!0),i[h]=o,a}}function Ys(){if(Ts)return Cs;Ts=1;var t=Mi();return Cs=function(e){return t(e)||null===e}}function Zs(){if(Es)return As;Es=1;var t=Ys(),e=String,n=TypeError;return As=function(r){if(t(r))return r;throw new n("Can't set "+e(r)+" as a prototype")}}function qs(){if(Is)return Ps;Is=1;var t=function(){if(xs)return ks;xs=1;var t=xi(),e=Gi();return ks=function(n,r,i){try{return t(e(Object.getOwnPropertyDescriptor(n,r)[i]))}catch(t){}},ks}(),e=Mi(),n=Ei(),r=Zs();return Ps=Object.setPrototypeOf||("__proto__"in{}?function(){var i,o=!1,a={};try{(i=t(Object.prototype,"__proto__","set"))(a,[]),o=a instanceof Array}catch(t){}return function(t,a){return n(t),r(a),e(t)?(o?i(t,a):t.__proto__=a,t):t}}():void 0)}function Ks(){if(Ds)return Ms;Ds=1;var t=$a(),e=Or(),n=go(),r=na(),i=Ii(),o=Vs(),a=Ns(),s=qs(),l=Xs(),u=Wo(),h=la(),c=So(),d=Hs(),f=zs(),p=r.PROPER,g=r.CONFIGURABLE,m=f.IteratorPrototype,v=f.BUGGY_SAFARI_ITERATORS,y=c("iterator"),_="keys",b="values",w="entries",S=function(){return this};return Ms=function(r,c,f,k,x,C,T){o(f,c,k);var A,E,P,I=function(t){if(t===x&&R)return R;if(!v&&t&&t in O)return O[t];switch(t){case _:case b:case w:return function(){return new f(this,t)}}return function(){return new f(this)}},M=c+" Iterator",D=!1,O=r.prototype,L=O[y]||O["@@iterator"]||x&&O[x],R=!v&&L||I(x),B="Array"===c&&O.entries||L;if(B&&(A=a(B.call(new r)))!==Object.prototype&&A.next&&(n||a(A)===m||(s?s(A,m):i(A[y])||h(A,y,S)),l(A,M,!0,!0),n&&(d[M]=S)),p&&x===b&&L&&L.name!==b&&(!n&&g?u(O,"name",b):(D=!0,R=function(){return e(L,this)})),x)if(E={values:I(b),keys:C?R:I(_),entries:I(w)},T)for(P in E)(v||D||!(P in O))&&h(O,P,E[P]);else t({target:c,proto:!0,forced:v||D},E);return n&&!T||O[y]===R||h(O,y,R,{name:x}),d[c]=R,E}}function Js(){return Ls?Os:(Ls=1,Os=function(t,e){return{value:t,done:e}})}function Qs(){if(Bs)return Rs;Bs=1;var t=Pi(),e=js(),n=Hs(),r=aa(),i=Uo().f,o=Ks(),a=Js(),s=go(),l=Mr(),u="Array Iterator",h=r.set,c=r.getterFor(u);Rs=o(Array,"Array",function(e,n){h(this,{type:u,target:t(e),index:0,kind:n})},function(){var t=c(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,a(void 0,!0);switch(t.kind){case"keys":return a(n,!1);case"values":return a(e[n],!1)}return a([n,e[n]],!1)},"values");var d=n.Arguments=n.Array;if(e("keys"),e("values"),e("entries"),!s&&l&&"values"!==d.name)try{i(d,"name",{value:"values"})}catch(t){}return Rs}Qs();var $s,tl,el,nl,rl,il,ol,al,sl,ll,ul,hl,cl,dl,fl,pl={};function gl(){if(tl)return $s;tl=1;var t=Ci();return $s=Array.isArray||function(e){return"Array"===t(e)}}function ml(){if(nl)return el;nl=1;var t={};return t[So()("toStringTag")]="z",el="[object z]"===String(t)}function vl(){if(il)return rl;il=1;var t=ml(),e=Ii(),n=Ci(),r=So()("toStringTag"),i=Object,o="Arguments"===n(function(){return arguments}());return rl=t?n:function(t){var a,s,l;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(s=function(t,e){try{return t[e]}catch(t){}}(a=i(t),r))?s:o?n(a):"Object"===(l=n(a))&&e(a.callee)?"Arguments":l},rl}function yl(){if(al)return ol;al=1;var t=xi(),e=Ir(),n=Ii(),r=vl(),i=Di(),o=ra(),a=function(){},s=i("Reflect","construct"),l=/^\s*(?:class|function)\b/,u=t(l.exec),h=!l.test(a),c=function(t){if(!n(t))return!1;try{return s(a,[],t),!0}catch(t){return!1}},d=function(t){if(!n(t))return!1;switch(r(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!u(l,o(t))}catch(t){return!0}};return d.sham=!0,ol=!s||e(function(){var t;return c(c.call)||!c(Object)||!c(function(){t=!0})||t})?d:c}function _l(){if(ll)return sl;ll=1;var t=Mr(),e=Uo(),n=ki();return sl=function(r,i,o){t?e.f(r,i,n(0,o)):r[i]=o},sl}function bl(){if(hl)return ul;hl=1;var t=Ir(),e=So(),n=Ri(),r=e("species");return ul=function(e){return n>=51||!t(function(){var t=[];return(t.constructor={})[r]=function(){return{foo:1}},1!==t[e](Boolean).foo})}}function wl(){if(dl)return cl;dl=1;var t=xi();return cl=t([].slice)}!function(){if(fl)return pl;fl=1;var t=$a(),e=gl(),n=yl(),r=Mi(),i=Ea(),o=Ia(),a=Pi(),s=_l(),l=So(),u=bl(),h=wl(),c=u("slice"),d=l("species"),f=Array,p=Math.max;t({target:"Array",proto:!0,forced:!c},{slice:function(t,l){var u,c,g,m=a(this),v=o(m),y=i(t,v),_=i(void 0===l?v:l,v);if(e(m)&&(u=m.constructor,(n(u)&&(u===f||e(u.prototype))||r(u)&&null===(u=u[d]))&&(u=void 0),u===f||void 0===u))return h(m,y,_);for(c=new(void 0===u?f:u)(p(_-y,0)),g=0;y<_;y++,g++)y in m&&s(c,g,m[y]);return c.length=g,c}})}();var Sl,kl,xl,Cl,Tl,Al,El,Pl,Il,Ml,Dl,Ol={};function Ll(){if(Cl)return xl;Cl=1;var t=TypeError;return xl=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}}function Rl(){if(Al)return Tl;Al=1;var t=gl(),e=yl(),n=Mi(),r=So()("species"),i=Array;return Tl=function(o){var a;return t(o)&&(a=o.constructor,(e(a)&&(a===i||t(a.prototype))||n(a)&&null===(a=a[r]))&&(a=void 0)),void 0===a?i:a}}function Bl(){if(Pl)return El;Pl=1;var t=Rl();return El=function(e,n){return new(t(e))(0===n?0:n)}}function Fl(){if(Ml)return Il;Ml=1;var t=Wi(),e=TypeError;return Il=function(n,r){if(!delete n[r])throw new e("Cannot delete property "+t(r)+" of "+t(n))}}!function(){if(Dl)return Ol;Dl=1;var t=$a(),e=_o(),n=Ea(),r=Aa(),i=Ia(),o=function(){if(kl)return Sl;kl=1;var t=Mr(),e=gl(),n=TypeError,r=Object.getOwnPropertyDescriptor,i=t&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();return Sl=i?function(t,i){if(e(t)&&!r(t,"length").writable)throw new n("Cannot set read only .length");return t.length=i}:function(t,e){return t.length=e}}(),a=Ll(),s=Bl(),l=_l(),u=Fl(),h=bl()("splice"),c=Math.max,d=Math.min;t({target:"Array",proto:!0,forced:!h},{splice:function(t,h){var f,p,g,m,v,y,_=e(this),b=i(_),w=n(t,b),S=arguments.length;for(0===S?f=p=0:1===S?(f=0,p=b-w):(f=S-2,p=d(c(r(h),0),b-w)),a(b+f-p),g=s(_,p),m=0;m<p;m++)(v=w+m)in _&&l(g,m,_[v]);if(g.length=p,f<p){for(m=w;m<b-p;m++)y=m+f,(v=m+p)in _?_[y]=_[v]:u(_,y);for(m=b;m>b-p+f;m--)u(_,m-1)}else if(f>p)for(m=b-p;m>w;m--)y=m+f-1,(v=m+p-1)in _?_[y]=_[v]:u(_,y);for(m=0;m<f;m++)_[m+w]=arguments[m+2];return o(_,b-p+f),g}})}();var Ul,Wl,Gl,jl={};!function(){if(Gl)return jl;Gl=1;var t=ml(),e=la(),n=function(){if(Wl)return Ul;Wl=1;var t=ml(),e=vl();return Ul=t?{}.toString:function(){return"[object "+e(this)+"]"}}();t||e(Object.prototype,"toString",n,{unsafe:!0})}();var Hl,Nl,zl,Xl,Vl,Yl,Zl,ql,Kl,Jl,Ql,$l,tu,eu,nu,ru,iu,ou,au,su,lu,uu,hu,cu,du,fu,pu,gu,mu,vu,yu,_u,bu,wu,Su,ku,xu,Cu,Tu={exports:{}},Au={};function Eu(){if(Hl)return Au;Hl=1;var t=Ci(),e=Pi(),n=La().f,r=wl(),i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];return Au.f=function(o){return i&&"Window"===t(o)?function(t){try{return n(t)}catch(t){return r(i)}}(o):n(e(o))},Au}function Pu(){if(Vl)return Xl;Vl=1;var t=Ir(),e=Mi(),n=Ci(),r=function(){if(zl)return Nl;zl=1;var t=Ir();return Nl=t(function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})}(),i=Object.isExtensible,o=t(function(){});return Xl=o||r?function(t){return!!e(t)&&((!r||"ArrayBuffer"!==n(t))&&(!i||i(t)))}:i}function Iu(){if(ql)return Tu.exports;ql=1;var t=$a(),e=xi(),n=oa(),r=Mi(),i=bo(),o=Uo().f,a=La(),s=Eu(),l=Pu(),u=wo(),h=function(){if(Zl)return Yl;Zl=1;var t=Ir();return Yl=!t(function(){return Object.isExtensible(Object.preventExtensions({}))})}(),c=!1,d=u("meta"),f=0,p=function(t){o(t,d,{value:{objectID:"O"+f++,weakData:{}}})},g=Tu.exports={enable:function(){g.enable=function(){},c=!0;var n=a.f,r=e([].splice),i={};i[d]=1,n(i).length&&(a.f=function(t){for(var e=n(t),i=0,o=e.length;i<o;i++)if(e[i]===d){r(e,i,1);break}return e},t({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:s.f}))},fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,d)){if(!l(t))return"F";if(!e)return"E";p(t)}return t[d].objectID},getWeakData:function(t,e){if(!i(t,d)){if(!l(t))return!0;if(!e)return!1;p(t)}return t[d].weakData},onFreeze:function(t){return h&&c&&l(t)&&!i(t,d)&&p(t),t}};return n[d]=!0,Tu.exports}function Mu(){if(Jl)return Kl;Jl=1;var t=ts(),e=Gi(),n=Dr(),r=t(t.bind);return Kl=function(t,i){return e(t),void 0===i?t:n?r(t,i):function(){return t.apply(i,arguments)}},Kl}function Du(){if($l)return Ql;$l=1;var t=So(),e=Hs(),n=t("iterator"),r=Array.prototype;return Ql=function(t){return void 0!==t&&(e.Array===t||r[n]===t)}}function Ou(){if(eu)return tu;eu=1;var t=vl(),e=ji(),n=Ai(),r=Hs(),i=So()("iterator");return tu=function(o){if(!n(o))return e(o,i)||e(o,"@@iterator")||r[t(o)]}}function Lu(){if(ru)return nu;ru=1;var t=Or(),e=Gi(),n=Fo(),r=Wi(),i=Ou(),o=TypeError;return nu=function(a,s){var l=arguments.length<2?i(a):s;if(e(l))return n(t(l,a));throw new o(r(a)+" is not iterable")},nu}function Ru(){if(ou)return iu;ou=1;var t=Or(),e=Fo(),n=ji();return iu=function(r,i,o){var a,s;e(r);try{if(!(a=n(r,"return"))){if("throw"===i)throw o;return o}a=t(a,r)}catch(t){s=!0,a=t}if("throw"===i)throw o;if(s)throw a;return e(a),o}}function Bu(){if(su)return au;su=1;var t=Mu(),e=Or(),n=Fo(),r=Wi(),i=Du(),o=Ia(),a=Oi(),s=Lu(),l=Ou(),u=Ru(),h=TypeError,c=function(t,e){this.stopped=t,this.result=e},d=c.prototype;return au=function(f,p,g){var m,v,y,_,b,w,S,k=g&&g.that,x=!(!g||!g.AS_ENTRIES),C=!(!g||!g.IS_RECORD),T=!(!g||!g.IS_ITERATOR),A=!(!g||!g.INTERRUPTED),E=t(p,k),P=function(t){return m&&u(m,"normal"),new c(!0,t)},I=function(t){return x?(n(t),A?E(t[0],t[1],P):E(t[0],t[1])):A?E(t,P):E(t)};if(C)m=f.iterator;else if(T)m=f;else{if(!(v=l(f)))throw new h(r(f)+" is not iterable");if(i(v)){for(y=0,_=o(f);_>y;y++)if((b=I(f[y]))&&a(d,b))return b;return new c(!1)}m=s(f,v)}for(w=C?f.next:m.next;!(S=e(w,m)).done;){try{b=I(S.value)}catch(t){u(m,"throw",t)}if("object"==typeof b&&b&&a(d,b))return b}return new c(!1)}}function Fu(){if(uu)return lu;uu=1;var t=Oi(),e=TypeError;return lu=function(n,r){if(t(r,n))return n;throw new e("Incorrect invocation")}}function Uu(){if(cu)return hu;cu=1;var t=So()("iterator"),e=!1;try{var n=0,r={next:function(){return{done:!!n++}},return:function(){e=!0}};r[t]=function(){return this},Array.from(r,function(){throw 2})}catch(t){}return hu=function(n,r){try{if(!r&&!e)return!1}catch(t){return!1}var i=!1;try{var o={};o[t]=function(){return{next:function(){return{done:i=!0}}}},n(o)}catch(t){}return i}}function Wu(){if(fu)return du;fu=1;var t=Ii(),e=Mi(),n=qs();return du=function(r,i,o){var a,s;return n&&t(a=i.constructor)&&a!==o&&e(s=a.prototype)&&s!==o.prototype&&n(r,s),r}}function Gu(){if(gu)return pu;gu=1;var t=$a(),e=br(),n=xi(),r=Qa(),i=la(),o=Iu(),a=Bu(),s=Fu(),l=Ii(),u=Ai(),h=Mi(),c=Ir(),d=Uu(),f=Xs(),p=Wu();return pu=function(g,m,v){var y=-1!==g.indexOf("Map"),_=-1!==g.indexOf("Weak"),b=y?"set":"add",w=e[g],S=w&&w.prototype,k=w,x={},C=function(t){var e=n(S[t]);i(S,t,"add"===t?function(t){return e(this,0===t?0:t),this}:"delete"===t?function(t){return!(_&&!h(t))&&e(this,0===t?0:t)}:"get"===t?function(t){return _&&!h(t)?void 0:e(this,0===t?0:t)}:"has"===t?function(t){return!(_&&!h(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(r(g,!l(w)||!(_||S.forEach&&!c(function(){(new w).entries().next()}))))k=v.getConstructor(m,g,y,b),o.enable();else if(r(g,!0)){var T=new k,A=T[b](_?{}:-0,1)!==T,E=c(function(){T.has(1)}),P=d(function(t){new w(t)}),I=!_&&c(function(){for(var t=new w,e=5;e--;)t[b](e,e);return!t.has(-0)});P||((k=m(function(t,e){s(t,S);var n=p(new w,t,k);return u(e)||a(e,n[b],{that:n,AS_ENTRIES:y}),n})).prototype=S,S.constructor=k),(E||I)&&(C("delete"),C("has"),y&&C("get")),(I||A)&&C(b),_&&S.clear&&delete S.clear}return x[g]=k,t({global:!0,constructor:!0,forced:k!==w},x),f(k,g),_||v.setStrong(k,g,y),k},pu}function ju(){if(vu)return mu;vu=1;var t=sa(),e=Uo();return mu=function(n,r,i){return i.get&&t(i.get,r,{getter:!0}),i.set&&t(i.set,r,{setter:!0}),e.f(n,r,i)}}function Hu(){if(_u)return yu;_u=1;var t=la();return yu=function(e,n,r){for(var i in n)t(e,i,n[i],r);return e},yu}function Nu(){if(wu)return bu;wu=1;var t=Di(),e=ju(),n=So(),r=Mr(),i=n("species");return bu=function(n){var o=t(n);r&&o&&!o[i]&&e(o,i,{configurable:!0,get:function(){return this}})}}function zu(){if(ku)return Su;ku=1;var t=Gs(),e=ju(),n=Hu(),r=Mu(),i=Fu(),o=Ai(),a=Bu(),s=Ks(),l=Js(),u=Nu(),h=Mr(),c=Iu().fastKey,d=aa(),f=d.set,p=d.getterFor;return Su={getConstructor:function(s,l,u,d){var g=s(function(e,n){i(e,m),f(e,{type:l,index:t(null),first:null,last:null,size:0}),h||(e.size=0),o(n)||a(n,e[d],{that:e,AS_ENTRIES:u})}),m=g.prototype,v=p(l),y=function(t,e,n){var r,i,o=v(t),a=_(t,e);return a?a.value=n:(o.last=a={index:i=c(e,!0),key:e,value:n,previous:r=o.last,next:null,removed:!1},o.first||(o.first=a),r&&(r.next=a),h?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t},_=function(t,e){var n,r=v(t),i=c(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key===e)return n};return n(m,{clear:function(){for(var e=v(this),n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=null),n=n.next;e.first=e.last=null,e.index=t(null),h?e.size=0:this.size=0},delete:function(t){var e=this,n=v(e),r=_(e,t);if(r){var i=r.next,o=r.previous;delete n.index[r.index],r.removed=!0,o&&(o.next=i),i&&(i.previous=o),n.first===r&&(n.first=i),n.last===r&&(n.last=o),h?n.size--:e.size--}return!!r},forEach:function(t){for(var e,n=v(this),i=r(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(i(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!_(this,t)}}),n(m,u?{get:function(t){var e=_(this,t);return e&&e.value},set:function(t,e){return y(this,0===t?0:t,e)}}:{add:function(t){return y(this,t=0===t?0:t,t)}}),h&&e(m,"size",{configurable:!0,get:function(){return v(this).size}}),g},setStrong:function(t,e,n){var r=e+" Iterator",i=p(e),o=p(r);s(t,e,function(t,e){f(this,{type:r,target:t,state:i(t),kind:e,last:null})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?l("keys"===e?n.key:"values"===e?n.value:[n.key,n.value],!1):(t.target=null,l(void 0,!0))},n?"entries":"values",!n,!0),u(e)}},Su}Cu||(Cu=1,xu||(xu=1,Gu()("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},zu())));var Xu,Vu,Yu,Zu,qu,Ku={};function Ju(){if(Vu)return Xu;Vu=1;var t=vl(),e=String;return Xu=function(n){if("Symbol"===t(n))throw new TypeError("Cannot convert a Symbol value to a string");return e(n)}}function Qu(){if(Zu)return Yu;Zu=1;var t=xi(),e=Aa(),n=Ju(),r=Ei(),i=t("".charAt),o=t("".charCodeAt),a=t("".slice),s=function(t){return function(s,l){var u,h,c=n(r(s)),d=e(l),f=c.length;return d<0||d>=f?t?"":void 0:(u=o(c,d))<55296||u>56319||d+1===f||(h=o(c,d+1))<56320||h>57343?t?i(c,d):u:t?a(c,d,d+2):h-56320+(u-55296<<10)+65536}};return Yu={codeAt:s(!1),charAt:s(!0)}}function $u(){if(qu)return Ku;qu=1;var t=Qu().charAt,e=Ju(),n=aa(),r=Ks(),i=Js(),o="String Iterator",a=n.set,s=n.getterFor(o);return r(String,"String",function(t){a(this,{type:o,string:e(t),index:0})},function(){var e,n=s(this),r=n.string,o=n.index;return o>=r.length?i(void 0,!0):(e=t(r,o),n.index+=e.length,i(e,!1))}),Ku}$u();var th,eh,nh={};eh||(eh=1,function(){if(th)return nh;th=1;var t=$a(),e=br();t({global:!0,forced:e.globalThis!==e},{globalThis:e})}());var rh,ih,oh,ah,sh,lh,uh,hh,ch,dh={};function fh(){return ih?rh:(ih=1,rh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})}function ph(){if(ah)return oh;ah=1;var t=Co()("span").classList,e=t&&t.constructor&&t.constructor.prototype;return oh=e===Object.prototype?void 0:e}function gh(){if(lh)return sh;lh=1;var t=Mu(),e=xi(),n=Ti(),r=_o(),i=Ia(),o=Bl(),a=e([].push),s=function(e){var s=1===e,l=2===e,u=3===e,h=4===e,c=6===e,d=7===e,f=5===e||c;return function(p,g,m,v){for(var y,_,b=r(p),w=n(b),S=i(w),k=t(g,m),x=0,C=v||o,T=s?C(p,S):l||d?C(p,0):void 0;S>x;x++)if((f||x in w)&&(_=k(y=w[x],x,b),e))if(s)T[x]=_;else if(_)switch(e){case 3:return!0;case 5:return y;case 6:return x;case 2:a(T,y)}else switch(e){case 4:return!1;case 7:a(T,y)}return c?-1:u||h?h:T}};return sh={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}}!function(){if(ch)return dh;ch=1;var t=br(),e=fh(),n=ph(),r=function(){if(hh)return uh;hh=1;var t=gh().forEach,e=es()("forEach");return uh=e?[].forEach:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)},uh}(),i=Wo(),o=function(t){if(t&&t.forEach!==r)try{i(t,"forEach",r)}catch(e){t.forEach=r}};for(var a in e)e[a]&&o(t[a]&&t[a].prototype);o(n)}();var mh,vh={};!function(){if(mh)return vh;mh=1;var t=br(),e=fh(),n=ph(),r=Qs(),i=Wo(),o=Xs(),a=So()("iterator"),s=r.values,l=function(t,n){if(t){if(t[a]!==s)try{i(t,a,s)}catch(e){t[a]=s}if(o(t,n,!0),e[n])for(var l in r)if(t[l]!==r[l])try{i(t,l,r[l])}catch(e){t[l]=r[l]}}};for(var u in e)l(t[u]&&t[u].prototype,u);l(n,"DOMTokenList")}(),function(t){var e=!(!t.starmusConfig||!t.starmusConfig.debug);function n(){if(e)try{(console.log||function(){}).apply(console,arguments)}catch(t){}}var r="function"==typeof Set,i={},o={};void 0===t.StarmusHooks&&(t.StarmusHooks={}),t.StarmusHooks.subscribe=function(t,e){var n,o;return i[t]||(i[t]=r?new Set:[]),n=i[t],o=e,r?n.add(o):-1===n.indexOf(o)&&n.push(o),function(){i[t]&&function(t,e){if(r)t.delete(e);else{var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}(i[t],e)}},t.StarmusHooks.dispatch=function(t,e,a){e=e||{};var s=t+"::"+((a=a||{}).instanceId||"");if(o[s])n("Prevented recursive dispatch:",t);else{o[s]=!0;try{var l=i[t];if(!l)return;!function(t,e){if(r)t.forEach(e);else for(var n=t.slice(),i=0;i<n.length;i++)e(n[i])}(l,function(n){try{n(e,a)}catch(e){console.error("Error executing handler for command "+t+":",e)}})}finally{delete o[s]}}},t.StarmusHooks.debugLog=n}("undefined"!=typeof window?window:globalThis);var yh="undefined"!=typeof window?window:globalThis,_h=yh.StarmusHooks&&yh.StarmusHooks.debugLog||function(){},bh=yh.StarmusHooks&&yh.StarmusHooks.dispatch||function(){},wh=yh.StarmusHooks&&yh.StarmusHooks.subscribe||function(){};"undefined"!=typeof module&&module.exports&&(module.exports={debugLog:_h,subscribe:yh.StarmusHooks.subscribe,dispatch:yh.StarmusHooks.dispatch});var Sh,kh={subscribe:wh,dispatch:bh,unsubscribeInstance:function(t){}},xh={};function Ch(t){return window.StarmusStore.createStore(t)}function Th(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Ah(t,e,n,r,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,i)}function Eh(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){Ah(o,r,i,a,s,"next",t)}function s(t){Ah(o,r,i,a,s,"throw",t)}a(void 0)})}}function Ph(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ih(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wh(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Mh(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=jh(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Dh(t,e,n){return(e=Wh(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Oh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Lh(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Oh(Object(n),!0).forEach(function(e){Dh(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Oh(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Rh(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=r&&r.prototype instanceof s?r:s,u=Object.create(l.prototype);return Bh(u,"_invoke",function(n,r,i){var o,s,l,u=0,h=i||[],c=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return o=e,s=0,l=t,d.n=n,a}};function f(n,r){for(s=n,l=r,e=0;!c&&u&&!i&&e<h.length;e++){var i,o=h[e],f=d.p,p=o[2];n>3?(i=p===r)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=t):o[0]<=f&&((i=n<2&&f<o[1])?(s=0,d.v=r,d.n=o[1]):f<p&&(i=n<3||o[0]>r||r>p)&&(o[4]=n,o[5]=r,d.n=p,s=0))}if(i||n>1)return a;throw c=!0,r}return function(i,h,p){if(u>1)throw TypeError("Generator is already running");for(c&&1===h&&f(h,p),s=h,l=p;(e=s<2?t:l)||!c;){o||(s?s<3?(s>1&&(d.n=-1),f(s,l)):d.n=l:d.v=l);try{if(u=2,o){if(s||(i="next"),e=o[i]){if(!(e=e.call(o,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,s<2&&(s=0)}else 1===s&&(e=o.return)&&e.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=t}else if((e=(c=d.n<0)?l:n.call(r,d))!==a)break}catch(e){o=t,s=1,l=e}finally{u=1}}return{value:e,done:c}}}(n,i,o),!0),u}var a={};function s(){}function l(){}function u(){}e=Object.getPrototypeOf;var h=[][r]?e(e([][r]())):(Bh(e={},r,function(){return this}),e),c=u.prototype=s.prototype=Object.create(h);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Bh(t,i,"GeneratorFunction")),t.prototype=Object.create(c),t}return l.prototype=u,Bh(c,"constructor",u),Bh(u,"constructor",l),l.displayName="GeneratorFunction",Bh(u,i,"GeneratorFunction"),Bh(c),Bh(c,i,"Generator"),Bh(c,r,function(){return this}),Bh(c,"toString",function(){return"[object Generator]"}),(Rh=function(){return{w:o,m:d}})()}function Bh(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Bh=function(t,e,n,r){function o(e,n){Bh(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},Bh(t,e,n,r)}function Fh(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(typeof t+" is not iterable")}function Uh(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e);else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||jh(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wh(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Gh(t){return Gh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gh(t)}function jh(t,e){if(t){if("string"==typeof t)return Th(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Th(t,e):void 0}}!function(){if(Sh)return xh;Sh=1;var t=Mr(),e=na().EXISTS,n=xi(),r=ju(),i=Function.prototype,o=n(i.toString),a=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,s=n(a.exec);t&&!e&&r(i,"name",{configurable:!0,get:function(){try{return s(a,o(this))[1]}catch(t){return""}}})}(),function(e){var n={instanceId:null,env:{},tier:null,status:"uninitialized",step:1,error:null,source:{kind:null,blob:null,file:null,fileName:"",transcript:"",interimTranscript:""},calibration:{phase:null,message:"",volumePercent:0,complete:!1,gain:1},recorder:{duration:0,amplitude:0,isPlaying:!1,isPaused:!1},submission:{progress:0,isQueued:!1}};function r(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function i(t,e){var n=r(t);for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}function o(t){var e=i(n,t||{}),o=[];return{getState:function(){return e},dispatch:function(t){e=function(t,e){if(!e||!e.type)return t;switch(!t.instanceId&&e.payload&&e.payload.instanceId&&(t=i(t,{instanceId:e.payload.instanceId})),e.type){case"starmus/tier-ready":return t.tier?t:i(t,{tier:e.payload&&e.payload.tier?e.payload.tier:t.tier});case"starmus/init":return i(t,i(e.payload||{},{status:"idle",error:null}));case"starmus/ui/step-continue":return i(t,{step:2,status:"idle",error:null});case"starmus/calibration-start":return i(t,{status:"calibrating"});case"starmus/calibration-update":return i(t,{calibration:i(t.calibration,{message:e.message,volumePercent:e.volumePercent})});case"starmus/calibration-complete":return i(t,{status:"ready",calibration:i(t.calibration,i(e.calibration||{},{complete:!0}))});case"starmus/mic-start":return i(t,{status:"recording",error:null,recorder:i(t.recorder,{duration:0,amplitude:0,isPaused:!1})});case"starmus/mic-pause":return i(t,{status:"paused",recorder:i(t.recorder,{isPaused:!0})});case"starmus/mic-resume":return i(t,{status:"recording",recorder:i(t.recorder,{isPaused:!1})});case"starmus/mic-stop":return i(t,{status:"processing"});case"starmus/recorder-tick":return i(t,{recorder:i(t.recorder,{duration:e.duration,amplitude:e.amplitude})});case"starmus/recording-available":return i(t,{status:"ready_to_submit",source:i(t.source,{kind:"blob",blob:e.payload.blob,fileName:e.payload.fileName})});case"starmus/recorder-playback-state":return i(t,{recorder:i(t.recorder,{isPlaying:e.isPlaying})});case"starmus/transcript-update":return i(t,{source:i(t.source,{transcript:e.transcript})});case"starmus/transcript-interim":return i(t,{source:i(t.source,{interimTranscript:e.interim})});case"starmus/env-update":return i(t,{env:i(t.env,e.payload||{}),tier:e.tier||t.tier});case"starmus/file-attached":return i(t,{status:"ready_to_submit",source:{kind:"file",file:e.file,fileName:e.file.name}});case"starmus/submit-start":return i(t,{status:"submitting",error:null});case"starmus/submit-progress":return i(t,{submission:i(t.submission,{progress:e.progress})});case"starmus/submit-complete":return i(t,{status:"complete",submission:{progress:1,isQueued:!1}});case"starmus/submit-queued":return i(t,{status:"complete",submission:{progress:0,isQueued:!0}});case"starmus/error":return i(t,{error:e.error||e.payload});case"starmus/reset":return i(r(n),{instanceId:t.instanceId,env:t.env,tier:t.tier,status:"idle",source:{kind:null,blob:null,file:null,fileName:"",transcript:"",interimTranscript:""}});default:return t}}(e,t);for(var a=0;a<o.length;a++)try{o[a](e)}catch(t){console.error(t)}},subscribe:function(t){return-1===o.indexOf(t)&&o.push(t),function(){var e=o.indexOf(t);-1!==e&&o.splice(e,1)}}}}e.StarmusStore=e.StarmusStore||{},e.StarmusStore.createStore=o,"undefined"!=typeof module&&module.exports&&(module.exports={createStore:o}),void 0!==t&&(t.createStore=o)}("undefined"!=typeof window?window:globalThis);var Hh,Nh={};!function(){if(Hh)return Nh;Hh=1;var t=$a(),e=Ir(),n=gl(),r=Mi(),i=_o(),o=Ia(),a=Ll(),s=_l(),l=Bl(),u=bl(),h=So(),c=Ri(),d=h("isConcatSpreadable"),f=c>=51||!e(function(){var t=[];return t[d]=!1,t.concat()[0]!==t}),p=function(t){if(!r(t))return!1;var e=t[d];return void 0!==e?!!e:n(t)};t({target:"Array",proto:!0,arity:1,forced:!f||!u("concat")},{concat:function(t){var e,n,r,u,h,c=i(this),d=l(c,0),f=0;for(e=-1,r=arguments.length;e<r;e++)if(p(h=-1===e?c:arguments[e]))for(u=o(h),a(f+u),n=0;n<u;n++,f++)n in h&&s(d,f,h[n]);else a(f+1),s(d,f++,h);return d.length=f,d}})}();var zh,Xh={};!function(){if(zh)return Xh;zh=1;var t=$a(),e=xi(),n=Ti(),r=Pi(),i=es(),o=e([].join);t({target:"Array",proto:!0,forced:n!==Object||!i("join",",")},{join:function(t){return o(r(this),void 0===t?",":t)}})}();var Vh,Yh,Zh,qh,Kh,Jh,Qh,$h={};function tc(){if(Yh)return Vh;Yh=1;var t=Gi(),e=_o(),n=Ti(),r=Ia(),i=TypeError,o="Reduce of empty array with no initial value",a=function(a){return function(s,l,u,h){var c=e(s),d=n(c),f=r(c);if(t(l),0===f&&u<2)throw new i(o);var p=a?f-1:0,g=a?-1:1;if(u<2)for(;;){if(p in d){h=d[p],p+=g;break}if(p+=g,a?p<0:f<=p)throw new i(o)}for(;a?p>=0:f>p;p+=g)p in d&&(h=l(h,d[p],p,c));return h}};return Vh={left:a(!1),right:a(!0)}}function ec(){if(qh)return Zh;qh=1;var t=br(),e=Li(),n=Ci(),r=function(t){return e.slice(0,t.length)===t};return Zh=r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":t.Bun&&"string"==typeof Bun.version?"BUN":t.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(t.process)?"NODE":t.window&&t.document?"BROWSER":"REST"}function nc(){if(Jh)return Kh;Jh=1;var t=ec();return Kh="NODE"===t}!function(){if(Qh)return $h;Qh=1;var t=$a(),e=tc().left,n=es(),r=Ri();t({target:"Array",proto:!0,forced:!nc()&&r>79&&r<83||!n("reduce")},{reduce:function(t){var n=arguments.length;return e(this,t,n,n>1?arguments[1]:void 0)}})}();var rc,ic,oc,ac={};!function(){if(oc)return ac;oc=1;var t=$a(),e=function(){if(ic)return rc;ic=1;var t=Mr(),e=Ir(),n=xi(),r=Ns(),i=Us(),o=Pi(),a=n(Si().f),s=n([].push),l=t&&e(function(){var t=Object.create(null);return t[2]=2,!a(t,2)}),u=function(e){return function(n){for(var u,h=o(n),c=i(h),d=l&&null===r(h),f=c.length,p=0,g=[];f>p;)u=c[p++],t&&!(d?u in h:a(h,u))||s(g,e?[u,h[u]]:h[u]);return g}};return rc={entries:u(!0),values:u(!1)}}().entries;t({target:"Object",stat:!0},{entries:function(t){return e(t)}})}();var sc,lc={};!function(){if(sc)return lc;sc=1;var t=$a(),e=_o(),n=Us();t({target:"Object",stat:!0,forced:Ir()(function(){n(1)})},{keys:function(t){return n(e(t))}})}();var uc,hc,cc,dc,fc,pc,gc,mc,vc,yc,_c,bc,wc,Sc,kc,xc,Cc,Tc,Ac,Ec,Pc,Ic,Mc,Dc,Oc,Lc,Rc,Bc,Fc,Uc,Wc,Gc,jc={};function Hc(){if(hc)return uc;hc=1;var t=br();return uc=t}function Nc(){if(dc)return cc;dc=1;var t=yl(),e=Wi(),n=TypeError;return cc=function(r){if(t(r))return r;throw new n(e(r)+" is not a constructor")}}function zc(){if(pc)return fc;pc=1;var t=Fo(),e=Nc(),n=Ai(),r=So()("species");return fc=function(i,o){var a,s=t(i).constructor;return void 0===s||n(a=t(s)[r])?o:e(a)}}function Xc(){if(mc)return gc;mc=1;var t=Dr(),e=Function.prototype,n=e.apply,r=e.call;return gc="object"==typeof Reflect&&Reflect.apply||(t?r.bind(n):function(){return r.apply(n,arguments)}),gc}function Vc(){if(yc)return vc;yc=1;var t=TypeError;return vc=function(e,n){if(e<n)throw new t("Not enough arguments");return e}}function Yc(){if(bc)return _c;bc=1;var t=Li();return _c=/(?:ipad|iphone|ipod).*applewebkit/i.test(t)}function Zc(){if(Sc)return wc;Sc=1;var t,e,n,r,i=br(),o=Xc(),a=Mu(),s=Ii(),l=bo(),u=Ir(),h=Ws(),c=wl(),d=Co(),f=Vc(),p=Yc(),g=nc(),m=i.setImmediate,v=i.clearImmediate,y=i.process,_=i.Dispatch,b=i.Function,w=i.MessageChannel,S=i.String,k=0,x={},C="onreadystatechange";u(function(){t=i.location});var T=function(t){if(l(x,t)){var e=x[t];delete x[t],e()}},A=function(t){return function(){T(t)}},E=function(t){T(t.data)},P=function(e){i.postMessage(S(e),t.protocol+"//"+t.host)};return m&&v||(m=function(t){f(arguments.length,1);var n=s(t)?t:b(t),r=c(arguments,1);return x[++k]=function(){o(n,void 0,r)},e(k),k},v=function(t){delete x[t]},g?e=function(t){y.nextTick(A(t))}:_&&_.now?e=function(t){_.now(A(t))}:w&&!p?(r=(n=new w).port2,n.port1.onmessage=E,e=a(r.postMessage,r)):i.addEventListener&&s(i.postMessage)&&!i.importScripts&&t&&"file:"!==t.protocol&&!u(P)?(e=P,i.addEventListener("message",E,!1)):e=C in d("script")?function(t){h.appendChild(d("script"))[C]=function(){h.removeChild(this),T(t)}}:function(t){setTimeout(A(t),0)}),wc={set:m,clear:v}}function qc(){if(xc)return kc;xc=1;var t=br(),e=Mr(),n=Object.getOwnPropertyDescriptor;return kc=function(r){if(!e)return t[r];var i=n(t,r);return i&&i.value}}function Kc(){if(Tc)return Cc;Tc=1;var t=function(){this.head=null,this.tail=null};return t.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},Cc=t}function Jc(){if(Dc)return Mc;Dc=1;var t,e,n,r,i,o=br(),a=qc(),s=Mu(),l=Zc().set,u=Kc(),h=Yc(),c=function(){if(Ec)return Ac;Ec=1;var t=Li();return Ac=/ipad|iphone|ipod/i.test(t)&&"undefined"!=typeof Pebble}(),d=function(){if(Ic)return Pc;Ic=1;var t=Li();return Pc=/web0s(?!.*chrome)/i.test(t)}(),f=nc(),p=o.MutationObserver||o.WebKitMutationObserver,g=o.document,m=o.process,v=o.Promise,y=a("queueMicrotask");if(!y){var _=new u,b=function(){var e,n;for(f&&(e=m.domain)&&e.exit();n=_.get();)try{n()}catch(e){throw _.head&&t(),e}e&&e.enter()};h||f||d||!p||!g?!c&&v&&v.resolve?((r=v.resolve(void 0)).constructor=v,i=s(r.then,r),t=function(){i(b)}):f?t=function(){m.nextTick(b)}:(l=s(l,o),t=function(){l(b)}):(e=!0,n=g.createTextNode(""),new p(b).observe(n,{characterData:!0}),t=function(){n.data=e=!e}),y=function(e){_.head||t(),_.add(e)}}return Mc=y}function Qc(){return Lc||(Lc=1,Oc=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}}),Oc}function $c(){return Bc?Rc:(Bc=1,Rc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}})}function td(){if(Uc)return Fc;Uc=1;var t=br();return Fc=t.Promise}function ed(){if(Gc)return Wc;Gc=1;var t=br(),e=td(),n=Ii(),r=Qa(),i=ra(),o=So(),a=ec(),s=go(),l=Ri(),u=e&&e.prototype,h=o("species"),c=!1,d=n(t.PromiseRejectionEvent),f=r("Promise",function(){var t=i(e),n=t!==String(e);if(!n&&66===l)return!0;if(s&&(!u.catch||!u.finally))return!0;if(!l||l<51||!/native code/.test(t)){var r=new e(function(t){t(1)}),o=function(t){t(function(){},function(){})};if((r.constructor={})[h]=o,!(c=r.then(function(){})instanceof o))return!0}return!(n||"BROWSER"!==a&&"DENO"!==a||d)});return Wc={CONSTRUCTOR:f,REJECTION_EVENT:d,SUBCLASSING:c}}var nd,rd,id={};function od(){if(nd)return id;nd=1;var t=Gi(),e=TypeError,n=function(n){var r,i;this.promise=new n(function(t,n){if(void 0!==r||void 0!==i)throw new e("Bad Promise constructor");r=t,i=n}),this.resolve=t(r),this.reject=t(i)};return id.f=function(t){return new n(t)},id}var ad,sd,ld,ud={};function hd(){if(sd)return ad;sd=1;var t=td(),e=Uu(),n=ed().CONSTRUCTOR;return ad=n||!e(function(e){t.all(e).then(void 0,function(){})})}var cd,dd={};var fd,pd={};var gd,md={};var vd,yd,_d,bd,wd={};function Sd(){if(yd)return vd;yd=1;var t=Fo(),e=Mi(),n=od();return vd=function(r,i){if(t(r),e(i)&&i.constructor===r)return i;var o=n.f(r);return(0,o.resolve)(i),o.promise}}bd||(bd=1,function(){if(rd)return jc;rd=1;var t,e,n,r,i=$a(),o=go(),a=nc(),s=br(),l=Hc(),u=Or(),h=la(),c=qs(),d=Xs(),f=Nu(),p=Gi(),g=Ii(),m=Mi(),v=Fu(),y=zc(),_=Zc().set,b=Jc(),w=Qc(),S=$c(),k=Kc(),x=aa(),C=td(),T=ed(),A=od(),E="Promise",P=T.CONSTRUCTOR,I=T.REJECTION_EVENT,M=T.SUBCLASSING,D=x.getterFor(E),O=x.set,L=C&&C.prototype,R=C,B=L,F=s.TypeError,U=s.document,W=s.process,G=A.f,j=G,H=!!(U&&U.createEvent&&s.dispatchEvent),N="unhandledrejection",z=function(t){var e;return!(!m(t)||!g(e=t.then))&&e},X=function(t,e){var n,r,i,o=e.value,a=1===e.state,s=a?t.ok:t.fail,l=t.resolve,h=t.reject,c=t.domain;try{s?(a||(2===e.rejection&&K(e),e.rejection=1),!0===s?n=o:(c&&c.enter(),n=s(o),c&&(c.exit(),i=!0)),n===t.promise?h(new F("Promise-chain cycle")):(r=z(n))?u(r,n,l,h):l(n)):h(o)}catch(t){c&&!i&&c.exit(),h(t)}},V=function(t,e){t.notified||(t.notified=!0,b(function(){for(var n,r=t.reactions;n=r.get();)X(n,t);t.notified=!1,e&&!t.rejection&&Z(t)}))},Y=function(t,e,n){var r,i;H?((r=U.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),s.dispatchEvent(r)):r={promise:e,reason:n},!I&&(i=s["on"+t])?i(r):t===N&&w("Unhandled promise rejection",n)},Z=function(t){u(_,s,function(){var e,n=t.facade,r=t.value;if(q(t)&&(e=S(function(){a?W.emit("unhandledRejection",r,n):Y(N,n,r)}),t.rejection=a||q(t)?2:1,e.error))throw e.value})},q=function(t){return 1!==t.rejection&&!t.parent},K=function(t){u(_,s,function(){var e=t.facade;a?W.emit("rejectionHandled",e):Y("rejectionhandled",e,t.value)})},J=function(t,e,n){return function(r){t(e,r,n)}},Q=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,V(t,!0))},$=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new F("Promise can't be resolved itself");var r=z(e);r?b(function(){var n={done:!1};try{u(r,e,J($,n,t),J(Q,n,t))}catch(e){Q(n,e,t)}}):(t.value=e,t.state=1,V(t,!1))}catch(e){Q({done:!1},e,t)}}};if(P&&(B=(R=function(e){v(this,B),p(e),u(t,this);var n=D(this);try{e(J($,n),J(Q,n))}catch(t){Q(n,t)}}).prototype,(t=function(t){O(this,{type:E,done:!1,notified:!1,parent:!1,reactions:new k,rejection:!1,state:0,value:null})}).prototype=h(B,"then",function(t,e){var n=D(this),r=G(y(this,R));return n.parent=!0,r.ok=!g(t)||t,r.fail=g(e)&&e,r.domain=a?W.domain:void 0,0===n.state?n.reactions.add(r):b(function(){X(r,n)}),r.promise}),e=function(){var e=new t,n=D(e);this.promise=e,this.resolve=J($,n),this.reject=J(Q,n)},A.f=G=function(t){return t===R||t===n?new e(t):j(t)},!o&&g(C)&&L!==Object.prototype)){r=L.then,M||h(L,"then",function(t,e){var n=this;return new R(function(t,e){u(r,n,t,e)}).then(t,e)},{unsafe:!0});try{delete L.constructor}catch(t){}c&&c(L,B)}i({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:R}),n=l.Promise,d(R,E,!1,!0),f(E)}(),function(){if(ld)return ud;ld=1;var t=$a(),e=Or(),n=Gi(),r=od(),i=$c(),o=Bu();t({target:"Promise",stat:!0,forced:hd()},{all:function(t){var a=this,s=r.f(a),l=s.resolve,u=s.reject,h=i(function(){var r=n(a.resolve),i=[],s=0,h=1;o(t,function(t){var n=s++,o=!1;h++,e(r,a,t).then(function(t){o||(o=!0,i[n]=t,--h||l(i))},u)}),--h||l(i)});return h.error&&u(h.value),s.promise}})}(),function(){if(cd)return dd;cd=1;var t=$a(),e=go(),n=ed().CONSTRUCTOR,r=td(),i=Di(),o=Ii(),a=la(),s=r&&r.prototype;if(t({target:"Promise",proto:!0,forced:n,real:!0},{catch:function(t){return this.then(void 0,t)}}),!e&&o(r)){var l=i("Promise").prototype.catch;s.catch!==l&&a(s,"catch",l,{unsafe:!0})}}(),function(){if(fd)return pd;fd=1;var t=$a(),e=Or(),n=Gi(),r=od(),i=$c(),o=Bu();t({target:"Promise",stat:!0,forced:hd()},{race:function(t){var a=this,s=r.f(a),l=s.reject,u=i(function(){var r=n(a.resolve);o(t,function(t){e(r,a,t).then(s.resolve,l)})});return u.error&&l(u.value),s.promise}})}(),function(){if(gd)return md;gd=1;var t=$a(),e=od();t({target:"Promise",stat:!0,forced:ed().CONSTRUCTOR},{reject:function(t){var n=e.f(this);return(0,n.reject)(t),n.promise}})}(),function(){if(_d)return wd;_d=1;var t=$a(),e=Di(),n=go(),r=td(),i=ed().CONSTRUCTOR,o=Sd(),a=e("Promise"),s=n&&!i;t({target:"Promise",stat:!0,forced:n||i},{resolve:function(t){return o(s&&this===a?r:this,t)}})}());var kd,xd={};!function(){if(kd)return xd;kd=1;var t=$a(),e=go(),n=td(),r=Ir(),i=Di(),o=Ii(),a=zc(),s=Sd(),l=la(),u=n&&n.prototype;if(t({target:"Promise",proto:!0,real:!0,forced:!!n&&r(function(){u.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=a(this,i("Promise")),n=o(t);return this.then(n?function(n){return s(e,t()).then(function(){return n})}:t,n?function(n){return s(e,t()).then(function(){throw n})}:t)}}),!e&&o(n)){var h=i("Promise").prototype.finally;u.finally!==h&&l(u,"finally",h,{unsafe:!0})}}();var Cd,Td,Ad,Ed,Pd,Id,Md,Dd,Od,Ld,Rd,Bd={};function Fd(){if(Td)return Cd;Td=1;var t=Fo();return Cd=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n}}function Ud(){if(Ld)return Od;Ld=1;var t,e,n=Or(),r=xi(),i=Ju(),o=Fd(),a=function(){if(Ed)return Ad;Ed=1;var t=Ir(),e=br().RegExp,n=t(function(){var t=e("a","y");return t.lastIndex=2,null!==t.exec("abcd")}),r=n||t(function(){return!e("a","y").sticky}),i=n||t(function(){var t=e("^r","gy");return t.lastIndex=2,null!==t.exec("str")});return Ad={BROKEN_CARET:i,MISSED_STICKY:r,UNSUPPORTED_Y:n}}(),s=yo(),l=Gs(),u=aa().get,h=function(){if(Id)return Pd;Id=1;var t=Ir(),e=br().RegExp;return Pd=t(function(){var t=e(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)})}(),c=function(){if(Dd)return Md;Dd=1;var t=Ir(),e=br().RegExp;return Md=t(function(){var t=e("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})}(),d=s("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,p=f,g=r("".charAt),m=r("".indexOf),v=r("".replace),y=r("".slice),_=(e=/b*/g,n(f,t=/a/,"a"),n(f,e,"a"),0!==t.lastIndex||0!==e.lastIndex),b=a.BROKEN_CARET,w=void 0!==/()??/.exec("")[1];return(_||w||b||h||c)&&(p=function(t){var e,r,a,s,h,c,S,k=this,x=u(k),C=i(t),T=x.raw;if(T)return T.lastIndex=k.lastIndex,e=n(p,T,C),k.lastIndex=T.lastIndex,e;var A=x.groups,E=b&&k.sticky,P=n(o,k),I=k.source,M=0,D=C;if(E&&(P=v(P,"y",""),-1===m(P,"g")&&(P+="g"),D=y(C,k.lastIndex),k.lastIndex>0&&(!k.multiline||k.multiline&&"\n"!==g(C,k.lastIndex-1))&&(I="(?: "+I+")",D=" "+D,M++),r=new RegExp("^(?:"+I+")",P)),w&&(r=new RegExp("^"+I+"$(?!\\s)",P)),_&&(a=k.lastIndex),s=n(f,E?r:k,D),E?s?(s.input=y(s.input,M),s[0]=y(s[0],M),s.index=k.lastIndex,k.lastIndex+=s[0].length):k.lastIndex=0:_&&s&&(k.lastIndex=k.global?s.index+s[0].length:a),w&&s&&s.length>1&&n(d,s[0],r,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(s[h]=void 0)}),s&&A)for(s.groups=c=l(null),h=0;h<A.length;h++)c[(S=A[h])[0]]=s[S[1]];return s}),Od=p}function Wd(){if(Rd)return Bd;Rd=1;var t=$a(),e=Ud();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),Bd}Wd();var Gd,jd,Hd,Nd,zd,Xd,Vd,Yd,Zd,qd,Kd,Jd,Qd,$d={};function tf(){if(Nd)return Hd;Nd=1;var t=Qu().charAt;return Hd=function(e,n,r){return n+(r?t(e,n).length:1)}}function ef(){if(Xd)return zd;Xd=1;var t=xi(),e=_o(),n=Math.floor,r=t("".charAt),i=t("".replace),o=t("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,s=/\$([$&'`]|\d{1,2})/g;return zd=function(t,l,u,h,c,d){var f=u+t.length,p=h.length,g=s;return void 0!==c&&(c=e(c),g=a),i(d,g,function(e,i){var a;switch(r(i,0)){case"$":return"$";case"&":return t;case"`":return o(l,0,u);case"'":return o(l,f);case"<":a=c[o(i,1,-1)];break;default:var s=+i;if(0===s)return e;if(s>p){var d=n(s/10);return 0===d?e:d<=p?void 0===h[d-1]?r(i,1):h[d-1]+r(i,1):e}a=h[s-1]}return void 0===a?"":a})}}function nf(){if(qd)return Zd;qd=1;var t=Or(),e=bo(),n=Oi(),r=function(){if(Yd)return Vd;Yd=1;var t=br(),e=Ir(),n=t.RegExp,r=!e(function(){var t=!0;try{n(".","d")}catch(e){t=!1}var e={},r="",i=t?"dgimsy":"gimsy",o=function(t,n){Object.defineProperty(e,t,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in t&&(a.hasIndices="d"),a)o(s,a[s]);return Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(e)!==i||r!==i});return Vd={correct:r}}(),i=Fd(),o=RegExp.prototype;return Zd=r.correct?function(t){return t.flags}:function(a){return r.correct||!n(o,a)||e(a,"flags")?a.flags:t(i,a)}}!function(){if(Qd)return $d;Qd=1;var t=Xc(),e=Or(),n=xi(),r=function(){if(jd)return Gd;jd=1,Wd();var t=Or(),e=la(),n=Ud(),r=Ir(),i=So(),o=Wo(),a=i("species"),s=RegExp.prototype;return Gd=function(l,u,h,c){var d=i(l),f=!r(function(){var t={};return t[d]=function(){return 7},7!==""[l](t)}),p=f&&!r(function(){var t=!1,e=/a/;if("split"===l){var n={};n[a]=function(){return e},(e={constructor:n,flags:""})[d]=/./[d]}return e.exec=function(){return t=!0,null},e[d](""),!t});if(!f||!p||h){var g=/./[d],m=u(d,""[l],function(e,r,i,o,a){var l=r.exec;return l===n||l===s.exec?f&&!a?{done:!0,value:t(g,r,i,o)}:{done:!0,value:t(e,i,r,o)}:{done:!1}});e(String.prototype,l,m[0]),e(s,d,m[1])}c&&o(s[d],"sham",!0)}}(),i=Ir(),o=Fo(),a=Ii(),s=Mi(),l=Aa(),u=Pa(),h=Ju(),c=Ei(),d=tf(),f=ji(),p=ef(),g=nf(),m=function(){if(Jd)return Kd;Jd=1;var t=Or(),e=Fo(),n=Ii(),r=Ci(),i=Ud(),o=TypeError;return Kd=function(a,s){var l=a.exec;if(n(l)){var u=t(l,a,s);return null!==u&&e(u),u}if("RegExp"===r(a))return t(i,a,s);throw new o("RegExp#exec called on incompatible receiver")}}(),v=So()("replace"),y=Math.max,_=Math.min,b=n([].concat),w=n([].push),S=n("".indexOf),k=n("".slice),x=function(t){return void 0===t?t:String(t)},C="$0"==="a".replace(/./,"$0"),T=!!/./[v]&&""===/./[v]("a","$0");r("replace",function(n,r,i){var C=T?"$":"$0";return[function(t,n){var i=c(this),o=s(t)?f(t,v):void 0;return o?e(o,t,i,n):e(r,h(i),t,n)},function(e,n){var s=o(this),c=h(e);if("string"==typeof n&&-1===S(n,C)&&-1===S(n,"$<")){var f=i(r,s,c,n);if(f.done)return f.value}var v=a(n);v||(n=h(n));var T,A=h(g(s)),E=-1!==S(A,"g");E&&(T=-1!==S(A,"u"),s.lastIndex=0);for(var P,I=[];null!==(P=m(s,c))&&(w(I,P),E);){""===h(P[0])&&(s.lastIndex=d(c,u(s.lastIndex),T))}for(var M="",D=0,O=0;O<I.length;O++){for(var L,R=h((P=I[O])[0]),B=y(_(l(P.index),c.length),0),F=[],U=1;U<P.length;U++)w(F,x(P[U]));var W=P.groups;if(v){var G=b([R],F,B,c);void 0!==W&&w(G,W),L=h(t(n,void 0,G))}else L=p(R,c,B,F,W,n);B>=D&&(M+=k(c,D,B)+L,D=B+R.length)}return M+k(c,D)}]},!!i(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})||!C||T)}();var rf={chunkSize:1048576,retryDelays:[0,3e3,5e3,1e4,2e4,6e4],maxChunkRetries:3};function of(){return window.starmusTus||window.starmusConfig||{}}function af(t){var e=("string"==typeof t?t:String(t)).replace(/[\r\n\t]/g," ");return e.length>500?e.slice(0,497)+"...":e}function sf(t){return t&&"object"===Gh(t)?t:{}}function lf(t,e){return uf.apply(this,arguments)}function uf(){return uf=Eh(Rh().m(function t(e,n){var r,i,o,a,s,l,u,h=arguments;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(r=h.length>2&&void 0!==h[2]?h[2]:{},i=h.length>3&&void 0!==h[3]?h[3]:{},o=h.length>4&&void 0!==h[4]?h[4]:"",a=h.length>5?h[5]:void 0,window.tus&&window.tus.Upload){t.n=1;break}throw _h("[TUS] No tus library  failing over"),new Error("TUS_NOT_AVAILABLE");case 1:if(s=of(),l=s.endpoint||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.tusUpload){t.n=2;break}throw new Error("TUS_ENDPOINT_NOT_CONFIGURED");case 2:if(u=Lh({filename:af(n),filetype:e.type||"audio/webm"},Object.entries(sf(r)).reduce(function(t,e){var n=Uh(e,2),r=n[0],i=n[1];return t[r]=af(i),t},{})),i)try{u.starmus_meta=af(JSON.stringify(i))}catch(t){_h("[TUS] Metadata sanitization failed",t)}return t.a(2,new Promise(function(t,n){var r,i={endpoint:l,chunkSize:s.chunkSize||rf.chunkSize,retryDelays:s.retryDelays||rf.retryDelays,metadata:u,fingerprint:function(t){return["starmus",o,t.size,t.lastModified||""].join("-")},onError:function(t){_h("[TUS] Upload error",t),n(t)},onProgress:function(t,e){"function"==typeof a&&a(t,e)},onSuccess:function(){return Eh(Rh().m(function n(){var o,a,l;return Rh().w(function(n){for(;;)switch(n.p=n.n){case 0:if(_h("[TUS] Upload success",r.url),!s.removeFingerprintOnSuccess||null===(o=window.tus)||void 0===o||null===(o=o.defaultOptions)||void 0===o||!o.removeFingerprint){n.n=5;break}return n.p=1,n.n=2,window.tus.defaultOptions.fingerprint(e,i);case 2:return a=n.v,n.n=3,window.tus.defaultOptions.removeFingerprint(a);case 3:n.n=5;break;case 4:n.p=4,l=n.v,_h("[TUS] Failed to remove fingerprint",l);case 5:t(r.url);case 6:return n.a(2)}},n,null,[[1,4]])}))()}};(r=new window.tus.Upload(e,i)).findPreviousUploads().then(function(t){t&&t.length>0&&(_h("[TUS] Resuming from previous upload",t[0].uploadUrl),r.resumeFromPreviousUpload(t[0]))}).finally(function(){r.start()})}))}},t)})),uf.apply(this,arguments)}function hf(t,e){return cf.apply(this,arguments)}function cf(){return cf=Eh(Rh().m(function t(e,n){var r,i,o,a,s,l,u,h,c,d,f,p,g,m,v,y,_,b,w=arguments;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(b=function(){return b=Eh(Rh().m(function t(n,r,i,o,a,s,l,u,h,c){return Rh().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,a){var f=new FormData;f.append("audio_chunk",r,"".concat(i,".part").concat(n)),f.append("chunk_index",n),f.append("total_chunks",d),s?f.append("upload_id",s):f.append("create_upload_id","1"),Object.entries(l).forEach(function(t){var e=Uh(t,2),n=e[0],r=e[1];return f.append(n,r)}),o&&f.append("_starmus_meta",JSON.stringify(o));var p=new XMLHttpRequest;p.open("POST",u,!0),p.setRequestHeader("X-WP-Nonce",h),p.upload&&"function"==typeof c&&(p.upload.onprogress=function(t){t.lengthComputable&&c(start+t.loaded,e.size)}),p.onload=function(){if(p.status>=200&&p.status<300)try{var e=JSON.parse(p.responseText);!s&&e.upload_id&&(window.lastUploadId=e.upload_id),t(e)}catch(t){a(new Error("Invalid JSON chunk response"))}else a(new Error("Chunk ".concat(n," failed: ").concat(p.status)))},p.onerror=function(){return a(new Error("Network error during chunk upload"))},p.send(f)}))},t)})),b.apply(this,arguments)},_=function(t,e,n,r,i,o,a,s,l,u){return b.apply(this,arguments)},r=w.length>2&&void 0!==w[2]?w[2]:{},i=w.length>3&&void 0!==w[3]?w[3]:{},o=w.length>4&&void 0!==w[4]?w[4]:"",a=w.length>5?w[5]:void 0,s=of(),l=s.chunkedUpload||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.chunkedUpload,u=s.nonce||window.starmusConfig&&window.starmusConfig.nonce||"",l){t.n=1;break}throw new Error("CHUNKED_UPLOAD_ENDPOINT_NOT_CONFIGURED");case 1:if(u){t.n=2;break}throw new Error("CHUNKED_UPLOAD_NONCE_MISSING");case 2:h=sf(r),c=s.chunkSize||rf.chunkSize,d=Math.ceil(e.size/c),f="starmus_chunked_".concat(o,"_").concat(n,"_").concat(e.size),p=localStorage.getItem(f)||null,g=Rh().m(function t(){var r,d,g,v,y,b;return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:r=0,d=!1,g=m*c,v=Math.min(g+c,e.size),y=e.slice(g,v);case 1:if(d||!(r<(s.maxChunkRetries||rf.maxChunkRetries))){t.n=7;break}return t.p=2,t.n=3,_(m,y,n,i,o,p,h,l,u,a);case 3:d=!0,t.n=6;break;case 4:if(t.p=4,b=t.v,!(++r>=(s.maxChunkRetries||rf.maxChunkRetries))){t.n=5;break}throw b;case 5:return t.n=6,new Promise(function(t){return setTimeout(t,300*r*r)});case 6:t.n=1;break;case 7:!p&&0===m&&window.lastUploadId&&(p=window.lastUploadId,localStorage.setItem(f,p));case 8:return t.a(2)}},t,null,[[2,4]])}),m=0;case 3:if(!(m<d)){t.n=5;break}return t.d(Fh(g()),4);case 4:m++,t.n=3;break;case 5:return(v=new FormData).append("upload_id",p),v.append("finalize","1"),(y=new XMLHttpRequest).open("POST",l,!0),y.setRequestHeader("X-WP-Nonce",u),t.a(2,new Promise(function(t,e){y.onload=function(){if(y.status>=200&&y.status<300)try{var n=JSON.parse(y.responseText);localStorage.removeItem(f),t(n)}catch(t){e(new Error("Invalid JSON on finalize"))}else e(new Error("Finalize failed: ".concat(y.status)))},y.onerror=function(){return e(new Error("Network error on finalize"))},y.send(v)}))}},t)})),cf.apply(this,arguments)}function df(t,e){return ff.apply(this,arguments)}function ff(){return ff=Eh(Rh().m(function t(e,n){var r,i,o,a,s,l,u,h=arguments;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(r=h.length>2&&void 0!==h[2]?h[2]:{},i=h.length>3&&void 0!==h[3]?h[3]:{},o=h.length>5?h[5]:void 0,a=of(),s=a.directUpload||window.starmusConfig&&window.starmusConfig.endpoints&&window.starmusConfig.endpoints.directUpload,l=a.nonce||window.starmusConfig&&window.starmusConfig.nonce||"",s){t.n=1;break}throw new Error("DIRECT_UPLOAD_ENDPOINT_NOT_CONFIGURED");case 1:return u=sf(r),t.a(2,new Promise(function(t,r){var a=new FormData;Object.entries(u).forEach(function(t){var e=Uh(t,2),n=e[0],r=e[1];return a.append(n,r)}),a.append("audio_file",e,n),null!=i&&i.transcript&&a.append("_starmus_transcript",i.transcript),null!=i&&i.calibration&&a.append("_starmus_calibration",JSON.stringify(i.calibration)),null!=i&&i.env&&a.append("_starmus_env",JSON.stringify(i.env));var h=new XMLHttpRequest;h.open("POST",s,!0),l&&h.setRequestHeader("X-WP-Nonce",l),h.upload&&"function"==typeof o&&(h.upload.onprogress=function(t){t.lengthComputable&&o(t.loaded,t.total)}),h.onload=function(){if(h.status>=200&&h.status<300)try{t(JSON.parse(h.responseText))}catch(t){r(new Error("Invalid JSON response"))}else r(new Error("Upload failed: ".concat(h.status)))},h.onerror=function(){return r(new Error("Network error on direct upload"))},h.send(a)}))}},t)})),ff.apply(this,arguments)}function pf(t,e,n,r,i,o){return gf.apply(this,arguments)}function gf(){return(gf=Eh(Rh().m(function t(e,n,r,i,o,a){var s,l;return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,lf(e,n,r,i,o,a);case 1:case 4:case 6:return t.a(2,t.v);case 2:return t.p=2,s=t.v,_h("[Uploader] TUS failed, trying fallback",s),t.p=3,t.n=4,hf(e,n,r,i,o,a);case 5:return t.p=5,l=t.v,_h("[Uploader] Chunked REST failed, trying direct",l),t.n=6,df(e,n,r,i,o,a)}},t,null,[[3,5],[0,2]])}))).apply(this,arguments)}function mf(t,e){var n=null==e?void 0:e.downlink;n&&0!==n||(n={"slow-2g":.05,"2g":.15,"3g":.75,"4g":8}[null==e?void 0:e.effectiveType]||.5);var r=1e6*(n=Math.min(n,10))/8;return Math.ceil(t/r*1.5)}function vf(t){return isFinite(t)?t<60?"~".concat(t,"s"):"~".concat(Math.ceil(t/60)," min"):"Calculating..."}var yf={uploadWithTus:lf,uploadWithChunkedRest:hf,uploadDirect:df,uploadWithPriority:pf,isTusAvailable:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var e=of();return!!(window.tus&&window.tus.Upload&&e.endpoint&&t>1048576)}catch(t){return!1}},estimateUploadTime:mf,formatUploadEstimate:vf};"undefined"!=typeof window&&(window.StarmusTus=yf);var _f,bf={};!function(){if(_f)return bf;_f=1;var t=$a(),e=gh().map;t({target:"Array",proto:!0,forced:!bl()("map")},{map:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}();var wf,Sf,kf,xf,Cf,Tf={};function Af(){if(Sf)return wf;Sf=1;var t=xi();return wf=t(1.1.valueOf)}function Ef(){if(xf)return kf;xf=1;var t=Aa(),e=Ju(),n=Ei(),r=RangeError;return kf=function(i){var o=e(n(this)),a="",s=t(i);if(s<0||s===1/0)throw new r("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(o+=o))1&s&&(a+=o);return a}}!function(){if(Cf)return Tf;Cf=1;var t=$a(),e=xi(),n=Aa(),r=Af(),i=Ef(),o=Ir(),a=RangeError,s=String,l=Math.floor,u=e(i),h=e("".slice),c=e(1.1.toFixed),d=function(t,e,n){return 0===e?n:e%2==1?d(t,e-1,n*t):d(t*t,e/2,n)},f=function(t,e,n){for(var r=-1,i=n;++r<6;)i+=e*t[r],t[r]=i%1e7,i=l(i/1e7)},p=function(t,e){for(var n=6,r=0;--n>=0;)r+=t[n],t[n]=l(r/e),r=r%e*1e7},g=function(t){for(var e=6,n="";--e>=0;)if(""!==n||0===e||0!==t[e]){var r=s(t[e]);n=""===n?r:n+u("0",7-r.length)+r}return n};t({target:"Number",proto:!0,forced:o(function(){return"0.000"!==c(8e-5,3)||"1"!==c(.9,0)||"1.25"!==c(1.255,2)||"1000000000000000128"!==c(0xde0b6b3a7640080,0)})||!o(function(){c({})})},{toFixed:function(t){var e,i,o,l,c=r(this),m=n(t),v=[0,0,0,0,0,0],y="",_="0";if(m<0||m>20)throw new a("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return s(c);if(c<0&&(y="-",c=-c),c>1e-21)if(i=(e=function(t){for(var e=0,n=t;n>=4096;)e+=12,n/=4096;for(;n>=2;)e+=1,n/=2;return e}(c*d(2,69,1))-69)<0?c*d(2,-e,1):c/d(2,e,1),i*=4503599627370496,(e=52-e)>0){for(f(v,0,i),o=m;o>=7;)f(v,1e7,0),o-=7;for(f(v,d(10,o,1),0),o=e-1;o>=23;)p(v,1<<23),o-=23;p(v,1<<o),f(v,1,1),p(v,2),_=g(v)}else f(v,0,i),f(v,1<<-e,0),_=g(v)+u("0",m);return _=m>0?y+((l=_.length)<=m?"0."+u("0",m-l)+_:h(_,0,l-m)+"."+h(_,l-m)):y+_}})}();var Pf,If={};!function(){if(Pf)return If;Pf=1;var t=na().PROPER,e=la(),n=Fo(),r=Ju(),i=Ir(),o=nf(),a="toString",s=RegExp.prototype,l=s[a],u=i(function(){return"/a/b"!==l.call({source:"a",flags:"b"})}),h=t&&l.name!==a;(u||h)&&e(s,a,function(){var t=n(this);return"/"+r(t.source)+"/"+r(o(t))},{unsafe:!0})}();var Mf={dbName:"StarmusSubmissions",storeName:"pendingSubmissions",dbVersion:1,maxRetries:10,retryDelays:[0,5e3,1e4,3e4,6e4,12e4,3e5,6e5,12e5,18e5],maxBlobSize:41943040},Df=function(){return Ih(function t(){Ph(this,t),this.db=null,this.isProcessing=!1},[{key:"init",value:(o=Eh(Rh().m(function t(){var e=this;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(window.indexedDB){t.n=1;break}return console.error("[Offline] IndexedDB not supported. Offline uploads disabled."),t.a(2);case 1:return t.a(2,new Promise(function(t){var n=indexedDB.open(Mf.dbName,Mf.dbVersion);n.onerror=function(e){_h("[Offline] DB open failed:",e),t()},n.onblocked=function(){_h("[Offline] DB open blocked  other tab open")},n.onsuccess=function(n){e.db=n.target.result,e.db.onversionchange=function(){e.db.close(),_h("[Offline] DB version changed  closed connection")},_h("[Offline] DB ready"),t()},n.onupgradeneeded=function(t){var e=t.target.result;if(!e.objectStoreNames.contains(Mf.storeName)){var n=e.createObjectStore(Mf.storeName,{keyPath:"id"});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("retryCount","retryCount",{unique:!1}),_h("[Offline] Created object store:",Mf.storeName)}}}))}},t)})),function(){return o.apply(this,arguments)})},{key:"add",value:(i=Eh(Rh().m(function t(e,n,r){var i,o,a,s,l,u=this,h=arguments;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(i=h.length>3&&void 0!==h[3]?h[3]:{},o=h.length>4&&void 0!==h[4]?h[4]:{},this.db){t.n=1;break}throw new Error("OfflineQueue: DB not initialized");case 1:if(!(n.size>Mf.maxBlobSize)){t.n=2;break}throw a="Audio too large (".concat((n.size/1024/1024).toFixed(2),"MB)  exceeds limit of ").concat(Mf.maxBlobSize/1024/1024,"MB"),_h("[Offline] "+a),new Error(a);case 2:return s=new Blob([n],{type:n.type}),l={id:"starmus-offline-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),instanceId:e,fileName:r,timestamp:Date.now(),audioBlob:s,formFields:i,metadata:o,retryCount:0,lastAttempt:null,error:null},t.a(2,new Promise(function(t,e){var n=u.db.transaction([Mf.storeName],"readwrite");n.objectStore(Mf.storeName).add(l),n.oncomplete=function(){_h("[Offline] Queued submission:",l.id),u._notifyQueueUpdate(),t(l.id)},n.onerror=function(t){var n=t.target.error;n&&"QuotaExceededError"===n.name?(_h("[Offline] IndexedDB quota exceeded  cannot save offline"),e(new Error("IndexedDB quota exceeded  cannot store offline"))):(_h("[Offline] Transaction error:",n),e(n))}}))}},t,this)})),function(t,e,n){return i.apply(this,arguments)})},{key:"getAll",value:(r=Eh(Rh().m(function t(){var e=this;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2,[]);case 1:return t.a(2,new Promise(function(t,n){var r=e.db.transaction([Mf.storeName],"readonly").objectStore(Mf.storeName).getAll();r.onsuccess=function(){return t(r.result||[])},r.onerror=function(){return n(r.error)}}))}},t,this)})),function(){return r.apply(this,arguments)})},{key:"remove",value:(n=Eh(Rh().m(function t(e){var n=this;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,r){var i=n.db.transaction([Mf.storeName],"readwrite");i.objectStore(Mf.storeName).delete(e),i.oncomplete=function(){_h("[Offline] Removed from queue:",e),n._notifyQueueUpdate(),t()},i.onerror=function(t){return r(t.target.error)}}))}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"_updateRetry",value:(e=Eh(Rh().m(function t(e,n,r){var i=this;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.a(2);case 1:return t.a(2,new Promise(function(t,o){var a=i.db.transaction([Mf.storeName],"readwrite"),s=a.objectStore(Mf.storeName),l=s.get(e);l.onsuccess=function(){var t=l.result;t&&(t.retryCount=n,t.lastAttempt=Date.now(),t.error=r||null,s.put(t))},l.onerror=function(t){return o(t.target.error)},a.oncomplete=function(){return t()}}))}},t,this)})),function(t,n,r){return e.apply(this,arguments)})},{key:"processQueue",value:(t=Eh(Rh().m(function t(){var e,n,r,i,o,a,s,l,u,h,c,d,f,p,g,m,v;return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isProcessing&&navigator.onLine){t.n=1;break}return t.a(2);case 1:return this.isProcessing=!0,_h("[Offline] Processing queue..."),t.p=2,t.n=3,this.getAll();case 3:e=t.v,_h("[Offline] ".concat(e.length," submissions pending")),n=Mh(e),t.p=4,n.s();case 5:if((r=n.n()).done){t.n=14;break}if(i=r.value,o=i.id,a=i.audioBlob,s=i.fileName,l=i.formFields,u=i.metadata,h=i.retryCount,c=i.instanceId,!(h>=Mf.maxRetries)){t.n=6;break}return _h("[Offline] Max retries exceeded for",o),t.a(3,13);case 6:if(null===i.lastAttempt){t.n=7;break}if(d=Mf.retryDelays[Math.min(h,Mf.retryDelays.length-1)],!(Date.now()-i.lastAttempt<d)){t.n=7;break}return t.a(3,13);case 7:return t.p=7,_h("[Offline] Uploading queued item",o),t.n=8,pf(a,s,l,u,c,null);case 8:return f=t.v,_h("[Offline] Upload succeeded for",o,f),t.n=9,this.remove(o);case 9:t.n=13;break;case 10:if(t.p=10,g=t.v,_h("[Offline] Upload failed for",o,g),p=g&&g.message?g.message:String(g),/400|Invalid JSON|QuotaExceeded/i.test(p)){t.n=12;break}return t.n=11,this._updateRetry(o,h+1,p);case 11:t.n=13;break;case 12:_h("[Offline] Nonretryable error, leaving in queue for manual review:",o);case 13:t.n=5;break;case 14:t.n=16;break;case 15:t.p=15,m=t.v,n.e(m);case 16:return t.p=16,n.f(),t.f(16);case 17:t.n=19;break;case 18:t.p=18,v=t.v,console.error("[Offline] Queue processing error:",v);case 19:return t.p=19,this.isProcessing=!1,t.f(19);case 20:return t.a(2)}},t,this,[[7,10],[4,15,16,17],[2,18,19,20]])})),function(){return t.apply(this,arguments)})},{key:"setupNetworkListeners",value:function(){var t=this;window.addEventListener("online",function(){_h("[Offline] Network online  processing queue"),t.processQueue()}),window.addEventListener("offline",function(){_h("[Offline] Network offline  queue paused")}),setInterval(function(){navigator.onLine&&t.processQueue().catch(function(t){return _h("[Offline] Retry error",t)})},6e4)}},{key:"_notifyQueueUpdate",value:function(){window.StarmusHooks&&"function"==typeof window.StarmusHooks.doAction&&this.getAll().then(function(t){var e=t.map(function(t){return{id:t.id,fileName:t.fileName,retryCount:t.retryCount,error:t.error,timestamp:t.timestamp}});window.StarmusHooks.doAction("starmus_offline_queue_updated",e)}).catch(function(t){return _h("[Offline] Queue notification failed",t)})}}]);var t,e,n,r,i,o}(),Of=new Df;function Lf(){return Rf.apply(this,arguments)}function Rf(){return(Rf=Eh(Rh().m(function t(){return Rh().w(function(t){for(;;)switch(t.n){case 0:if(Of.db){t.n=2;break}return t.n=1,Of.init();case 1:Of.setupNetworkListeners();case 2:return t.a(2,Of)}},t)}))).apply(this,arguments)}function Bf(t,e,n,r,i){return Ff.apply(this,arguments)}function Ff(){return(Ff=Eh(Rh().m(function t(e,n,r,i,o){var a;return Rh().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Lf();case 1:return a=t.v,t.a(2,a.add(e,n,r,i,o))}},t)}))).apply(this,arguments)}function Uf(){return Wf.apply(this,arguments)}function Wf(){return(Wf=Eh(Rh().m(function t(){var e,n;return Rh().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Lf();case 1:return e=t.v,t.n=2,e.getAll();case 2:return n=t.v,t.a(2,n.length)}},t)}))).apply(this,arguments)}function Gf(){return Lf()}"undefined"!=typeof window&&(window.initOffline=Gf);var jf,Hf,Nf;function zf(){if(Hf)return jf;Hf=1;var t=br().isFinite;return jf=Number.isFinite||function(e){return"number"==typeof e&&t(e)}}Nf||(Nf=1,$a()({target:"Number",stat:!0},{isFinite:zf()}));var Xf,Vf,Yf,Zf,qf,Kf={};!function(){if(qf)return Kf;qf=1;var t=$a(),e=function(){if(Vf)return Xf;Vf=1;var t=xi(),e=Pa(),n=Ju(),r=Ef(),i=Ei(),o=t(r),a=t("".slice),s=Math.ceil,l=function(t){return function(r,l,u){var h,c,d=n(i(r)),f=e(l),p=d.length,g=void 0===u?" ":n(u);return f<=p||""===g?d:((c=o(g,s((h=f-p)/g.length))).length>h&&(c=a(c,0,h)),t?d+c:c+d)}};return Xf={start:l(!1),end:l(!0)}}().start;t({target:"String",proto:!0,forced:function(){if(Zf)return Yf;Zf=1;var t=Li();return Yf=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(t)}()},{padStart:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}(),window.StarmusInstances=window.StarmusInstances||{};var Jf=!1;function Qf(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML}function $f(t,e){var n;"error"!==t.status&&"complete"!==t.status||console.log("[StarmusUI] Render called with state:",{status:t.status,calibrationComplete:null===(n=t.calibration)||void 0===n?void 0:n.complete,instanceId:t.instanceId});var r=t.status,i=t.error,o=t.source,a=void 0===o?{}:o,s=t.submission,l=void 0===s?{}:s,u=t.calibration,h=void 0===u?{}:u,c=t.recorder,d=void 0===c?{}:c,f=t.instanceId;if("C"===t.tier||!0===t.fallbackActive)return["recordBtn","pauseBtn","resumeBtn","stopBtn","recorderContainer"].forEach(function(t){e[t]&&(e[t].style.display="none")}),void(e.fallbackContainer&&(e.fallbackContainer.style.display="block"));if(e.step1&&e.step2){var p=t.step>=2;e.step1.style.display=p?"none":"block",e.step2.style.display=p?"block":"none"}if(e.timer||e.timerElapsed){var g=function(t){if(!Number.isFinite(t))return"00m 00s";var e=Math.floor(t/60),n=Math.floor(t%60);return"".concat(e.toString().padStart(2,"0"),"m ").concat(n.toString().padStart(2,"0"),"s")}(d.duration||0);e.timerElapsed?e.timerElapsed.textContent=g:e.timer&&(e.timer.textContent=g),e.timer&&("recording"===r?e.timer.classList.add("starmus-timer--recording"):e.timer.classList.remove("starmus-timer--recording"))}if(e.durationProgress){var m=d.duration||0,v="recording"===r||"paused"===r||"calibrating"===r;if(e.durationProgress.parentElement&&(e.durationProgress.parentElement.style.display=v?"block":"none"),v){var y=Math.min(100,m/1200*100);e.durationProgress.style.setProperty("--starmus-recording-progress","".concat(y,"%")),e.durationProgress.setAttribute("aria-valuenow",Math.floor(m)),m>=1020?e.durationProgress.setAttribute("data-level","danger"):m>=900?e.durationProgress.setAttribute("data-level","warning"):e.durationProgress.setAttribute("data-level","safe"),m>=1200&&"recording"===r&&window.CommandBus&&window.CommandBus.dispatch("stop-mic",{},{instanceId:f})}}if(e.volumeMeter){var _="recording"===r||"paused"===r||"calibrating"===r;if(e.volumeMeter.parentElement&&(e.volumeMeter.parentElement.style.display=_?"block":"none"),_){var b=Math.max(0,Math.min(100,"calibrating"===r?h.volumePercent||0:d.amplitude||0));e.volumeMeter.style.setProperty("--starmus-audio-level","".concat(b,"%"));var w=b/100;w<.6?e.volumeMeter.setAttribute("data-level","safe"):w<.85?e.volumeMeter.setAttribute("data-level","hot"):e.volumeMeter.setAttribute("data-level","clip"),"recording"===r&&function(t,e){if(t>=.85&&!Jf){Jf=!0;var n=e.messageBox||document.querySelector("[data-starmus-message-box]");n&&(n.textContent=" Your microphone is too loud. Move back 612 inches or speak softer for a cleaner recording.",n.style.display="block",n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),setTimeout(function(){n.style.display="none",n.removeAttribute("role"),n.removeAttribute("aria-live")},6e3))}}(w,e)}else e.volumeMeter.style.setProperty("--starmus-audio-level","0%"),e.volumeMeter.removeAttribute("data-level")}var S="recording"===r,k="paused"===r,x="ready"===r||"ready_to_record"===r,C="calibrating"===r,T="ready_to_submit"===r,A=h&&!0===h.complete,E=S||k||C;if(e.recordBtn&&(e.recordBtn.style.display=x&&A&&!E&&!T?"inline-flex":"none"),e.pauseBtn&&(e.pauseBtn.style.display=S?"inline-flex":"none"),e.resumeBtn&&(e.resumeBtn.style.display=k?"inline-flex":"none"),e.stopBtn&&(e.stopBtn.style.display=E?"inline-flex":"none",e.stopBtn.disabled=C,e.stopBtn.innerHTML=C?'<span class="dashicons dashicons-update"></span> Calibrating...':'<span class="dashicons dashicons-media-default"></span> Stop'),e.submitBtn&&(e.submitBtn.disabled="ready_to_submit"!==r,e.submitBtn.textContent="submitting"===r?"Uploading":"Submit Recording"),e.transcriptBox){var P,I,M=(null===(P=a.transcript)||void 0===P?void 0:P.length)>0,D=(null===(I=a.interimTranscript)||void 0===I?void 0:I.length)>0;M||D?(e.transcriptBox.style.display="block",e.transcriptBox.innerHTML=(M?'<span class="starmus-transcript--final">'.concat(Qf(a.transcript),"</span>"):"")+(D?' <span class="starmus-transcript--interim">'.concat(Qf(a.interimTranscript),"</span>"):"")):e.transcriptBox.style.display="none"}if(e.statusEl){var O=e.statusEl,L="",R="starmus-status";if(i)L=i.message||"An error occurred.",R+=" starmus-status--error";else switch(r){case"ready":L="Mic calibrated. Click Start Recording.",R+=" starmus-status--success";break;case"recording":L="Recording...",R+=" starmus-status--recording";break;case"paused":L="Paused  Resume or Stop.";break;case"submitting":L="Uploading ".concat(Math.round(100*l.progress),"%");break;case"complete":L="Upload successful!",R+=" starmus-status--success";break;default:L=""}O.className=R,O.textContent=L,O.style.display=L?"block":"none"}}function tp(t,e){var n,r,i,o,a,s,l;console.log("[StarmusUI] initInstance called with elements:",{recordBtn:!!e.recordBtn,setupMicBtn:!!e.setupMicBtn,volumeMeter:!!e.volumeMeter,timer:!!e.timer,elementKeys:Object.keys(e)});var u=t.getState().instanceId,h=window.CommandBus||window.StarmusHooks;function c(t){if(!h)return console.warn("[StarmusUI] No CommandBus detected.");console.log("[StarmusUI] Dispatching:",t),h.dispatch(t,{},{instanceId:u})}console.log("[StarmusUI] CommandBus found:",!!h,"Instance ID:",u),console.log("[StarmusUI] Attaching event listeners..."),e.recordBtn?(console.log("[StarmusUI] Record button element:",e.recordBtn),console.log("[StarmusUI] Button disabled:",e.recordBtn.disabled),console.log("[StarmusUI] Button style display:",getComputedStyle(e.recordBtn).display),console.log("[StarmusUI] Button style visibility:",getComputedStyle(e.recordBtn).visibility),console.log("[StarmusUI] Button style pointer-events:",getComputedStyle(e.recordBtn).pointerEvents),e.recordBtn.addEventListener("click",function(t){console.log("[StarmusUI] Record button clicked! Event:",t),console.log("[StarmusUI] Button disabled at click time:",e.recordBtn.disabled),c("start-recording")}),e.recordBtn.addEventListener("mousedown",function(t){console.log("[StarmusUI] Record button MOUSEDOWN detected!",t)}),setTimeout(function(){console.log("[StarmusUI] Testing manual click..."),e.recordBtn.click();var t=e.recordBtn.getBoundingClientRect(),n=t.left+t.width/2,r=t.top+t.height/2,i=document.elementFromPoint(n,r);console.log("[StarmusUI] Button position:",{x:n,y:r}),console.log("[StarmusUI] Element at button center:",i),console.log("[StarmusUI] Is the button the top element?",i===e.recordBtn),i!==e.recordBtn&&(console.log("[StarmusUI] *** FOUND THE PROBLEM! Another element is covering the button ***"),console.log("[StarmusUI] Covering element classes:",null==i?void 0:i.className),console.log("[StarmusUI] Covering element z-index:",getComputedStyle(i).zIndex))},2e3),console.log("[StarmusUI] Record button listener attached")):console.log("[StarmusUI] No record button found!"),null===(n=e.pauseBtn)||void 0===n||n.addEventListener("click",function(){return c("pause-mic")}),null===(r=e.resumeBtn)||void 0===r||r.addEventListener("click",function(){return c("resume-mic")}),null===(i=e.stopBtn)||void 0===i||i.addEventListener("click",function(){return c("stop-mic")}),null===(o=e.submitBtn)||void 0===o||o.addEventListener("click",function(){var t,n=e.submitBtn.closest("form"),r={},i=Mh((n?new FormData(n):new FormData).entries());try{for(i.s();!(t=i.n()).done;){var o=Uh(t.value,2),a=o[0],s=o[1];r[a]=s}}catch(t){i.e(t)}finally{i.f()}c("submit")}),null===(a=e.resetBtn)||void 0===a||a.addEventListener("click",function(){return c("reset")}),null===(s=e.playBtn)||void 0===s||s.addEventListener("click",function(){return c("play")}),null===(l=e.setupMicBtn)||void 0===l||l.addEventListener("click",function(){return c("setup-mic")}),e.fileInput&&e.fileInput.addEventListener("change",function(t){var e,n=null===(e=t.target.files)||void 0===e?void 0:e[0];n&&h.dispatch("file-attached",{file:n},{instanceId:u})});var d=t.subscribe(function(t){return $f(t,e)});return $f(t.getState(),e),d}"undefined"!=typeof window&&(window.initUI=tp),document.addEventListener("DOMContentLoaded",function(){var t=document.querySelectorAll('[data-starmus-action="next"]');t.length&&t.forEach(function(t){t.addEventListener("click",function(){try{var e;if(!window.StarmusStore||!window.StarmusStore.createStore)return void console.error("[Starmus] Store not available");var n=t.closest("[data-starmus-instance]");if(!n)return;var r=n.getAttribute("data-starmus-instance"),i=null===(e=window.StarmusInstances)||void 0===e||null===(e=e[r])||void 0===e?void 0:e.store;if(!i)return void console.error("[Starmus] No store for instance",r);i.dispatch({type:"starmus/ui/step-continue"});var o=document.querySelector("#starmus_step1_"+r),a=document.querySelector("#starmus_step2_"+r);o&&(o.style.display="none"),a&&(a.style.display="block"),console.log("[Starmus] Continue  Recording step enabled",r)}catch(t){console.error("[Starmus Continue Error]",t)}})})});var ep,np={};!function(){if(ep)return np;ep=1;var t=$a(),e=Ma().includes,n=Ir(),r=js();t({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),r("includes")}();var rp,ip,op,ap,sp,lp,up,hp={};function cp(){if(ap)return op;ap=1;var t=function(){if(ip)return rp;ip=1;var t=Mi(),e=Ci(),n=So()("match");return rp=function(r){var i;return t(r)&&(void 0!==(i=r[n])?!!i:"RegExp"===e(r))}}(),e=TypeError;return op=function(n){if(t(n))throw new e("The method doesn't accept regular expressions");return n}}!function(){if(up)return hp;up=1;var t=$a(),e=xi(),n=cp(),r=Ei(),i=Ju(),o=function(){if(lp)return sp;lp=1;var t=So()("match");return sp=function(e){var n=/./;try{"/./"[e](n)}catch(r){try{return n[t]=!1,"/./"[e](n)}catch(t){}}return!1}}(),a=e("".indexOf);t({target:"String",proto:!0,forced:!o("includes")},{includes:function(t){return!!~a(i(r(this)),i(n(t)),arguments.length>1?arguments[1]:void 0)}})}();var dp,fp,pp,gp,mp,vp,yp,_p={};function bp(){return fp?dp:(fp=1,dp="\t\n\v\f\r \u2028\u2029\ufeff")}function wp(){if(gp)return pp;gp=1;var t=xi(),e=Ei(),n=Ju(),r=bp(),i=t("".replace),o=RegExp("^["+r+"]+"),a=RegExp("(^|[^"+r+"])["+r+"]+$"),s=function(t){return function(r){var s=n(e(r));return 1&t&&(s=i(s,o,"")),2&t&&(s=i(s,a,"$1")),s}};return pp={start:s(1),end:s(2),trim:s(3)}}!function(){if(yp)return _p;yp=1;var t=$a(),e=wp().trim,n=function(){if(vp)return mp;vp=1;var t=na().PROPER,e=Ir(),n=bp();return mp=function(r){return e(function(){return!!n[r]()||""!==""[r]()||t&&n[r].name!==r})}}();t({target:"String",proto:!0,forced:n("trim")},{trim:function(){return e(this)}})}();var Sp=window.StarmusHooks||{},kp=Sp.subscribe||function(){},xp=Sp.debugLog||function(){};function Cp(t,e,n){xp("[StarmusCore] initCore",e,n);try{window.dispatchEvent(new CustomEvent("starmus-ready",{detail:{instanceId:e}})),xp("[StarmusCore] dispatched starmus-ready event")}catch(t){xp("[StarmusCore] failed to dispatch starmus-ready",t)}function r(t){return i.apply(this,arguments)}function i(){return(i=Eh(Rh().m(function r(i){var o,a,s,l,u,h,c,d,f,p,g,m,v,y,_,b,w;return Rh().w(function(r){for(;;)switch(r.p=r.n){case 0:if(a=t.getState(),s=a.source||{},l=a.calibration||{},u=a.env||n||{},h=s.blob||s.file,c=s.fileName||s.file&&s.file.name||"recording.webm",h){r.n=1;break}return t.dispatch({type:"starmus/error",error:{message:"Please record or attach audio before submitting.",retryable:!1},status:a.status}),r.a(2);case 1:if(d={transcript:(null===(o=s.transcript)||void 0===o?void 0:o.trim())||null,calibration:l.complete?{gain:l.gain,snr:l.snr,noiseFloor:l.noiseFloor,speechLevel:l.speechLevel,timestamp:l.timestamp||(new Date).toISOString()}:null,env:u},f=mf(h.size,u.network),xp("[StarmusCore] Upload size: ".concat((h.size/1024/1024).toFixed(2),"MB, estimated time: ").concat(vf(f))),t.dispatch({type:"starmus/submit-start"}),p=function(e,n){t.dispatch({type:"starmus/submit-progress",progress:e/n})},r.p=2,navigator.onLine){r.n=3;break}throw new Error("OFFLINE_FAST_PATH");case 3:return r.n=4,pf({blob:h,fileName:c,formFields:i,metadata:d,instanceId:e,onProgress:p});case 4:g=r.v,xp("[StarmusCore] Upload succeeded via",g.method,g),t.dispatch({type:"starmus/submit-complete",payload:g});try{window.dispatchEvent(new CustomEvent("starmus-upload-finished",{detail:{instanceId:e,method:g.method}}))}catch(t){}r.n=12;break;case 5:if(r.p=5,b=r.v,xp("[StarmusCore] Upload error",b),m=(null==b?void 0:b.message)||"",v=m.includes("not configured"),"OFFLINE_FAST_PATH"!==b.message&&v){r.n=11;break}return xp("[StarmusCore] Saving submission to offline queue for retry"),r.p=6,r.n=7,Bf(e,h,c,i,d);case 7:return y=r.v,t.dispatch({type:"starmus/submit-queued",submissionId:y}),r.n=8,Uf();case 8:_=r.v,xp("[StarmusCore] Offline queue count: ".concat(_)),window.dispatchEvent(new CustomEvent("starmus-offline-queued",{detail:{instanceId:e,pending:_}})),r.n=10;break;case 9:r.p=9,w=r.v,console.error("[StarmusCore] Failed to save offline submission",w),t.dispatch({type:"starmus/error",error:{message:"Upload failed and could not be saved offline.",retryable:!1},status:"ready_to_submit"});case 10:r.n=12;break;case 11:t.dispatch({type:"starmus/error",error:{message:b.message||"Upload failed.",retryable:!1},status:"ready_to_submit"});case 12:return r.a(2)}},r,null,[[6,9],[2,5]])}))).apply(this,arguments)}return kp("submit",function(t,n){n&&n.instanceId===e&&r(t.formFields||{})}),kp("reset",function(n,r){r&&r.instanceId===e&&t.dispatch({type:"starmus/reset"})}),kp("continue",function(n,r){r&&r.instanceId===e&&t.dispatch({type:"starmus/ui/step-continue"})}),{handleSubmit:r}}"undefined"!=typeof window&&(window.initCore=Cp),"undefined"!=typeof module&&module.exports&&(module.exports={initCore:Cp});var Tp,Ap,Ep,Pp,Ip,Mp,Dp,Op,Lp,Rp,Bp,Fp,Up,Wp,Gp,jp,Hp,Np,zp,Xp={};function Vp(){return Ap?Tp:(Ap=1,Tp="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView)}function Yp(){if(Pp)return Ep;Pp=1;var t=Aa(),e=Pa(),n=RangeError;return Ep=function(r){if(void 0===r)return 0;var i=t(r),o=e(i);if(i!==o)throw new n("Wrong length or index");return o}}function Zp(){if(Rp)return Lp;Rp=1;var t=Mp?Ip:(Mp=1,Ip=Math.sign||function(t){var e=+t;return 0===e||e!=e?e:e<0?-1:1}),e=function(){if(Op)return Dp;Op=1;var t=4503599627370496;return Dp=function(e){return e+t-t}}(),n=Math.abs;return Lp=function(r,i,o,a){var s=+r,l=n(s),u=t(s);if(l<a)return u*e(l/a/i)*a*i;var h=(1+i/2220446049250313e-31)*l,c=h-(h-l);return c>o||c!=c?u*(1/0):u*c}}function qp(){if(Wp)return Up;Wp=1;var t=Array,e=Math.abs,n=Math.pow,r=Math.floor,i=Math.log,o=Math.LN2;return Up={pack:function(a,s,l){var u,h,c,d=t(l),f=8*l-s-1,p=(1<<f)-1,g=p>>1,m=23===s?n(2,-24)-n(2,-77):0,v=a<0||0===a&&1/a<0?1:0,y=0;for((a=e(a))!=a||a===1/0?(h=a!=a?1:0,u=p):(u=r(i(a)/o),a*(c=n(2,-u))<1&&(u--,c*=2),(a+=u+g>=1?m/c:m*n(2,1-g))*c>=2&&(u++,c/=2),u+g>=p?(h=0,u=p):u+g>=1?(h=(a*c-1)*n(2,s),u+=g):(h=a*n(2,g-1)*n(2,s),u=0));s>=8;)d[y++]=255&h,h/=256,s-=8;for(u=u<<s|h,f+=s;f>0;)d[y++]=255&u,u/=256,f-=8;return d[y-1]|=128*v,d},unpack:function(t,e){var r,i=t.length,o=8*i-e-1,a=(1<<o)-1,s=a>>1,l=o-7,u=i-1,h=t[u--],c=127&h;for(h>>=7;l>0;)c=256*c+t[u--],l-=8;for(r=c&(1<<-l)-1,c>>=-l,l+=e;l>0;)r=256*r+t[u--],l-=8;if(0===c)c=1-s;else{if(c===a)return r?NaN:h?-1/0:1/0;r+=n(2,e),c-=s}return(h?-1:1)*r*n(2,c-e)}}}function Kp(){if(jp)return Gp;jp=1;var t=_o(),e=Ea(),n=Ia();return Gp=function(r){for(var i=t(this),o=n(i),a=arguments.length,s=e(a>1?arguments[1]:void 0,o),l=a>2?arguments[2]:void 0,u=void 0===l?o:e(l,o);u>s;)i[s++]=r;return i},Gp}function Jp(){if(Np)return Hp;Np=1;var t=br(),e=xi(),n=Mr(),r=Vp(),i=na(),o=Wo(),a=ju(),s=Hu(),l=Ir(),u=Fu(),h=Aa(),c=Pa(),d=Yp(),f=function(){if(Fp)return Bp;Fp=1;var t=Zp();return Bp=Math.fround||function(e){return t(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}}(),p=qp(),g=Ns(),m=qs(),v=Kp(),y=wl(),_=Wu(),b=Ja(),w=Xs(),S=aa(),k=i.PROPER,x=i.CONFIGURABLE,C="ArrayBuffer",T="DataView",A="prototype",E="Wrong index",P=S.getterFor(C),I=S.getterFor(T),M=S.set,D=t[C],O=D,L=O&&O[A],R=t[T],B=R&&R[A],F=Object.prototype,U=t.Array,W=t.RangeError,G=e(v),j=e([].reverse),H=p.pack,N=p.unpack,z=function(t){return[255&t]},X=function(t){return[255&t,t>>8&255]},V=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Y=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Z=function(t){return H(f(t),23,4)},q=function(t){return H(t,52,8)},K=function(t,e,n){a(t[A],e,{configurable:!0,get:function(){return n(this)[e]}})},J=function(t,e,n,r){var i=I(t),o=d(n),a=!!r;if(o+e>i.byteLength)throw new W(E);var s=i.bytes,l=o+i.byteOffset,u=y(s,l,l+e);return a?u:j(u)},Q=function(t,e,n,r,i,o){var a=I(t),s=d(n),l=r(+i),u=!!o;if(s+e>a.byteLength)throw new W(E);for(var h=a.bytes,c=s+a.byteOffset,f=0;f<e;f++)h[c+f]=l[u?f:e-f-1]};if(r){var $=k&&D.name!==C;l(function(){D(1)})&&l(function(){new D(-1)})&&!l(function(){return new D,new D(1.5),new D(NaN),1!==D.length||$&&!x})?$&&x&&o(D,"name",C):((O=function(t){return u(this,L),_(new D(d(t)),this,O)})[A]=L,L.constructor=O,b(O,D)),m&&g(B)!==F&&m(B,F);var tt=new R(new O(2)),et=e(B.setInt8);tt.setInt8(0,2147483648),tt.setInt8(1,2147483649),!tt.getInt8(0)&&tt.getInt8(1)||s(B,{setInt8:function(t,e){et(this,t,e<<24>>24)},setUint8:function(t,e){et(this,t,e<<24>>24)}},{unsafe:!0})}else L=(O=function(t){u(this,L);var e=d(t);M(this,{type:C,bytes:G(U(e),0),byteLength:e}),n||(this.byteLength=e,this.detached=!1)})[A],B=(R=function(t,e,r){u(this,B),u(t,L);var i=P(t),o=i.byteLength,a=h(e);if(a<0||a>o)throw new W("Wrong offset");if(a+(r=void 0===r?o-a:c(r))>o)throw new W("Wrong length");M(this,{type:T,buffer:t,byteLength:r,byteOffset:a,bytes:i.bytes}),n||(this.buffer=t,this.byteLength=r,this.byteOffset=a)})[A],n&&(K(O,"byteLength",P),K(R,"buffer",I),K(R,"byteLength",I),K(R,"byteOffset",I)),s(B,{getInt8:function(t){return J(this,1,t)[0]<<24>>24},getUint8:function(t){return J(this,1,t)[0]},getInt16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=J(this,2,t,arguments.length>1&&arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))},getUint32:function(t){return Y(J(this,4,t,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(t){return N(J(this,4,t,arguments.length>1&&arguments[1]),23)},getFloat64:function(t){return N(J(this,8,t,arguments.length>1&&arguments[1]),52)},setInt8:function(t,e){Q(this,1,t,z,e)},setUint8:function(t,e){Q(this,1,t,z,e)},setInt16:function(t,e){Q(this,2,t,X,e,arguments.length>2&&arguments[2])},setUint16:function(t,e){Q(this,2,t,X,e,arguments.length>2&&arguments[2])},setInt32:function(t,e){Q(this,4,t,V,e,arguments.length>2&&arguments[2])},setUint32:function(t,e){Q(this,4,t,V,e,arguments.length>2&&arguments[2])},setFloat32:function(t,e){Q(this,4,t,Z,e,arguments.length>2&&arguments[2])},setFloat64:function(t,e){Q(this,8,t,q,e,arguments.length>2&&arguments[2])}});return w(O,C),w(R,T),Hp={ArrayBuffer:O,DataView:R}}!function(){if(zp)return Xp;zp=1;var t=$a(),e=br(),n=Jp(),r=Nu(),i="ArrayBuffer",o=n[i];t({global:!0,constructor:!0,forced:e[i]!==o},{ArrayBuffer:o}),r(i)}();var Qp,$p={};!function(){if(Qp)return $p;Qp=1;var t=$a(),e=ts(),n=Ir(),r=Jp(),i=Fo(),o=Ea(),a=Pa(),s=r.ArrayBuffer,l=r.DataView,u=l.prototype,h=e(s.prototype.slice),c=e(u.getUint8),d=e(u.setUint8);t({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:n(function(){return!new s(2).slice(1,void 0).byteLength})},{slice:function(t,e){if(h&&void 0===e)return h(i(this),t);for(var n=i(this).byteLength,r=o(t,n),u=o(void 0===e?n:e,n),f=new s(a(u-r)),p=new l(this),g=new l(f),m=0;r<u;)d(g,m++,c(p,r++));return f}})}();var tg,eg;eg||(eg=1,tg||(tg=1,Gu()("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},zu())));var ng,rg,ig,og={};!function(){if(ig)return og;ig=1;var t=$a(),e=function(){if(rg)return ng;rg=1;var t=br(),e=Ir(),n=xi(),r=Ju(),i=wp().trim,o=bp(),a=n("".charAt),s=t.parseFloat,l=t.Symbol,u=l&&l.iterator,h=1/s(o+"-0")!=-1/0||u&&!e(function(){s(Object(u))});return ng=h?function(t){var e=i(r(t)),n=s(e);return 0===n&&"-"===a(e,0)?-0:n}:s}();t({global:!0,forced:parseFloat!==e},{parseFloat:e})}();var ag,sg,lg,ug,hg,cg,dg,fg,pg,gg,mg,vg,yg,_g,bg,wg,Sg,kg,xg,Cg,Tg,Ag,Eg={exports:{}};function Pg(){if(sg)return ag;sg=1;var t,e,n,r=Vp(),i=Mr(),o=br(),a=Ii(),s=Mi(),l=bo(),u=vl(),h=Wi(),c=Wo(),d=la(),f=ju(),p=Oi(),g=Ns(),m=qs(),v=So(),y=wo(),_=aa(),b=_.enforce,w=_.get,S=o.Int8Array,k=S&&S.prototype,x=o.Uint8ClampedArray,C=x&&x.prototype,T=S&&g(S),A=k&&g(k),E=Object.prototype,P=o.TypeError,I=v("toStringTag"),M=y("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",O=r&&!!m&&"Opera"!==u(o.opera),L=!1,R={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},B={BigInt64Array:8,BigUint64Array:8},F=function(t){var e=g(t);if(s(e)){var n=w(e);return n&&l(n,D)?n[D]:F(e)}},U=function(t){if(!s(t))return!1;var e=u(t);return l(R,e)||l(B,e)};for(t in R)(n=(e=o[t])&&e.prototype)?b(n)[D]=e:O=!1;for(t in B)(n=(e=o[t])&&e.prototype)&&(b(n)[D]=e);if((!O||!a(T)||T===Function.prototype)&&(T=function(){throw new P("Incorrect invocation")},O))for(t in R)o[t]&&m(o[t],T);if((!O||!A||A===E)&&(A=T.prototype,O))for(t in R)o[t]&&m(o[t].prototype,A);if(O&&g(C)!==A&&m(C,A),i&&!l(A,I))for(t in L=!0,f(A,I,{configurable:!0,get:function(){return s(this)?this[M]:void 0}}),R)o[t]&&c(o[t],M,t);return ag={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:L&&M,aTypedArray:function(t){if(U(t))return t;throw new P("Target is not a typed array")},aTypedArrayConstructor:function(t){if(a(t)&&(!m||p(T,t)))return t;throw new P(h(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,n,r){if(i){if(n)for(var a in R){var s=o[a];if(s&&l(s.prototype,t))try{delete s.prototype[t]}catch(n){try{s.prototype[t]=e}catch(t){}}}A[t]&&!n||d(A,t,n?e:O&&k[t]||e,r)}},exportTypedArrayStaticMethod:function(t,e,n){var r,a;if(i){if(m){if(n)for(r in R)if((a=o[r])&&l(a,t))try{delete a[t]}catch(t){}if(T[t]&&!n)return;try{return d(T,t,n?e:O&&T[t]||e)}catch(t){}}for(r in R)!(a=o[r])||a[t]&&!n||d(a,t,e)}},getTypedArrayConstructor:F,isView:function(t){if(!s(t))return!1;var e=u(t);return"DataView"===e||l(R,e)||l(B,e)},isTypedArray:U,TypedArray:T,TypedArrayPrototype:A}}function Ig(){if(cg)return hg;cg=1;var t=Mi(),e=Math.floor;return hg=Number.isInteger||function(n){return!t(n)&&isFinite(n)&&e(n)===n}}function Mg(){if(fg)return dg;fg=1;var t=Aa(),e=RangeError;return dg=function(n){var r=t(n);if(r<0)throw new e("The argument can't be less than 0");return r}}function Dg(){if(gg)return pg;gg=1;var t=Mg(),e=RangeError;return pg=function(n,r){var i=t(n);if(i%r)throw new e("Wrong offset");return i}}function Og(){if(vg)return mg;vg=1;var t=Math.round;return mg=function(e){var n=t(e);return n<0?0:n>255?255:255&n}}function Lg(){if(_g)return yg;_g=1;var t=vl();return yg=function(e){var n=t(e);return"BigInt64Array"===n||"BigUint64Array"===n}}function Rg(){if(wg)return bg;wg=1;var t=ko(),e=TypeError;return bg=function(n){var r=t(n,"number");if("number"==typeof r)throw new e("Can't convert number to bigint");return BigInt(r)}}function Bg(){if(kg)return Sg;kg=1;var t=Mu(),e=Or(),n=Nc(),r=_o(),i=Ia(),o=Lu(),a=Ou(),s=Du(),l=Lg(),u=Pg().aTypedArrayConstructor,h=Rg();return Sg=function(c){var d,f,p,g,m,v,y,_,b=n(this),w=r(c),S=arguments.length,k=S>1?arguments[1]:void 0,x=void 0!==k,C=a(w);if(C&&!s(C))for(_=(y=o(w,C)).next,w=[];!(v=e(_,y)).done;)w.push(v.value);for(x&&S>2&&(k=t(k,arguments[2])),f=i(w),p=new(u(b))(f),g=l(p),d=0;f>d;d++)m=x?k(w[d],d):w[d],p[d]=g?h(m):+m;return p},Sg}function Fg(){if(Cg)return xg;Cg=1;var t=Ia();return xg=function(e,n,r){for(var i=0,o=arguments.length>2?r:t(n),a=new e(o);o>i;)a[i]=n[i++];return a},xg}function Ug(){if(Tg)return Eg.exports;Tg=1;var t=$a(),e=br(),n=Or(),r=Mr(),i=function(){if(ug)return lg;ug=1;var t=br(),e=Ir(),n=Uu(),r=Pg().NATIVE_ARRAY_BUFFER_VIEWS,i=t.ArrayBuffer,o=t.Int8Array;return lg=!r||!e(function(){o(1)})||!e(function(){new o(-1)})||!n(function(t){new o,new o(null),new o(1.5),new o(t)},!0)||e(function(){return 1!==new o(new i(2),1,void 0).length})}(),o=Pg(),a=Jp(),s=Fu(),l=ki(),u=Wo(),h=Ig(),c=Pa(),d=Yp(),f=Dg(),p=Og(),g=xo(),m=bo(),v=vl(),y=Mi(),_=Ui(),b=Gs(),w=Oi(),S=qs(),k=La().f,x=Bg(),C=gh().forEach,T=Nu(),A=ju(),E=Uo(),P=Ao(),I=Fg(),M=aa(),D=Wu(),O=M.get,L=M.set,R=M.enforce,B=E.f,F=P.f,U=e.RangeError,W=a.ArrayBuffer,G=W.prototype,j=a.DataView,H=o.NATIVE_ARRAY_BUFFER_VIEWS,N=o.TYPED_ARRAY_TAG,z=o.TypedArray,X=o.TypedArrayPrototype,V=o.isTypedArray,Y="BYTES_PER_ELEMENT",Z="Wrong length",q=function(t,e){A(t,e,{configurable:!0,get:function(){return O(this)[e]}})},K=function(t){var e;return w(G,t)||"ArrayBuffer"===(e=v(t))||"SharedArrayBuffer"===e},J=function(t,e){return V(t)&&!_(e)&&e in t&&h(+e)&&e>=0},Q=function(t,e){return e=g(e),J(t,e)?l(2,t[e]):F(t,e)},$=function(t,e,n){return e=g(e),!(J(t,e)&&y(n)&&m(n,"value"))||m(n,"get")||m(n,"set")||n.configurable||m(n,"writable")&&!n.writable||m(n,"enumerable")&&!n.enumerable?B(t,e,n):(t[e]=n.value,t)};return r?(H||(P.f=Q,E.f=$,q(X,"buffer"),q(X,"byteOffset"),q(X,"byteLength"),q(X,"length")),t({target:"Object",stat:!0,forced:!H},{getOwnPropertyDescriptor:Q,defineProperty:$}),Eg.exports=function(r,o,a){var l=r.match(/\d+/)[0]/8,h=r+(a?"Clamped":"")+"Array",g="get"+r,m="set"+r,v=e[h],_=v,w=_&&_.prototype,A={},E=function(t,e){B(t,e,{get:function(){return function(t,e){var n=O(t);return n.view[g](e*l+n.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,n){var r=O(t);r.view[m](e*l+r.byteOffset,a?p(n):n,!0)}(this,e,t)},enumerable:!0})};H?i&&(_=o(function(t,e,r,i){return s(t,w),D(y(e)?K(e)?void 0!==i?new v(e,f(r,l),i):void 0!==r?new v(e,f(r,l)):new v(e):V(e)?I(_,e):n(x,_,e):new v(d(e)),t,_)}),S&&S(_,z),C(k(v),function(t){t in _||u(_,t,v[t])}),_.prototype=w):(_=o(function(t,e,r,i){s(t,w);var o,a,u,h=0,p=0;if(y(e)){if(!K(e))return V(e)?I(_,e):n(x,_,e);o=e,p=f(r,l);var g=e.byteLength;if(void 0===i){if(g%l)throw new U(Z);if((a=g-p)<0)throw new U(Z)}else if((a=c(i)*l)+p>g)throw new U(Z);u=a/l}else u=d(e),o=new W(a=u*l);for(L(t,{buffer:o,byteOffset:p,byteLength:a,length:u,view:new j(o)});h<u;)E(t,h++)}),S&&S(_,z),w=_.prototype=b(X)),w.constructor!==_&&u(w,"constructor",_),R(w).TypedArrayConstructor=_,N&&u(w,N,h);var P=_!==v;A[h]=_,t({global:!0,constructor:!0,forced:P,sham:!H},A),Y in _||u(_,Y,l),Y in w||u(w,Y,l),T(h)}):Eg.exports=function(){},Eg.exports}Ag||(Ag=1,Ug()("Float32",function(t){return function(e,n,r){return t(this,e,n,r)}}));var Wg,Gg,jg,Hg={};!function(){if(jg)return Hg;jg=1;var t=xi(),e=Pg(),n=function(){if(Gg)return Wg;Gg=1;var t=_o(),e=Ea(),n=Ia(),r=Fl(),i=Math.min;return Wg=[].copyWithin||function(o,a){var s=t(this),l=n(s),u=e(o,l),h=e(a,l),c=arguments.length>2?arguments[2]:void 0,d=i((void 0===c?l:e(c,l))-h,l-u),f=1;for(h<u&&u<h+d&&(f=-1,h+=d-1,u+=d-1);d-- >0;)h in s?s[u]=s[h]:r(s,u),u+=f,h+=f;return s},Wg}(),r=t(n),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("copyWithin",function(t,e){return r(i(this),t,e,arguments.length>2?arguments[2]:void 0)})}();var Ng,zg={};!function(){if(Ng)return zg;Ng=1;var t=Pg(),e=gh().every,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("every",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Xg,Vg={};!function(){if(Xg)return Vg;Xg=1;var t=Pg(),e=Kp(),n=Rg(),r=vl(),i=Or(),o=xi(),a=Ir(),s=t.aTypedArray,l=t.exportTypedArrayMethod,u=o("".slice);l("fill",function(t){var o=arguments.length;s(this);var a="Big"===u(r(this),0,3)?n(t):+t;return i(e,this,a,o>1?arguments[1]:void 0,o>2?arguments[2]:void 0)},a(function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t}))}();var Yg,Zg,qg,Kg={};!function(){if(qg)return Kg;qg=1;var t=Pg(),e=gh().filter,n=function(){if(Zg)return Yg;Zg=1;var t=Fg(),e=Pg().getTypedArrayConstructor;return Yg=function(n,r){return t(e(n),r)}}(),r=t.aTypedArray;(0,t.exportTypedArrayMethod)("filter",function(t){var i=e(r(this),t,arguments.length>1?arguments[1]:void 0);return n(this,i)})}();var Jg,Qg={};!function(){if(Jg)return Qg;Jg=1;var t=Pg(),e=gh().find,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("find",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var $g,tm={};!function(){if($g)return tm;$g=1;var t=Pg(),e=gh().findIndex,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("findIndex",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var em,nm={};!function(){if(em)return nm;em=1;var t=Pg(),e=gh().forEach,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("forEach",function(t){e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var rm,im={};!function(){if(rm)return im;rm=1;var t=Pg(),e=Ma().includes,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("includes",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var om,am={};!function(){if(om)return am;om=1;var t=Pg(),e=Ma().indexOf,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("indexOf",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var sm,lm={};!function(){if(sm)return lm;sm=1;var t=br(),e=Ir(),n=xi(),r=Pg(),i=Qs(),o=So()("iterator"),a=t.Uint8Array,s=n(i.values),l=n(i.keys),u=n(i.entries),h=r.aTypedArray,c=r.exportTypedArrayMethod,d=a&&a.prototype,f=!e(function(){d[o].call([1])}),p=!!d&&d.values&&d[o]===d.values&&"values"===d.values.name,g=function(){return s(h(this))};c("entries",function(){return u(h(this))},f),c("keys",function(){return l(h(this))},f),c("values",g,f||!p,{name:"values"}),c(o,g,f||!p,{name:"values"})}();var um,hm={};!function(){if(um)return hm;um=1;var t=Pg(),e=xi(),n=t.aTypedArray,r=t.exportTypedArrayMethod,i=e([].join);r("join",function(t){return i(n(this),t)})}();var cm,dm,fm,pm={};!function(){if(fm)return pm;fm=1;var t=Pg(),e=Xc(),n=function(){if(dm)return cm;dm=1;var t=Xc(),e=Pi(),n=Aa(),r=Ia(),i=es(),o=Math.min,a=[].lastIndexOf,s=!!a&&1/[1].lastIndexOf(1,-0)<0,l=i("lastIndexOf");return cm=s||!l?function(i){if(s)return t(a,this,arguments)||0;var l=e(this),u=r(l);if(0===u)return-1;var h=u-1;for(arguments.length>1&&(h=o(h,n(arguments[1]))),h<0&&(h=u+h);h>=0;h--)if(h in l&&l[h]===i)return h||0;return-1}:a,cm}(),r=t.aTypedArray;(0,t.exportTypedArrayMethod)("lastIndexOf",function(t){var i=arguments.length;return e(n,r(this),i>1?[t,arguments[1]]:[t])})}();var gm,mm={};!function(){if(gm)return mm;gm=1;var t=Pg(),e=gh().map,n=t.aTypedArray,r=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("map",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0,function(t,e){return new(r(t))(e)})})}();var vm,ym={};!function(){if(vm)return ym;vm=1;var t=Pg(),e=tc().left,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduce",function(t){var r=arguments.length;return e(n(this),t,r,r>1?arguments[1]:void 0)})}();var _m,bm={};!function(){if(_m)return bm;_m=1;var t=Pg(),e=tc().right,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("reduceRight",function(t){var r=arguments.length;return e(n(this),t,r,r>1?arguments[1]:void 0)})}();var wm,Sm={};!function(){if(wm)return Sm;wm=1;var t=Pg(),e=t.aTypedArray,n=t.exportTypedArrayMethod,r=Math.floor;n("reverse",function(){for(var t,n=this,i=e(n).length,o=r(i/2),a=0;a<o;)t=n[a],n[a++]=n[--i],n[i]=t;return n})}();var km,xm={};!function(){if(km)return xm;km=1;var t=br(),e=Or(),n=Pg(),r=Ia(),i=Dg(),o=_o(),a=Ir(),s=t.RangeError,l=t.Int8Array,u=l&&l.prototype,h=u&&u.set,c=n.aTypedArray,d=n.exportTypedArrayMethod,f=!a(function(){var t=new Uint8ClampedArray(2);return e(h,t,{length:1,0:3},1),3!==t[1]}),p=f&&n.NATIVE_ARRAY_BUFFER_VIEWS&&a(function(){var t=new l(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]});d("set",function(t){c(this);var n=i(arguments.length>1?arguments[1]:void 0,1),a=o(t);if(f)return e(h,this,a,n);var l=this.length,u=r(a),d=0;if(u+n>l)throw new s("Wrong length");for(;d<u;)this[n+d]=a[d++]},!f||p)}();var Cm,Tm={};!function(){if(Cm)return Tm;Cm=1;var t=Pg(),e=Ir(),n=wl(),r=t.aTypedArray,i=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("slice",function(t,e){for(var o=n(r(this),t,e),a=i(this),s=0,l=o.length,u=new a(l);l>s;)u[s]=o[s++];return u},e(function(){new Int8Array(1).slice()}))}();var Am,Em={};!function(){if(Am)return Em;Am=1;var t=Pg(),e=gh().some,n=t.aTypedArray;(0,t.exportTypedArrayMethod)("some",function(t){return e(n(this),t,arguments.length>1?arguments[1]:void 0)})}();var Pm,Im,Mm,Dm,Om,Lm,Rm,Bm,Fm,Um={};function Wm(){if(Im)return Pm;Im=1;var t=wl(),e=Math.floor,n=function(r,i){var o=r.length;if(o<8)for(var a,s,l=1;l<o;){for(s=l,a=r[l];s&&i(r[s-1],a)>0;)r[s]=r[--s];s!==l++&&(r[s]=a)}else for(var u=e(o/2),h=n(t(r,0,u),i),c=n(t(r,u),i),d=h.length,f=c.length,p=0,g=0;p<d||g<f;)r[p+g]=p<d&&g<f?i(h[p],c[g])<=0?h[p++]:c[g++]:p<d?h[p++]:c[g++];return r};return Pm=n}function Gm(){if(Dm)return Mm;Dm=1;var t=Li().match(/firefox\/(\d+)/i);return Mm=!!t&&+t[1]}function jm(){if(Lm)return Om;Lm=1;var t=Li();return Om=/MSIE|Trident/.test(t)}function Hm(){if(Bm)return Rm;Bm=1;var t=Li().match(/AppleWebKit\/(\d+)\./);return Rm=!!t&&+t[1]}!function(){if(Fm)return Um;Fm=1;var t=br(),e=ts(),n=Ir(),r=Gi(),i=Wm(),o=Pg(),a=Gm(),s=jm(),l=Ri(),u=Hm(),h=o.aTypedArray,c=o.exportTypedArrayMethod,d=t.Uint16Array,f=d&&e(d.prototype.sort),p=!(!f||n(function(){f(new d(2),null)})&&n(function(){f(new d(2),{})})),g=!!f&&!n(function(){if(l)return l<74;if(a)return a<67;if(s)return!0;if(u)return u<602;var t,e,n=new d(516),r=Array(516);for(t=0;t<516;t++)e=t%4,n[t]=515-t,r[t]=t-2*e+3;for(f(n,function(t,e){return(t/4|0)-(e/4|0)}),t=0;t<516;t++)if(n[t]!==r[t])return!0});c("sort",function(t){return void 0!==t&&r(t),g?f(this,t):i(h(this),function(t){return function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}}(t))},!g||p)}();var Nm,zm={};!function(){if(Nm)return zm;Nm=1;var t=Pg(),e=Pa(),n=Ea(),r=t.aTypedArray,i=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("subarray",function(t,o){var a=r(this),s=a.length,l=n(t,s);return new(i(a))(a.buffer,a.byteOffset+l*a.BYTES_PER_ELEMENT,e((void 0===o?s:n(o,s))-l))})}();var Xm,Vm={};!function(){if(Xm)return Vm;Xm=1;var t=br(),e=Xc(),n=Pg(),r=Ir(),i=wl(),o=t.Int8Array,a=n.aTypedArray,s=n.exportTypedArrayMethod,l=[].toLocaleString,u=!!o&&r(function(){l.call(new o(1))});s("toLocaleString",function(){return e(l,u?i(a(this)):a(this),i(arguments))},r(function(){return[1,2].toLocaleString()!==new o([1,2]).toLocaleString()})||!r(function(){o.prototype.toLocaleString.call([1,2])}))}();var Ym,Zm={};!function(){if(Ym)return Zm;Ym=1;var t=Pg().exportTypedArrayMethod,e=Ir(),n=br(),r=xi(),i=n.Uint8Array,o=i&&i.prototype||{},a=[].toString,s=r([].join);e(function(){a.call({})})&&(a=function(){return s(this)});var l=o.toString!==a;t("toString",a,l)}();var qm=new Map,Km=null;function Jm(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{window.StarmusHooks&&"function"==typeof window.StarmusHooks.doAction&&window.StarmusHooks.doAction("starmus_event",{instanceId:t,event:e,severity:n.severity||"info",message:n.message||"",data:n.data||{}})}catch(t){console.warn("[Starmus] Telemetry emit failed:",t)}}function Qm(t){return $m.apply(this,arguments)}function $m(){return($m=Eh(Rh().m(function t(e){var n,r;return Rh().w(function(t){for(;;)switch(t.n){case 0:if((n=e.getAudioTracks&&e.getAudioTracks()||[]).length){t.n=1;break}return t.a(2);case 1:if("live"!==(r=n[0]).readyState){t.n=2;break}return t.a(2);case 2:return t.a(2,new Promise(function(t){var e=0,n=setInterval(function(){("live"===r.readyState||e>100)&&(clearInterval(n),t()),e+=1},50);setTimeout(function(){clearInterval(n),t()},5e3)}))}},t)}))).apply(this,arguments)}function tv(){var t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("AudioContext not supported in this browser");if((!Km||"closed"===Km.state)&&(Km=new t({latencyHint:"interactive"}),_h("[Recorder] Created AudioContext, state:",Km.state),"function"!=typeof Km.createMediaStreamSource))throw new Error("AudioContext lacks createMediaStreamSource");return Km}function ev(t){var e=tv(),n=e.createMediaStreamSource(t);try{var r=function(t){var e=t.createMediaStreamDestination||t.createMediaStreamAudioDestination;if("function"!=typeof e)throw new Error("MediaStreamDestination not supported");var n=e.call(t);if(!n||!n.stream)throw new Error("Destination stream invalid");return n}(e),i=e.createBiquadFilter();i.type="highpass",i.frequency.value=85;var o=e.createDynamicsCompressor();o.threshold.value=-20,o.knee.value=40,o.ratio.value=12,o.attack.value=0,o.release.value=.25;var a=e.createAnalyser();return a.fftSize=2048,n.connect(i),i.connect(o),o.connect(a),a.connect(r),{audioContext:e,destinationStream:r.stream,analyser:a,nodes:[n,i,o,a,r],fallbackActive:!1}}catch(r){_h("[Recorder] Audio graph failed  fallback to raw stream:",r.message);var s=e.createAnalyser();return s.fftSize=2048,n.connect(s),{audioContext:e,destinationStream:t,analyser:s,nodes:[n,s],fallbackActive:!0}}}function nv(t,e){return rv.apply(this,arguments)}function rv(){return(rv=Eh(Rh().m(function t(e,n){var r,i,o,a,s,l;return Rh().w(function(t){for(;;)if(0===t.n)return r=tv(),(i=r.createAnalyser()).fftSize=2048,(o=r.createMediaStreamSource(e)).connect(i),a=new Float32Array(i.fftSize),s=[],l=performance.now(),t.a(2,new Promise(function(t){!function e(){if("running"===r.state){i.getFloatTimeDomainData(a);for(var u=0,h=0;h<a.length;h++)u+=a[h]*a[h];var c=Math.sqrt(u/a.length);if(isFinite(c)){s.push(c);var d=Math.min(100,2e3*c);n&&n("",d,!1),performance.now()-l<15e3?requestAnimationFrame(e):function(){var e=Math.max(1,Math.floor(s.length/3)),r=s.slice(0,e),a=s.slice(e,2*e),l=function(t){return t.length?t.reduce(function(t,e){return t+e},0)/t.length:0},u=l(r),h=l(a),c=h/Math.max(u,1e-6),d=c<3?6:Math.max(1,Math.min(4,.1/Math.max(h,1e-6))),f={gain:parseFloat(d.toFixed(3)),snr:parseFloat(c.toFixed(3)),noiseFloor:parseFloat(u.toFixed(6)),speechLevel:parseFloat(h.toFixed(6)),timestamp:(new Date).toISOString()};try{o.disconnect()}catch(t){}try{i.disconnect()}catch(t){}n&&n("",null,!0);t(f)}()}else requestAnimationFrame(e)}else requestAnimationFrame(e)}()}))},t)}))).apply(this,arguments)}function iv(t,e){kh.unsubscribeInstance&&kh.unsubscribeInstance(e),kh.subscribe("setup-mic",function(){var n=Eh(Rh().m(function n(r,i){var o,a,s,l,u;return Rh().w(function(n){for(;;)switch(n.p=n.n){case 0:if(i.instanceId===e){n.n=1;break}return n.a(2);case 1:if(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia){n.n=2;break}return Jm(e,"E_RECORDER_UNSUPPORTED",{severity:"error",message:o="Microphone not supported."}),t.dispatch({type:"starmus/error",payload:{message:o,retryable:!1}}),n.a(2);case 2:return n.p=2,n.n=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:return a=n.v,Jm(e,"E_MIC_ACCESS",{severity:"info",message:"Mic access granted  calibrating"}),t.dispatch({type:"starmus/calibration-start"}),n.n=4,nv(a,function(e,n,r){t.dispatch({type:"starmus/calibration-update",message:e,volumePercent:n})});case 4:s=n.v,a.getTracks().forEach(function(t){return t.stop()}),t.dispatch({type:"starmus/calibration-complete",payload:{calibration:s},calibration:s}),n.n=6;break;case 5:n.p=5,u=n.v,l="NotAllowedError"===u.name?"Microphone permission denied.":"Failed to access microphone.",Jm(e,"E_MIC_ACCESS",{severity:"error",message:l,data:{error:u.message}}),t.dispatch({type:"starmus/error",payload:{message:l,retryable:!0}});case 6:return n.a(2)}},n,null,[[2,5]])}));return function(t,e){return n.apply(this,arguments)}}()),kh.subscribe("start-recording",function(){var n=Eh(Rh().m(function n(r,i){var o,a,s,l,u,h,c,d,f,p,g;return Rh().w(function(n){for(;;)switch(n.p=n.n){case 0:if(i.instanceId===e){n.n=1;break}return n.a(2);case 1:if("calibrating"!==(o=t.getState()).status){n.n=2;break}return t.dispatch({type:"starmus/error",payload:{message:"Please wait for calibration to complete.",retryable:!0}}),n.a(2);case 2:if(o.calibration&&o.calibration.complete){n.n=3;break}return t.dispatch({type:"starmus/error",payload:{message:"Please setup your microphone first.",retryable:!0}}),n.a(2);case 3:return n.p=3,a=function(){var n=qm.get(e);if(n&&"recording"===n.mediaRecorder.state){try{d.getFloatTimeDomainData(f);for(var r=0,i=0;i<f.length;i++)r+=f[i]*f[i];var o=Math.sqrt(r/f.length),s=Math.min(100,4e3*o),l=(performance.now()-p)/1e3;t.dispatch({type:"starmus/recorder-tick",duration:l,amplitude:s})}catch(t){}n.rafId=requestAnimationFrame(a)}},n.n=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:if(s=n.v,"suspended"!==(l=ev(s)).audioContext.state){n.n=5;break}return n.n=5,l.audioContext.resume();case 5:return n.n=6,Qm(l.destinationStream);case 6:if(u=l.destinationStream,u.getAudioTracks().length){n.n=7;break}throw new Error("No audio tracks available");case 7:h=new MediaRecorder(u),c=[],h.ondataavailable=function(t){t.data&&t.data.size>0&&c.push(t.data)},h.onstop=function(){var n=qm.get(e);if(n){n.rafId&&cancelAnimationFrame(n.rafId);var r=new Blob(c,{type:h.mimeType||"audio/webm"}),i="starmus-recording-".concat(Date.now(),".webm");Jm(e,"REC_COMPLETE",{severity:"info",message:"Recording stopped and blob created",data:{mimeType:h.mimeType||"audio/webm",chunkCount:c.length}}),t.dispatch({type:"starmus/recording-available",payload:{blob:r,fileName:i}}),s.getTracks().forEach(function(t){return t.stop()}),u.getTracks().forEach(function(t){return t.stop()}),l.nodes.forEach(function(t){try{t.disconnect()}catch(t){}}),qm.delete(e)}},qm.set(e,{mediaRecorder:h,rawStream:s,graph:l,rafId:null}),h.start(3e3),t.dispatch({type:"starmus/mic-start"}),d=l.analyser,f=new Float32Array(d.fftSize),p=performance.now(),requestAnimationFrame(a),n.n=9;break;case 8:n.p=8,g=n.v,console.error("[Recorder] ERROR start-recording:",g),Jm(e,"E_RECORDER_START_FAIL",{severity:"error",message:g.message}),t.dispatch({type:"starmus/error",payload:{message:"Recording failed to start.",retryable:!0}});case 9:return n.a(2)}},n,null,[[3,8]])}));return function(t,e){return n.apply(this,arguments)}}()),kh.subscribe("stop-mic",function(n,r){if(r.instanceId===e){var i=qm.get(e);i&&i.mediaRecorder&&"recording"===i.mediaRecorder.state&&(i.mediaRecorder.stop(),t.dispatch({type:"starmus/mic-stop"}))}}),kh.subscribe("pause-mic",function(n,r){if(r.instanceId===e){var i=qm.get(e);i&&i.mediaRecorder&&"recording"===i.mediaRecorder.state&&"function"==typeof i.mediaRecorder.pause&&(t.dispatch({type:"starmus/mic-pause"}),i.mediaRecorder.pause())}}),kh.subscribe("resume-mic",function(n,r){if(r.instanceId===e){var i=qm.get(e);i&&i.mediaRecorder&&"paused"===i.mediaRecorder.state&&"function"==typeof i.mediaRecorder.resume&&(t.dispatch({type:"starmus/mic-resume"}),i.mediaRecorder.resume())}}),kh.subscribe("reset",function(t,n){if(n.instanceId===e){var r=qm.get(e);if(r){try{r.mediaRecorder&&"inactive"!==r.mediaRecorder.state&&r.mediaRecorder.stop()}catch(t){}r.rafId&&cancelAnimationFrame(r.rafId),r.rawStream&&r.rawStream.getTracks().forEach(function(t){return t.stop()}),r.graph&&r.graph.destinationStream&&r.graph.destinationStream.getTracks().forEach(function(t){return t.stop()}),r.graph&&r.graph.nodes&&r.graph.nodes.forEach(function(t){try{t.disconnect()}catch(t){}}),qm.delete(e)}}})}var ov=window.StarmusHooks||window.CommandBus,av=ov&&ov.debugLog?ov.debugLog:function(){},sv=function(){return Ih(function t(e,n,r){Ph(this,t),this.peaks=e,this.container=document.getElementById(n),this.data=Array.isArray(r)?r:[],this.activeTokenIndex=-1,this.isUserScrolling=!1,this.scrollTimeout=null,this.boundOnTimeUpdate=null,this.boundOnSeeked=null,this.boundOnClick=null,this.boundOnScroll=null,this.init()},[{key:"init",value:function(){this.container?(this.render(),this.bindEvents()):console.warn("[StarmusTranscript] Container not found. Transcript sync disabled.")}},{key:"render",value:function(){var t=this,e=document.createDocumentFragment();this.data.forEach(function(n,r){var i=document.createElement("span");i.textContent=n.text,i.className="starmus-word",i.dataset.index=r,i.dataset.start=n.start,i.dataset.end=n.end,"confidence"in n&&n.confidence<.8&&(i.dataset.confidence="low",i.title="Low confidence: ".concat(Math.round(100*n.confidence),"%")),e.appendChild(i),r<t.data.length-1&&e.appendChild(document.createTextNode(" "))}),this.container.innerHTML="",this.container.appendChild(e),this.activeTokenIndex=-1}},{key:"bindEvents",value:function(){var t=this;this.boundOnClick=function(e){var n=e.target;if(n.classList.contains("starmus-word")){var r=parseFloat(n.dataset.start);t.peaks&&t.peaks.player&&"function"==typeof t.peaks.player.seek&&(t.peaks.player.seek(r),ov&&"function"==typeof ov.dispatch&&ov.dispatch("starmus/transcript/seek",{time:r},{instanceId:t.peaks.instanceId}))}},this.container.addEventListener("click",this.boundOnClick),this.boundOnScroll=function(){t.isUserScrolling=!0,t.scrollTimeout&&clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout(function(){t.isUserScrolling=!1},1e3)},this.container.addEventListener("scroll",this.boundOnScroll);var e=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;e&&"function"==typeof e.addEventListener?(this.boundOnTimeUpdate=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked=function(){var n=e.currentTime;"number"!=typeof n||isNaN(n)||t.syncHighlight(n)},e.addEventListener("seeked",this.boundOnSeeked)):av("[StarmusTranscript] Player media element not found  sync disabled")}},{key:"findTokenIndex",value:function(t){if("number"!=typeof t||0===this.data.length)return-1;for(var e=0,n=this.data.length-1;e<=n;){var r=e+n>>1,i=this.data[r];if(t>=i.start&&t<=i.end)return r;t<i.start?n=r-1:e=r+1}return-1}},{key:"syncHighlight",value:function(t){var e=this.findTokenIndex(t);-1===e?this.clearHighlight():e!==this.activeTokenIndex&&this.updateDOM(e)}},{key:"updateDOM",value:function(t){var e=this.container.querySelectorAll(".starmus-word");this.activeTokenIndex>=0&&e[this.activeTokenIndex]&&e[this.activeTokenIndex].classList.remove("is-active"),this.activeTokenIndex=t;var n=e[t];n&&(n.classList.add("is-active"),this.isUserScrolling||this.scrollToWord(n))}},{key:"clearHighlight",value:function(){var t=this.container.querySelector(".starmus-word.is-active");t&&t.classList.remove("is-active"),this.activeTokenIndex=-1}},{key:"scrollToWord",value:function(t){t.scrollIntoView&&t.scrollIntoView({block:"center",behavior:"smooth"})}},{key:"updateData",value:function(t){this.data=Array.isArray(t)?t:[],this.render(),this.unbindEvents(),this.bindEvents()}},{key:"unbindEvents",value:function(){if(this.container){this.boundOnClick&&this.container.removeEventListener("click",this.boundOnClick),this.boundOnScroll&&this.container.removeEventListener("scroll",this.boundOnScroll);var t=this.peaks&&this.peaks.player&&this.peaks.player.getMediaElement?this.peaks.player.getMediaElement():null;t&&"function"==typeof t.removeEventListener&&(this.boundOnTimeUpdate&&t.removeEventListener("timeupdate",this.boundOnTimeUpdate),this.boundOnSeeked&&t.removeEventListener("seeked",this.boundOnSeeked))}}},{key:"destroy",value:function(){this.unbindEvents(),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.container&&(this.container.innerHTML=""),this.data=[],this.activeTokenIndex=-1,this.isUserScrolling=!1}}])}();function lv(t,e,n){return new sv(t,e,n)}"undefined"!=typeof window&&(window.StarmusTranscript=sv,window.StarmusTranscriptController={StarmusTranscript:sv,init:lv}),"undefined"!=typeof module&&module.exports&&(module.exports={StarmusTranscript:sv,init:lv});var uv,hv={};!function(){if(uv)return hv;uv=1;var t=$a(),e=gh().filter;t({target:"Array",proto:!0,forced:!bl()("filter")},{filter:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}})}();var cv,dv={};!function(){if(cv)return dv;cv=1;var t=$a(),e=gh().find,n=js(),r="find",i=!0;r in[]&&Array(1)[r](function(){i=!1}),t({target:"Array",proto:!0,forced:i},{find:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}}),n(r)}();var fv,pv={};function gv(t,e){Object.keys(t).forEach(function(n){var r=t[n],i=e.querySelector('input[name="'.concat(n,'"]'));if(i||((i=document.createElement("input")).type="hidden",i.name=n,e.appendChild(i)),null==r)i.value="";else if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)i.value=String(r);else try{i.value=JSON.stringify(r)}catch(t){console.warn("[StarmusMetadataAuto] Could not serialize field",n,r),i.value=""}})}function mv(t,e){t&&Array.isArray(e)&&1===t.nodeType?e.forEach(function(e){try{var n=t.querySelector('input[name="'.concat(e,'"]'));n&&n.parentNode&&(t.contains(n)?(n.parentNode.removeChild(n),console.debug("[StarmusMetadataAuto] Removed field:",e)):console.debug("[StarmusMetadataAuto] Field not a child of form:",e))}catch(t){console.warn("[StarmusMetadataAuto] Could not remove field",e,t.message)}}):console.warn("[StarmusMetadataAuto] Invalid form element or field names for clearHiddenFields")}function vv(t){var e,n,r,i,o,a,s,l,u,h,c,d,f,p,g,m,v,y,_,b,w,S,k,x,C=new Date,T=C.toISOString().split("T")[0],A=C.toISOString();return{starmus_title:(null===(e=t.source)||void 0===e?void 0:e.title)||"",starmus_language:(null===(n=t.source)||void 0===n?void 0:n.language)||"",starmus_recording_type:(null===(r=t.source)||void 0===r?void 0:r.type)||"",audio_file_type:(null===(i=t.submission)||void 0===i||null===(i=i.blob)||void 0===i?void 0:i.type)||"audio/webm",agreement_to_terms:null!==(o=t.user)&&void 0!==o&&o.agreedToTerms?"1":"0",_starmus_calibration:t.calibration||{},_starmus_env:t.env||{},first_pass_transcription:(null===(a=t.source)||void 0===a?void 0:a.transcript)||"",recording_metadata:(null===(s=t.source)||void 0===s?void 0:s.metadata)||{},waveform_json:(null===(l=t.source)||void 0===l?void 0:l.waveform)||{},project_collection_id:(null===(u=t.submission)||void 0===u?void 0:u.collectionId)||"",accession_number:(null===(h=t.submission)||void 0===h?void 0:h.accession)||"",session_date:T,session_start_time:(null===(c=t.recorder)||void 0===c?void 0:c.startTime)||A,session_end_time:(null===(d=t.recorder)||void 0===d?void 0:d.endTime)||A,location:(null===(f=t.source)||void 0===f?void 0:f.location)||"",gps_coordinates:(null===(p=t.source)||void 0===p?void 0:p.gps)||"",contributor_id:(null===(g=t.user)||void 0===g?void 0:g.id)||"",interviewers_recorders:(null===(m=t.source)||void 0===m?void 0:m.interviewers)||"",recording_equipment:(null===(v=t.source)||void 0===v?void 0:v.equipment)||"",audio_files_originals:(null===(y=t.source)||void 0===y?void 0:y.originals)||[],media_condition_notes:(null===(_=t.source)||void 0===_?void 0:_.conditionNotes)||"",related_consent_agreement:(null===(b=t.source)||void 0===b?void 0:b.consent)||"",usage_restrictions_rights:(null===(w=t.source)||void 0===w?void 0:w.usageRights)||"",access_level:(null===(S=t.submission)||void 0===S?void 0:S.accessLevel)||"",audio_quality_score:(null===(k=t.submission)||void 0===k?void 0:k.qualityScore)||"",mic_rest_adjustments:(null===(x=t.calibration)||void 0===x?void 0:x.adjustments)||"",device:navigator.userAgent,user_agent:navigator.userAgent}}function yv(t,e){var n=[];return e.forEach(function(e){var r=t[e];(null==r||"string"==typeof r&&""===r.trim()||Array.isArray(r)&&0===r.length)&&n.push(e)}),{valid:0===n.length,missing:n}}function _v(t,e,n){if(t&&"function"==typeof t.getState&&"function"==typeof t.subscribe){if(e instanceof HTMLFormElement){var r=n||{},i=Array.isArray(r.trigger)?r.trigger:[r.trigger||"ready_to_submit"],o=Array.isArray(r.clearOn)?r.clearOn:[r.clearOn||"reset"],a=Array.isArray(r.requiredFields)?r.requiredFields:[],s=null,l=t.subscribe(u);return u(),l}console.warn("[StarmusMetadataAuto] Invalid form element  must be HTMLFormElement")}else console.warn("[StarmusMetadataAuto] Invalid store  cannot init auto metadata");function u(){var n=t.getState(),r=n.status;if(o.includes(r)&&mv(e,Object.keys(vv(n))),r!==s&&i.includes(r)){s=r;var l=vv(n),u=a.length?yv(l,a):{valid:!0,missing:[]},h=u.valid,c=u.missing;h||console.warn("[StarmusMetadataAuto] Missing required metadata fields:",c),gv(l,e)}else s=r}}!function(){if(fv)return pv;fv=1;var t=$a(),e=xi(),n=Gi(),r=_o(),i=Ia(),o=Fl(),a=Ju(),s=Ir(),l=Wm(),u=es(),h=Gm(),c=jm(),d=Ri(),f=Hm(),p=[],g=e(p.sort),m=e(p.push),v=s(function(){p.sort(void 0)}),y=s(function(){p.sort(null)}),_=u("sort"),b=!s(function(){if(d)return d<70;if(!(h&&h>3)){if(c)return!0;if(f)return f<603;var t,e,n,r,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)p.push({k:e+r,v:n})}for(p.sort(function(t,e){return e.v-t.v}),r=0;r<p.length;r++)e=p[r].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return"DGBEFHACIJK"!==i}});t({target:"Array",proto:!0,forced:v||!y||!_||!b},{sort:function(t){void 0!==t&&n(t);var e=r(this);if(b)return void 0===t?g(e):g(e,t);var s,u,h=[],c=i(e);for(u=0;u<c;u++)u in e&&m(h,e[u]);for(l(h,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:a(e)>a(n)?1:-1}}(t)),s=i(h),u=0;u<s;)e[u]=h[u++];for(;u<c;)o(e,u++);return e}})}(),function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e():t.StarmusAudioEditor=e()}("undefined"!=typeof window?window:globalThis,function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error",n=document.getElementById("starmus-editor-notice");n&&(t?(n.textContent=t,n.className="starmus-alert starmus-alert--".concat(e),n.hidden=!1):n.hidden=!0)}function e(t){var e=Math.floor(t/60),n=Math.floor(t%60);return e+":"+String(n).padStart(2,"0")}return{init:function(){var n=window.STARMUS_EDITOR_DATA;if(n){var r=n.restUrl,i=n.nonce,o=n.postId,a=n.audioUrl,s=n.annotations,l=void 0===s?[]:s,u=document.getElementById("overview"),h=document.getElementById("zoomview"),c=document.getElementById("play"),d=document.getElementById("back5"),f=document.getElementById("fwd5"),p=document.getElementById("zoom-in"),g=document.getElementById("zoom-out"),m=document.getElementById("zoom-fit"),v=document.getElementById("loop"),y=document.getElementById("add-region"),_=document.getElementById("save"),b=document.getElementById("regions-list");document.getElementById("starmus-editor-notice");var w=document.getElementById("starmus-time-cur"),S=document.getElementById("starmus-time-dur");if(a&&u&&h&&c&&y&&_&&b){var k=!1,x=function(t){k=!!t,_.disabled=!k};x(!1),window.addEventListener("beforeunload",function(t){k&&(t.preventDefault(),t.returnValue="")});var C=new Audio(a);C.crossOrigin="anonymous",C.addEventListener("error",function(){return t("Audio load error  check CORS or URL.","error")}),C.addEventListener("loadedmetadata",function(){var n=C.duration;if(!isFinite(n)||n<=0)t("Invalid audio file  cannot initialize.","error");else{var a=function(t){var e=(t||[]).filter(function(t){return isFinite(t.startTime)&&isFinite(t.endTime)&&t.startTime>=0&&t.endTime>t.startTime&&t.endTime<=n});e.sort(function(t,e){return t.startTime-e.startTime});var r,i=[],o=-1,a=Mh(e);try{for(a.s();!(r=a.n()).done;){var l=r.value;l.startTime>=o&&(i.push({id:l.id||s(),startTime:l.startTime,endTime:l.endTime,label:(l.label||"").trim().slice(0,200)}),o=l.endTime)}}catch(t){a.e(t)}finally{a.f()}return i},s=function(){var t,e;return(null===(t=window.crypto)||void 0===t||null===(e=t.randomUUID)||void 0===e?void 0:e.call(t))||"id-"+Math.random().toString(36).slice(2)+Date.now()},T=a(l);"undefined"!=typeof Peaks?Peaks.init({containers:{overview:u,zoomview:h},mediaElement:C,webAudio:{audioContext:new(window.AudioContext||window.webkitAudioContext),multiChannel:!1},height:180,zoomLevels:[64,128,256,512,1024,2048],segments:T,keyboard:!1,showPlayheadTime:!0},function(l,u){if(l)return console.error("Peaks init error:",l),void t("Could not load editor (see console).","error");S.textContent=e(n),C.addEventListener("timeupdate",function(){w.textContent=e(C.currentTime)}),c.addEventListener("click",function(){return C.paused?C.play():C.pause()}),C.addEventListener("play",function(){c.textContent="Pause",c.setAttribute("aria-pressed","true")}),C.addEventListener("pause",function(){c.textContent="Play",c.setAttribute("aria-pressed","false")}),d.onclick=function(){return C.currentTime=Math.max(0,C.currentTime-5)},f.onclick=function(){return C.currentTime=Math.min(n,C.currentTime+5)},p.onclick=function(){return u.zoom.zoomIn()},g.onclick=function(){return u.zoom.zoomOut()},m.onclick=function(){return u.zoom.zoom(0)};var h=!1;v.onchange=function(){return h=v.checked},C.addEventListener("timeupdate",function(){if(h){var t=C.currentTime,e=u.segments.getSegments();if(e.length){var n=e.find(function(e){return t>=e.startTime&&t<e.endTime});n&&t>=n.endTime&&(C.currentTime=n.startTime)}}});var T=function(){var t=a(u.segments.getSegments());if(b.innerHTML="",!t.length)return b.innerHTML='<tr><td colspan="5">No annotations. Click Add Region.</td></tr>',void x(!1);t.forEach(function(t){var e=document.createElement("tr");e.innerHTML='<td><input data-id="'.concat(t.id,'" data-key="label" value="').concat((""+t.label).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),'"/></td>')+'<td><input data-id="'.concat(t.id,'" data-key="startTime" value="').concat(t.startTime.toFixed(2),'" step="0.01"/></td>')+'<td><input data-id="'.concat(t.id,'" data-key="endTime" value="').concat(t.endTime.toFixed(2),'" step="0.01"/></td>')+"<td>".concat((t.endTime-t.startTime).toFixed(2),"s</td>")+'<td><button data-act="jump" data-id="'.concat(t.id,'">Jump</button> <button data-act="del" data-id="').concat(t.id,'">Delete</button></td>'),b.appendChild(e)}),x(!0)};b.addEventListener("input",function(t){var e=t.target.dataset.id,n=t.target.dataset.key;if(e&&n){var r=u.segments.getSegment(e);if(r){var i=t.target.value;("startTime"!==n&&"endTime"!==n||(i=parseFloat(i),!isNaN(i)))&&(r.update(Dh({},n,i)),x(!0),T())}}}),b.addEventListener("click",function(t){var e=t.target.dataset.act,n=t.target.dataset.id;if(e&&n){var r=u.segments.getSegment(n);r&&("jump"===e?(C.currentTime=r.startTime,C.play()):"del"===e&&(u.segments.removeById(n),x(!0),T()))}}),y.onclick=function(){var t=C.currentTime||0,e=Math.max(0,t-2),r=Math.min(n,t+2);u.segments.add({id:s(),startTime:e,endTime:r,label:""}),T()},_.onclick=Eh(Rh().m(function e(){var n,s,l;return Rh().w(function(e){for(;;)switch(e.p=e.n){case 0:if(k){e.n=1;break}return e.a(2);case 1:return x(!1),n=a(u.segments.getSegments()),e.p=2,e.n=3,fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":i},body:JSON.stringify({postId:o,annotations:n})});case 3:return s=e.v,e.n=4,s.json();case 4:if(l=e.v,s.ok&&l.success){e.n=5;break}throw new Error(l.message);case 5:u.segments.removeAll(),u.segments.add(a(l.annotations||[])),T(),t("Annotations saved.","success"),e.n=7;break;case 6:e.p=6,t("Save failed: "+e.v.message,"error");case 7:return e.a(2)}},e,null,[[2,6]])})),T()}):t("Peaks.js not loaded  cannot initialize editor.","error")}})}else t("Missing required editor elements.","error")}else console.error("STARMUS_EDITOR_DATA not defined  cannot initialize.")}}}),"undefined"!=typeof window&&(window.StarmusMetadataAuto={initAutoMetadata:_v,populateHiddenFields:gv,buildMetadataMap:vv,validateMetadata:yv,clearHiddenFields:mv});var bv,wv,Sv,kv,xv,Cv,Tv,Av,Ev,Pv,Iv={};function Mv(){if(wv)return bv;wv=1;var t=Ir(),e=So(),n=Mr(),r=go(),i=e("iterator");return bv=!t(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,o=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",e.forEach(function(t,n){e.delete("b"),a+=n+t}),o.delete("a",2),o.delete("b",void 0),r&&(!t.toJSON||!o.has("a",1)||o.has("a",2)||!o.has("a",void 0)||o.has("b"))||!e.size&&(r||!n)||!e.sort||"https://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[i]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==a||"x"!==new URL("https://x",void 0).host}),bv}function Dv(){if(Cv)return xv;Cv=1;var t=Fo(),e=Ru();return xv=function(n,r,i,o){try{return o?r(t(i)[0],i[1]):r(i)}catch(t){e(n,"throw",t)}}}function Ov(){if(Av)return Tv;Av=1;var t=Mu(),e=Or(),n=_o(),r=Dv(),i=Du(),o=yl(),a=Ia(),s=_l(),l=Lu(),u=Ou(),h=Array;return Tv=function(c){var d=n(c),f=o(this),p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g;m&&(g=t(g,p>2?arguments[2]:void 0));var v,y,_,b,w,S,k=u(d),x=0;if(!k||this===h&&i(k))for(v=a(d),y=f?new this(v):h(v);v>x;x++)S=m?g(d[x],x):d[x],s(y,x,S);else for(y=f?new this:[],w=(b=l(d,k)).next;!(_=e(w,b)).done;x++)S=m?r(b,g,[_.value,x],!0):_.value,s(y,x,S);return y.length=x,y},Tv}function Lv(){if(Pv)return Ev;Pv=1;var t=xi(),e=2147483647,n=/[^\0-\u007E]/,r=/[.\u3002\uFF0E\uFF61]/g,i="Overflow: input needs wider integers to process",o=RangeError,a=t(r.exec),s=Math.floor,l=String.fromCharCode,u=t("".charCodeAt),h=t([].join),c=t([].push),d=t("".replace),f=t("".split),p=t("".toLowerCase),g=function(t){return t+22+75*(t<26)},m=function(t,e,n){var r=0;for(t=n?s(t/700):t>>1,t+=s(t/e);t>455;)t=s(t/35),r+=36;return s(r+36*t/(t+38))},v=function(t){var n=[];t=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=u(t,n++);if(i>=55296&&i<=56319&&n<r){var o=u(t,n++);56320==(64512&o)?c(e,((1023&i)<<10)+(1023&o)+65536):(c(e,i),n--)}else c(e,i)}return e}(t);var r,a,d=t.length,f=128,p=0,v=72;for(r=0;r<t.length;r++)(a=t[r])<128&&c(n,l(a));var y=n.length,_=y;for(y&&c(n,"-");_<d;){var b=e;for(r=0;r<t.length;r++)(a=t[r])>=f&&a<b&&(b=a);var w=_+1;if(b-f>s((e-p)/w))throw new o(i);for(p+=(b-f)*w,f=b,r=0;r<t.length;r++){if((a=t[r])<f&&++p>e)throw new o(i);if(a===f){for(var S=p,k=36;;){var x=k<=v?1:k>=v+26?26:k-v;if(S<x)break;var C=S-x,T=36-x;c(n,l(g(x+C%T))),S=s(C/T),k+=36}c(n,l(g(S))),v=m(p,w,_===y),p=0,_++}}p++,f++}return h(n,"")};return Ev=function(t){var e,i,o=[],s=f(d(p(t),r,"."),".");for(e=0;e<s.length;e++)i=s[e],c(o,a(n,i)?"xn--"+v(i):i);return h(o,".")}}var Rv,Bv,Fv,Uv,Wv,Gv={};function jv(){if(Fv)return Bv;Fv=1,Qs(),function(){if(Rv)return Gv;Rv=1;var t=$a(),e=xi(),n=Ea(),r=RangeError,i=String.fromCharCode,o=String.fromCodePoint,a=e([].join);t({target:"String",stat:!0,arity:1,forced:!!o&&1!==o.length},{fromCodePoint:function(t){for(var e,o=[],s=arguments.length,l=0;s>l;){if(e=+arguments[l++],n(e,1114111)!==e)throw new r(e+" is not a valid code point");o[l]=e<65536?i(e):i(55296+((e-=65536)>>10),e%1024+56320)}return a(o,"")}})}();var t=$a(),e=br(),n=qc(),r=Di(),i=Or(),o=xi(),a=Mr(),s=Mv(),l=la(),u=ju(),h=Hu(),c=Xs(),d=Vs(),f=aa(),p=Fu(),g=Ii(),m=bo(),v=Mu(),y=vl(),_=Fo(),b=Mi(),w=Ju(),S=Gs(),k=ki(),x=Lu(),C=Ou(),T=Js(),A=Vc(),E=So(),P=Wm(),I=E("iterator"),M="URLSearchParams",D=M+"Iterator",O=f.set,L=f.getterFor(M),R=f.getterFor(D),B=n("fetch"),F=n("Request"),U=n("Headers"),W=F&&F.prototype,G=U&&U.prototype,j=e.TypeError,H=e.encodeURIComponent,N=String.fromCharCode,z=r("String","fromCodePoint"),X=parseInt,V=o("".charAt),Y=o([].join),Z=o([].push),q=o("".replace),K=o([].shift),J=o([].splice),Q=o("".split),$=o("".slice),tt=o(/./.exec),et=/\+/g,nt=/^[0-9a-f]+$/i,rt=function(t,e){var n=$(t,e,e+2);return tt(nt,n)?X(n,16):NaN},it=function(t){for(var e=0,n=128;n>0&&0!==(t&n);n>>=1)e++;return e},ot=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},at=function(t){for(var e=(t=q(t,et," ")).length,n="",r=0;r<e;){var i=V(t,r);if("%"===i){if("%"===V(t,r+1)||r+3>e){n+="%",r++;continue}var o=rt(t,r+1);if(o!=o){n+=i,r++;continue}r+=2;var a=it(o);if(0===a)i=N(o);else{if(1===a||a>4){n+="",r++;continue}for(var s=[o],l=1;l<a&&!(++r+3>e||"%"!==V(t,r));){var u=rt(t,r+1);if(u!=u){r+=3;break}if(u>191||u<128)break;Z(s,u),r+=2,l++}if(s.length!==a){n+="";continue}var h=ot(s);null===h?n+="":i=z(h)}}n+=i,r++}return n},st=/[!'()~]|%20/g,lt={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ut=function(t){return lt[t]},ht=function(t){return q(H(t),st,ut)},ct=d(function(t,e){O(this,{type:D,target:L(t).entries,index:0,kind:e})},M,function(){var t=R(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,T(void 0,!0);var r=e[n];switch(t.kind){case"keys":return T(r.key,!1);case"values":return T(r.value,!1)}return T([r.key,r.value],!1)},!0),dt=function(t){this.entries=[],this.url=null,void 0!==t&&(b(t)?this.parseObject(t):this.parseQuery("string"==typeof t?"?"===V(t,0)?$(t,1):t:w(t)))};dt.prototype={type:M,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,r,o,a,s,l,u=this.entries,h=C(t);if(h)for(n=(e=x(t,h)).next;!(r=i(n,e)).done;){if(a=(o=x(_(r.value))).next,(s=i(a,o)).done||(l=i(a,o)).done||!i(a,o).done)throw new j("Expected sequence with length 2");Z(u,{key:w(s.value),value:w(l.value)})}else for(var c in t)m(t,c)&&Z(u,{key:c,value:w(t[c])})},parseQuery:function(t){if(t)for(var e,n,r=this.entries,i=Q(t,"&"),o=0;o<i.length;)(e=i[o++]).length&&(n=Q(e,"="),Z(r,{key:at(K(n)),value:at(Y(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],r=0;r<e.length;)t=e[r++],Z(n,ht(t.key)+"="+ht(t.value));return Y(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ft=function(){p(this,pt);var t=O(this,new dt(arguments.length>0?arguments[0]:void 0));a||(this.size=t.entries.length)},pt=ft.prototype;if(h(pt,{append:function(t,e){var n=L(this);A(arguments.length,2),Z(n.entries,{key:w(t),value:w(e)}),a||this.size++,n.updateURL()},delete:function(t){for(var e=L(this),n=A(arguments.length,1),r=e.entries,i=w(t),o=n<2?void 0:arguments[1],s=void 0===o?o:w(o),l=0;l<r.length;){var u=r[l];if(u.key!==i||void 0!==s&&u.value!==s)l++;else if(J(r,l,1),void 0!==s)break}a||(this.size=r.length),e.updateURL()},get:function(t){var e=L(this).entries;A(arguments.length,1);for(var n=w(t),r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){var e=L(this).entries;A(arguments.length,1);for(var n=w(t),r=[],i=0;i<e.length;i++)e[i].key===n&&Z(r,e[i].value);return r},has:function(t){for(var e=L(this).entries,n=A(arguments.length,1),r=w(t),i=n<2?void 0:arguments[1],o=void 0===i?i:w(i),a=0;a<e.length;){var s=e[a++];if(s.key===r&&(void 0===o||s.value===o))return!0}return!1},set:function(t,e){var n=L(this);A(arguments.length,1);for(var r,i=n.entries,o=!1,s=w(t),l=w(e),u=0;u<i.length;u++)(r=i[u]).key===s&&(o?J(i,u--,1):(o=!0,r.value=l));o||Z(i,{key:s,value:l}),a||(this.size=i.length),n.updateURL()},sort:function(){var t=L(this);P(t.entries,function(t,e){return t.key>e.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=L(this).entries,r=v(t,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((e=n[i++]).value,e.key,this)},keys:function(){return new ct(this,"keys")},values:function(){return new ct(this,"values")},entries:function(){return new ct(this,"entries")}},{enumerable:!0}),l(pt,I,pt.entries,{name:"entries"}),l(pt,"toString",function(){return L(this).serialize()},{enumerable:!0}),a&&u(pt,"size",{get:function(){return L(this).entries.length},configurable:!0,enumerable:!0}),c(ft,M),t({global:!0,constructor:!0,forced:!s},{URLSearchParams:ft}),!s&&g(U)){var gt=o(G.has),mt=o(G.set),vt=function(t){if(b(t)){var e,n=t.body;if(y(n)===M)return e=t.headers?new U(t.headers):new U,gt(e,"content-type")||mt(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),S(t,{body:k(0,w(n)),headers:k(0,e)})}return t};if(g(B)&&t({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return B(t,arguments.length>1?vt(arguments[1]):{})}}),g(F)){var yt=function(t){return p(this,W),new F(t,arguments.length>1?vt(arguments[1]):{})};W.constructor=yt,yt.prototype=W,t({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:yt})}}return Bv={URLSearchParams:ft,getState:L}}function Hv(){if(Uv)return Iv;Uv=1,$u();var t,e=$a(),n=Mr(),r=Mv(),i=br(),o=Mu(),a=xi(),s=la(),l=ju(),u=Fu(),h=bo(),c=function(){if(kv)return Sv;kv=1;var t=Mr(),e=xi(),n=Or(),r=Ir(),i=Us(),o=Ka(),a=Si(),s=_o(),l=Ti(),u=Object.assign,h=Object.defineProperty,c=e([].concat);return Sv=!u||r(function(){if(t&&1!==u({b:1},u(h({},"a",{enumerable:!0,get:function(){h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},n={},r=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach(function(t){n[t]=t}),7!==u({},e)[r]||i(u({},n)).join("")!==o})?function(e,r){for(var u=s(e),h=arguments.length,d=1,f=o.f,p=a.f;h>d;)for(var g,m=l(arguments[d++]),v=f?c(i(m),f(m)):i(m),y=v.length,_=0;y>_;)g=v[_++],t&&!n(p,m,g)||(u[g]=m[g]);return u}:u,Sv}(),d=Ov(),f=wl(),p=Qu().codeAt,g=Lv(),m=Ju(),v=Xs(),y=Vc(),_=jv(),b=aa(),w=b.set,S=b.getterFor("URL"),k=_.URLSearchParams,x=_.getState,C=i.URL,T=i.TypeError,A=i.parseInt,E=Math.floor,P=Math.pow,I=a("".charAt),M=a(/./.exec),D=a([].join),O=a(1.1.toString),L=a([].pop),R=a([].push),B=a("".replace),F=a([].shift),U=a("".split),W=a("".slice),G=a("".toLowerCase),j=a([].unshift),H="Invalid scheme",N="Invalid host",z="Invalid port",X=/[a-z]/i,V=/[\d+-.a-z]/i,Y=/\d/,Z=/^0x/i,q=/^[0-7]+$/,K=/^\d+$/,J=/^[\da-f]+$/i,Q=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$=/[\0\t\n\r #/:<>?@[\\\]^|]/,tt=/^[\u0000-\u0020]+/,et=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,nt=/[\t\n\r]/g,rt=function(t){var e,n,r,i;if("number"==typeof t){for(e=[],n=0;n<4;n++)j(e,t%256),t=E(t/256);return D(e,".")}if("object"==typeof t){for(e="",r=function(t){for(var e=null,n=1,r=null,i=0,o=0;o<8;o++)0!==t[o]?(i>n&&(e=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n?r:e}(t),n=0;n<8;n++)i&&0===t[n]||(i&&(i=!1),r===n?(e+=n?":":"::",i=!0):(e+=O(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},it={},ot=c({},it,{" ":1,'"':1,"<":1,">":1,"`":1}),at=c({},ot,{"#":1,"?":1,"{":1,"}":1}),st=c({},at,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),lt=function(t,e){var n=p(t,0);return n>32&&n<127&&!h(e,t)?t:encodeURIComponent(t)},ut={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ht=function(t,e){var n;return 2===t.length&&M(X,I(t,0))&&(":"===(n=I(t,1))||!e&&"|"===n)},ct=function(t){var e;return t.length>1&&ht(W(t,0,2))&&(2===t.length||"/"===(e=I(t,2))||"\\"===e||"?"===e||"#"===e)},dt=function(t){return"."===t||"%2e"===G(t)},ft=function(t){return".."===(t=G(t))||"%2e."===t||".%2e"===t||"%2e%2e"===t},pt={},gt={},mt={},vt={},yt={},_t={},bt={},wt={},St={},kt={},xt={},Ct={},Tt={},At={},Et={},Pt={},It={},Mt={},Dt={},Ot={},Lt={},Rt=function(t,e,n){var r,i,o,a=m(t);if(e){if(i=this.parse(a))throw new T(i);this.searchParams=null}else{if(void 0!==n&&(r=new Rt(n,!0)),i=this.parse(a,null,r))throw new T(i);(o=x(new k)).bindURL(this),this.searchParams=o}};Rt.prototype={type:"URL",parse:function(e,n,r){var i,o,a,s,l=this,u=n||pt,c=0,p="",g=!1,v=!1,y=!1;for(e=m(e),n||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,e=B(e,tt,""),e=B(e,et,"$1")),e=B(e,nt,""),i=d(e);c<=i.length;){switch(o=i[c],u){case pt:if(!o||!M(X,o)){if(n)return H;u=mt;continue}p+=G(o),u=gt;break;case gt:if(o&&(M(V,o)||"+"===o||"-"===o||"."===o))p+=G(o);else{if(":"!==o){if(n)return H;p="",u=mt,c=0;continue}if(n&&(l.isSpecial()!==h(ut,p)||"file"===p&&(l.includesCredentials()||null!==l.port)||"file"===l.scheme&&!l.host))return;if(l.scheme=p,n)return void(l.isSpecial()&&ut[l.scheme]===l.port&&(l.port=null));p="","file"===l.scheme?u=At:l.isSpecial()&&r&&r.scheme===l.scheme?u=vt:l.isSpecial()?u=wt:"/"===i[c+1]?(u=yt,c++):(l.cannotBeABaseURL=!0,R(l.path,""),u=Dt)}break;case mt:if(!r||r.cannotBeABaseURL&&"#"!==o)return H;if(r.cannotBeABaseURL&&"#"===o){l.scheme=r.scheme,l.path=f(r.path),l.query=r.query,l.fragment="",l.cannotBeABaseURL=!0,u=Lt;break}u="file"===r.scheme?At:_t;continue;case vt:if("/"!==o||"/"!==i[c+1]){u=_t;continue}u=St,c++;break;case yt:if("/"===o){u=kt;break}u=Mt;continue;case _t:if(l.scheme=r.scheme,o===t)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=f(r.path),l.query=r.query;else if("/"===o||"\\"===o&&l.isSpecial())u=bt;else if("?"===o)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=f(r.path),l.query="",u=Ot;else{if("#"!==o){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=f(r.path),l.path.length--,u=Mt;continue}l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=f(r.path),l.query=r.query,l.fragment="",u=Lt}break;case bt:if(!l.isSpecial()||"/"!==o&&"\\"!==o){if("/"!==o){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,u=Mt;continue}u=kt}else u=St;break;case wt:if(u=St,"/"!==o||"/"!==I(p,c+1))continue;c++;break;case St:if("/"!==o&&"\\"!==o){u=kt;continue}break;case kt:if("@"===o){g&&(p="%40"+p),g=!0,a=d(p);for(var _=0;_<a.length;_++){var b=a[_];if(":"!==b||y){var w=lt(b,st);y?l.password+=w:l.username+=w}else y=!0}p=""}else if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()){if(g&&""===p)return"Invalid authority";c-=d(p).length+1,p="",u=xt}else p+=o;break;case xt:case Ct:if(n&&"file"===l.scheme){u=Pt;continue}if(":"!==o||v){if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()){if(l.isSpecial()&&""===p)return N;if(n&&""===p&&(l.includesCredentials()||null!==l.port))return;if(s=l.parseHost(p))return s;if(p="",u=It,n)return;continue}"["===o?v=!0:"]"===o&&(v=!1),p+=o}else{if(""===p)return N;if(s=l.parseHost(p))return s;if(p="",u=Tt,n===Ct)return}break;case Tt:if(!M(Y,o)){if(o===t||"/"===o||"?"===o||"#"===o||"\\"===o&&l.isSpecial()||n){if(""!==p){var S=A(p,10);if(S>65535)return z;l.port=l.isSpecial()&&S===ut[l.scheme]?null:S,p=""}if(n)return;u=It;continue}return z}p+=o;break;case At:if(l.scheme="file","/"===o||"\\"===o)u=Et;else{if(!r||"file"!==r.scheme){u=Mt;continue}switch(o){case t:l.host=r.host,l.path=f(r.path),l.query=r.query;break;case"?":l.host=r.host,l.path=f(r.path),l.query="",u=Ot;break;case"#":l.host=r.host,l.path=f(r.path),l.query=r.query,l.fragment="",u=Lt;break;default:ct(D(f(i,c),""))||(l.host=r.host,l.path=f(r.path),l.shortenPath()),u=Mt;continue}}break;case Et:if("/"===o||"\\"===o){u=Pt;break}r&&"file"===r.scheme&&!ct(D(f(i,c),""))&&(ht(r.path[0],!0)?R(l.path,r.path[0]):l.host=r.host),u=Mt;continue;case Pt:if(o===t||"/"===o||"\\"===o||"?"===o||"#"===o){if(!n&&ht(p))u=Mt;else if(""===p){if(l.host="",n)return;u=It}else{if(s=l.parseHost(p))return s;if("localhost"===l.host&&(l.host=""),n)return;p="",u=It}continue}p+=o;break;case It:if(l.isSpecial()){if(u=Mt,"/"!==o&&"\\"!==o)continue}else if(n||"?"!==o)if(n||"#"!==o){if(o!==t&&(u=Mt,"/"!==o))continue}else l.fragment="",u=Lt;else l.query="",u=Ot;break;case Mt:if(o===t||"/"===o||"\\"===o&&l.isSpecial()||!n&&("?"===o||"#"===o)){if(ft(p)?(l.shortenPath(),"/"===o||"\\"===o&&l.isSpecial()||R(l.path,"")):dt(p)?"/"===o||"\\"===o&&l.isSpecial()||R(l.path,""):("file"===l.scheme&&!l.path.length&&ht(p)&&(l.host&&(l.host=""),p=I(p,0)+":"),R(l.path,p)),p="","file"===l.scheme&&(o===t||"?"===o||"#"===o))for(;l.path.length>1&&""===l.path[0];)F(l.path);"?"===o?(l.query="",u=Ot):"#"===o&&(l.fragment="",u=Lt)}else p+=lt(o,at);break;case Dt:"?"===o?(l.query="",u=Ot):"#"===o?(l.fragment="",u=Lt):o!==t&&(l.path[0]+=lt(o,it));break;case Ot:n||"#"!==o?o!==t&&("'"===o&&l.isSpecial()?l.query+="%27":l.query+="#"===o?"%23":lt(o,it)):(l.fragment="",u=Lt);break;case Lt:o!==t&&(l.fragment+=lt(o,ot))}c++}},parseHost:function(t){var e,n,r;if("["===I(t,0)){if("]"!==I(t,t.length-1))return N;if(e=function(t){var e,n,r,i,o,a,s,l=[0,0,0,0,0,0,0,0],u=0,h=null,c=0,d=function(){return I(t,c)};if(":"===d()){if(":"!==I(t,1))return;c+=2,h=++u}for(;d();){if(8===u)return;if(":"!==d()){for(e=n=0;n<4&&M(J,d());)e=16*e+A(d(),16),c++,n++;if("."===d()){if(0===n)return;if(c-=n,u>6)return;for(r=0;d();){if(i=null,r>0){if(!("."===d()&&r<4))return;c++}if(!M(Y,d()))return;for(;M(Y,d());){if(o=A(d(),10),null===i)i=o;else{if(0===i)return;i=10*i+o}if(i>255)return;c++}l[u]=256*l[u]+i,2!==++r&&4!==r||u++}if(4!==r)return;break}if(":"===d()){if(c++,!d())return}else if(d())return;l[u++]=e}else{if(null!==h)return;c++,h=++u}}if(null!==h)for(a=u-h,u=7;0!==u&&a>0;)s=l[u],l[u--]=l[h+a-1],l[h+--a]=s;else if(8!==u)return;return l}(W(t,1,-1)),!e)return N;this.host=e}else if(this.isSpecial()){if(t=g(t),M(Q,t))return N;if(e=function(t){var e,n,r,i,o,a,s,l=U(t,".");if(l.length&&""===l[l.length-1]&&l.length--,(e=l.length)>4)return t;for(n=[],r=0;r<e;r++){if(""===(i=l[r]))return t;if(o=10,i.length>1&&"0"===I(i,0)&&(o=M(Z,i)?16:8,i=W(i,8===o?1:2)),""===i)a=0;else{if(!M(10===o?K:8===o?q:J,i))return t;a=A(i,o)}R(n,a)}for(r=0;r<e;r++)if(a=n[r],r===e-1){if(a>=P(256,5-e))return null}else if(a>255)return null;for(s=L(n),r=0;r<n.length;r++)s+=n[r]*P(256,3-r);return s}(t),null===e)return N;this.host=e}else{if(M($,t))return N;for(e="",n=d(t),r=0;r<n.length;r++)e+=lt(n[r],it);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return h(ut,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||"file"===this.scheme&&1===e&&ht(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,r=t.password,i=t.host,o=t.port,a=t.path,s=t.query,l=t.fragment,u=e+":";return null!==i?(u+="//",t.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=rt(i),null!==o&&(u+=":"+o)):"file"===e&&(u+="//"),u+=t.cannotBeABaseURL?a[0]:a.length?"/"+D(a,"/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u},setHref:function(t){var e=this.parse(t);if(e)throw new T(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if("blob"===t)try{return new Bt(t.path[0]).origin}catch(t){return"null"}return"file"!==t&&this.isSpecial()?t+"://"+rt(this.host)+(null!==e?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(m(t)+":",pt)},getUsername:function(){return this.username},setUsername:function(t){var e=d(m(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=lt(e[n],st)}},getPassword:function(){return this.password},setPassword:function(t){var e=d(m(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=lt(e[n],st)}},getHost:function(){var t=this.host,e=this.port;return null===t?"":null===e?rt(t):rt(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,xt)},getHostname:function(){var t=this.host;return null===t?"":rt(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,Ct)},getPort:function(){var t=this.port;return null===t?"":m(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||(""===(t=m(t))?this.port=null:this.parse(t,Tt))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+D(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,It))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){""===(t=m(t))?this.query=null:("?"===I(t,0)&&(t=W(t,1)),this.query="",this.parse(t,Ot)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){""!==(t=m(t))?("#"===I(t,0)&&(t=W(t,1)),this.fragment="",this.parse(t,Lt)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Bt=function(t){var e=u(this,Ft),r=y(arguments.length,1)>1?arguments[1]:void 0,i=w(e,new Rt(t,!1,r));n||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Ft=Bt.prototype,Ut=function(t,e){return{get:function(){return S(this)[t]()},set:e&&function(t){return S(this)[e](t)},configurable:!0,enumerable:!0}};if(n&&(l(Ft,"href",Ut("serialize","setHref")),l(Ft,"origin",Ut("getOrigin")),l(Ft,"protocol",Ut("getProtocol","setProtocol")),l(Ft,"username",Ut("getUsername","setUsername")),l(Ft,"password",Ut("getPassword","setPassword")),l(Ft,"host",Ut("getHost","setHost")),l(Ft,"hostname",Ut("getHostname","setHostname")),l(Ft,"port",Ut("getPort","setPort")),l(Ft,"pathname",Ut("getPathname","setPathname")),l(Ft,"search",Ut("getSearch","setSearch")),l(Ft,"searchParams",Ut("getSearchParams")),l(Ft,"hash",Ut("getHash","setHash"))),s(Ft,"toJSON",function(){return S(this).serialize()},{enumerable:!0}),s(Ft,"toString",function(){return S(this).serialize()},{enumerable:!0}),C){var Wt=C.createObjectURL,Gt=C.revokeObjectURL;Wt&&s(Bt,"createObjectURL",o(Wt,C)),Gt&&s(Bt,"revokeObjectURL",o(Gt,C))}return v(Bt,"URL"),e({global:!0,constructor:!0,forced:!r,sham:!n},{URL:Bt}),Iv}Wv||(Wv=1,Hv());var Nv,zv={};!function(){if(Nv)return zv;Nv=1;var t=$a(),e=Or();t({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return e(URL.prototype.toString,this)}})}();var Xv;function Vv(t){return Vv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vv(t)}function Yv(t,e,n){return e=Jv(e),function(t,e){if(e&&("object"===Vv(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,qv()?Reflect.construct(e,n||[],Jv(t).constructor):e.apply(t,n))}function Zv(t){var e="function"==typeof Map?new Map:void 0;return Zv=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(qv())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return n&&Kv(i,n.prototype),i}(t,arguments,Jv(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Kv(n,t)},Zv(t)}function qv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qv=function(){return!!t})()}function Kv(t,e){return Kv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kv(t,e)}function Jv(t){return Jv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jv(t)}Xv||(Xv=1,jv());var Qv=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Yv(this,e,[t])).originalRequest=i,n.originalResponse=o,n.causingError=r,null!=r&&(t+=", caused by ".concat(r.toString())),null!=i){var a=i.getHeader("X-Request-ID")||"n/a",s=i.getMethod(),l=i.getURL(),u=o?o.getStatus():"n/a",h=o?o.getBody()||"":"n/a";t+=", originated from request (method: ".concat(s,", url: ").concat(l,", response code: ").concat(u,", response text: ").concat(h,", request id: ").concat(a,")")}return n.message=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kv(t,e)}(e,t),n=e,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(Zv(Error)),$v=!1;function ty(t){$v&&console.log(t)}function ey(t){return ey="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ey(t)}function ny(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ry(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ry(t){var e=function(t,e){if("object"!=ey(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=ey(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==ey(e)?e:e+""}var iy=function(){return ny(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(t){return Promise.resolve([])}},{key:"removeUpload",value:function(t){return Promise.resolve()}},{key:"addUpload",value:function(t,e){return Promise.resolve(null)}}])}();const oy="function"==typeof Buffer,ay=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),sy=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),ly=(t=>{let e={};return t.forEach((t,n)=>e[t]=n),e})(sy),uy=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,hy=String.fromCharCode.bind(String),cy=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/=/g,"").replace(/[+\/]/g,t=>"+"==t?"-":"_")),dy=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),fy=t=>{let e,n,r,i,o="";const a=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|i,o+=sy[e>>18&63]+sy[e>>12&63]+sy[e>>6&63]+sy[63&e]}return a?o.slice(0,a-3)+"===".substring(a):o},py="function"==typeof btoa?t=>btoa(t):oy?t=>Buffer.from(t,"binary").toString("base64"):fy,gy=oy?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,r=t.length;n<r;n+=4096)e.push(hy.apply(null,t.subarray(n,n+4096)));return py(e.join(""))},my=t=>{if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?hy(192|e>>>6)+hy(128|63&e):hy(224|e>>>12&15)+hy(128|e>>>6&63)+hy(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return hy(240|e>>>18&7)+hy(128|e>>>12&63)+hy(128|e>>>6&63)+hy(128|63&e)},vy=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,yy=t=>t.replace(vy,my),_y=oy?t=>Buffer.from(t,"utf8").toString("base64"):ay?t=>gy(ay.encode(t)):t=>py(yy(t)),by=(t,e=!1)=>e?cy(_y(t)):_y(t),wy=t=>{if(t=t.replace(/\s+/g,""),!uy.test(t))throw new TypeError("malformed base64.");let e,n,r;t+="==".slice(2-(3&t.length));let i=[];for(let o=0;o<t.length;)e=ly[t.charAt(o++)]<<18|ly[t.charAt(o++)]<<12|(n=ly[t.charAt(o++)])<<6|(r=ly[t.charAt(o++)]),64===n?i.push(hy(e>>16&255)):64===r?i.push(hy(e>>16&255,e>>8&255)):i.push(hy(e>>16&255,e>>8&255,255&e));return i.join("")},Sy=by;var ky,xy;var Cy,Ty,Ay,Ey={};var Py=function(){if(Ay)return Ty;Ay=1;var t=xy?ky:(xy=1,ky=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}),e=function(){if(Cy)return Ey;Cy=1;var t=Object.prototype.hasOwnProperty;function e(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function n(t){try{return encodeURIComponent(t)}catch(t){return null}}return Ey.stringify=function(e,r){r=r||"";var i,o,a=[];for(o in"string"!=typeof r&&(r="?"),e)if(t.call(e,o)){if((i=e[o])||null!=i&&!isNaN(i)||(i=""),o=n(o),i=n(i),null===o||null===i)continue;a.push(o+"="+i)}return a.length?r+a.join("&"):""},Ey.parse=function(t){for(var n,r=/([^=?#&]+)=?([^&]*)/g,i={};n=r.exec(t);){var o=e(n[1]),a=e(n[2]);null===o||null===a||o in i||(i[o]=a)}return i},Ey}(),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r=/[\n\r\t]/g,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o=/:\d+$/,a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,s=/^[a-zA-Z]:/;function l(t){return(t||"").toString().replace(n,"")}var u=[["#","hash"],["?","query"],function(t,e){return d(e.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],h={hash:1,query:1};function c(t){var e,n=("undefined"!=typeof window?window:void 0!==gr?gr:"undefined"!=typeof self?self:{}).location||{},r={},o=typeof(t=t||n);if("blob:"===t.protocol)r=new p(unescape(t.pathname),{});else if("string"===o)for(e in r=new p(t,{}),h)delete r[e];else if("object"===o){for(e in t)e in h||(r[e]=t[e]);void 0===r.slashes&&(r.slashes=i.test(t.href))}return r}function d(t){return"file:"===t||"ftp:"===t||"http:"===t||"https:"===t||"ws:"===t||"wss:"===t}function f(t,e){t=(t=l(t)).replace(r,""),e=e||{};var n,i=a.exec(t),o=i[1]?i[1].toLowerCase():"",s=!!i[2],u=!!i[3],h=0;return s?u?(n=i[2]+i[3]+i[4],h=i[2].length+i[3].length):(n=i[2]+i[4],h=i[2].length):u?(n=i[3]+i[4],h=i[3].length):n=i[4],"file:"===o?h>=2&&(n=n.slice(2)):d(o)?n=i[4]:o?s&&(n=n.slice(2)):h>=2&&d(e.protocol)&&(n=i[4]),{protocol:o,slashes:s||d(o),slashesCount:h,rest:n}}function p(n,i,o){if(n=(n=l(n)).replace(r,""),!(this instanceof p))return new p(n,i,o);var a,h,g,m,v,y,_=u.slice(),b=typeof i,w=this,S=0;for("object"!==b&&"string"!==b&&(o=i,i=null),o&&"function"!=typeof o&&(o=e.parse),a=!(h=f(n||"",i=c(i))).protocol&&!h.slashes,w.slashes=h.slashes||a&&i.slashes,w.protocol=h.protocol||i.protocol||"",n=h.rest,("file:"===h.protocol&&(2!==h.slashesCount||s.test(n))||!h.slashes&&(h.protocol||h.slashesCount<2||!d(w.protocol)))&&(_[3]=[/(.*)/,"pathname"]);S<_.length;S++)"function"!=typeof(m=_[S])?(g=m[0],y=m[1],g!=g?w[y]=n:"string"==typeof g?~(v="@"===g?n.lastIndexOf(g):n.indexOf(g))&&("number"==typeof m[2]?(w[y]=n.slice(0,v),n=n.slice(v+m[2])):(w[y]=n.slice(v),n=n.slice(0,v))):(v=g.exec(n))&&(w[y]=v[1],n=n.slice(0,v.index)),w[y]=w[y]||a&&m[3]&&i[y]||"",m[4]&&(w[y]=w[y].toLowerCase())):n=m(n,w);o&&(w.query=o(w.query)),a&&i.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==i.pathname)&&(w.pathname=function(t,e){if(""===t)return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,i=n[r-1],o=!1,a=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),a++):a&&(0===r&&(o=!0),n.splice(r,1),a--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(w.pathname,i.pathname)),"/"!==w.pathname.charAt(0)&&d(w.protocol)&&(w.pathname="/"+w.pathname),t(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(v=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,v),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(v+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&d(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}return p.prototype={set:function(n,r,i){var a=this;switch(n){case"query":"string"==typeof r&&r.length&&(r=(i||e.parse)(r)),a[n]=r;break;case"port":a[n]=r,t(r,a.protocol)?r&&(a.host=a.hostname+":"+r):(a.host=a.hostname,a[n]="");break;case"hostname":a[n]=r,a.port&&(r+=":"+a.port),a.host=r;break;case"host":a[n]=r,o.test(r)?(r=r.split(":"),a.port=r.pop(),a.hostname=r.join(":")):(a.hostname=r,a.port="");break;case"protocol":a.protocol=r.toLowerCase(),a.slashes=!i;break;case"pathname":case"hash":if(r){var s="pathname"===n?"/":"#";a[n]=r.charAt(0)!==s?s+r:r}else a[n]=r;break;case"username":case"password":a[n]=encodeURIComponent(r);break;case"auth":var l=r.indexOf(":");~l?(a.username=r.slice(0,l),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=r.slice(l+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(r))}for(var h=0;h<u.length;h++){var c=u[h];c[4]&&(a[c[1]]=a[c[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&d(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(t){t&&"function"==typeof t||(t=e.stringify);var n,r=this,i=r.host,a=r.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var s=a+(r.protocol&&r.slashes||d(r.protocol)?"//":"");return r.username?(s+=r.username,r.password&&(s+=":"+r.password),s+="@"):r.password?(s+=":"+r.password,s+="@"):"file:"!==r.protocol&&d(r.protocol)&&!i&&"/"!==r.pathname&&(s+="@"),(":"===i[i.length-1]||o.test(r.hostname)&&!r.port)&&(i+=":"),s+=i+r.pathname,(n="object"==typeof r.query?t(r.query):r.query)&&(s+="?"!==n.charAt(0)?"?"+n:n),r.hash&&(s+=r.hash),s}},p.extractProtocol=f,p.location=c,p.trimLeft=l,p.qs=e,Ty=p}(),Iy=mr(Py);function My(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */My=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:T(t,n,s)}),a}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function _(){}var b={};u(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(M([])));S&&S!==n&&r.call(S,a)&&(b=S);var k=_.prototype=v.prototype=Object.create(b);function x(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function C(t,e){function n(i,o,a,s){var l=c(t[i],t,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==Ly(h)&&r.call(h,"__await")?e.resolve(h.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(h).then(function(t){u.value=t,a(u)},function(t){return n("throw",t,a,s)})}s(l.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e(function(e,i){n(t,r,e,i)})}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=d;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=A(s,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=c(e,n,r);if("normal"===u.type){if(i=r.done?g:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=c(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Ly(e)+" is not iterable")}return y.prototype=_,i(k,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=u(_,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,u(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},x(C.prototype),u(C.prototype,s,function(){return this}),e.AsyncIterator=C,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new C(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},x(k),u(k,l,"Generator"),u(k,a,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function Dy(t,e,n,r,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,i)}function Oy(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e);else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}(t,e)||Ry(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ly(t){return Ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ly(t)}function Ry(t,e){if(t){if("string"==typeof t)return By(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?By(t,e):void 0}}function By(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fy(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Uy(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fy(Object(n),!0).forEach(function(e){Wy(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fy(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Wy(t,e,n){return(e=jy(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jy(r.key),r)}}function jy(t){var e=function(t,e){if("object"!=Ly(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=Ly(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==Ly(e)?e:e+""}var Hy="tus-v1",Ny="ietf-draft-03",zy="ietf-draft-05",Xy={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:$y,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:Hy},Vy=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"resume"in n&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=n,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return e=t,n=[{key:"findPreviousUploads",value:function(){var t=this;return this.options.fingerprint(this.file,this.options).then(function(e){return t._urlStorage.findUploadsByFingerprint(e)})}},{key:"resumeFromPreviousUpload",value:function(t){this.url=t.uploadUrl||null,this._parallelUploadUrls=t.parallelUploadUrls||null,this._urlStorageKey=t.urlStorageKey}},{key:"start",value:function(){var t=this,e=this.file;if(e)if([Hy,Ny,zy].includes(this.options.protocol))if(this.options.endpoint||this.options.uploadUrl||this.url){var n=this.options.retryDelays;if(null==n||"[object Array]"===Object.prototype.toString.call(n)){if(this.options.parallelUploads>1)for(var r=0,i=["uploadUrl","uploadSize","uploadLengthDeferred"];r<i.length;r++){var o=i[r];if(this.options[o])return void this._emitError(new Error("tus: cannot use the ".concat(o," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(e,this.options).then(function(n){return ty(null==n?"No fingerprint was calculated meaning that the upload cannot be stored in the URL storage.":"Calculated fingerprint: ".concat(n)),t._fingerprint=n,t._source?t._source:t.options.fileReader.openFile(e,t.options.chunkSize)}).then(function(e){if(t._source=e,t.options.uploadLengthDeferred)t._size=null;else if(null!=t.options.uploadSize){if(t._size=Number(t.options.uploadSize),Number.isNaN(t._size))return void t._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(t._size=t._source.size,null==t._size)return void t._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));t.options.parallelUploads>1||null!=t._parallelUploadUrls?t._startParallelUpload():t._startSingleUpload()}).catch(function(e){t._emitError(e)})}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var e,n=this,r=this._size,i=0;this._parallelUploads=[];var o=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,a=null!==(e=this.options.parallelUploadBoundaries)&&void 0!==e?e:function(t,e){for(var n=Math.floor(t/e),r=[],i=0;i<e;i++)r.push({start:n*i,end:n*(i+1)});return r[e-1].end=t,r}(this._source.size,o);this._parallelUploadUrls&&a.forEach(function(t,e){t.uploadUrl=n._parallelUploadUrls[e]||null}),this._parallelUploadUrls=new Array(a.length);var s,l=a.map(function(e,o){var s=0;return n._source.slice(e.start,e.end).then(function(l){var u=l.value;return new Promise(function(l,h){var c=Uy(Uy({},n.options),{},{uploadUrl:e.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:Uy(Uy({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:l,onError:h,onProgress:function(t){i=i-s+t,s=t,n._emitProgress(i,r)},onUploadUrlAvailable:function(){n._parallelUploadUrls[o]=d.url,n._parallelUploadUrls.filter(function(t){return Boolean(t)}).length===a.length&&n._saveUploadInUrlStorage()}}),d=new t(u,c);d.start(),n._parallelUploads.push(d)})})});Promise.all(l).then(function(){(s=n._openRequest("POST",n.options.endpoint)).setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var t=Yy(n.options.metadata);return""!==t&&s.setHeader("Upload-Metadata",t),n._sendRequest(s,null)}).then(function(t){if(Zy(t.getStatus(),200)){var e=t.getHeader("Location");null!=e?(n.url=t_(n.options.endpoint,e),ty("Created upload at ".concat(n.url)),n._emitSuccess(t)):n._emitHttpError(s,t,"tus: invalid or missing Location header")}else n._emitHttpError(s,t,"tus: unexpected response while creating upload")}).catch(function(t){n._emitError(t)})}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?(ty("Resuming upload from previous URL: ".concat(this.url)),void this._resumeUpload()):null!=this.options.uploadUrl?(ty("Resuming upload from provided URL: ".concat(this.options.uploadUrl)),this.url=this.options.uploadUrl,void this._resumeUpload()):(ty("Creating a new upload"),void this._createUpload())}},{key:"abort",value:function(e){var n=this;if(null!=this._parallelUploads){var r,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Ry(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this._parallelUploads);try{for(i.s();!(r=i.n()).done;)r.value.abort(e)}catch(t){i.e(t)}finally{i.f()}}return null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),e&&null!=this.url?t.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()}):Promise.resolve()}},{key:"_emitHttpError",value:function(t,e,n,r){this._emitError(new Qv(n,r,t,e))}},{key:"_emitError",value:function(t){var e=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),Qy(t,this._retryAttempt,this.options))){var n=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout(function(){e.start()},n))}if("function"!=typeof this.options.onError)throw t;this.options.onError(t)}}},{key:"_emitSuccess",value:function(t){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess({lastResponse:t})}},{key:"_emitProgress",value:function(t,e){"function"==typeof this.options.onProgress&&this.options.onProgress(t,e)}},{key:"_emitChunkComplete",value:function(t,e,n){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(t,e,n)}},{key:"_createUpload",value:function(){var t=this;if(this.options.endpoint){var e=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?e.setHeader("Upload-Defer-Length","1"):e.setHeader("Upload-Length","".concat(this._size));var n,r=Yy(this.options.metadata);""!==r&&e.setHeader("Upload-Metadata",r),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,n=this._addChunkToRequest(e)):(this.options.protocol!==Ny&&this.options.protocol!==zy||e.setHeader("Upload-Complete","?0"),n=this._sendRequest(e,null)),n.then(function(n){if(Zy(n.getStatus(),200)){var r=n.getHeader("Location");if(null!=r){if(t.url=t_(t.options.endpoint,r),ty("Created upload at ".concat(t.url)),"function"==typeof t.options.onUploadUrlAvailable&&t.options.onUploadUrlAvailable(),0===t._size)return t._emitSuccess(n),void t._source.close();t._saveUploadInUrlStorage().then(function(){t.options.uploadDataDuringCreation?t._handleUploadResponse(e,n):(t._offset=0,t._performUpload())})}else t._emitHttpError(e,n,"tus: invalid or missing Location header")}else t._emitHttpError(e,n,"tus: unexpected response while creating upload")}).catch(function(n){t._emitHttpError(e,null,"tus: failed to create upload",n)})}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var t=this,e=this._openRequest("HEAD",this.url);this._sendRequest(e,null).then(function(n){var r=n.getStatus();if(!Zy(r,200))return 423===r?void t._emitHttpError(e,n,"tus: upload is currently locked; retry later"):(Zy(r,400)&&t._removeFromUrlStorage(),t.options.endpoint?(t.url=null,void t._createUpload()):void t._emitHttpError(e,n,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var i=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(i))t._emitHttpError(e,n,"tus: invalid or missing offset value");else{var o=Number.parseInt(n.getHeader("Upload-Length"),10);!Number.isNaN(o)||t.options.uploadLengthDeferred||t.options.protocol!==Hy?("function"==typeof t.options.onUploadUrlAvailable&&t.options.onUploadUrlAvailable(),t._saveUploadInUrlStorage().then(function(){if(i===o)return t._emitProgress(o,o),void t._emitSuccess(n);t._offset=i,t._performUpload()})):t._emitHttpError(e,n,"tus: invalid or missing length value")}}).catch(function(n){t._emitHttpError(e,null,"tus: failed to resume upload",n)})}},{key:"_performUpload",value:function(){var t,e=this;this._aborted||(this.options.overridePatchMethod?(t=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):t=this._openRequest("PATCH",this.url),t.setHeader("Upload-Offset","".concat(this._offset)),this._addChunkToRequest(t).then(function(n){Zy(n.getStatus(),200)?e._handleUploadResponse(t,n):e._emitHttpError(t,n,"tus: unexpected response while uploading chunk")}).catch(function(n){e._aborted||e._emitHttpError(t,null,"tus: failed to upload chunk at offset ".concat(e._offset),n)}))}},{key:"_addChunkToRequest",value:function(t){var e=this,n=this._offset,r=this._offset+this.options.chunkSize;return t.setProgressHandler(function(t){e._emitProgress(n+t,e._size)}),this.options.protocol===Hy?t.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===zy&&t.setHeader("Content-Type","application/partial-upload"),(r===Number.POSITIVE_INFINITY||r>this._size)&&!this.options.uploadLengthDeferred&&(r=this._size),this._source.slice(n,r).then(function(n){var r=n.value,i=n.done,o=null!=r&&r.size?r.size:0;e.options.uploadLengthDeferred&&i&&(e._size=e._offset+o,t.setHeader("Upload-Length","".concat(e._size)));var a=e._offset+o;return!e.options.uploadLengthDeferred&&i&&a!==e._size?Promise.reject(new Error("upload was configured with a size of ".concat(e._size," bytes, but the source is done after ").concat(a," bytes"))):null===r?e._sendRequest(t):(e.options.protocol!==Ny&&e.options.protocol!==zy||t.setHeader("Upload-Complete",i?"?1":"?0"),e._emitProgress(e._offset,e._size),e._sendRequest(t,r))})}},{key:"_handleUploadResponse",value:function(t,e){var n=Number.parseInt(e.getHeader("Upload-Offset"),10);if(Number.isNaN(n))this._emitHttpError(t,e,"tus: invalid or missing offset value");else{if(this._emitProgress(n,this._size),this._emitChunkComplete(n-this._offset,n,this._size),this._offset=n,n===this._size)return this._emitSuccess(e),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(t,e){var n=qy(t,e,this.options);return this._req=n,n}},{key:"_removeFromUrlStorage",value:function(){var t=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(e){t._emitError(e)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var t=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var e={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?e.parallelUploadUrls=this._parallelUploadUrls:e.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,e).then(function(e){t._urlStorageKey=e})}},{key:"_sendRequest",value:function(t){return Ky(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],r=[{key:"terminate",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=qy("DELETE",e,n);return Ky(r,null,n).then(function(t){if(204!==t.getStatus())throw new Qv("tus: unexpected response while terminating upload",null,r,t)}).catch(function(i){if(i instanceof Qv||(i=new Qv("tus: failed to terminate upload",i,r,null)),!Qy(i,0,n))throw i;var o=n.retryDelays[0],a=n.retryDelays.slice(1),s=Uy(Uy({},n),{},{retryDelays:a});return new Promise(function(t){return setTimeout(t,o)}).then(function(){return t.terminate(e,s)})})}}],n&&Gy(e.prototype,n),r&&Gy(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r}();function Yy(t){return Object.entries(t).map(function(t){var e=Oy(t,2),n=e[0],r=e[1];return"".concat(n," ").concat(Sy(String(r)))}).join(",")}function Zy(t,e){return t>=e&&t<e+100}function qy(t,e,n){var r=n.httpStack.createRequest(t,e);n.protocol===Ny?r.setHeader("Upload-Draft-Interop-Version","5"):n.protocol===zy?r.setHeader("Upload-Draft-Interop-Version","6"):r.setHeader("Tus-Resumable","1.0.0");for(var i=n.headers||{},o=0,a=Object.entries(i);o<a.length;o++){var s=Oy(a[o],2),l=s[0],u=s[1];r.setHeader(l,u)}if(n.addRequestId){var h="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});r.setHeader("X-Request-ID",h)}return r}function Ky(t,e,n){return Jy.apply(this,arguments)}function Jy(){var t;return t=My().mark(function t(e,n,r){var i;return My().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof r.onBeforeRequest){t.next=3;break}return t.next=3,r.onBeforeRequest(e);case 3:return t.next=5,e.send(n);case 5:if(i=t.sent,"function"!=typeof r.onAfterResponse){t.next=9;break}return t.next=9,r.onAfterResponse(e,i);case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}},t)}),Jy=function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){Dy(o,r,i,a,s,"next",t)}function s(t){Dy(o,r,i,a,s,"throw",t)}a(void 0)})},Jy.apply(this,arguments)}function Qy(t,e,n){return!(null==n.retryDelays||e>=n.retryDelays.length||null==t.originalRequest)&&(n&&"function"==typeof n.onShouldRetry?n.onShouldRetry(t,e,n):$y(t))}function $y(t){var e,n=t.originalResponse?t.originalResponse.getStatus():0;return(!Zy(n,400)||409===n||423===n)&&(e=!0,"undefined"!=typeof navigator&&!1===navigator.onLine&&(e=!1),e)}function t_(t,e){return new Iy(e,t).toString()}Vy.defaultOptions=Xy;var e_=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};function n_(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var t=r.response;e(t)},r.onerror=function(t){n(t)},r.open("GET",t),r.send()})}function r_(t){return r_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r_(t)}function i_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function o_(t){var e=function(t,e){if("object"!=r_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=r_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==r_(e)?e:e+""}var a_=function(){return i_(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._file=e,this.size=e.size},[{key:"slice",value:function(t,e){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return n=this._file.slice(t,e),new Promise(function(t,e){var r=new FileReader;r.onload=function(){var e=new Uint8Array(r.result);t({value:e})},r.onerror=function(t){e(t)},r.readAsArrayBuffer(n)});var n,r=this._file.slice(t,e),i=e>=this.size;return Promise.resolve({value:r,done:i})}},{key:"close",value:function(){}}])}();function s_(t){return s_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s_(t)}function l_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function u_(t){var e=function(t,e){if("object"!=s_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=s_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==s_(e)?e:e+""}function h_(t){return void 0===t?0:void 0!==t.size?t.size:t.length}var c_=function(){return l_(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1},[{key:"slice",value:function(t,e){return t<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(t,e)}},{key:"_readUntilEnoughDataOrDone",value:function(t,e){var n=this,r=e<=this._bufferOffset+h_(this._buffer);if(this._done||r){var i=this._getDataFromBuffer(t,e),o=null==i&&this._done;return Promise.resolve({value:i,done:o})}return this._reader.read().then(function(r){var i=r.value;return r.done?n._done=!0:void 0===n._buffer?n._buffer=i:n._buffer=function(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}throw new Error("Unknown data type")}(n._buffer,i),n._readUntilEnoughDataOrDone(t,e)})}},{key:"_getDataFromBuffer",value:function(t,e){t>this._bufferOffset&&(this._buffer=this._buffer.slice(t-this._bufferOffset),this._bufferOffset=t);var n=0===h_(this._buffer);return this._done&&n?null:this._buffer.slice(0,e-t)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function d_(t){return d_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d_(t)}function f_(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */f_=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:T(t,n,s)}),a}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function _(){}var b={};u(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(M([])));S&&S!==n&&r.call(S,a)&&(b=S);var k=_.prototype=v.prototype=Object.create(b);function x(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function C(t,e){function n(i,o,a,s){var l=c(t[i],t,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==d_(h)&&r.call(h,"__await")?e.resolve(h.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(h).then(function(t){u.value=t,a(u)},function(t){return n("throw",t,a,s)})}s(l.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e(function(e,i){n(t,r,e,i)})}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=d;return function(o,a){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=A(s,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=c(e,n,r);if("normal"===u.type){if(i=r.done?g:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=c(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(d_(e)+" is not iterable")}return y.prototype=_,i(k,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:y,configurable:!0}),y.displayName=u(_,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,u(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},x(C.prototype),u(C.prototype,s,function(){return this}),e.AsyncIterator=C,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new C(h(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},x(k),u(k,l,"Generator"),u(k,a,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function p_(t,e,n,r,i,o,a){try{var s=t[o](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(r,i)}function g_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,m_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function m_(t){var e=function(t,e){if("object"!=d_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=d_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==d_(e)?e:e+""}var v_=function(){return g_(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},[{key:"openFile",value:(t=f_().mark(function t(e,n){var r;return f_().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e_()||!e||void 0===e.uri){t.next=11;break}return t.prev=1,t.next=4,n_(e.uri);case 4:return r=t.sent,t.abrupt("return",new a_(r));case 8:throw t.prev=8,t.t0=t.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(t.t0));case 11:if("function"!=typeof e.slice||void 0===e.size){t.next=13;break}return t.abrupt("return",Promise.resolve(new a_(e)));case 13:if("function"!=typeof e.read){t.next=18;break}if(n=Number(n),Number.isFinite(n)){t.next=17;break}return t.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return t.abrupt("return",Promise.resolve(new c_(e,n)));case 18:return t.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return t.stop()}},t,null,[[1,8]])}),e=function(){var e=this,n=arguments;return new Promise(function(r,i){var o=t.apply(e,n);function a(t){p_(o,r,i,a,s,"next",t)}function s(t){p_(o,r,i,a,s,"throw",t)}a(void 0)})},function(t,n){return e.apply(this,arguments)})}]);var t,e}();function y_(t){return y_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y_(t)}function __(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function w_(t){var e=function(t,e){if("object"!=y_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=y_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==y_(e)?e:e+""}var S_=function(){return b_(function t(){__(this,t)},[{key:"createRequest",value:function(t,e){return new k_(t,e)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),k_=function(){return b_(function t(e,n){__(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,n,!0),this._method=e,this._url=n,this._headers={}},[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(t,e){this._xhr.setRequestHeader(t,e),this._headers[t]=e}},{key:"getHeader",value:function(t){return this._headers[t]}},{key:"setProgressHandler",value:function(t){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(e){e.lengthComputable&&t(e.loaded)})}},{key:"send",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(n,r){t._xhr.onload=function(){n(new x_(t._xhr))},t._xhr.onerror=function(t){r(t)},t._xhr.send(e)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),x_=function(){return b_(function t(e){__(this,t),this._xhr=e},[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(t){return this._xhr.getResponseHeader(t)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function C_(t){return C_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C_(t)}function T_(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,A_(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function A_(t){var e=function(t,e){if("object"!=C_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=C_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==C_(e)?e:e+""}var E_=!1;try{E_="localStorage"in window;var P_="tusSupport",I_=localStorage.getItem(P_);localStorage.setItem(P_,I_),null===I_&&localStorage.removeItem(P_)}catch(t){if(t.code!==t.SECURITY_ERR&&t.code!==t.QUOTA_EXCEEDED_ERR)throw t;E_=!1}var M_=E_,D_=function(){return T_(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},[{key:"findAllUploads",value:function(){var t=this._findEntries("tus::");return Promise.resolve(t)}},{key:"findUploadsByFingerprint",value:function(t){var e=this._findEntries("tus::".concat(t,"::"));return Promise.resolve(e)}},{key:"removeUpload",value:function(t){return localStorage.removeItem(t),Promise.resolve()}},{key:"addUpload",value:function(t,e){var n=Math.round(1e12*Math.random()),r="tus::".concat(t,"::").concat(n);return localStorage.setItem(r,JSON.stringify(e)),Promise.resolve(r)}},{key:"_findEntries",value:function(t){for(var e=[],n=0;n<localStorage.length;n++){var r=localStorage.key(n);if(0===r.indexOf(t))try{var i=JSON.parse(localStorage.getItem(r));i.urlStorageKey=r,e.push(i)}catch(t){}}return e}}])}();function O_(t){return O_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O_(t)}function L_(t,e,n){return n&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,H_(r.key),r)}}(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function R_(t,e,n){return e=F_(e),function(t,e){if(e&&("object"===O_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,B_()?Reflect.construct(e,n||[],F_(t).constructor):e.apply(t,n))}function B_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(B_=function(){return!!t})()}function F_(t){return F_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F_(t)}function U_(t,e){return U_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},U_(t,e)}function W_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function G_(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?W_(Object(n),!0).forEach(function(e){j_(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W_(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function j_(t,e,n){return(e=H_(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function H_(t){var e=function(t,e){if("object"!=O_(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=O_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==O_(e)?e:e+""}var N_,z_=G_(G_({},Vy.defaultOptions),{},{httpStack:new S_,fileReader:new v_,urlStorage:M_?new D_:new iy,fingerprint:function(t,e){return e_()?Promise.resolve(function(t,e){var n=t.exif?function(t){var e=0;if(0===t.length)return e;for(var n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return e}(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",n,e.endpoint].join("/")}(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}}),X_=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),R_(this,e,[t,n=G_(G_({},z_),n)])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U_(t,e)}(e,t),L_(e,0,[{key:"terminate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=G_(G_({},z_),e),Vy.terminate(t,e)}}])}(Vy),V_="function"==typeof XMLHttpRequest&&"function"==typeof Blob&&"function"==typeof Blob.prototype.slice,Y_=Object.freeze({__proto__:null,DefaultHttpStack:S_,DetailedError:Qv,Upload:X_,canStoreURLs:M_,defaultOptions:z_,enableDebugLog:function(){$v=!0},isSupported:V_});if(window.STARMUS_EDITOR_DATA?(window.STARMUS_BOOTSTRAP=window.STARMUS_EDITOR_DATA,window.STARMUS_BOOTSTRAP.pageType="editor"):window.STARMUS_RERECORDER_DATA?(window.STARMUS_BOOTSTRAP=window.STARMUS_RERECORDER_DATA,window.STARMUS_BOOTSTRAP.pageType="rerecorder"):window.STARMUS_RECORDER_DATA&&(window.STARMUS_BOOTSTRAP=window.STARMUS_RECORDER_DATA,window.STARMUS_BOOTSTRAP.pageType="recorder"),window.Starmus_DisableOptionalNodes=!0,window.Starmus_DisableOptionalNodes){var Z_,q_=null===(Z_=window.AudioContext||window.webkitAudioContext)||void 0===Z_?void 0:Z_.prototype;q_&&(q_.createConstantSource&&(q_.createConstantSource=function(){throw new Error("ConstantSourceNode disabled for stability.")}),q_.createIIRFilter&&(q_.createIIRFilter=function(){throw new Error("IIRFilterNode disabled for stability.")}))}function K_(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{window.StarmusHooks&&"function"==typeof window.StarmusHooks.doAction&&window.StarmusHooks.doAction("starmus_event",{instanceId:e.instanceId||null,event:t,severity:e.severity||"info",message:e.message||"",data:e.data||{}})}catch(t){console.warn("[Starmus] Global telemetry emit failed:",t)}}function J_(t){return Q_.apply(this,arguments)}function Q_(){return(Q_=Eh(Rh().m(function t(e){return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e){t.n=1;break}return t.a(2);case 1:if("suspended"!==e.state){t.n=6;break}return t.p=2,t.n=3,e.resume();case 3:t.n=5;break;case 4:t.p=4,t.v;case 5:console.log("[Starmus] AudioContext resumed");case 6:return t.a(2)}},t,null,[[2,4]])}))).apply(this,arguments)}function $_(){try{return navigator.deviceMemory||null}catch(t){return null}}function tb(){try{return navigator.hardwareConcurrency||null}catch(t){return null}}function eb(t){var e=t.capabilities||{},n=t.network||{};if(/\bCrOS\b|Chrome OS/i.test(navigator.userAgent))return"A";if(!e.mediaRecorder||!e.webrtc)return"C";var r=$_(),i=tb();if(null!=r&&r<1)return"C";if(null!=i){if(1===i)return"C";if(2===i)return"B"}return/wv|Crosswalk|Android WebView|Opera Mini/i.test(navigator.userAgent)?"C":"2g"===n.effectiveType||"slow-2g"===n.effectiveType||null!=r&&r<2?"B":"A"}function nb(t){return rb.apply(this,arguments)}function rb(){return(rb=Eh(Rh().m(function t(e){var n,r;return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:if("C"!==e){t.n=1;break}return t.a(2,"C");case 1:if(!navigator.storage||!navigator.storage.estimate){t.n=6;break}return t.p=2,t.n=3,navigator.storage.estimate();case 3:if(n=t.v,!((r=(n.quota||0)/1024/1024)&&r<80)){t.n=4;break}return t.a(2,"C");case 4:t.n=6;break;case 5:t.p=5,t.v;case 6:if(!navigator.permissions||!navigator.permissions.query){t.n=11;break}return t.p=7,t.n=8,navigator.permissions.query({name:"microphone"});case 8:if("denied"!==t.v.state){t.n=9;break}return t.a(2,"C");case 9:t.n=11;break;case 10:t.p=10,t.v;case 11:return t.a(2,e)}},t,null,[[7,10],[2,5]])}))).apply(this,arguments)}function ib(t,e){var n,r=t.getState(),i=r.env||{},o=r.calibration||{},a=r.source||{},s=function(t,n){var r=e.querySelector('[name="'.concat(t,'"]'));r&&(r.value=n)};i&&Object.keys(i).length>0&&s("_starmus_env",JSON.stringify(i)),o.complete&&s("_starmus_calibration",JSON.stringify(o)),a.transcript&&s("first_pass_transcription",a.transcript.trim()),a.waveform_data&&s("waveform_json",JSON.stringify(a.waveform_data)),s("user_agent",navigator.userAgent||""),s("device_fingerprint",(null==i||null===(n=i.identifiers)||void 0===n?void 0:n.visitorId)||"")}window.tus=Y_,(N_="undefined"!=typeof window?window:globalThis).Starmus||(N_.Starmus={}),N_.Peaks&&(N_.Starmus.Peaks=N_.Peaks),window.SPARXSTAR=window.SPARXSTAR||{},window.SPARXSTAR.StarmusReady=!0,Lf().then(function(){return console.log("[Starmus] Offline queue initialized")}).catch(function(t){return console.error("[Starmus] Offline queue init failed:",t)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),window.StarmusApp=window.StarmusApp||{},window.StarmusApp.isRecordingSupported=function(){try{var t=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),e=!!window.MediaRecorder,n=!(!window.AudioContext&&!window.webkitAudioContext);return t&&e&&n}catch(t){return!1}};var ob=new Map;function ab(t,e){return sb.apply(this,arguments)}function sb(){return sb=Eh(Rh().m(function t(e,n){var r,i,o,a,s,l,u,h;return Rh().w(function(t){for(;;)switch(t.n){case 0:if((r=n.getAttribute("data-starmus-id"))||(r="starmus_"+Date.now()+"_"+Math.random().toString(16).slice(2),n.setAttribute("data-starmus-id",r)),!ob.has(r)){t.n=1;break}return t.a(2,r);case 1:return i=eb(e),t.n=2,nb(i);case 2:return i=t.v,console.log("[Starmus] Instance ".concat(r,"  Tier ").concat(i)),K_("TIER_ASSIGN",{instanceId:r,severity:"info",message:"Tier ".concat(i," assigned"),data:{tier:i}}),o=Ch({instanceId:r,env:e,tier:i}),a={step1:n.querySelector(".starmus-step-1"),step2:n.querySelector(".starmus-step-2"),continueBtn:n.querySelector('[data-starmus-action="continue"]'),messageBox:n.querySelector("[data-starmus-message-box]"),setupMicBtn:n.querySelector('[data-starmus-action="setup-mic"]'),setupContainer:n.querySelector("[data-starmus-setup-container]"),recordBtn:n.querySelector('[data-starmus-action="record"]'),pauseBtn:n.querySelector('[data-starmus-action="pause"]'),resumeBtn:n.querySelector('[data-starmus-action="resume"]'),stopBtn:n.querySelector('[data-starmus-action="stop"]'),submitBtn:n.querySelector('[data-starmus-action="submit"]'),resetBtn:n.querySelector('[data-starmus-action="reset"]'),fileInput:n.querySelector('input[type="file"]'),statusEl:n.querySelector("[data-starmus-status]"),progressEl:n.querySelector("[data-starmus-progress]"),progressWrap:n.querySelector(".starmus-progress-wrap"),recorderContainer:n.querySelector("[data-starmus-recorder-container]"),fallbackContainer:n.querySelector("[data-starmus-fallback-container]"),timer:n.querySelector("[data-starmus-timer]"),timerElapsed:n.querySelector(".starmus-timer-elapsed"),durationProgress:n.querySelector("[data-starmus-duration-progress]"),volumeMeter:n.querySelector("[data-starmus-volume-meter]"),waveformBox:n.querySelector("[data-starmus-waveform]"),reviewControls:n.querySelector(".starmus-review-controls"),playBtn:n.querySelector('[data-starmus-action="play"]'),transcriptBox:n.querySelector("[data-starmus-transcript]")},"C"===i&&(a.recorderContainer&&(a.recorderContainer.style.display="none"),a.fallbackContainer&&(a.fallbackContainer.style.display="block"),null!==(s=window.StarmusHooks)&&void 0!==s&&s.doAction&&window.StarmusHooks.doAction("starmus_tier_c_revealed",r,e)),tp(o,a),Cp(o,r,e),"C"!==i&&iv(o,r),ob.set(r,{store:o,form:n,elements:a,tier:i}),o.subscribe(function(){var t=o.getState();if("C"===t.tier&&"C"!==i&&!0===t.fallbackActive){var e=i;i="C",a.recorderContainer&&(a.recorderContainer.style.display="none"),a.fallbackContainer&&(a.fallbackContainer.style.display="block"),console.warn("[Starmus] Instance ".concat(r," downgraded from ").concat(e,"  C")),K_("TIER_DOWNGRADE",{instanceId:r,severity:"warning",message:"Runtime tier downgrade from ".concat(e," to C"),data:{previousTier:e,currentTier:"C",reason:"audio_graph_failure"}})}}),l="A"===i&&!(!window.SpeechRecognition&&!window.webkitSpeechRecognition),o.dispatch({type:"starmus/init",payload:{instanceId:r,env:e,tier:i,speechSupported:l}}),a.continueBtn&&a.continueBtn.addEventListener("click",function(t){console.log("[Starmus Integrator] Continue button clicked!"),t.preventDefault();var e=a.step1;if(e){var i=e.querySelector('[name="starmus_title"]'),s=e.querySelector('[name="starmus_language"]'),l=e.querySelector('[name="starmus_recording_type"]'),u=e.querySelector('[name="agreement_to_terms"]'),h=a.messageBox,c=[];if(i&&i.value.trim()||c.push("Title"),s&&s.value.trim()||c.push("Language"),l&&l.value.trim()||c.push("Recording Type"),u&&u.checked||c.push("Consent"),c.length>0)h&&(h.textContent="Missing: "+c.join(", "),h.style.display="block");else if(h&&(h.textContent="",h.style.display="none"),console.log("[Starmus Integrator] Dispatching step-continue action"),o.dispatch({type:"starmus/ui/step-continue"}),console.log("[Starmus Integrator] Step-continue dispatched, current state:",o.getState()),window.innerWidth<768){var d=n.closest(".starmus-recorder-form")||n;d.classList.add("starmus-immersive"),document.body.classList.add("starmus-lock-scroll"),history.pushState({starmusMode:"immersive",instanceId:r},"","#recording-mode");var f=function(){d.classList.remove("starmus-immersive"),document.body.classList.remove("starmus-lock-scroll");var t=d.querySelector(".starmus-close-immersive");t&&t.remove(),window.removeEventListener("popstate",f)};if(window.addEventListener("popstate",f),!d.querySelector(".starmus-close-immersive")){var p=document.createElement("button");p.innerHTML="&times;",p.className="starmus-close-immersive",p.setAttribute("aria-label","Close fullscreen mode"),p.onclick=function(t){t.preventDefault(),history.back()},d.style.position="relative",d.insertBefore(p,d.firstChild)}}}else console.log("[Starmus Integrator] No step1 element found")}),"true"===n.dataset.starmusRerecord&&o.dispatch({type:"starmus/ui/step-continue"}),"C"!==i&&(a.setupMicBtn&&a.setupMicBtn.addEventListener("click",function(){var t=Eh(Rh().m(function t(e){var n,i;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(e.preventDefault(),!(n=window.AudioContext||window.webkitAudioContext)){t.n=1;break}return i=new n({latencyHint:"interactive"}),t.n=1,J_(i);case 1:kh.dispatch("setup-mic",{},{instanceId:r});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),a.recordBtn&&a.recordBtn.addEventListener("click",function(){var t=Eh(Rh().m(function t(e){var n,i;return Rh().w(function(t){for(;;)switch(t.n){case 0:if(e.preventDefault(),!(n=window.AudioContext||window.webkitAudioContext)){t.n=1;break}return i=new n({latencyHint:"interactive"}),t.n=1,J_(i);case 1:kh.dispatch("start-recording",{},{instanceId:r});case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),a.pauseBtn&&a.pauseBtn.addEventListener("click",function(t){t.preventDefault(),kh.dispatch("pause-mic",{},{instanceId:r})}),a.resumeBtn&&a.resumeBtn.addEventListener("click",function(t){t.preventDefault(),kh.dispatch("resume-mic",{},{instanceId:r})}),a.stopBtn&&a.stopBtn.addEventListener("click",function(t){t.preventDefault(),kh.dispatch("stop-mic",{},{instanceId:r})})),a.fileInput&&a.fileInput.addEventListener("change",function(){var t,e=null===(t=a.fileInput.files)||void 0===t?void 0:t[0];e&&kh.dispatch("attach-file",{file:e},{instanceId:r})}),n.addEventListener("submit",function(t){t.preventDefault(),ib(o,n);var e=new FormData(n),i={};e.forEach(function(t,e){return i[e]=t}),kh.dispatch("submit",{formFields:i},{instanceId:r})}),a.resetBtn&&a.resetBtn.addEventListener("click",function(t){t.preventDefault(),o.dispatch({type:"starmus/reset"}),kh.dispatch("reset",{},{instanceId:r})}),u=null,h=null,a.playBtn&&a.playBtn.addEventListener("click",function(t){var e;t.preventDefault();var n=o.getState().source||{},r=n.blob||n.file;r&&(u||(u=new Audio,h=URL.createObjectURL(r),u.src=h,u.addEventListener("ended",function(){o.dispatch({type:"starmus/recorder-playback-state",payload:{isPlaying:!1}})})),(null===(e=o.getState().recorder)||void 0===e?void 0:e.isPlaying)?(u.pause(),o.dispatch({type:"starmus/recorder-playback-state",payload:{isPlaying:!1}})):u.play().then(function(){o.dispatch({type:"starmus/recorder-playback-state",payload:{isPlaying:!0}})}).catch(function(t){return console.error("[Starmus] Playback failed:",t)}))}),kh.subscribe("reset",function(t,e){if(e.instanceId===r){if(u)try{u.pause()}catch(t){}h&&URL.revokeObjectURL(h),u=null,h=null}}),t.a(2,r)}},t)})),sb.apply(this,arguments)}function lb(t){return ub.apply(this,arguments)}function ub(){return(ub=Eh(Rh().m(function t(e){var n,r,i,o,a,s;return Rh().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=e.detail||{},null!=(r=document.querySelectorAll('form[data-starmus="recorder"]'))&&r.length){t.n=1;break}return t.a(2);case 1:i=Mh(r),t.p=2,i.s();case 3:if((o=i.n()).done){t.n=5;break}return a=o.value,t.n=4,ab(n,a);case 4:t.n=3;break;case 5:t.n=7;break;case 6:t.p=6,s=t.v,i.e(s);case 7:return t.p=7,i.f(),t.f(7);case 8:return t.a(2)}},t,null,[[2,6,7,8]])}))).apply(this,arguments)}function hb(){var t=function(){try{return navigator.connection||navigator.mozConnection||navigator.webkitConnection||null}catch(t){return null}}(),e=t?{effectiveType:t.effectiveType||"unknown",downlink:t.downlink||null,saveData:t.saveData||!1}:{effectiveType:"unknown",downlink:null,saveData:!1},n={browser:{userAgent:navigator.userAgent},device:{type:/mobile|android|iphone|ipad/i.test(navigator.userAgent)?"mobile":"desktop",memory:$_(),concurrency:tb()},capabilities:{webrtc:!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),mediaRecorder:!(!navigator.mediaDevices||!window.MediaRecorder),indexedDB:!!window.indexedDB},network:e};K_("E_ENV_FALLBACK_INIT",{severity:"warning",message:"Environment-ready event not fired; using fallback env",data:{fallbackEnv:n}}),lb({detail:n})}var cb=!1,db=null;return document.addEventListener("sparxstar:environment-ready",function(t){cb=!0,db&&(clearTimeout(db),db=null),lb(t)}),db=setTimeout(function(){cb||(console.warn("[Starmus] Using fallback initialization"),hb())},2e3),"undefined"!=typeof window&&(window.STARMUS=window.STARMUS||{},window.STARMUS.instances=ob,window.StarmusHooks=window.StarmusHooks||{doAction:kh.dispatch},window.CommandBus=kh),window.Peaks=sr,window.createStore=Ch,window.initCore=Cp,window.initUI=tp,window.initRecorder=iv,window.StarmusTus=yf,window.StarmusTranscriptController=sv,window.StarmusOfflineQueue=Lf,window.StarmusQueueSubmission=Bf,window.initOffline=Gf,window.initAutoMetadata=_v,window.StarmusIntegrator=!0,window.StarmusRecorder=iv,window.initStarmusRecorder=iv,console.log("[Starmus] Runtime globals wired"),t.StarmusTranscript=sv,t.StarmusTus=yf,t.createStore=Ch,t.getOfflineQueue=Lf,t.initAutoMetadata=_v,t.initCore=Cp,t.initOffline=Gf,t.initRecorder=iv,t.initUI=tp,t.queueSubmission=Bf,t}({});
