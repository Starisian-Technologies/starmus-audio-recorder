!function(){"use strict";!function(t,e){t.STARMUS||(t.STARMUS={});var n=t.STARMUS,s=n.StateStore,r=n.CommandBus,a=n.UI,i=n.Recorder,c=n.Core;n.instances||(n.instances={}),n.getInstanceStore=function(t){var e=n.instances[t];return e?e.store:null},r&&r.subscribe("reset",function(t){var e=n.getInstanceStore(t.meta.instanceId);e&&e.dispatch({type:"starmus/reset"})}),e.addEventListener("sparxstar:environment-ready",function(o){var u=o.detail||{},d=e.querySelectorAll('form[data-starmus="recorder"]');d&&d.length&&Array.prototype.forEach.call(d,function(e){!function(e,o){var u=o.getAttribute("data-starmus-id");u||(u="starmus_"+Date.now()+"_"+Math.random().toString(16).slice(2),o.setAttribute("data-starmus-id",u));var d=s.create(),l={recordBtn:o.querySelector('[data-starmus-action="record"]'),stopBtn:o.querySelector('[data-starmus-action="stop"]'),submitBtn:o.querySelector('[data-starmus-action="submit"]'),resetBtn:o.querySelector('[data-starmus-action="reset"]'),fileInput:o.querySelector('input[type="file"]'),statusEl:o.querySelector("[data-starmus-status]"),progressEl:o.querySelector("[data-starmus-progress]")};a.initInstance(d,l),i.init(d),c.init(d),n.instances[u]={store:d,form:o,elements:l},d.dispatch({type:"starmus/init",payload:{instanceId:u,env:e,speechSupported:!(!t.SpeechRecognition&&!t.webkitSpeechRecognition)}}),l.recordBtn&&l.recordBtn.addEventListener("click",function(){r.dispatch("start-mic",{},{instanceId:u})}),l.stopBtn&&l.stopBtn.addEventListener("click",function(){r.dispatch("stop-mic",{},{instanceId:u})}),l.fileInput&&l.fileInput.addEventListener("change",function(){l.fileInput.files&&l.fileInput.files.length>0&&r.dispatch("attach-file",{file:l.fileInput.files[0]},{instanceId:u})}),o.addEventListener("submit",function(t){t.preventDefault();var e=new FormData(o),n={};e.forEach(function(t,e){n[e]=t}),r.dispatch("submit",{formFields:n},{instanceId:u})}),l.resetBtn&&l.resetBtn.addEventListener("click",function(){r.dispatch("reset",{},{instanceId:u})})}(u,e)})},{once:!0})}(window,document)}();
