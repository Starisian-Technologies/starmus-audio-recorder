document.addEventListener("DOMContentLoaded",(()=>{"use strict";const e="[Starmus Submissions]",t=void 0!==window.STARMUS_DEBUG&&window.STARMUS_DEBUG,o=document.querySelectorAll("[data-enabled-recorder]");0!==o.length&&o.forEach((o=>{const r=o.id.substring(21),s=document.getElementById(r);if(!s)return void console.error(e,`Form element not found for instance ID: ${r}.`);const n=s.querySelector(`#starmus_step_1_${r}`),i=s.querySelector(`#starmus_step_2_${r}`),a=s.querySelector(`#starmus_continue_btn_${r}`);if(!n||!i||!a)return console.error(e,"Multi-step form elements are missing. Defaulting to show recorder."),n&&(n.style.display="none"),i&&(i.style.display="block"),void initializeRecorder(r);function transitionToStep2(){const e=s.querySelector(`#starmus_step_1_status_${r}`);e&&(e.style.display="none"),a&&(a.disabled=!1),n.style.display="none",i.style.display="block";const t=s.querySelector(`#sparxstar_audioRecorderHeading_${r}`);t&&(t.setAttribute("tabindex","-1"),t.focus()),initializeRecorder(r)}function initializeRecorder(o){"function"==typeof StarmusAudioRecorder?.init?StarmusAudioRecorder.init({formInstanceId:o}).then((r=>{r&&t&&console.log(e,`Recorder module initialized for ${o}.`)})):console.error(e,"StarmusAudioRecorder module is not available.")}a.addEventListener("click",(function(o){o.preventDefault();const n=s.querySelector(`#starmus_step_1_error_${r}`),i=s.querySelector(`#starmus_step_1_status_${r}`),l=[{id:`audio_title_${r}`,name:"Title",type:"text"},{id:`language_${r}`,name:"Language",type:"select"},{id:`recording_type_${r}`,name:"Recording Type",type:"select"},{id:`audio_consent_${r}`,name:"Consent",type:"checkbox"}];n.style.display="none",n.textContent="",l.forEach((e=>document.getElementById(e.id)?.removeAttribute("aria-describedby")));for(const e of l){const t=document.getElementById(e.id);if(!t)continue;let o=!0;if("text"===e.type&&(o=""!==t.value.trim()),"select"===e.type&&(o=""!==t.value),"checkbox"===e.type&&(o=t.checked),!o)return n.textContent=`Please complete the "${e.name}" field.`,n.style.display="block",n.id=`starmus_step_1_error_${r}`,t.focus(),void t.setAttribute("aria-describedby",n.id)}i&&(i.style.display="block"),a.disabled=!0,"geolocation"in navigator?navigator.geolocation.getCurrentPosition((o=>{const n=s.querySelector(`#gps_latitude_${r}`),i=s.querySelector(`#gps_longitude_${r}`);n&&(n.value=o.coords.latitude),i&&(i.value=o.coords.longitude),t&&console.log(e,"GPS Location captured."),transitionToStep2()}),(t=>{console.warn(e,`Geolocation error (${t.code}): ${t.message}`),transitionToStep2()})):(console.log(e,"Geolocation is not available."),transitionToStep2())})),s.addEventListener("submit",(async e=>{e.preventDefault();const t=document.getElementById(`submit_button_${r}`),o=document.getElementById(`sparxstar_loader_overlay_${r}`);if("function"==typeof StarmusAudioRecorder?.submit){t&&(t.disabled=!0),o&&o.classList.remove("sparxstar_visually_hidden");const e=await StarmusAudioRecorder.submit(r);o&&o.classList.add("sparxstar_visually_hidden"),e.success?e.redirectUrl?window.location.href=e.redirectUrl:(alert("Successfully submitted!"),s.reset(),"function"==typeof StarmusAudioRecorder?.cleanup&&StarmusAudioRecorder.cleanup(r)):t&&(t.disabled=!1)}else alert("Error: Submission handler is not available. Please contact support.")}))}))}));
//# sourceMappingURL=starmus-audio-recorder-submission.min.js.map