document.addEventListener("DOMContentLoaded",(()=>{"use strict";const e={};window;async function t(){}const o=document.createElement("div");async function n(){}document.body.appendChild(o),document.getElementById("starmus_queue_retry")?.addEventListener("click",t),window.addEventListener("online",t),n(),navigator.onLine&&setTimeout(t,2e3);const r=document.querySelectorAll("[data-enabled-recorder]");0!==r.length&&r.forEach((t=>{const o=t.id.substring(21),r=document.getElementById(o);if(!r)return console.error(e.LOG_PREFIX,`Form element not found for instance ID: ${o}.`);const s=r.querySelector(`#starmus_step_1_${o}`),a=r.querySelector(`#starmus_step_2_${o}`),i=r.querySelector(`#starmus_continue_btn_${o}`);if(!s||!a||!i)return console.error(e.LOG_PREFIX,"Multi-step form elements are missing. Defaulting to show recorder."),s&&(s.style.display="none"),a&&(a.style.display="block"),void l(o);function d(){const e=r.querySelector(`#starmus_step_1_status_${o}`);e&&(e.style.display="none"),i&&(i.disabled=!1),s.style.display="none",a.style.display="block";const t=r.querySelector(`#sparxstar_audioRecorderHeading_${o}`);t&&(t.setAttribute("tabindex","-1"),t.focus()),l(o)}function l(t){"function"==typeof StarmusAudioRecorder?.init?StarmusAudioRecorder.init({formInstanceId:t}).then((o=>{o&&e.DEBUG_MODE&&console.log(e.LOG_PREFIX,`Recorder module initialized for ${t}.`)})):console.error(e.LOG_PREFIX,"StarmusAudioRecorder module is not available.")}i.addEventListener("click",(function(t){t.preventDefault();const n=r.querySelector(`#starmus_step_1_error_${o}`),s=r.querySelector(`#starmus_step_1_status_${o}`),a=[{id:`audio_title_${o}`,name:"Title",type:"text"},{id:`language_${o}`,name:"Language",type:"select"},{id:`recording_type_${o}`,name:"Recording Type",type:"select"},{id:`audio_consent_${o}`,name:"Consent",type:"checkbox"}];n.style.display="none",n.textContent="",a.forEach((e=>document.getElementById(e.id)?.removeAttribute("aria-describedby")));for(const e of a){const t=document.getElementById(e.id);if(!t)continue;let r=!0;if("text"===e.type&&(r=""!==t.value.trim()),"select"===e.type&&(r=""!==t.value),"checkbox"===e.type&&(r=t.checked),!r)return n.textContent=`Please complete the "${e.name}" field.`,n.style.display="block",n.id=`starmus_step_1_error_${o}`,t.focus(),void t.setAttribute("aria-describedby",n.id)}s&&(s.style.display="block"),i.disabled=!0,"geolocation"in navigator?navigator.geolocation.getCurrentPosition((t=>{r.querySelector(`#gps_latitude_${o}`).value=t.coords.latitude,r.querySelector(`#gps_longitude_${o}`).value=t.coords.longitude,e.DEBUG_MODE&&console.log(e.LOG_PREFIX,"GPS Location captured."),d()}),(t=>{console.warn(e.LOG_PREFIX,`Geolocation error (${t.code}): ${t.message}`),d()})):(console.log(e.LOG_PREFIX,"Geolocation is not available."),d())})),r.addEventListener("submit",(async t=>{t.preventDefault();const s=document.getElementById(`audio_uuid_${o}`),a=document.getElementById(`audio_file_${o}`),i=document.getElementById(`submit_button_${o}`),d=document.getElementById(`sparxstar_loader_overlay_${o}`);if(!s?.value||!a?.files?.length)return void alert("Error: No audio file has been recorded to submit.");i&&(i.disabled=!0),d&&d.classList.remove("sparxstar_visually_hidden");const l=new FormData(r),c={};l.forEach(((e,t)=>{e instanceof File||(c[t]=e)}));const u={id:s.value,meta:c,audio:a.files[0],restUrl:starmusFormData?.rest_url,audioField:a.name,uploadedBytes:0};if(e.DEBUG_MODE&&console.log(e.LOG_PREFIX,"--- Submission Data ---",u),!u.restUrl)return alert("Error: The submission endpoint is not configured. Please contact support."),i&&(i.disabled=!1),void(d&&d.classList.add("sparxstar_visually_hidden"));const m=await async function(e,t){}();d&&d.classList.add("sparxstar_visually_hidden"),m.success?m.redirectUrl?window.location.href=m.redirectUrl:(alert("Successfully submitted!"),r.reset(),"function"==typeof StarmusAudioRecorder?.cleanup&&StarmusAudioRecorder.cleanup(o)):m.queued?(alert("Connection issue. Your recording has been saved and will be uploaded automatically when you are back online."),r.reset(),"function"==typeof StarmusAudioRecorder?.cleanup&&StarmusAudioRecorder.cleanup(o),await n()):(alert("An unknown error occurred during upload. Please try again."),i&&(i.disabled=!1))}))}))}));
//# sourceMappingURL=starmus-audio-recorder-submissions.min.js.map
